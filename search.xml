<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Ajax</title>
    <url>/2022/02/17/Ajax/</url>
    <content><![CDATA[<h1 id="Ajax"><a href="#Ajax" class="headerlink" title="Ajax"></a>Ajax</h1><h2 id="一、概念"><a href="#一、概念" class="headerlink" title="一、概念"></a>一、概念</h2><p>Ajax即<strong>A</strong>synchronous <strong>J</strong>avascript <strong>A</strong>nd <strong>X</strong>ML（异步JavaScript和<a href="https://baike.baidu.com/item/XML/86251">XML</a>）</p>
<p>​        使用Ajax的最大优点，就是能在不更新整个页面的前提下维护数据。这使得Web应用程序更为迅捷地回应用户动作，并避免了在网络上发送那些没有改变的信息。</p>
<p>​        Ajax不需要任何浏览器插件，但需要用户<strong>允许JavaScript在浏览器上执行</strong>。</p>
<ul>
<li><p>同步和异步的概念</p>
<p><img src="/2022/02/17/Ajax/1.png" alt></p>
</li>
</ul>
<h2 id="二、实现方式"><a href="#二、实现方式" class="headerlink" title="二、实现方式"></a>二、实现方式</h2><ol>
<li><p>原生的js实现方式(了解)</p>
<p>页面代码</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>$Title$<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;res/js/jquery-3.4.1.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;res/js/bootstrap.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;resources/css/bootstrap.min.css&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">abc</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">//发送异步请求</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">//创建核心参数xhttp</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> xhttp;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest) &#123;</span></span><br><span class="line"><span class="javascript">        xhttp = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// code for IE6, IE5</span></span></span><br><span class="line"><span class="javascript">        xhttp = <span class="keyword">new</span> ActiveXObject(<span class="string">&quot;Microsoft.XMLHTTP&quot;</span>);</span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript">      <span class="comment">//1.建立链接 xhttp.open(&quot;GET&quot;,&quot;text.txt&quot;,true);</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">//参数1：请求方式</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">//参数2：请求路径（URL）（get方式参数在URL后拼接，post在发送请求时传入）</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">//参数3：请求同步还是异步（true为异步，false为同步）</span></span></span><br><span class="line"><span class="javascript">      xhttp.open(<span class="string">&quot;GET&quot;</span>,<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/nicepage?name=tom&quot;</span>,<span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">      <span class="comment">//2.发送请求xhttp.send()----如果是post方法可以在次传递参数send(&quot;name=123&quot;)</span></span></span><br><span class="line"><span class="javascript">      xhttp.send();</span></span><br><span class="line"><span class="javascript">      <span class="comment">//3.接受并处理服务器请求</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">//判断xhttp对象就绪状态是否改变</span></span></span><br><span class="line"><span class="javascript">      xhttp.onreadystatechange=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//判断就绪状态是否为4（请求已完成，响应就绪），status200表示响应成功就绪</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(xhttp.readyState==<span class="number">4</span>&amp;&amp;xhttp.status==<span class="number">200</span>)&#123;</span></span><br><span class="line"><span class="javascript">          $(<span class="string">&quot;#text1&quot;</span>).val(xhttp.responseText);</span></span><br><span class="line"><span class="javascript">          $(<span class="string">&quot;#p1&quot;</span>).html(xhttp.responseText);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      $(<span class="string">&quot;#b1&quot;</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        abc();</span></span><br><span class="line"><span class="javascript">      &#125;);</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;b1&quot;</span>&gt;</span>点击链接<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;text1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;p1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>jQuery实现方式(三种方式)</p>
<ul>
<li><p>$.ajax()</p>
<ul>
<li><p>语法：$.ajax(url,[settings])；</p>
<ul>
<li><p>一般写法$.ajax({键值对})；</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">eg:$.ajax(&#123;</span><br><span class="line">键值对</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="/2022/02/17/Ajax/2.png" alt></p>
</li>
</ul>
</li>
<li><p>实例</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">abc</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">            <span class="attr">url</span>:<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/nicepage&quot;</span>,<span class="comment">//请求路径</span></span></span><br><span class="line"><span class="javascript">            <span class="attr">type</span>:<span class="string">&quot;post&quot;</span>,<span class="comment">//请求方式</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//data:&quot;name=jack&amp;age=21&quot;,//请求参数</span></span></span><br><span class="line"><span class="javascript">            <span class="attr">data</span>:&#123;</span></span><br><span class="line"><span class="javascript">                <span class="string">&quot;name&quot;</span>:<span class="string">&quot;tom&quot;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">&quot;age&quot;</span>:<span class="number">21</span></span></span><br><span class="line"><span class="javascript">            &#125;,<span class="comment">//请求参数json格式</span></span></span><br><span class="line"><span class="javascript">            <span class="attr">success</span>:<span class="function"><span class="keyword">function</span> (<span class="params">date</span>) </span>&#123;<span class="comment">//参数接受返回的数据</span></span></span><br><span class="line"><span class="javascript">                alert(date);</span></span><br><span class="line"><span class="javascript">                $(<span class="string">&quot;#text1&quot;</span>).val(date);</span></span><br><span class="line"><span class="javascript">                $(<span class="string">&quot;#p1&quot;</span>).html(date);</span></span><br><span class="line"><span class="javascript">            &#125;,<span class="comment">//响应成功后的回调函数</span></span></span><br><span class="line"><span class="javascript">            <span class="attr">error</span>:<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                alert(<span class="string">&quot;出错了&quot;</span>);</span></span><br><span class="line"><span class="javascript">            &#125;,<span class="comment">//表示如果请求出错会执行的回调函数</span></span></span><br><span class="line"><span class="javascript">            <span class="attr">dataType</span>:<span class="string">&quot;text&quot;</span> <span class="comment">//设置服务器响应的数据类型</span></span></span><br><span class="line"><span class="javascript">        &#125;)</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">       $(<span class="string">&quot;#b1&quot;</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">           abc();</span></span><br><span class="line"><span class="javascript">       &#125;);</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;b1&quot;</span>&gt;</span>点击链接<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;text1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;p1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<ul>
<li><p>$.get(url,响应参数,回调函数，响应类型)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">abc</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//$.get方式</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//$.get(url,响应参数,回调函数，响应类型)</span></span></span><br><span class="line"><span class="javascript">        $.get(<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/nicepage&quot;</span>,&#123;<span class="attr">name</span>:<span class="string">&quot;jack123&quot;</span>&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            alert(data);</span></span><br><span class="line"><span class="javascript">        &#125;,<span class="string">&quot;text&quot;</span>);</span></span><br><span class="line"><span class="javascript">        <span class="comment">//$.post方式与$.get方式，使用方式只有名字不一样</span></span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">&quot;#b1&quot;</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            abc();</span></span><br><span class="line"><span class="javascript">        &#125;);</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;b1&quot;</span>&gt;</span>点击链接<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;text1&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;p1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>$.post(url,响应参数,回调函数，响应类型)</p>
<ul>
<li>使用方式同$.get()</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>Ajax</category>
      </categories>
      <tags>
        <tag>Ajax</tag>
      </tags>
  </entry>
  <entry>
    <title>DubboZookeeper</title>
    <url>/2022/06/05/DubboZookeeper/</url>
    <content><![CDATA[<h1 id="Zookeeper安装"><a href="#Zookeeper安装" class="headerlink" title="Zookeeper安装"></a>Zookeeper安装</h1><h2 id="1-1-下载安装"><a href="#1-1-下载安装" class="headerlink" title="1.1 下载安装"></a>1.1 下载安装</h2><p><strong>1、环境准备</strong></p>
<p>ZooKeeper服务器是用Java创建的，它运行在JVM之上。需要安装JDK 7或更高版本。</p>
<p><strong>2、上传</strong></p>
<p>将下载的ZooKeeper放到/opt/ZooKeeper目录下</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">上传zookeeper alt+p</span></span><br><span class="line">put f:/setup/apache-zookeeper-3.5.6-bin.tar.gz</span><br><span class="line"><span class="meta">#</span><span class="bash">打开 opt目录</span></span><br><span class="line">cd /opt</span><br><span class="line"><span class="meta">#</span><span class="bash">创建zooKeeper目录</span></span><br><span class="line">mkdir  zooKeeper</span><br><span class="line"><span class="meta">#</span><span class="bash">将zookeeper安装包移动到 /opt/zooKeeper</span></span><br><span class="line">mv apache-zookeeper-3.5.6-bin.tar.gz /opt/zookeeper/</span><br></pre></td></tr></table></figure>
<p><strong>3、解压</strong></p>
<p>将tar包解压到/opt/zookeeper目录下</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar -zxvf apache-ZooKeeper-3.5.6-bin.tar.gz </span><br></pre></td></tr></table></figure>
<h2 id="1-2-配置启动"><a href="#1-2-配置启动" class="headerlink" title="1.2 配置启动"></a>1.2 配置启动</h2><p><strong>1、配置zoo.cfg</strong></p>
<p>进入到conf目录拷贝一个zoo_sample.cfg并完成配置</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">进入到conf目录</span></span><br><span class="line">cd /opt/zooKeeper/apache-zooKeeper-3.5.6-bin/conf/</span><br><span class="line"><span class="meta">#</span><span class="bash">拷贝</span></span><br><span class="line">cp  zoo_sample.cfg  zoo.cfg</span><br></pre></td></tr></table></figure>
<p>修改zoo.cfg</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">打开目录</span></span><br><span class="line">cd /opt/zooKeeper/</span><br><span class="line"><span class="meta">#</span><span class="bash">创建zooKeeper存储目录</span></span><br><span class="line">mkdir  zkdata</span><br><span class="line"><span class="meta">#</span><span class="bash">修改zoo.cfg</span></span><br><span class="line">vim /opt/zooKeeper/apache-zooKeeper-3.5.6-bin/conf/zoo.cfg</span><br></pre></td></tr></table></figure>
<p><img src="/2022/06/05/DubboZookeeper/1.png" alt="1577548250377"></p>
<p>修改存储目录：dataDir=/opt/zookeeper/zkdata</p>
<p><strong>2、启动ZooKeeper</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /opt/zooKeeper/apache-zooKeeper-3.5.6-bin/bin/</span><br><span class="line"><span class="meta">#</span><span class="bash">启动</span></span><br><span class="line"> ./zkServer.sh  start</span><br></pre></td></tr></table></figure>
<p><img src="/2022/06/05/DubboZookeeper/2.png" alt="1577548052037"></p>
<p>看到上图表示ZooKeeper成功启动</p>
<p><strong>3、查看ZooKeeper状态</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./zkServer.sh status</span><br></pre></td></tr></table></figure>
<p>zookeeper启动成功。standalone代表zk没有搭建集群，现在是单节点</p>
<p><img src="/2022/06/05/DubboZookeeper/3.png" alt="1577548175232"></p>
<p>zookeeper没有启动</p>
<p><img src="/2022/06/05/DubboZookeeper/4.png" alt="1577548112773"></p>
<h1 id="dubbo快速入门"><a href="#dubbo快速入门" class="headerlink" title="dubbo快速入门"></a>dubbo快速入门</h1><h2 id="1-整合spring-springmvc"><a href="#1-整合spring-springmvc" class="headerlink" title="1. 整合spring springmvc"></a>1. 整合spring springmvc</h2><ul>
<li><p>创建服务提供者Provider模块创建服务消费者Consumer模块</p>
</li>
<li><p>在服务提供者模块编写UserServicelmpl提供服务</p>
</li>
<li><p>在服务消费者中的UserController远程调用</p>
</li>
<li><p>UserServicelmpl提供的服务</p>
</li>
<li><p>分别启动两个服务，测试</p>
</li>
</ul>
<p><img src="/2022/06/05/DubboZookeeper/5.png" alt="image-20220605111318500"></p>
<h2 id="2-服务端代码"><a href="#2-服务端代码" class="headerlink" title="2. 服务端代码"></a>2. 服务端代码</h2><ul>
<li>编写服务代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">sayHello</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hestialx.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.apache.dubbo.config.annotation.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">//dubbo提供的Service注解。将这个类提供的方法对外发布，将访问的地址ip，端口，路径注册到注册中心</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;sayhello&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>配置dubbo</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://dubbo.apache.org/schema/dubbo&quot;</span> <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--   &lt;context:component-scan base-package=&quot;cn.hestialx.service&quot;/&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--dubbo配置--&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--1. 配置项目名称，必须唯一--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">&quot;dubbo-service&quot;</span>/&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--2. 配置注册中心--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">&quot;zookeeper://192.168.61.131:2181&quot;</span>/&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--3. 配置包扫描--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dubbo:annotation</span> <span class="attr">package</span>=<span class="string">&quot;cn.hestialx.service.impl&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="3-消费端代码"><a href="#3-消费端代码" class="headerlink" title="3. 消费端代码"></a>3. 消费端代码</h2><ul>
<li>编写service接口</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">sayHello</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>controller 类</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cn.hestialx.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.apache.dubbo.config.annotation.Reference;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 远程注入</span></span><br><span class="line"><span class="comment">     * 1. 从zookeeper注册中心获取userService的访问url</span></span><br><span class="line"><span class="comment">     * 2. 进行远程调用RPC</span></span><br><span class="line"><span class="comment">     * 3. 将结果封装为一个代理对象。给变量赋值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Reference</span> <span class="comment">//远程注入</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.sayHello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>配置dubbo</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://dubbo.apache.org/schema/dubbo&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">         http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;cn.hestialx.controller&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--dubbo配置--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--1. 配置项目名称，必须唯一--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--1.2 单机模式下qos服务端口冲突，因为服务端和消费端都有这个进程，默认在同样端口--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--可以在dubbo:application标签中自定义属性--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">&quot;dubbo-web&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dubbo:parameter</span> <span class="attr">key</span>=<span class="string">&quot;qos.port&quot;</span> <span class="attr">value</span>=<span class="string">&quot;33333&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dubbo:application</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--2. 配置注册中心--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">&quot;zookeeper://192.168.61.131:2181&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--3. 配置包扫描--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:annotation</span> <span class="attr">package</span>=<span class="string">&quot;cn.hestialx.controller&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="4-提取公共接口"><a href="#4-提取公共接口" class="headerlink" title="4. 提取公共接口"></a>4. 提取公共接口</h2><ul>
<li>在上述远程调用过程中，使用的UserService接口需要在服务端定义实现，也要在消费端声明，进行了重复的编写</li>
<li>我们可以将公共接口都抽取出来，放在同一个模块中，让后在需要使用的地方使用maven导入即可</li>
</ul>
<ol>
<li><p>创建dubbo-interface模块，并编写公共接口</p>
<p><img src="/2022/06/05/DubboZookeeper/6.png" alt="image-20220605162335370"></p>
</li>
<li><p>在使用的地方进行导入</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hestialx<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="dubbo-admin"><a href="#dubbo-admin" class="headerlink" title="dubbo-admin"></a>dubbo-admin</h1><h2 id="一、dubbo-admin安装"><a href="#一、dubbo-admin安装" class="headerlink" title="一、dubbo-admin安装"></a>一、dubbo-admin安装</h2><p><strong>1、环境准备</strong></p>
<p>dubbo-admin 是一个前后端分离的项目。前端使用vue，后端使用springboot，安装 dubbo-admin 其实就是部署该项目。我们将dubbo-admin安装到开发环境上。要保证开发环境有jdk，maven，nodejs</p>
<p>安装node<strong>(如果当前机器已经安装请忽略)</strong></p>
<p>因为前端工程是用vue开发的，所以需要安装node.js，node.js中自带了npm，后面我们会通过npm启动</p>
<p>下载地址</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://nodejs.org/en/</span><br></pre></td></tr></table></figure>
<p><img src="/2022/06/05/DubboZookeeper/7.png" alt="1578298201398"></p>
<p><strong>2、下载 Dubbo-Admin</strong></p>
<p>进入github，搜索dubbo-admin</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/apache/dubbo-admin</span><br></pre></td></tr></table></figure>
<p>下载：</p>
<p><img src="/2022/06/05/DubboZookeeper/8.png" alt="1578297063167"></p>
<p><strong>3、把下载的zip包解压到指定文件夹(解压到那个文件夹随意)</strong></p>
<p><img src="/2022/06/05/DubboZookeeper/9.png" alt="1578297477356"></p>
<p><strong>4、修改配置文件</strong></p>
<p>解压后我们进入…\dubbo-admin-develop\dubbo-admin-server\src\main\resources目录，找到 <strong>application.properties</strong> 配置文件 进行配置修改</p>
<p><img src="/2022/06/05/DubboZookeeper/10.png" alt="1578297603008"></p>
<p>修改zookeeper地址</p>
<p><img src="/2022/06/05/DubboZookeeper/11.png" alt="1578297758655"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> centers <span class="keyword">in</span> dubbo2.7</span></span><br><span class="line">admin.registry.address=zookeeper://192.168.149.135:2181</span><br><span class="line">admin.config-center=zookeeper://192.168.149.135:2181</span><br><span class="line">admin.metadata-report.address=zookeeper://192.168.149.135:2181</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>admin.registry.address注册中心<br>admin.config-center 配置中心<br>admin.metadata-report.address元数据中心</p>
<p><strong>5、打包项目</strong></p>
<p>mvn clean install -DskipTests<br>mvn clean install -Dmaven.test.skip=true</p>
<ul>
<li><p>DskipTests，不执行测试用例，但编译测试用例类生成相应的class文件至target/test-classes下</p>
</li>
<li><p>Dmaven.test.skip=true，不执行测试用例，也不编译测试用例类</p>
</li>
</ul>
<p>使用maven.test.skip，不但跳过单元测试的运行，也跳过测试代码的编译;</p>
<p>使用 mvn package -DskipTests 跳过单元测试，但是会继续编译。</p>
<p>在 dubbo-admin-develop 目录执行打包命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mvn  clean package</span><br></pre></td></tr></table></figure>
<p><img src="/2022/06/05/DubboZookeeper/12.png" alt="1578300464726"></p>
<p><strong>6、启动后端</strong></p>
<p>切换到目录</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">dubbo-Admin-develop\dubbo-admin-distribution\target&gt;</span><br></pre></td></tr></table></figure>
<p>执行下面的命令启动 dubbo-admin，dubbo-admin后台由SpringBoot构建。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java -jar .\dubbo-admin-0.1.jar</span><br></pre></td></tr></table></figure>
<p><strong>7、前台后端</strong></p>
<p>dubbo-admin-ui 目录下执行命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure>
<p><img src="/2022/06/05/DubboZookeeper/13.png" alt="1578300677041"></p>
<p><strong>8、访问</strong></p>
<p>浏览器输入。用户名密码都是root</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://localhost:8081/</span><br></pre></td></tr></table></figure>
<p><img src="/2022/06/05/DubboZookeeper/14.png" alt="1578300774258"></p>
<h2 id="二、dubbo-admin简单使用"><a href="#二、dubbo-admin简单使用" class="headerlink" title="二、dubbo-admin简单使用"></a>二、dubbo-admin简单使用</h2><p>注意:Dubbo Admin【服务Mock】【服务统计】将在后续版本发布….</p>
<p>在上面的步骤中，我们已经进入了Dubbo-Admin的主界面，在【快速入门】章节中，我们定义了服务生产者、和服务消费者，下面我们从Dubbo-Admin管理界面找到这个两个服务</p>
<p><strong>1、点击服务查询</strong></p>
<p><img src="/2022/06/05/DubboZookeeper/16.png" alt></p>
<p><strong>2、查询结果</strong></p>
<p><img src="/2022/06/05/DubboZookeeper/15.png" alt="1578301528363"></p>
<p>A:输入的查询条件</p>
<p>B:搜索类型，主要分为【按服务名】【按IP地址】【按应用】三种类型查询</p>
<p>C:搜索结果</p>
<p><strong>3.1.4 dubo-admin查看详情</strong></p>
<p>我们查看com.itheima.service.UserService （服务提供者）的具体详细信息，包含【元数据信息】</p>
<p><strong>1）点击详情</strong></p>
<p>从【详情】界面查看，主要分为3个区域</p>
<p>A区域：主要包含服务端 基础信息比如服务名称、应用名称等</p>
<p>B区域：主要包含了生产者、消费者一些基本信息</p>
<p><strong>C区域：是元数据信息，注意看上面的图,元数据信息是空的</strong></p>
<p>我们需要打开我们的生产者配置文件加入下面配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 元数据配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:metadata-report</span> <span class="attr">address</span>=<span class="string">&quot;zookeeper://192.168.149.135:2181&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>重新启动生产者，再次打开Dubbo-Admin</p>
<p>这样我们的元数据信息就出来了</p>
<p><img src="/2022/06/05/DubboZookeeper/17.png" alt="1578301892712"></p>
<h1 id="dubbo高级特性"><a href="#dubbo高级特性" class="headerlink" title="dubbo高级特性"></a>dubbo高级特性</h1><h2 id="1-序列化传输java对象"><a href="#1-序列化传输java对象" class="headerlink" title="1. 序列化传输java对象"></a>1. 序列化传输java对象</h2><ul>
<li>dubbo内部已经实现了序列化和反序列化</li>
</ul>
<p><img src="/2022/06/05/DubboZookeeper/18.png" alt="image-20220605191708873"></p>
<p>所有的pojo对象可以放在一个模块中，和通用接口一样通过maven依赖引入</p>
<ul>
<li>本文采用的方式是在dubbo-interface模块中引入dubbo-pojo模块，在服务端和消费端引入dubbo-interface模块。</li>
</ul>
<p><strong>注意：所有的pojo对象都需要实现serializable接口</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(Integer id, String username, String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>controller</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 远程注入</span></span><br><span class="line"><span class="comment">     * 1. 从zookeeper注册中心获取userService的访问url</span></span><br><span class="line"><span class="comment">     * 2. 进行远程调用RPC</span></span><br><span class="line"><span class="comment">     * 3. 将结果封装为一个代理对象。给变量赋值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Reference</span> <span class="comment">//远程注入</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.sayHello();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/find&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">(<span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.findUserById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试：</p>
<p><img src="/2022/06/05/DubboZookeeper/19.png" alt="image-20220605200400505"></p>
<h2 id="2-地址缓存"><a href="#2-地址缓存" class="headerlink" title="2. 地址缓存"></a>2. 地址缓存</h2><p>注册中心挂了，服务是否可以正常访问？</p>
<ul>
<li>可以，因为dubbo服务消费者在第一次调用时，会将服务的提供方地址缓存到本地，以后再调用不会访问注册中心</li>
</ul>
<h2 id="3-超时和重试"><a href="#3-超时和重试" class="headerlink" title="3. 超时和重试"></a>3. 超时和重试</h2><p><img src="/2022/06/05/DubboZookeeper/20.png" alt="image-20220605201129026"></p>
<ul>
<li><p>服务消费者在调用服务提供者的时候发生了阻塞、等待的情形，这个时候，服务消费者会一直等待下去。</p>
</li>
<li><p>在某个峰值时刻，大量的请求都在同时请求服务消费者，会造成线程的大量堆积，势必会造成雪崩。</p>
</li>
<li><p>dubbo 利用超时机制来解决这个问题，设置一个超时时间，在这个时间段内，无法完成服务访问，则自动断开连接。</p>
</li>
<li><p>使用timeout属性配置超时时间，默认值1000，单位毫秒。</p>
</li>
<li>设置了超时时间，在这个时间段内，无法完成服务访问，则自动断开连接。</li>
<li>如果出现网络抖动，则这一次请求就会失败。</li>
<li>Dubbo 提供重试机制来避免类似问题的发生。</li>
<li>通过 retries  属性来设置重试次数。默认为 2 次。</li>
</ul>
<p>timeout和retries  属性通过服务端@Service(timeout = 3000,retries = 3)进行设置</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//dubbo提供的Service注解。将这个类提供的方法对外发布，将访问的地址ip，端口，路径注册到注册中心</span></span><br><span class="line"><span class="meta">@Service(timeout = 3000,retries = 3)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;sayhello&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findUserById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;服务被调用了&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">6000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        User user = <span class="keyword">new</span> User(<span class="number">1</span>,<span class="string">&quot;zhangsan&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也可以通过消费端@Reference(timeout = 3000,retries = 3)设置</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 远程注入</span></span><br><span class="line"><span class="comment">     * 1. 从zookeeper注册中心获取userService的访问url</span></span><br><span class="line"><span class="comment">     * 2. 进行远程调用RPC</span></span><br><span class="line"><span class="comment">     * 3. 将结果封装为一个代理对象。给变量赋值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Reference(timeout = 3000,retries = 3)</span> <span class="comment">//远程注入</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.sayHello();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/find&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">(<span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">                System.out.println(i++);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">        User userById = userService.findUserById(id);</span><br><span class="line">        <span class="keyword">return</span> userById;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>同时配置则消费端配置生效会覆盖服务端配置</li>
</ul>
<p><strong>推荐在服务端配置</strong></p>
<h2 id="4-多版本"><a href="#4-多版本" class="headerlink" title="4. 多版本"></a>4. 多版本</h2><p><img src="/2022/06/05/DubboZookeeper/21.png" alt="image-20220605204430549"></p>
<ul>
<li><p>灰度发布：当出现新功能时，会让一部分用户先使用新功能，用户反馈没问题时，再将所有用户迁移到新功能。</p>
</li>
<li><p>dubbo 中使用version 属性来设置和调用同一个接口的不同版本</p>
</li>
</ul>
<h3 id="在服务端可以通过-Service注解中的version-“1-0”属性设置版本"><a href="#在服务端可以通过-Service注解中的version-“1-0”属性设置版本" class="headerlink" title="在服务端可以通过@Service注解中的version = “1.0”属性设置版本"></a>在服务端可以通过@Service注解中的version = “1.0”属性设置版本</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//dubbo提供的Service注解。将这个类提供的方法对外发布，将访问的地址ip，端口，路径注册到注册中心</span></span><br><span class="line"><span class="meta">@Service(timeout = 3000,retries = 3,version = &quot;1.0&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;sayhello&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findUserById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;服务被调用了&quot;</span>);</span><br><span class="line">        User user = <span class="keyword">new</span> User(<span class="number">1</span>,<span class="string">&quot;zhangsan&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service(version = &quot;2.0&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl1</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findUserById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        User lisi = <span class="keyword">new</span> User(<span class="number">1</span>, <span class="string">&quot;lisi&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> lisi;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="在消费端通过-Reference-version-“2-0”-设置使用哪个版本"><a href="#在消费端通过-Reference-version-“2-0”-设置使用哪个版本" class="headerlink" title="在消费端通过@Reference(version = “2.0”)设置使用哪个版本"></a>在消费端通过@Reference(version = “2.0”)设置使用哪个版本</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 远程注入</span></span><br><span class="line"><span class="comment">     * 1. 从zookeeper注册中心获取userService的访问url</span></span><br><span class="line"><span class="comment">     * 2. 进行远程调用RPC</span></span><br><span class="line"><span class="comment">     * 3. 将结果封装为一个代理对象。给变量赋值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Reference(timeout = 3000,retries = 3,version = &quot;2.0&quot;)</span> <span class="comment">//远程注入</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.sayHello();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/find&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">(<span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line">        User userById = userService.findUserById(id);</span><br><span class="line">        <span class="keyword">return</span> userById;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5-负载均衡"><a href="#5-负载均衡" class="headerlink" title="5. 负载均衡"></a>5. 负载均衡</h2><p>​    一个服务如果十分复杂或者被调用的次数很多，往往单机无法承受，因此可以在多台机器上部署相同的服务，注册相同的服务</p>
<p>通过注册服务时的权重设置和消费时的负载策略来进行负载均衡，这就是集群的模式</p>
<p><img src="/2022/06/05/DubboZookeeper/22.png" alt="image-20220605205940240"></p>
<p>负载均衡策略（4种）：</p>
<ul>
<li><p>Random ：按权重随机，默认值。按权重设置随机概率。</p>
</li>
<li><p>RoundRobin ：按权重轮询。</p>
</li>
<li><p>LeastActive：最少活跃调用数，相同活跃数的随机。</p>
</li>
<li><p>ConsistentHash：一致性 Hash，相同参数的请求总是发到同一提供者</p>
</li>
</ul>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><h4 id="1-在服务端可以通过-Service注解中的weight属性值（int）设置权重"><a href="#1-在服务端可以通过-Service注解中的weight属性值（int）设置权重" class="headerlink" title="1. 在服务端可以通过@Service注解中的weight属性值（int）设置权重"></a>1. 在服务端可以通过@Service注解中的weight属性值（int）设置权重</h4><h4 id="2-在消费端通过-Reference-loadbalance-“random”-设置负载均衡策略"><a href="#2-在消费端通过-Reference-loadbalance-“random”-设置负载均衡策略" class="headerlink" title="2. 在消费端通过@Reference(loadbalance = “random”)设置负载均衡策略"></a>2. 在消费端通过@Reference(loadbalance = “random”)设置负载均衡策略</h4><h2 id="6-集群容错"><a href="#6-集群容错" class="headerlink" title="6. 集群容错"></a>6. 集群容错</h2><p><img src="/2022/06/05/DubboZookeeper/23.png" alt="image-20220605210844691"></p>
<p>集群容错模式：</p>
<ul>
<li><p>Failover Cluster：失败重试。默认值。当出现失败，重试其它服务器 ，默认重试2次，使用 retries 配置。一般用于读操作</p>
</li>
<li><p>Failfast Cluster ：快速失败，只发起一次调用，失败立即报错。通常用于写操作。</p>
</li>
<li><p>Failsafe Cluster ：失败安全，出现异常时，直接忽略。返回一个空结果。</p>
</li>
<li><p>Failback Cluster ：失败自动恢复，后台记录失败请求，定时重发。通常用于消息通知操作。</p>
</li>
<li><p>Forking Cluster ：并行调用多个服务器，只要一个成功即返回。</p>
</li>
<li><p>Broadcast  Cluster ：广播调用所有提供者，逐个调用，任意一台报错则报错。</p>
</li>
</ul>
<h3 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h3><h4 id="消费端-Reference-cluster-“failover”-的cluster属性值设置集群容错模式"><a href="#消费端-Reference-cluster-“failover”-的cluster属性值设置集群容错模式" class="headerlink" title="消费端@Reference(cluster = “failover”)的cluster属性值设置集群容错模式"></a>消费端@Reference(cluster = “failover”)的cluster属性值设置集群容错模式</h4><h2 id="7-服务降级"><a href="#7-服务降级" class="headerlink" title="7. 服务降级"></a>7. 服务降级</h2><p><img src="/2022/06/05/DubboZookeeper/24.png" alt="image-20220605212420273"></p>
<p>服务降级方式:</p>
<ul>
<li><p>mock=force:return null表示消费方对该服务的方法调用都直接返回null值，不发起远程调用。用来屏蔽不重要服务不可用时对调用方的影响。</p>
</li>
<li><p>mock=fail:return null表示消费方对该服务的方法调用在失败后，再返回null值，不抛异常。用来容忍不重要服务不稳定时对调用方的影响。</p>
</li>
</ul>
<h3 id="代码实现-2"><a href="#代码实现-2" class="headerlink" title="代码实现"></a>代码实现</h3><h4 id="在消费端-Reference-mock-”fail-return-null”-设置mock属性值"><a href="#在消费端-Reference-mock-”fail-return-null”-设置mock属性值" class="headerlink" title="在消费端@Reference(mock=”fail:return null”)设置mock属性值"></a>在消费端@Reference(mock=”fail:return null”)设置mock属性值</h4>]]></content>
      <categories>
        <category>dubbo</category>
        <category>zookeeper</category>
      </categories>
      <tags>
        <tag>dubbo</tag>
        <tag>zookeeper</tag>
      </tags>
  </entry>
  <entry>
    <title>ELandJSTL</title>
    <url>/2021/12/23/ELandJSTL/</url>
    <content><![CDATA[<h3 id="一、EL表达式基础"><a href="#一、EL表达式基础" class="headerlink" title="一、EL表达式基础"></a>一、EL表达式基础</h3><h5 id="1-概念：（不用导入，jsp自带）"><a href="#1-概念：（不用导入，jsp自带）" class="headerlink" title="1. 概念：（不用导入，jsp自带）"></a>1. 概念：（不用导入，jsp自带）</h5><p>​    Expression Language 表达式语言</p>
<h5 id="2-作用："><a href="#2-作用：" class="headerlink" title="2. 作用："></a>2. 作用：</h5><p>​    替换和简化jsp中的java代码</p>
<h5 id="3-语法：-输出表达式的结果"><a href="#3-语法：-输出表达式的结果" class="headerlink" title="3. 语法：(输出表达式的结果)"></a>3. 语法：(输出表达式的结果)</h5><p>​    ${表达式}</p>
<h5 id="4-忽略el表达式"><a href="#4-忽略el表达式" class="headerlink" title="4. 忽略el表达式"></a>4. 忽略el表达式</h5><figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> 忽略全部</span><br><span class="line"><span class="comment">//设置isELIgnored值为true</span></span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> isELIgnored=<span class="string">&quot;true&quot;</span>%&gt;</span><br><span class="line"><span class="number">2.</span> 忽略单个(使用“\”进行转义)</span><br><span class="line">\$&#123;<span class="number">3</span> &gt; <span class="number">4</span>&#125;</span><br></pre></td></tr></table></figure>
<h3 id="二、EL表达式使用"><a href="#二、EL表达式使用" class="headerlink" title="二、EL表达式使用"></a>二、EL表达式使用</h3><h5 id="1-运算："><a href="#1-运算：" class="headerlink" title="1. 运算："></a>1. 运算：</h5><ul>
<li>运算符<ul>
<li>1．算数运算符∶+、-、/(div)、%( mod)</li>
<li>2．比较运算符∶&gt;、&lt;、&gt;=、&lt;=、== 、!=</li>
<li>3．逻辑运算符: &amp;&amp;( and)、ll(or)、 ! (not)</li>
<li>4．空运算符: empty<ul>
<li>功能∶用于判断字符串、集合、数组对象是否为null、长度是否为0</li>
<li>${ empty list)判断字符串、集合、数组对象是否为null或者长度是否为0</li>
<li>${ not empty list)判断字符串、集合、数组对象是否不为null并且长度不为0</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="2-获取值："><a href="#2-获取值：" class="headerlink" title="2. 获取值："></a>2. 获取值：</h5><ol>
<li><p>el表达式只能从域对象中获取值</p>
<ul>
<li><p>语法：</p>
<ol>
<li><p>${域名称.键名}：从指定域中获取指定键的值</p>
<ul>
<li>域名称：<ol>
<li>pagescope             —&gt; pagecontext</li>
<li>requestscope        —&gt; request</li>
<li>sessionscope        —&gt; session</li>
<li>applicationscope  —&gt; application (ServletContext)</li>
</ol>
</li>
</ul>
</li>
<li><p>${键名}：表示依次从最小的域中查找是否有改建对应的值，直到找到对应键的值。</p>
</li>
<li><p>如果域对象中存储的不是基本数据类型，而是对象、List集合、Map集合</p>
<ul>
<li><p>对象${域对象.get方法去掉get首字母小写）</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//可以使用setter或getter方法，去掉set或get，在将剩余部分，首字母变为小写。</span><br><span class="line">//setName --&gt; Name --&gt; name</span><br><span class="line">$&#123;user.name&#125;</span><br><span class="line">//获取日期</span><br><span class="line">在user bean类中，定义String getBirStr() 方法，在方法中格式化日期类，并返回。</span><br><span class="line">$&#123;user.birStr&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>List</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$&#123;域名称.键名[索引]&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Map</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. $&#123;域名.键名.Map键&#125;</span><br><span class="line">2. $&#123;域名.键名[&quot;Map键名&quot;]&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
</ol>
<h5 id="3-隐式对象："><a href="#3-隐式对象：" class="headerlink" title="3. 隐式对象："></a>3. 隐式对象：</h5><p>el表达式中有11个隐式对象</p>
<ol>
<li><p>pageContext:</p>
<ul>
<li><p>获取jsp中其他8个隐式对象</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. pageContext.request</span><br><span class="line">//eg:动态获取虚拟目录</span><br><span class="line">pageContext.request.contextPath</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h3 id="三、JSTL基础"><a href="#三、JSTL基础" class="headerlink" title="三、JSTL基础"></a>三、JSTL基础</h3><p>概念：JavaServer Pages Tag Library    —-  jsp标准标签库</p>
<p>作用：用于简化和替换jsp页面上的java代码</p>
<p>使用步骤：</p>
<ol>
<li>导入jstl相关jar包</li>
<li>引入标签库：taglib指令：&lt;%@ taglib%&gt;</li>
</ol>
<h5 id="1-常用的-STL标签"><a href="#1-常用的-STL标签" class="headerlink" title="1. 常用的]STL标签"></a>1. 常用的]STL标签</h5><p>if:相当于java代码的if语句</p>
<ol>
<li><p>属性:</p>
<ul>
<li><p>test 必须属性，接受boolean表达式</p>
<ul>
<li><p>如果表达式为true，则显示if标签体内容，如果为false，则不显示标签体内容。</p>
</li>
<li><p>—般情况下, test属性值会结合el表达式一起使用。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>注意：</p>
<ul>
<li>c:if标签没有else情况，想要else情况，则可以再定义一个c:if标签</li>
</ul>
</li>
</ol>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">    pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;%@ taglib uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> prefix=<span class="string">&quot;c&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;c:<span class="keyword">if</span> 标签实例&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">&quot;salary&quot;</span> scope=<span class="string">&quot;session&quot;</span> value=<span class="string">&quot;$&#123;2000*2&#125;&quot;</span>/&gt;</span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;salary &gt; 2000&#125;&quot;</span>&gt;</span><br><span class="line">   &lt;p&gt;我的工资为: &lt;c:out value=<span class="string">&quot;$&#123;salary&#125;&quot;</span>/&gt;&lt;p&gt;</span><br><span class="line">&lt;/c:<span class="keyword">if</span>&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>choose:相当于java代码的switch语句</p>
<ol>
<li><p>使用choose标签声明 ——- 相当于switch声明</p>
</li>
<li><p>使用when标签做判断——-相当于case</p>
</li>
<li><p>使用otherwise标签做其他情况的声明——-相当于default</p>
</li>
</ol>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">    pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;%@ taglib uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> prefix=<span class="string">&quot;c&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;c:choose 标签实例&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">&quot;salary&quot;</span> scope=<span class="string">&quot;session&quot;</span> value=<span class="string">&quot;$&#123;2000*2&#125;&quot;</span>/&gt;</span><br><span class="line">&lt;p&gt;你的工资为 : &lt;c:out value=<span class="string">&quot;$&#123;salary&#125;&quot;</span>/&gt;&lt;/p&gt;</span><br><span class="line">&lt;c:choose&gt;</span><br><span class="line">    &lt;c:when test=<span class="string">&quot;$&#123;salary &lt;= 0&#125;&quot;</span>&gt;</span><br><span class="line">       太惨了。</span><br><span class="line">    &lt;/c:when&gt;</span><br><span class="line">    &lt;c:when test=<span class="string">&quot;$&#123;salary &gt; 1000&#125;&quot;</span>&gt;</span><br><span class="line">       不错的薪水，还能生活。</span><br><span class="line">    &lt;/c:when&gt;</span><br><span class="line">    &lt;c:otherwise&gt;</span><br><span class="line">        什么都没有。</span><br><span class="line">    &lt;/c:otherwise&gt;</span><br><span class="line">&lt;/c:choose&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h5 id="2-c-forEach-c-forTokens标签"><a href="#2-c-forEach-c-forTokens标签" class="headerlink" title="2. c:forEach, c:forTokens标签"></a>2. c:forEach, c:forTokens标签</h5><p>foreach:相当于java代码的for语句</p>
<p>这些标签封装了Java中的for，while，do-while循环。</p>
<p>相比而言，c:forEach标签是更加通用的标签，因为它迭代一个集合中的对象。</p>
<p>c:forTokens标签通过指定分隔符将字符串分隔为一个数组然后迭代它们。</p>
<ul>
<li>forEach 语法格式</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;c:forEach</span><br><span class="line">    items=&quot;&lt;object&gt;&quot;</span><br><span class="line">    begin=&quot;&lt;int&gt;&quot;</span><br><span class="line">    end=&quot;&lt;int&gt;&quot;</span><br><span class="line">    step=&quot;&lt;int&gt;&quot;</span><br><span class="line">    var=&quot;&lt;string&gt;&quot;</span><br><span class="line">    varStatus=&quot;&lt;string&gt;&quot;&gt;</span><br><span class="line"></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<ul>
<li>forTokens 语法格式</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;c:forTokens</span><br><span class="line">    items=&quot;&lt;string&gt;&quot;</span><br><span class="line">    delims=&quot;&lt;string&gt;&quot;</span><br><span class="line">    begin=&quot;&lt;int&gt;&quot;</span><br><span class="line">    end=&quot;&lt;int&gt;&quot;</span><br><span class="line">    step=&quot;&lt;int&gt;&quot;</span><br><span class="line">    var=&quot;&lt;string&gt;&quot;</span><br><span class="line">    varStatus=&quot;&lt;string&gt;&quot;&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>属性</li>
</ul>
<p>c:forEach标签有如下属性：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left"><strong>属性</strong></th>
<th style="text-align:left"><strong>描述</strong></th>
<th style="text-align:left"><strong>是否必要</strong></th>
<th style="text-align:left"><strong>默认值</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">items</td>
<td style="text-align:left">要被循环的信息</td>
<td style="text-align:left">否</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">begin</td>
<td style="text-align:left">开始的元素（0=第一个元素，1=第二个元素）</td>
<td style="text-align:left">否</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">end</td>
<td style="text-align:left">最后一个元素（0=第一个元素，1=第二个元素）</td>
<td style="text-align:left">否</td>
<td style="text-align:left">Last element</td>
</tr>
<tr>
<td style="text-align:left">step</td>
<td style="text-align:left">每一次迭代的步长</td>
<td style="text-align:left">否</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">var</td>
<td style="text-align:left">代表当前条目的变量名称</td>
<td style="text-align:left">否</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td style="text-align:left">varStatus</td>
<td style="text-align:left">代表循环状态的变量名称</td>
<td style="text-align:left">否</td>
<td style="text-align:left">无</td>
</tr>
</tbody>
</table>
</div>
<p><strong>c:forEach varStatus 属性</strong></p>
<ul>
<li><strong>current</strong>: 当前这次迭代的（集合中的）项</li>
<li><strong>index</strong>: 当前这次迭代从 0 开始的迭代索引</li>
<li><strong>count</strong>: 当前这次迭代从 1 开始的迭代计数</li>
<li><strong>first</strong>: 用来表明当前这轮迭代是否为第一次迭代的标志</li>
<li><strong>last</strong>: 用来表明当前这轮迭代是否为最后一次迭代的标志</li>
<li><strong>begin</strong>: 属性值</li>
<li><strong>end</strong>: 属性值</li>
<li><strong>step</strong>: 属性值</li>
</ul>
<p>c:forTokens标签与c:forEach标签有相似的属性，不过c:forTokens还有另一个属性：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left"><strong>属性</strong></th>
<th style="text-align:left"><strong>描述</strong></th>
<th style="text-align:left"><strong>是否必要</strong></th>
<th style="text-align:left"><strong>默认值</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">delims</td>
<td style="text-align:left">分隔符</td>
<td style="text-align:left">是</td>
<td style="text-align:left">无</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>c:forEach实例演示</li>
</ul>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">    pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;%@ taglib uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> prefix=<span class="string">&quot;c&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;c:forEach 标签实例&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;c:forEach <span class="keyword">var</span>=<span class="string">&quot;i&quot;</span> begin=<span class="string">&quot;1&quot;</span> end=<span class="string">&quot;5&quot;</span>&gt;</span><br><span class="line">   Item &lt;c:out value=<span class="string">&quot;$&#123;i&#125;&quot;</span>/&gt;&lt;p&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>运行结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Item 1</span><br><span class="line">Item 2</span><br><span class="line">Item 3</span><br><span class="line">Item 4</span><br><span class="line">Item 5</span><br></pre></td></tr></table></figure>
<ul>
<li>c:forTokens演示实例</li>
</ul>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">    pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;%@ taglib uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> prefix=<span class="string">&quot;c&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;c:forTokens 标签实例&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;c:forTokens items=<span class="string">&quot;google,runoob,taobao&quot;</span> delims=<span class="string">&quot;,&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;name&quot;</span>&gt;</span><br><span class="line">   &lt;c:out value=<span class="string">&quot;$&#123;name&#125;&quot;</span>/&gt;&lt;p&gt;</span><br><span class="line">&lt;/c:forTokens&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>运行结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">google</span><br><span class="line">runoob</span><br><span class="line">taobao</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>jsp</category>
      </categories>
      <tags>
        <tag>el</tag>
        <tag>jstl</tag>
      </tags>
  </entry>
  <entry>
    <title>Git</title>
    <url>/2022/02/22/Git/</url>
    <content><![CDATA[<h1 id="Git学习"><a href="#Git学习" class="headerlink" title="Git学习"></a>Git学习</h1><h2 id="一、概念"><a href="#一、概念" class="headerlink" title="一、概念"></a>一、概念</h2><p>git是分布式版本控制系统</p>
<p>svn是集中化版本控制系统</p>
<h2 id="二、安装"><a href="#二、安装" class="headerlink" title="二、安装"></a>二、安装</h2><p>官网安装</p>
<h2 id="三、本地结构"><a href="#三、本地结构" class="headerlink" title="三、本地结构"></a>三、本地结构</h2><p><img src="/2022/02/22/Git/1.png" alt></p>
<h2 id="四、初始化本地库"><a href="#四、初始化本地库" class="headerlink" title="四、初始化本地库"></a>四、初始化本地库</h2><ol>
<li><p>创建文件夹</p>
</li>
<li><p>打开Git终端</p>
</li>
<li><p>右键选中option，设置字符集</p>
<p><img src="/2022/02/22/Git/2.png" alt></p>
<p><img src="/2022/02/22/Git/3.png" alt></p>
</li>
<li><p>git version查看git版本，判断否安装成功</p>
<p><img src="/2022/02/22/Git/4.png" alt></p>
</li>
<li><p>git config —global user.name “” ——设置全局用户名</p>
<ul>
<li>（全局的存储在C:\Users\用户名.gitconfig 文件）</li>
<li>（局部的存储在对应仓库文件下的.git文件夹下的config文件）</li>
</ul>
</li>
<li><p>git config —global user.email “” ——设置全局邮箱</p>
</li>
<li><p>本地仓库初始化</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure>
</li>
<li><p>注意：.git目录下的本地仓库相关的子目录和子文件不要删除和修改</p>
</li>
</ol>
<h2 id="五、常用命令"><a href="#五、常用命令" class="headerlink" title="五、常用命令"></a>五、常用命令</h2><ul>
<li><p>git add 文件名 （将文件放入暂存区）</p>
</li>
<li><p>git commit -m “注释” （将暂存区文件提交到本地库）</p>
<ul>
<li><p>已提交文件修改后要重新add和commit</p>
</li>
<li><p>如果你觉得 git add 提交缓存的流程太过繁琐，Git 也允许你用 -a 选项跳过这一步。命令格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git commit -am [注释]</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>git status (查看仓库状态)</p>
<p><img src="/2022/02/22/Git/5.png" alt></p>
</li>
<li><p>git log（展示操作日志：历史仓库记录对应的索引，操作人，操作时间，操作注释）</p>
<ul>
<li>git log —pretty=oneline (在一行展示一条操作日志)</li>
<li>git reflog (多了HEAD@{数字}信息，表示到此版本要走几步)</li>
<li>如果操作过多会分屏显示<ul>
<li>空格：向下翻页</li>
<li>b：向上翻页</li>
<li>q：退出</li>
</ul>
</li>
</ul>
<p><img src="/2022/02/22/Git/6.png" alt></p>
</li>
<li><p>git reset —hard  [历史仓库记录对应的索引]（前进或后退历史版本）</p>
<ul>
<li>reset 和 git reflog 结合使用</li>
<li>—hard 参数表示暂存区，工作区，本地库全部发生变化（一般只使用hard）</li>
<li>—mixed 参数表示暂存区，本地库发生变化，工作区不变（文件不变）</li>
<li>—soft 参数表示本地库发生变化，其他都不变</li>
</ul>
<p><img src="/2022/02/22/Git/7.png" alt></p>
</li>
<li><p>删除文件，和恢复文件</p>
<ul>
<li><p>删除（直接删除文件，在重新add，commit）</p>
<p><img src="/2022/02/22/Git/8.png" alt></p>
</li>
<li><p>恢复reset —hard [索引]</p>
<p><img src="/2022/02/22/Git/9.png" alt></p>
</li>
</ul>
</li>
<li><p>git diff （比对所有暂存区文件和工作区文件）</p>
<ul>
<li>git diff [文件名] 比对单个文件</li>
<li>git diff HEAD [文件名] 暂存区和当前指针对应的本地库文件进行比对。（HEAD 改为索引号，指定对应版本比较）</li>
</ul>
<p><img src="/2022/02/22/Git/10.png" alt></p>
</li>
</ul>
<h2 id="六、分支"><a href="#六、分支" class="headerlink" title="六、分支"></a>六、分支</h2><h3 id="1-分支概念"><a href="#1-分支概念" class="headerlink" title="1.分支概念"></a>1.分支概念</h3><p><img src="/2022/02/22/Git/11.png" alt></p>
<h3 id="2-查看分支"><a href="#2-查看分支" class="headerlink" title="2. 查看分支"></a>2. 查看分支</h3><ul>
<li><p>git branch -v  (查看所有分支)</p>
<p><img src="/2022/02/22/Git/12.png" alt></p>
</li>
</ul>
<h3 id="3-创建分支"><a href="#3-创建分支" class="headerlink" title="3. 创建分支"></a>3. 创建分支</h3><ul>
<li><p>git branch [分支名称]</p>
<p><img src="/2022/02/22/Git/13.png" alt></p>
</li>
</ul>
<h3 id="4-切换分支"><a href="#4-切换分支" class="headerlink" title="4. 切换分支"></a>4. 切换分支</h3><ul>
<li><p>git checkout [分支名称]</p>
<p><img src="/2022/02/22/Git/14.png" alt></p>
</li>
</ul>
<h3 id="5-将分支合并到主分支"><a href="#5-将分支合并到主分支" class="headerlink" title="5. 将分支合并到主分支"></a>5. 将分支合并到主分支</h3><ol>
<li><p>切换到主分支</p>
</li>
<li><p>合并</p>
<ul>
<li><p>git merge [分支名称] （可能产生冲突:当不同分支修改同一个文件的同一行时）</p>
<p><img src="/2022/02/22/Git/15.png" alt></p>
<p><img src="/2022/02/22/Git/16.png" alt></p>
</li>
<li><p>如果有冲突，人工商议处理</p>
<ul>
<li><p>人工查看冲突文件并解决</p>
</li>
<li><p>重新add冲突文件</p>
<p><img src="/2022/02/22/Git/17.png" alt></p>
</li>
<li><p>重新commit（此时commit不可以带文件名）</p>
<p><img src="/2022/02/22/Git/18.png" alt></p>
</li>
<li><p>冲突解决，退出合并状态</p>
</li>
</ul>
</li>
</ul>
</li>
</ol>
]]></content>
      <categories>
        <category>git</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>GitHub</title>
    <url>/2022/02/23/GitHub/</url>
    <content><![CDATA[<h1 id="GitHub"><a href="#GitHub" class="headerlink" title="GitHub"></a>GitHub</h1><h2 id="一、本地库与远程库连接"><a href="#一、本地库与远程库连接" class="headerlink" title="一、本地库与远程库连接"></a>一、本地库与远程库连接</h2><h3 id="1、初始本地库"><a href="#1、初始本地库" class="headerlink" title="1、初始本地库"></a>1、初始本地库</h3><ol>
<li>git init</li>
<li>git add [文件名]</li>
<li>git commit -m “注释” [文件名]</li>
</ol>
<h3 id="2、创建github远程仓库"><a href="#2、创建github远程仓库" class="headerlink" title="2、创建github远程仓库"></a>2、创建github远程仓库</h3><p><img src="/2022/02/23/GitHub/1.png" alt></p>
<h3 id="3、在本地创建远程库地址的别名"><a href="#3、在本地创建远程库地址的别名" class="headerlink" title="3、在本地创建远程库地址的别名"></a>3、在本地创建远程库地址的别名</h3><ul>
<li><p>本地仓库每次与远程仓库交互需要知道远程仓库url地址（其地址一般很长）</p>
<ul>
<li><p>远程仓库url地址</p>
<ul>
<li><p>点击进入仓库</p>
<p><img src="/2022/02/23/GitHub/2.png" alt></p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>可以给远程仓库起别名，简化操作</p>
<ul>
<li>git remote -v （查看当前仓库远程库别名）</li>
<li><p>git remote add [别名] [远程地址]  （添加别名）</p>
<p><img src="/2022/02/23/GitHub/3.png" alt></p>
<p><img src="/2022/02/23/GitHub/4.png" alt></p>
</li>
</ul>
</li>
</ul>
<h3 id="4、推送操作"><a href="#4、推送操作" class="headerlink" title="4、推送操作"></a>4、推送操作</h3><ul>
<li><p>git push [别名] [分支]</p>
<p><img src="/2022/02/23/GitHub/5.png" alt></p>
<ul>
<li><p>推送后，第一次会提示输入github（或其他远程仓库）账号密码</p>
<p><img src="/2022/02/23/GitHub/6.png" alt></p>
</li>
<li><p>（github在2021/8/13日移除了账号密码远程推送的方式，改为personal access token）</p>
<ul>
<li><ol>
<li><p>进入GitHub（点击setting）</p>
<p><img src="/2022/02/23/GitHub/7.png" alt></p>
</li>
</ol>
</li>
<li><ol>
<li><p>点击developer setting</p>
<p><img src="/2022/02/23/GitHub/8.png" style="zoom: 67%;"></p>
</li>
</ol>
</li>
<li><ol>
<li><p>点击personal access token</p>
<p><img src="/2022/02/23/GitHub/9.png" alt></p>
</li>
</ol>
</li>
<li><ol>
<li><p>选中repo</p>
<p><img src="/2022/02/23/GitHub/10.png" alt></p>
</li>
</ol>
</li>
</ul>
</li>
<li><p>使用token后成功推送</p>
<p><img src="/2022/02/23/GitHub/11.png" alt></p>
</li>
</ul>
</li>
</ul>
<h3 id="5、克隆操作"><a href="#5、克隆操作" class="headerlink" title="5、克隆操作"></a>5、克隆操作</h3><ul>
<li><p>git clone [地址]（地址到github对应仓库复制）</p>
<ul>
<li><img src="/2022/02/23/GitHub/12.png" alt></li>
<li><img src="/2022/02/23/GitHub/13.png" alt></li>
</ul>
</li>
<li><p>clone命令完成操作：</p>
<ol>
<li>初始化本地库</li>
<li>将远程库内容完整的克隆到本地</li>
<li>替我们clone创建远程库别名</li>
</ol>
</li>
</ul>
<h2 id="二、团队开发"><a href="#二、团队开发" class="headerlink" title="二、团队开发"></a>二、团队开发</h2><p>如果是本机操作，会存在缓存，使得clone下来的仓库修改后，无需验证直接就可以push到远程仓库</p>
<ul>
<li><p>搜索windows 凭证</p>
<p><img src="/2022/02/23/GitHub/14.png" alt></p>
</li>
<li><p>删除github凭证</p>
<p><img src="/2022/02/23/GitHub/15.png" alt></p>
</li>
</ul>
<p>切换账号再push会出错，需要加入团队</p>
<h3 id="1-邀请成员加入"><a href="#1-邀请成员加入" class="headerlink" title="1. 邀请成员加入"></a>1. 邀请成员加入</h3><ul>
<li><p>登录项目创建者账号，进入共同开发仓库，点击settings</p>
</li>
<li><p>点击collaborators，点击add people</p>
<p><img src="/2022/02/23/GitHub/16.png" alt></p>
<p><img src="/2022/02/23/GitHub/17.png" alt></p>
</li>
<li><p>复制邀请链接</p>
<p><img src="/2022/02/23/GitHub/18.png" alt></p>
</li>
<li><p>登录被邀请人账号，复制链接到url地址栏，回车</p>
<ul>
<li>点击接受邀请</li>
</ul>
</li>
</ul>
<h3 id="2-远程库修改拉取（远程库变动后拉取）"><a href="#2-远程库修改拉取（远程库变动后拉取）" class="headerlink" title="2. 远程库修改拉取（远程库变动后拉取）"></a>2. 远程库修改拉取（远程库变动后拉取）</h3><h4 id="一、git-pull-远程库别名-分支"><a href="#一、git-pull-远程库别名-分支" class="headerlink" title="一、git pull [远程库别名] [分支]"></a>一、git pull [远程库别名] [分支]</h4><p>pull操作相当于fetch + merge</p>
<ul>
<li>git fetch [远程库别名] [分支]<ul>
<li>此操作只是将远程库内容下载到本地库，工作区中文件不变</li>
</ul>
</li>
<li>git checkout [远程库别名] /[分支]<ul>
<li>git fetch后此操作可以进入本地拉取的远程库查看远程库文件</li>
</ul>
</li>
<li>git merge [远程库别名]/[分支]<ul>
<li>此操作合并当前分支和远程库分支</li>
</ul>
</li>
</ul>
<h4 id="二、协同开发冲突问题"><a href="#二、协同开发冲突问题" class="headerlink" title="二、协同开发冲突问题"></a>二、协同开发冲突问题</h4><p>流程：</p>
<ol>
<li><p>A创建仓库，邀请B加入</p>
</li>
<li><p>A push文件1.txt</p>
</li>
<li><p>B pull文件1.txt</p>
</li>
<li><p>A 修改文件1.txt第一行，push</p>
</li>
<li><p>B 修改文件1.txt第一行，push（此时产生冲突）</p>
</li>
<li><p>发现冲突，push失败</p>
</li>
<li><p>此时应该先拉取，然后人为解决冲突</p>
<p><img src="/2022/02/23/GitHub/19.png" alt></p>
<p><img src="/2022/02/23/GitHub/20.png" alt></p>
</li>
<li><p>解决冲突后提交到本地库</p>
</li>
<li><p>推送到服务端</p>
</li>
</ol>
<h2 id="三、跨团队开发"><a href="#三、跨团队开发" class="headerlink" title="三、跨团队开发"></a>三、跨团队开发</h2><h3 id="步骤："><a href="#步骤：" class="headerlink" title="步骤："></a>步骤：</h3><ol>
<li><p>进入A团队项目仓库，复制仓库地址</p>
</li>
<li><p>登录B团队项目仓库，进行fork操作：</p>
<ul>
<li><p>将复制的地址，复制到地址栏，回车</p>
</li>
<li><p>点击fork</p>
<p><img src="/2022/02/23/GitHub/21.png" alt></p>
</li>
</ul>
</li>
<li><p>B团队从B团队项目仓库clone项目到本地</p>
</li>
<li><p>更改数据</p>
</li>
<li><p>添加到暂存区，提交到本地库</p>
</li>
<li><p>将修改push到服务端B团队项目仓库</p>
</li>
<li><p>回到B团队项目仓库，点击Pull requests</p>
<p><img src="/2022/02/23/GitHub/22.png" alt></p>
</li>
<li><p>点击new pull request，输入请求信息</p>
<p><img src="/2022/02/23/GitHub/23.png" alt></p>
<p><img src="/2022/02/23/GitHub/24.png" alt></p>
<p><img src="/2022/02/23/GitHub/25.png" alt></p>
</li>
<li><p>登录A团队仓库，点击pull request，，点击commit回复消息</p>
<p><img src="/2022/02/23/GitHub/26.png" alt></p>
<p><img src="/2022/02/23/GitHub/27.png" alt></p>
</li>
<li><p>查看消息（file changed），点击merge pull request 合并分支</p>
<p><img src="/2022/02/23/GitHub/28.png" alt></p>
</li>
</ol>
<h2 id="四、ssh免密登录"><a href="#四、ssh免密登录" class="headerlink" title="四、ssh免密登录"></a>四、ssh免密登录</h2><h3 id="1-进入用户主目录（git-bash）"><a href="#1-进入用户主目录（git-bash）" class="headerlink" title="1. 进入用户主目录（git bash）"></a>1. 进入用户主目录（git bash）</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd ~  //进入主目录</span><br></pre></td></tr></table></figure>
<h3 id="2-执行命令，生成-ssh目录"><a href="#2-执行命令，生成-ssh目录" class="headerlink" title="2. 执行命令，生成.ssh目录"></a>2. 执行命令，生成.ssh目录</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa -C [邮箱]</span><br></pre></td></tr></table></figure>
<p>三次回车确认，生成.ssh目录</p>
<h3 id="3-C-Users-用户名-ssh目录下，打开id-rsa-pub文件，复制内容"><a href="#3-C-Users-用户名-ssh目录下，打开id-rsa-pub文件，复制内容" class="headerlink" title="3. C:\Users[用户名]\.ssh目录下，打开id_rsa.pub文件，复制内容"></a>3. C:\Users[用户名]\.ssh目录下，打开id_rsa.pub文件，复制内容</h3><p><img src="/2022/02/23/GitHub/29.png" alt></p>
<h3 id="4-进入github，点击setting，选择ssh-and-gpg-keys"><a href="#4-进入github，点击setting，选择ssh-and-gpg-keys" class="headerlink" title="4. 进入github，点击setting，选择ssh and gpg keys"></a>4. 进入github，点击setting，选择ssh and gpg keys</h3><p><img src="/2022/02/23/GitHub/30.png" alt></p>
<h3 id="5-点击new-SSH-key"><a href="#5-点击new-SSH-key" class="headerlink" title="5. 点击new SSH key"></a>5. 点击new SSH key</h3><p><img src="/2022/02/23/GitHub/31.png" alt></p>
<h3 id="6-添加ssh别名"><a href="#6-添加ssh别名" class="headerlink" title="6. 添加ssh别名"></a>6. 添加ssh别名</h3><p>git remote add [别名] [ssh地址]</p>
<p><img src="/2022/02/23/GitHub/32.png" alt></p>
<h1 id="五、github被墙无法提交代码解决方案"><a href="#五、github被墙无法提交代码解决方案" class="headerlink" title="五、github被墙无法提交代码解决方案"></a>五、github被墙无法提交代码解决方案</h1><p>使用vpn代理</p>
<p>git配置代理的方式：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git config --global http.proxy &quot;127.0.0.1:8787&quot;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>GitHub</category>
      </categories>
      <tags>
        <tag>GitHub</tag>
      </tags>
  </entry>
  <entry>
    <title>JSON</title>
    <url>/2022/02/18/JSON/</url>
    <content><![CDATA[<h1 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h1><h2 id="一、概念"><a href="#一、概念" class="headerlink" title="一、概念"></a>一、概念</h2><p>JSON(JavaScript Object Notation, JS 对象简谱) 是一种轻量级的数据交换格式。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">a</span>: <span class="string">&#x27;Hello&#x27;</span>, <span class="attr">b</span>: <span class="string">&#x27;World&#x27;</span>&#125;; <span class="comment">//这是一个对象，注意键名也是可以使用引号包裹的</span></span><br><span class="line"><span class="keyword">var</span> json = <span class="string">&#x27;&#123;&quot;a&quot;: &quot;Hello&quot;, &quot;b&quot;: &quot;World&quot;&#125;&#x27;</span>; <span class="comment">//这是一个 JSON 字符串，本质是一个字符串</span></span><br></pre></td></tr></table></figure>
<h3 id="JSON-格式评估为-JavaScript-对象"><a href="#JSON-格式评估为-JavaScript-对象" class="headerlink" title="JSON 格式评估为 JavaScript 对象"></a>JSON 格式评估为 JavaScript 对象</h3><p>JSON 格式在语法上与创建 JavaScript 对象的代码相同。</p>
<p>由于这种相似性，JavaScript 程序可以很容易地将 JSON 数据转换成本地的 JavaScript 对象。</p>
<h3 id="JSON实例"><a href="#JSON实例" class="headerlink" title="JSON实例"></a>JSON实例</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;employees&quot;</span>:[</span><br><span class="line">    &#123;<span class="string">&quot;firstName&quot;</span>:<span class="string">&quot;Bill&quot;</span>, <span class="string">&quot;lastName&quot;</span>:<span class="string">&quot;Gates&quot;</span>&#125;, </span><br><span class="line">    &#123;<span class="string">&quot;firstName&quot;</span>:<span class="string">&quot;Steve&quot;</span>, <span class="string">&quot;lastName&quot;</span>:<span class="string">&quot;Jobs&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;firstName&quot;</span>:<span class="string">&quot;Alan&quot;</span>, <span class="string">&quot;lastName&quot;</span>:<span class="string">&quot;Turing&quot;</span>&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="二、语法"><a href="#二、语法" class="headerlink" title="二、语法"></a>二、语法</h2><h3 id="1-基本规则"><a href="#1-基本规则" class="headerlink" title="1. 基本规则"></a>1. 基本规则</h3><ul>
<li>数据是名称/值对：数据由键值对构成<ul>
<li>JSON 键名称需要双引号。JavaScript 名称不需要。</li>
<li>取值类型：<ul>
<li>数字</li>
<li>字符串</li>
<li>bool</li>
<li>数组：{“person”:[{“name”:”dd”},{“name”:”asd”}]}</li>
<li>对象：{“address”:{“province”:”asd”,”country”:”china”}}</li>
<li>null</li>
</ul>
</li>
</ul>
</li>
<li>数据由逗号分隔：多键值对，分割</li>
<li>花括号保存对象：{}定义json格式</li>
<li>方括号保存数组：[]</li>
</ul>
<h3 id="2-交换数据"><a href="#2-交换数据" class="headerlink" title="2. 交换数据"></a>2. 交换数据</h3><p>当数据在浏览器与服务器之间进行交换时，这些数据只能是文本。</p>
<p>JSON 属于文本，并且我们能够把任何 JavaScript 对象转换为 JSON，然后将 JSON 发送到服务器。</p>
<p>我们也能把从服务器接收到的任何 JSON 转换为 JavaScript 对象。</p>
<p>以这样的方式，我们能够把数据作为 JavaScript 对象来处理，无需复杂的解析和转译。</p>
<h3 id="3-发送数据（json对象转json字符串）"><a href="#3-发送数据（json对象转json字符串）" class="headerlink" title="3. * 发送数据（json对象转json字符串）"></a>3. * 发送数据（json对象转json字符串）</h3><p>​        如果您的数据存储在 JavaScript 对象中，您可以把该对象转换为 JSON，然后将其发送到服务器。</p>
<p>实例</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> myObj = &#123; <span class="attr">name</span>:<span class="string">&quot;Bill Gates&quot;</span>,  <span class="attr">age</span>:<span class="number">62</span>, <span class="attr">city</span>:<span class="string">&quot;Seattle&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> myJSON =  <span class="built_in">JSON</span>.stringify(myObj);</span><br><span class="line"><span class="built_in">window</span>.location = <span class="string">&quot;demo_json.php?x=&quot;</span> + myJSON;</span><br></pre></td></tr></table></figure>
<h3 id="4-接收数据（json字符串转json对象）"><a href="#4-接收数据（json字符串转json对象）" class="headerlink" title="4. * 接收数据（json字符串转json对象）"></a>4. * 接收数据（json字符串转json对象）</h3><p>​        如果您以 JSON 格式接收到数据，您能够将其转换为 JavaScript 对象：</p>
<p>实例</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> myJSON = <span class="string">&#x27;&#123; &quot;name&quot;:&quot;Bill Gates&quot;,  &quot;age&quot;:62, &quot;city&quot;:&quot;Seattle&quot; &#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> myObj =  <span class="built_in">JSON</span>.parse(myJSON);</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&quot;demo&quot;</span>).innerHTML = myObj.name;</span><br></pre></td></tr></table></figure>
<h3 id="5-存储数据"><a href="#5-存储数据" class="headerlink" title="5. * 存储数据"></a>5. * 存储数据</h3><p>​        在存储数据时，数据必须是某种具体的格式，并且无论您选择在何处存储它，文本永远是合法格式之一。</p>
<p>JSON 让 JavaScript 对象存储为文本成为可能。</p>
<p>实例</p>
<p>把数据存储在本地存储中</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//存储数据：</span></span><br><span class="line">myObj = &#123; <span class="attr">name</span>:<span class="string">&quot;Bill Gates&quot;</span>,  <span class="attr">age</span>:<span class="number">62</span>, <span class="attr">city</span>:<span class="string">&quot;Seattle&quot;</span> &#125;;</span><br><span class="line">myJSON =  <span class="built_in">JSON</span>.stringify(myObj);</span><br><span class="line"><span class="built_in">localStorage</span>.setItem(<span class="string">&quot;testJSON&quot;</span>, myJSON);</span><br><span class="line"></span><br><span class="line"><span class="comment">//接收数据：</span></span><br><span class="line">text = <span class="built_in">localStorage</span>.getItem(<span class="string">&quot;testJSON&quot;</span>);</span><br><span class="line">obj =  <span class="built_in">JSON</span>.parse(text);</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&quot;demo&quot;</span>).innerHTML = obj.name;</span><br></pre></td></tr></table></figure>
<h3 id="6-遍历访问"><a href="#6-遍历访问" class="headerlink" title="6. * 遍历访问"></a>6. * 遍历访问</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1.直接访问有两种方式</span></span><br><span class="line">    <span class="comment">//1.json1.键</span></span><br><span class="line">    <span class="comment">//2.json1[&quot;键&quot;]</span></span><br><span class="line"><span class="comment">//2.遍历对象得到的是键值字符串</span></span><br><span class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> json1 = &#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;lx&quot;</span>,<span class="string">&quot;age&quot;</span>:<span class="number">12</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> json1) &#123;</span><br><span class="line">        <span class="comment">//i是键值&quot;name&quot; 和 &quot;age&quot;</span></span><br><span class="line">        alert(i+<span class="string">&quot;:&quot;</span>+json1[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//3.数组遍历：两层for循环</span></span><br><span class="line"><span class="comment">//json1[index][key]取值</span></span><br><span class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> json1 = [&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;lx&quot;</span>,<span class="string">&quot;age&quot;</span>:<span class="number">12</span>&#125;,&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;lx1&quot;</span>,<span class="string">&quot;age&quot;</span>:<span class="number">12</span>&#125;,&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;lx2&quot;</span>,<span class="string">&quot;age&quot;</span>:<span class="number">12</span>&#125;];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;json1.length;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> json1[i])&#123;</span><br><span class="line">            alert(key+<span class="string">&quot;:&quot;</span>+json1[i][key]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="三、JSON数据和Java对象的相互转换"><a href="#三、JSON数据和Java对象的相互转换" class="headerlink" title="三、JSON数据和Java对象的相互转换"></a>三、JSON数据和Java对象的相互转换</h2><h3 id="1-JSON常见解析器："><a href="#1-JSON常见解析器：" class="headerlink" title="1. JSON常见解析器："></a>1. JSON常见解析器：</h3><ul>
<li>常见的解析器：Jsonlib，Gson，fastjson，jackson</li>
</ul>
<h3 id="2-jackson使用"><a href="#2-jackson使用" class="headerlink" title="2. jackson使用"></a>2. jackson使用</h3><ul>
<li><p>JSON转Java对象</p>
<ul>
<li><p>导入jackson相关jar包</p>
</li>
<li><p>创建jackson核心对象ObjecMapper</p>
</li>
<li><p>调ObjectMapper相关方法</p>
<ul>
<li><p>方法1：readValue(json字符串数据，Class)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jack_test3</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String json1 = <span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;asda\&quot;,\&quot;age\&quot;:12,\&quot;hobby\&quot;:\&quot;跑步\&quot;,\&quot;birthday\&quot;:\&quot;2022-2-18\&quot;&#125;&quot;</span>;</span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        person p = objectMapper.readValue(json1, person.class);</span><br><span class="line">        System.out.println(p);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Java对象转JSON</p>
<ul>
<li><p>使用步骤：</p>
<ol>
<li><p>导入jackson相关jar包</p>
</li>
<li><p>创建jackson核心对象ObjecMapper</p>
</li>
<li><p>调ObjectMapper相关方法</p>
<ul>
<li><p>方法1：writeValue(参数1，obj):</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*方法1：writeValue(参数1，obj):</span></span><br><span class="line"><span class="comment">* 参数1:</span></span><br><span class="line"><span class="comment">*  File:将obj对d象转换为JSON字符串，并保存到指定的文件File中</span></span><br><span class="line"><span class="comment">*  writer:将obj对象转换为JSON字符串，并将json数据填充到字符输出流writer中</span></span><br><span class="line"><span class="comment">*  outputStream:将obj对象转换为JSON字符串，并将json数据填充到字节输出流outputStream中</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jack_test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String json1 = <span class="string">&quot;&#123;&#x27;name&#x27;:&#x27;asda&#x27;,&#x27;age&#x27;:12&#125;&quot;</span>;</span><br><span class="line">        person p = <span class="keyword">new</span> person();</span><br><span class="line">        p.setAge(<span class="number">12</span>);</span><br><span class="line">        p.setHobby(<span class="string">&quot;跑步&quot;</span>);</span><br><span class="line">        p.setName(<span class="string">&quot;lx&quot;</span>);</span><br><span class="line">        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        mapper.writeValue(<span class="keyword">new</span> File(<span class="string">&quot;f://a.txt&quot;</span>),p);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
</ul>
<pre><code>   * 方法2：writeValueAsString(obj):将对象转为JSON字符串

     <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jack_test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String json1 = <span class="string">&quot;&#123;&#x27;name&#x27;:&#x27;asda&#x27;,&#x27;age&#x27;:12&#125;&quot;</span>;</span><br><span class="line">        person p = <span class="keyword">new</span> person();</span><br><span class="line">        p.setAge(<span class="number">12</span>);</span><br><span class="line">        p.setHobby(<span class="string">&quot;跑步&quot;</span>);</span><br><span class="line">        p.setName(<span class="string">&quot;lx&quot;</span>);</span><br><span class="line">        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        String s = mapper.writeValueAsString(p);</span><br><span class="line">    	System.out.println(s);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</code></pre><ul>
<li><p>注解学习：</p>
<ol>
<li><p>@JsonIgnore：排除属性（添加到属性或者get方法上）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">person</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    String hobby;</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    Date birthday;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>@JsonFormat：属性格式化</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">person</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    String hobby;</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line">    Date birthday;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>复杂java对象转换</p>
<ol>
<li><p>List（数组）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jack_test1</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String json1 = <span class="string">&quot;&#123;&#x27;name&#x27;:&#x27;asda&#x27;,&#x27;age&#x27;:12&#125;&quot;</span>;</span><br><span class="line">        person p = <span class="keyword">new</span> person();</span><br><span class="line">        p.setAge(<span class="number">12</span>);</span><br><span class="line">        p.setHobby(<span class="string">&quot;跑步&quot;</span>);</span><br><span class="line">        p.setName(<span class="string">&quot;lx&quot;</span>);</span><br><span class="line">        p.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">        person p1 = <span class="keyword">new</span> person();</span><br><span class="line">        p1.setAge(<span class="number">12</span>);</span><br><span class="line">        p1.setHobby(<span class="string">&quot;跑步&quot;</span>);</span><br><span class="line">        p1.setName(<span class="string">&quot;lx&quot;</span>);</span><br><span class="line">        p1.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">        person p2 = <span class="keyword">new</span> person();</span><br><span class="line">        p2.setAge(<span class="number">12</span>);</span><br><span class="line">        p2.setHobby(<span class="string">&quot;跑步&quot;</span>);</span><br><span class="line">        p2.setName(<span class="string">&quot;lx&quot;</span>);</span><br><span class="line">        p2.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">        ArrayList&lt;person&gt; plist = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        plist.add(p);</span><br><span class="line">        plist.add(p1);</span><br><span class="line">        plist.add(p2);</span><br><span class="line">        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        String s = mapper.writeValueAsString(plist);</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
<pre><code>2. Map（对象）

   <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jack_test2</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Map&lt;String,String&gt; mam1 = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        mam1.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;lx&quot;</span>);</span><br><span class="line">        mam1.put(<span class="string">&quot;age&quot;</span>,<span class="string">&quot;12&quot;</span>);</span><br><span class="line">        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        String s = mapper.writeValueAsString(mam1);</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</code></pre><h2 id="四、案例"><a href="#四、案例" class="headerlink" title="四、案例"></a>四、案例</h2><ol>
<li><p>判断用户名是否存在</p>
<ul>
<li><p>服务器响应的数据，在客户端使用时想要当作json数据格式使用</p>
<ol>
<li><p>$.get(…,”json”):设置最后一个参数为“json”</p>
</li>
<li><p>或者设置respond的MIME类型：application/json</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">response.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
</li>
</ol>
]]></content>
      <categories>
        <category>JSON</category>
      </categories>
      <tags>
        <tag>JSON</tag>
      </tags>
  </entry>
  <entry>
    <title>JUC</title>
    <url>/2022/05/25/JUC/</url>
    <content><![CDATA[<h1 id="JUC"><a href="#JUC" class="headerlink" title="JUC"></a>JUC</h1><h2 id="一、开启线程"><a href="#一、开启线程" class="headerlink" title="一、开启线程"></a>一、开启线程</h2><p>Thread.start()</p>
<p>获取线程类对象的方式</p>
<ol>
<li>继承Thread类</li>
<li>实现Runnable接口</li>
<li>new Thread(Runnable r)  ——-传入实现了Runnable接口的实例对象</li>
<li>new Thread（()-&gt;{}） —————-lambda表达式</li>
<li>new Thread(FutureTask ft) ——传入FutureTask对象实例<ul>
<li>new FutureTask(Callable c) </li>
</ul>
</li>
</ol>
]]></content>
      <categories>
        <category>JUC</category>
      </categories>
      <tags>
        <tag>JUC</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx学习</title>
    <url>/2022/06/03/Nginx/</url>
    <content><![CDATA[<h1 id="安装虚拟机软件"><a href="#安装虚拟机软件" class="headerlink" title="安装虚拟机软件"></a>安装虚拟机软件</h1><p>VMware 建议安装16.1以上版本</p>
<h1 id="VMware安装CentOS7"><a href="#VMware安装CentOS7" class="headerlink" title="VMware安装CentOS7"></a>VMware安装CentOS7</h1><h2 id="1-选择镜像文件开始安装"><a href="#1-选择镜像文件开始安装" class="headerlink" title="1. 选择镜像文件开始安装"></a>1. 选择镜像文件开始安装</h2><h2 id="2-让虚拟机可以联网"><a href="#2-让虚拟机可以联网" class="headerlink" title="2. 让虚拟机可以联网"></a>2. 让虚拟机可以联网</h2><ul>
<li>ip addr查看发现网卡没有IP地址</li>
</ul>
<p><img src="/2022/06/03/Nginx/1.png" alt="image-20220603141611917"></p>
<ul>
<li>修改网卡配置</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-ens33</span><br></pre></td></tr></table></figure>
<p><img src="/2022/06/03/Nginx/2.png" alt="image-20220603142700843"></p>
<ul>
<li>重启网络服务</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">systemctl restart network</span><br></pre></td></tr></table></figure>
<ul>
<li>测试</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ping qq.com</span><br></pre></td></tr></table></figure>
<p><img src="/2022/06/03/Nginx/3.png" alt="image-20220603143757261"></p>
<h2 id="3-配置静态ip"><a href="#3-配置静态ip" class="headerlink" title="3. 配置静态ip"></a>3. 配置静态ip</h2><p>之前的网络配置是使用dhcp方式分配ip地址，这种方式会在系统每次联网的时候分配一个ip给我们用，也就是说有可能系统下次启动的时候ip会变，这样非常不方便我们管理。 </p>
<ul>
<li>配置静态ip首先需要打开网卡配置文件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-ens33</span><br></pre></td></tr></table></figure>
<p>修改启动协议</p>
<ul>
<li>BOOTPROTO=static </li>
</ul>
<p>手动配置ip地址</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">IPADDR=192.168.44.101</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=192.168.44.1</span><br><span class="line">DNS1=8.8.8.8</span><br></pre></td></tr></table></figure>
<p>根据自己的环境，ip地址可能略有不同。 </p>
<p><img src="/2022/06/03/Nginx/5.png" alt></p>
<p><img src="/2022/06/03/Nginx/4.png" alt="image-20220603162311832"></p>
<p>接下来重启网络服务 </p>
<ul>
<li>systemctl restart network </li>
</ul>
<p>重启之后 xshell可能无响应，这是因为ip变了，修改xshell配置中的ip重新连接即可。</p>
<h1 id="安装Nginx"><a href="#安装Nginx" class="headerlink" title="安装Nginx"></a>安装Nginx</h1><ul>
<li>安装前可以先克隆保存当前状态</li>
</ul>
<p><img src="/2022/06/03/Nginx/6.png" alt="image-20220603173328885"></p>
<p><img src="/2022/06/03/Nginx/7.png" alt="image-20220603173405692"></p>
<h2 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h2><ul>
<li>将Nginx压缩包解压出来</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tar zxvf nginx-1.21.6.tar.gz </span><br></pre></td></tr></table></figure>
<h2 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./configure --prefix=/usr/local/nginx make make install </span><br></pre></td></tr></table></figure>
<h2 id="如果出现警告或报错"><a href="#如果出现警告或报错" class="headerlink" title="如果出现警告或报错"></a>如果出现警告或报错</h2><p>提示 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">checking for OS + Linux 3.10.0-693.el7.x86_64 x86_64 checking for C compiler ... not found ./configure: error: C compiler cc is not found </span><br></pre></td></tr></table></figure>
<p>安装gcc</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yum install -y gcc </span><br></pre></td></tr></table></figure>
<p>提示： </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./configure: error: the HTTP rewrite module requires the PCRE library. You can either disable the module by using --without-http_rewrite_module option, or install the PCRE library into the system, or build the PCRE library statically from the source with nginx by using --with-pcre= option. </span><br></pre></td></tr></table></figure>
<p>安装perl库 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yum install -y pcre pcre-devel </span><br></pre></td></tr></table></figure>
<p>提示：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./configure: error: the HTTP gzip module requires the zlib library. You can either disable the module by using --without-http_gzip_module option, or install the zlib library into the system, or build the zlib library statically from the source with nginx by using --with-zlib= option. </span><br></pre></td></tr></table></figure>
<p>安装zlib库 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yum install -y zlib zlib-devel </span><br></pre></td></tr></table></figure>
<p>接下来执行 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./configure --prefix=/usr/local/nginx</span><br><span class="line"></span><br><span class="line">make </span><br><span class="line"></span><br><span class="line">make install </span><br></pre></td></tr></table></figure>
<h2 id="启动Nginx"><a href="#启动Nginx" class="headerlink" title="启动Nginx"></a>启动Nginx</h2><p>进入安装好的目录 /usr/local/nginx/sbin </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./nginx 启动 </span><br><span class="line"></span><br><span class="line">./nginx -s stop 快速停止 </span><br><span class="line"></span><br><span class="line">./nginx -s quit 优雅关闭，在退出前完成已经接受的连接请求</span><br><span class="line"></span><br><span class="line">./nginx -s reload 重新加载配置</span><br></pre></td></tr></table></figure>
<ul>
<li>启动后关闭防火墙，输入虚拟机ip就可以访问了</li>
</ul>
<h2 id="关于防火墙"><a href="#关于防火墙" class="headerlink" title="关于防火墙"></a>关于防火墙</h2><p>关闭防火墙 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">systemctl stop firewalld.service </span><br></pre></td></tr></table></figure>
<p>禁止防火墙开机启动 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">systemctl disable firewalld.service </span><br></pre></td></tr></table></figure>
<p>放行端口 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=80/tcp --permanent </span><br></pre></td></tr></table></figure>
<p>重启防火墙 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>
<h2 id="安装成系统服务"><a href="#安装成系统服务" class="headerlink" title="安装成系统服务"></a>安装成系统服务</h2><p>创建服务脚本 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vi /usr/lib/systemd/system/nginx.service </span><br></pre></td></tr></table></figure>
<p>服务脚本内容 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[Unit] Description=nginx - web server </span><br><span class="line">After=network.target remote-fs.target nss-lookup.target </span><br><span class="line">[Service] </span><br><span class="line">Type=forking </span><br><span class="line">PIDFile=/usr/local/nginx/logs/nginx.pid </span><br><span class="line">ExecStartPre=/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf </span><br><span class="line">ExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf </span><br><span class="line">ExecReload=/usr/local/nginx/sbin/nginx -s reload </span><br><span class="line">ExecStop=/usr/local/nginx/sbin/nginx -s stop </span><br><span class="line">ExecQuit=/usr/local/nginx/sbin/nginx -s quit </span><br><span class="line">PrivateTmp=true </span><br><span class="line"></span><br><span class="line">[Install] </span><br><span class="line">WantedBy=multi-user.target </span><br></pre></td></tr></table></figure>
<p>重新加载系统服务 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">systemctl daemon-reload </span><br></pre></td></tr></table></figure>
<p>启动服务 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">systemctl start nginx.service </span><br></pre></td></tr></table></figure>
<p>开机启动 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">systemctl enable nginx.service</span><br></pre></td></tr></table></figure>
<h1 id="1-反向代理"><a href="#1-反向代理" class="headerlink" title="1. 反向代理"></a>1. 反向代理</h1><p>关于代理</p>
<p>说到代理，首先我们要明确一个概念，所谓代理就是一个代表、一个渠道；</p>
<p>此时就设计到两个角色，一个是被代理角色，一个是目标角色，被代理角色通过这个代理访问目标角色完成一些任务的过程称为代理操作过程；如同生活中的专卖店~客人到adidas专卖店买了一双鞋，这个专卖店就是代理，被代理角色就是adidas厂家，目标角色就是用户</p>
<p><img src="/2022/06/03/Nginx/8.png" alt="img"></p>
<p>正向代理</p>
<p>说反向代理之前，我们先看看正向代理，正向代理也是大家最常接触的到的代理模式，我们会从两个方面来说关于正向代理的处理模式，分别从软件方面和生活方面来解释一下什么叫正向代理</p>
<p>正向代理最大的特点是客户端非常明确要访问的服务器地址；服务器只清楚请求来自哪个<a href="https://so.csdn.net/so/search?q=代理服务器&amp;spm=1001.2101.3001.7020">代理服务器</a>，而不清楚来自哪个具体的客户端；正向代理模式屏蔽或者隐藏了真实客户端信息。</p>
<p>举例图片审核不过 大家自行理解吧</p>
<p>反向代理</p>
<p>明白了什么是正向代理，我们继续看关于反向代理的处理方式，举例如我大天朝的某宝网站，每天同时连接到网站的访问人数已经爆表，单个服务器远远不能满足人民日益增长的购买欲望了，此时就出现了一个大家耳熟能详的名词：分布式部署；也就是通过部署多台服务器来解决访问人数限制的问题；某宝网站中大部分功能也是直接使用nginx进行反向代理实现的，并且通过封装nginx和其他的组件之后起了个高大上的名字：Tengine，有兴趣的童鞋可以访问Tengine的官网查看具体的信息：<a href="http://tengine.taobao.org/">http://tengine.taobao.org/</a><br>那么反向代理具体是通过什么样的方式实现的分布式的集群操作呢，我们先看一个示意图：</p>
<p><img src="/2022/06/03/Nginx/9.png" alt="img"></p>
<p>通过上述的图解大家就可以看清楚了，多个客户端给服务器发送的请求，nginx服务器接收到之后，按照一定的规则分发给了后端的业务处理服务器进行处理了。此时~请求的来源也就是客户端是明确的，但是请求具体由哪台服务器处理的并不明确了，nginx扮演的就是一个反向代理角色</p>
<p>反向代理，主要用于服务器集群分布式部署的情况下，反向代理隐藏了服务器的信息！</p>
<p>项目场景</p>
<p>通常情况下，我们在实际项目操作时，正向代理和反向代理很有可能会存在在一个应用场景中，正向代理代理客户端的请求去访问目标服务器，目标服务器是一个反向单利服务器，反向代理了多台真实的业务处理服务器。具体的拓扑图如下：</p>
<p><img src="/2022/06/03/Nginx/10.png" alt="img"></p>
<h1 id="2-负载均衡"><a href="#2-负载均衡" class="headerlink" title="2. 负载均衡"></a>2. 负载均衡</h1><p>我们已经明确了所谓代理服务器的概念，那么接下来，nginx扮演了反向代理服务器的角色，它是以依据什么样的规则进行请求分发的呢？不用的项目应用场景，分发的规则是否可以控制呢？</p>
<p>这里提到的客户端发送的、nginx反向代理服务器接收到的请求数量，就是我们说的负载量</p>
<p>请求数量按照一定的规则进行分发到不同的服务器处理的规则，就是一种均衡规则</p>
<p>所以~将服务器接收到的请求按照规则分发的过程，称为负载均衡。</p>
<p>负载均衡在实际项目操作过程中，有硬件负载均衡和软件负载均衡两种，硬件负载均衡也称为硬负载，如F5负载均衡，相对造价昂贵成本较高，但是数据的稳定性安全性等等有非常好的保障，如中国移动中国联通这样的公司才会选择硬负载进行操作；更多的公司考虑到成本原因，会选择使用软件负载均衡，软件负载均衡是利用现有的技术结合主机硬件实现的一种消息队列分发机制</p>
<p><img src="/2022/06/03/Nginx/11.png" alt="img"></p>
<p>nginx支持的负载均衡调度算法方式如下：</p>
<ol>
<li>weight轮询（默认）：接收到的请求按照顺序逐一分配到不同的后端服务器，即使在使用过程中，某一台后端服务器宕机，nginx会自动将该服务器剔除出队列，请求受理情况不会受到任何影响。 这种方式下，可以给不同的后端服务器设置一个权重值（weight），用于调整不同的服务器上请求的分配率；权重数据越大，被分配到请求的几率越大；该权重值，主要是针对实际工作环境中不同的后端服务器硬件配置进行调整的。</li>
<li>ip_hash：每个请求按照发起客户端的ip的hash结果进行匹配，这样的算法下一个固定ip地址的客户端总会访问到同一个后端服务器，这也在一定程度上解决了集群部署环境下session共享的问题。</li>
<li>fair：智能调整调度算法，动态的根据后端服务器的请求处理到响应的时间进行均衡分配，响应时间短处理效率高的服务器分配到请求的概率高，响应时间长处理效率低的服务器分配到的请求少；结合了前两者的优点的一种调度算法。但是需要注意的是nginx默认不支持fair算法，如果要使用这种调度算法，请安装upstream_fair模块</li>
<li>url_hash：按照访问的url的hash结果分配请求，每个请求的url会指向后端固定的某个服务器，可以在nginx作为静态服务器的情况下提高缓存效率。同样要注意nginx默认不支持这种调度算法，要使用的话需要安装nginx的hash软件包</li>
</ol>
<h1 id="nginx配置"><a href="#nginx配置" class="headerlink" title="nginx配置"></a>nginx配置</h1><p>nginx是一个功能非常强大的web服务器加反向代理服务器，同时又是邮件服务器等等</p>
<p>在项目使用中，使用最多的三个核心功能是反向代理、负载均衡和静态服务器</p>
<p>这三个不同的功能的使用，都跟nginx的配置密切相关，nginx服务器的配置信息主要集中在nginx.conf这个配置文件中，并且所有的可配置选项大致分为以下几个部分</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">main # 全局配置</span><br><span class="line"></span><br><span class="line">events &#123; # nginx工作模式配置</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123; # http设置</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line"> server &#123; # 服务器主机配置</span><br><span class="line"> ....</span><br><span class="line"> location &#123; # 路由配置</span><br><span class="line"> ....</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> location path &#123;</span><br><span class="line"> ....</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> location otherpath &#123;</span><br><span class="line"> ....</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> server &#123;</span><br><span class="line"> ....</span><br><span class="line"> </span><br><span class="line"> location &#123;</span><br><span class="line"> ....</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> upstream name &#123; # 负载均衡配置</span><br><span class="line"> ....</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>如上述配置文件所示，主要由6个部分组成：</p>
<ol>
<li>main：用于进行nginx全局信息的配置</li>
<li>events：用于nginx工作模式的配置</li>
<li>http：用于进行http协议信息的一些配置</li>
<li>server：用于进行服务器访问信息的配置</li>
<li>location：用于进行访问路由的配置</li>
<li>upstream：用于进行负载均衡的配置</li>
</ol>
<h3 id="main模块"><a href="#main模块" class="headerlink" title="main模块"></a>main模块</h3><p>观察下面的配置代码</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># user nobody nobody;</span><br><span class="line">worker_processes 2;</span><br><span class="line"># error_log logs/error.log</span><br><span class="line"># error_log logs/error.log notice</span><br><span class="line"># error_log logs/error.log info</span><br><span class="line"># pid logs/nginx.pid</span><br><span class="line">worker_rlimit_nofile 1024;</span><br></pre></td></tr></table></figure>
<p>上述配置都是存放在main全局配置模块中的配置项</p>
<ul>
<li>user用来指定nginx worker进程运行用户以及用户组，默认nobody账号运行</li>
<li>worker_processes指定nginx要开启的子进程数量，运行过程中监控每个进程消耗内存(一般几M~几十M不等)根据实际情况进行调整，通常数量是CPU内核数量的整数倍</li>
<li>error_log定义错误日志文件的位置及输出级别【debug / info / notice / warn / error / crit】</li>
<li>pid用来指定进程id的存储文件的位置</li>
<li>worker_rlimit_nofile用于指定一个进程可以打开最多文件数量的描述</li>
</ul>
<h3 id="event-模块"><a href="#event-模块" class="headerlink" title="event 模块"></a>event 模块</h3><p>上干货</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">event &#123;</span><br><span class="line">worker_connections 1024;</span><br><span class="line">multi_accept on;</span><br><span class="line">use epoll;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述配置是针对nginx服务器的工作模式的一些操作配置</p>
<ul>
<li>worker_connections 指定最大可以同时接收的连接数量，这里一定要注意，最大连接数量是和worker processes共同决定的。</li>
<li>multi_accept 配置指定nginx在收到一个新连接通知后尽可能多的接受更多的连接</li>
<li>use epoll 配置指定了线程轮询的方法，如果是linux2.6+，使用epoll，如果是BSD如Mac请使用Kqueue</li>
</ul>
<h3 id="http模块"><a href="#http模块" class="headerlink" title="http模块"></a>http模块</h3><p>作为web服务器，http模块是nginx最核心的一个模块，配置项也是比较多的，项目中会设置到很多的实际业务场景，需要根据硬件信息进行适当的配置，常规情况下，使用默认配置即可！</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">##</span><br><span class="line"># 基础配置</span><br><span class="line">##</span><br><span class="line"></span><br><span class="line">sendfile on;</span><br><span class="line">tcp_nopush on;</span><br><span class="line">tcp_nodelay on;</span><br><span class="line">keepalive_timeout 65;</span><br><span class="line"> types_hash_max_size 2048;</span><br><span class="line"> # server_tokens off;</span><br><span class="line"> </span><br><span class="line"> # server_names_hash_bucket_size 64;</span><br><span class="line"> # server_name_in_redirect off;</span><br><span class="line"> </span><br><span class="line"> include /etc/nginx/mime.types;</span><br><span class="line"> default_type application/octet-stream;</span><br><span class="line"> </span><br><span class="line"> ##</span><br><span class="line"> # SSL证书配置</span><br><span class="line"> ##</span><br><span class="line"> </span><br><span class="line"> ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # Dropping SSLv3, ref: POODLE</span><br><span class="line"> ssl_prefer_server_ciphers on;</span><br><span class="line"> </span><br><span class="line"> ##</span><br><span class="line"> # 日志配置</span><br><span class="line"> ##</span><br><span class="line"> </span><br><span class="line"> access_log /var/log/nginx/access.log;</span><br><span class="line"> error_log /var/log/nginx/error.log;</span><br><span class="line"> </span><br><span class="line"> ##</span><br><span class="line"> # Gzip 压缩配置</span><br><span class="line"> ##</span><br><span class="line"> </span><br><span class="line"> gzip on;</span><br><span class="line"> gzip_disable &quot;msie6&quot;;</span><br><span class="line"> </span><br><span class="line"># gzip_vary on;</span><br><span class="line"># gzip_proxied any;</span><br><span class="line"># gzip_comp_level 6;</span><br><span class="line"># gzip_buffers 16 8k;</span><br><span class="line"># gzip_http_version 1.1;</span><br><span class="line"># gzip_types text/plain text/css application/json application/javascript</span><br><span class="line"> text/xml application/xml application/xml+rss text/javascript;</span><br><span class="line"> </span><br><span class="line">##</span><br><span class="line"># 虚拟主机配置</span><br><span class="line">##</span><br><span class="line"> </span><br><span class="line"> include /etc/nginx/conf.d/*.conf;</span><br><span class="line"> include /etc/nginx/sites-enabled/*;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="（1-基础配置"><a href="#（1-基础配置" class="headerlink" title="（1) 基础配置"></a>（1) 基础配置</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. sendfile on：配置on让sendfile发挥作用，将文件的回写过程交给数据缓冲去去完成，而不是放在应用中完成，这样的话在性能提升有有好处</span><br><span class="line">2. tc_nopush on：让nginx在一个数据包中发送所有的头文件，而不是一个一个单独发</span><br><span class="line">3. tcp_nodelay on：让nginx不要缓存数据，而是一段一段发送，如果数据的传输有实时性的要求的话可以配置它，发送完一小段数据就立刻能得到返回值，但是不要滥用哦</span><br><span class="line">4. </span><br><span class="line">5. keepalive_timeout 10：给客户端分配连接超时时间，服务器会在这个时间过后关闭连接。一般设置时间较短，可以让nginx工作持续性更好</span><br><span class="line">6. client_header_timeout 10：设置请求头的超时时间</span><br><span class="line">7. client_body_timeout 10:设置请求体的超时时间</span><br><span class="line">8. send_timeout 10：指定客户端响应超时时间，如果客户端两次操作间隔超过这个时间，服务器就会关闭这个链接</span><br><span class="line">9. </span><br><span class="line">10. limit_conn_zone $binary_remote_addr zone=addr:5m ：设置用于保存各种key的共享内存的参数，</span><br><span class="line">11. limit_conn addr 100: 给定的key设置最大连接数</span><br><span class="line">12. </span><br><span class="line">13. server_tokens：虽然不会让nginx执行速度更快，但是可以在错误页面关闭nginx版本提示，对于网站安全性的提升有好处哦</span><br><span class="line">14. include /etc/nginx/mime.types：指定在当前文件中包含另一个文件的指令</span><br><span class="line">15. default_type application/octet-stream：指定默认处理的文件类型可以是二进制</span><br><span class="line">16. type_hash_max_size 2048：混淆数据，影响三列冲突率，值越大消耗内存越多，散列key冲突率会降低，检索速度更快；值越小key，占用内存较少，冲突率越高，检索速度变慢</span><br></pre></td></tr></table></figure>
<h4 id="（2-日志配置"><a href="#（2-日志配置" class="headerlink" title="（2) 日志配置"></a>（2) 日志配置</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. access_log logs/access.log：设置存储访问记录的日志</span><br><span class="line">2. error_log logs/error.log：设置存储记录错误发生的日志</span><br></pre></td></tr></table></figure>
<h4 id="（3-SSL证书加密"><a href="#（3-SSL证书加密" class="headerlink" title="（3) SSL证书加密"></a>（3) SSL证书加密</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. ssl_protocols：指令用于启动特定的加密协议，nginx在1.1.13和1.0.12版本后默认是ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2，TLSv1.1与TLSv1.2要确保OpenSSL &gt;= 1.0.1 ，SSLv3 现在还有很多地方在用但有不少被攻击的漏洞。</span><br><span class="line">2. ssl prefer server ciphers：设置协商加密算法时，优先使用我们服务端的加密套件，而不是客户端浏览器的加密套件</span><br></pre></td></tr></table></figure>
<h4 id="（4-压缩配置"><a href="#（4-压缩配置" class="headerlink" title="（4) 压缩配置"></a>（4) 压缩配置</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. gzip 是告诉nginx采用gzip压缩的形式发送数据。这将会减少我们发送的数据量。</span><br><span class="line">2. gzip_disable 为指定的客户端禁用gzip功能。我们设置成IE6或者更低版本以使我们的方案能够广泛兼容。</span><br><span class="line">3. gzip_static 告诉nginx在压缩资源之前，先查找是否有预先gzip处理过的资源。这要求你预先压缩你的文件（在这个例子中被注释掉了），从而允许你使用最高压缩比，这样nginx就不用再压缩这些文件了（想要更详尽的gzip_static的信息，请点击这里）。</span><br><span class="line">4. gzip_proxied 允许或者禁止压缩基于请求和响应的响应流。我们设置为any，意味着将会压缩所有的请求。</span><br><span class="line">5. gzip_min_length 设置对数据启用压缩的最少字节数。如果一个请求小于1000字节，我们最好不要压缩它，因为压缩这些小的数据会降低处理此请求的所有进程的速度。</span><br><span class="line">6. gzip_comp_level 设置数据的压缩等级。这个等级可以是1-9之间的任意数值，9是最慢但是压缩比最大的。我们设置为4，这是一个比较折中的设置。</span><br><span class="line">7. gzip_type 设置需要压缩的数据格式。上面例子中已经有一些了，你也可以再添加更多的格式。</span><br></pre></td></tr></table></figure>
<h4 id="（5-文件缓存配置"><a href="#（5-文件缓存配置" class="headerlink" title="（5) 文件缓存配置"></a>（5) 文件缓存配置</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. open_file_cache 打开缓存的同时也指定了缓存最大数目，以及缓存的时间。我们可以设置一个相对高的最大时间，这样我们可以在它们不活动超过20秒后清除掉。</span><br><span class="line">2. open_file_cache_valid 在open_file_cache中指定检测正确信息的间隔时间。</span><br><span class="line">3. open_file_cache_min_uses 定义了open_file_cache中指令参数不活动时间期间里最小的文件数。</span><br><span class="line">4. open_file_cache_errors 指定了当搜索一个文件时是否缓存错误信息，也包括再次给配置中添加文件。我们也包括了服务器模块，这些是在不同文件中定义的。如果你的服务器模块不在这些位置，你就得修改这一行来指定正确的位置。</span><br></pre></td></tr></table></figure>
<h3 id="server模块"><a href="#server模块" class="headerlink" title="server模块"></a>server模块</h3><p>srever模块配置是http模块中的一个子模块，用来定义一个虚拟访问主机，也就是一个虚拟服务器的配置信息</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name localhost 192.168.1.100;</span><br><span class="line">root /nginx/www;</span><br><span class="line">index index.php index.html index.html;</span><br><span class="line">charset utf-8;</span><br><span class="line">access_log logs/access.log;</span><br><span class="line">error_log logs/error.log;</span><br><span class="line">......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>核心配置信息如下：</p>
<ul>
<li>server：一个虚拟主机的配置，一个http中可以配置多个server</li>
<li>server_name：用力啊指定ip地址或者域名，多个配置之间用空格分隔</li>
<li>root：表示整个server虚拟主机内的根目录，所有当前主机中web项目的根目录</li>
<li>index：用户访问web网站时的全局首页</li>
<li>charset：用于设置www/路径中配置的网页的默认编码格式</li>
<li>access_log：用于指定该虚拟主机服务器中的访问记录日志存放路径</li>
<li>error_log：用于指定该虚拟主机服务器中访问错误日志的存放路径</li>
</ul>
<h3 id="location模块"><a href="#location模块" class="headerlink" title="location模块"></a>location模块</h3><p>location模块是nginx配置中出现最多的一个配置，主要用于配置路由访问信息</p>
<p>在路由访问信息配置中关联到反向代理、负载均衡等等各项功能，所以location模块也是一个非常重要的配置模块</p>
<p>基本配置</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">root /nginx/www;</span><br><span class="line">index index.php index.html index.htm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>location /：表示匹配访问根目录</p>
<p>root：用于指定访问根目录时，访问虚拟主机的web目录</p>
<p>index：在不指定访问具体资源时，默认展示的资源文件列表</p>
<p>反向代理配置方式</p>
<p>通过反向代理代理服务器访问模式，通过proxy_set配置让客户端访问透明化</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">proxy_pass http://localhost:8888;</span><br><span class="line">proxy_set_header X-real-ip $remote_addr;</span><br><span class="line">proxy_set_header Host $http_host;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>uwsgi配置</p>
<p>wsgi模式下的服务器配置访问方式</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">include uwsgi_params;</span><br><span class="line">uwsgi_pass localhost:8888</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="upstream模块"><a href="#upstream模块" class="headerlink" title="upstream模块"></a>upstream模块</h3><p>upstream模块主要负责负载均衡的配置，通过默认的轮询调度方式来分发请求到后端服务器</p>
<p>简单的配置方式如下</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">upstream name &#123;</span><br><span class="line">ip_hash;</span><br><span class="line">server 192.168.1.100:8000;</span><br><span class="line">server 192.168.1.100:8001 down;</span><br><span class="line">server 192.168.1.100:8002 max_fails=3;</span><br><span class="line">server 192.168.1.100:8003 fail_timeout=20s;</span><br><span class="line">server 192.168.1.100:8004 max_fails=3 fail_timeout=20s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>核心配置信息如下</p>
<ul>
<li>ip_hash：指定请求调度算法，默认是weight权重轮询调度，可以指定</li>
<li>server host:port：分发服务器的列表配置</li>
<li>— down：表示该主机暂停服务</li>
<li>— max_fails：表示失败最大次数，超过失败最大次数暂停服务</li>
<li>— fail_timeout：表示如果请求受理失败，暂停指定的时间之后重新发起请求</li>
</ul>
]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>RNN</title>
    <url>/2022/03/06/RNN/</url>
    <content><![CDATA[<h1 id="RNN学习"><a href="#RNN学习" class="headerlink" title="RNN学习"></a>RNN学习</h1><h2 id="一、RNN基础概念"><a href="#一、RNN基础概念" class="headerlink" title="一、RNN基础概念"></a>一、RNN基础概念</h2><p><img src="/2022/03/06/RNN/1.png" alt></p>
<h2 id="二、自然语言处理与词嵌入"><a href="#二、自然语言处理与词嵌入" class="headerlink" title="二、自然语言处理与词嵌入"></a>二、自然语言处理与词嵌入</h2><h2 id="2-1词汇表征"><a href="#2-1词汇表征" class="headerlink" title="2.1词汇表征"></a>2.1词汇表征</h2><p>（1）使用one-hot方法表示词汇有两个主要的缺点，以10000个词为例，每个单词需要用10000维来表示，而且只有一个数是零，其他维度都是1，造成表示非常冗余，存储量大；第二每个单词表示的向量相乘都为零（正交），导致没能够表示是词汇之间的联系，比如oriange和apple,queen和king应该是联系比价紧密的，但是用上面的词典表示无法体现出这一点。</p>
<p>（2）使用新的特征表示法，如下图所示，特征比如有性别、高贵、年龄、颜色、尺寸、食物等等作为特征，那么一个词汇符合一个特征将会取较大的值，完全没什么关系取接近于0，加入设置了300个特征，那么每个单词就可以用300维的向量表示（解决了表示太冗余），而且相似的词（比如apple和oriange）在不同特征可能都非常类似的值（即相似性高），从而使得词汇之间有了联系。</p>
<p><img src="/2022/03/06/RNN/2.png" alt="img"></p>
<p>（3）在上面提到那些特征，在实际中是通过网络来学习得到的，具体表示什么特征是没人知道的。</p>
<h2 id="2-2使用词嵌入"><a href="#2-2使用词嵌入" class="headerlink" title="2.2使用词嵌入"></a>2.2使用词嵌入</h2><p>（1）如何用词嵌入做迁移学习的步骤：</p>
<p>1.先从大量的文本机中学习词嵌入（词嵌入其实就是用一些特征来表示一个词汇，而不是通过one-hot表示），当然也可以直接使用别人训练好的词嵌入。</p>
<p>2.然后根据你新任务的数据量来决定是否还要调整这些词嵌入，如果数据量很少的话，直接使用之前的词嵌入。数据多的话可以进行微调。</p>
<p>（3）词嵌入和之前讲过的人脸编码非常的类似，有一点区别就是：词嵌入，是有固定的词汇表的，而在人脸编码中可能会有一个完全没有见过的人脸，然后需要对他进行编码。</p>
<h2 id="2-3词嵌入的特性"><a href="#2-3词嵌入的特性" class="headerlink" title="2.3词嵌入的特性"></a>2.3词嵌入的特性</h2><p>（1）提出问题：man如果对应woman,那么King应该对应什么？方法是man的向量减去woman向量的值应该（约等于）等于King向量减去某个词汇的向量，式子如下所示：</p>
<p><img src="/2022/03/06/RNN/3.png" alt="img"></p>
<p>移项之后即找到等式两边的相似度：</p>
<p><img src="/2022/03/06/RNN/4.png" alt="img"></p>
<p>（2）使用余弦相似度（其实就是夹角的余弦值），值接近1是表明越相似：</p>
<p><img src="/2022/03/06/RNN/5.png" alt="img"></p>
<p><img src="/2022/03/06/RNN/6.png" alt="img"></p>
<h2 id="2-4嵌入矩阵"><a href="#2-4嵌入矩阵" class="headerlink" title="2.4嵌入矩阵"></a>2.4嵌入矩阵</h2><p>（1）如果词汇量是10000，每个词汇由300个特征表示，那么嵌入矩阵就是一个300*10000的矩阵，嵌入矩阵与某个词汇的one-hot表示的向量相乘会会的该词汇的嵌入表示（即300维来表示），如下图所示：</p>
<p><img src="/2022/03/06/RNN/7.png" alt="img"></p>
<p>（2）上面的相乘由于one-hot只有特定的值是1，所以其实相乘的本质是取出该词汇在嵌入矩阵的位置的那一列，所以实际中不会进行这么复杂的矩阵乘法运算，而是用一些方法直接取出那一列即可，如Keras中有一个嵌入层，我们用这个嵌入层可以有效的从嵌入矩阵中提出出你需要的列，而不是对矩阵进行很慢很复杂的乘法运算。</p>
<h2 id="2-5学习词嵌入"><a href="#2-5学习词嵌入" class="headerlink" title="2.5学习词嵌入"></a>2.5学习词嵌入</h2><p>（1）案例是：预测“I want a glass of oriange___”划线处的单词是什么？可以用one-hot的I然后输入到一个嵌入层，嵌入层会做的操作将嵌入矩阵与one-hot向量相乘得到该词汇的嵌入向量，然后再输入到后面的网络进行输出，所以通过训练这整个网络，也就可以学习了嵌入矩阵。</p>
<p><img src="/2022/03/06/RNN/8.png" alt="img"></p>
<p>（2）后面有全连接层，所以输入的维度需要固定，这时有一个上下文的概念（context），比如用目标预测位置的前4个单词（这时嵌入层输出总共4*300=1200个输入输入到下一层网络中），或者目标位置前后各4个词汇，实践证明，在以训练嵌入矩阵时，只使用目标位置的前一个词汇作为上下文也是效果非常不错的。</p>
<h2 id="2-6Word2Vec"><a href="#2-6Word2Vec" class="headerlink" title="2.6Word2Vec"></a>2.6Word2Vec</h2><p>（1）使用Skip-Gram模型，其做法首先是上下文c进行采样，然后目标词就会在上下文c的正负10个词距内进行采样。换言之，在句子“I want a glass of orange juice to go alone with my cereal”,这时选择上下文c假设是orange,然后再距离orange10以内的词出现某个词的概率，<strong>比如选中glass,这时glass就是相当于(输出的标签)y,而orange是x</strong>。</p>
<p>（2）Skip-Gram可以理解为取一个词，然后在这个词周围出现什么词的概率比较大，用这样来构造一个监督学习，其目的就是为了学习嵌入矩阵。</p>
<p>（3）网络示意图和代价函数如下所示（其中y,y帽都是用one-hot表示的，y是上下文orange在一定词距范围内随机取到的一个词）：</p>
<p><img src="/2022/03/06/RNN/9.png" alt="img"></p>
<p><img src="https://images2018.cnblogs.com/blog/1326691/201807/1326691-20180721202329171-663569937.png" alt="img"></p>
<p><img src="https://images2018.cnblogs.com/blog/1326691/201807/1326691-20180721202340451-1301658230.png" alt="img"></p>
<p>（4）采用上述的算法有一个问题就是计算量非常大，因为根据损失函数来看，其求和操作很慢因为词汇量非常大可能达到百万。解决的办法有分级（hierarchical）的softmax分类器和负采样（Negative Sampling）。</p>
<p>（5）分级的思路是（以10000个词汇为例），第一个分类器先告诉你目标词在前5000还是后5000，然后第二个分类器告诉你是前2500还是后2500，这样计算复杂度是词汇输取对数，而不是线性的。另外所形成的树一般常见的词在比较浅的地方，少见的词在更深的地方，如下图所示。</p>
<p><img src="/2022/03/06/RNN/10.png" alt="img"></p>
<h2 id="2-7负采样"><a href="#2-7负采样" class="headerlink" title="2.7负采样"></a>2.7负采样</h2><p>（1）负采样可以将上面的sotfmax变成一个二分类问题，这样可以大大减小计算量。</p>
<p>（2）负采样的做法是在选定上下文词，然后在上下文词限定的范围内（如10个词内）选取一个目标词，然后网络的输出为1，再在字典随机选取K个词当成负样本（即使选的词在上下文的限定范围内的词也没关系），然后网络的输出为0。如下图所示：</p>
<p><img src="/2022/03/06/RNN/11.png" alt="img"></p>
<p>（3）一个样本对对应了一个二分类器（即输出只有一个神经元（实质上是只看softmax10000维中对应target词汇的那个维度），计算非常之简单），与之前的sotfmax（输出有10000个神经元）对比如下：</p>
<p><img src="/2022/03/06/RNN/12.png" alt="img"></p>
<p><img src="/2022/03/06/RNN/13.png" alt="img"></p>
<p>（4）如何选取样本按照以下的方式，其中f(wi)是观测到的在语料库中的某个英语词的词频率。</p>
<p><img src="/2022/03/06/RNN/14.png" alt="img"></p>
<h2 id="2-8GloVe词向量"><a href="#2-8GloVe词向量" class="headerlink" title="2.8GloVe词向量"></a>2.8GloVe词向量</h2><p>（1）Xij表示单词i在单词j上下文中出现的次数，所以这里的i和j就和target和context的功能一样，所以可以认为Xij等于Xji。</p>
<p>（2）目标函数是最小化下面的式子（约定Xij为0时，f(Xij)也为0,约定0log0=0,f(Xij)是一个权重）：</p>
<p><img src="/2022/03/06/RNN/15.png" alt="img"></p>
<h2 id="2-9情感分类"><a href="#2-9情感分类" class="headerlink" title="2.9情感分类"></a>2.9情感分类</h2><p>（1）案例1：输入x是一段文字，而输出y是你要预测的相应情感，比如说是对一个餐馆的评价的星级，分数为1-5。</p>
<p><img src="/2022/03/06/RNN/16.png" alt="img"></p>
<p>（2）直接下载使用别人用非常大数据集训练好的嵌入矩阵即可。</p>
<p>（3）方法一使用以下的网络，每个单词one-hot之后经过嵌入矩阵，形成词嵌入，然后将所有单词的特征进行平均，再将平均值送入到softmax中得到最终的评分。</p>
<p> <img src="/2022/03/06/RNN/17.png" alt="img"></p>
<p>（4）上一方法存在的问题是，没有考虑到单词的位置关系，所有在句子“Completely lacking in good taste, good service, and good ambiance.”中由于good非常多，所以最终预测得到一个较高的分数，但实际这句话是差评。所以第二种方法是使用循环神经网络RNN，这将是一个多对一问题，这样可以很好的得到一个情感分析的系统。</p>
<p><img src="/2022/03/06/RNN/18.png" alt="img"></p>
<h2 id="2-10词嵌入除偏"><a href="#2-10词嵌入除偏" class="headerlink" title="2.10词嵌入除偏"></a>2.10词嵌入除偏</h2><p>（1）当一个系统Father对应Doctor,Mother对应Nurse时这就是一个偏见的系统。</p>
<p>（2）以消除性别偏差为例，叙述消除偏差的主要步骤。首先第一步是将所以带写别的组（如he,she）做ehe-eshe,egirl-eboy然后将这些结果求和取平均，得到如下的轴：</p>
<p><img src="/2022/03/06/RNN/19.png" alt="img"></p>
<p>（2）第二步是中和步骤，意思就是将应该无偏的词移动到轴上，如下图所示：</p>
<p><img src="/2022/03/06/RNN/20.png" alt="img"></p>
<p>（3）第三步是均衡步，即移动一对词将其关于轴对称（如上图中grandmother与grandfather并没有关于轴对称，所以grandmother与中和步骤之后的babysister距离更近一点），如下图所示</p>
<p><img src="/2022/03/06/RNN/21.png" alt="img"></p>
<p>（5）有一点是，对于性别而言，有明确性别一一的词特别少，用一个二分类器来判断一个词是否是有明确的性别的，然后将所有其他词对这些有明确性别的词做上面的步骤即可解决偏见问题。关于其他偏见同样如此。</p>
]]></content>
      <categories>
        <category>deepLearning</category>
      </categories>
      <tags>
        <tag>RNN</tag>
      </tags>
  </entry>
  <entry>
    <title>SSMFileUpload</title>
    <url>/2022/04/06/SSMFileUpload/</url>
    <content><![CDATA[<h1 id="文件上传和下载"><a href="#文件上传和下载" class="headerlink" title="文件上传和下载"></a>文件上传和下载</h1><blockquote>
<p>准备工作</p>
</blockquote>
<p>文件上传是项目开发中最常见的功能之一 ,springMVC 可以很好的支持文件上传，但是SpringMVC上下文中默认没有装配MultipartResolver，因此默认情况下其不能处理文件上传工作。如果想使用Spring的文件上传功能，则需要在上下文中配置MultipartResolver。</p>
<p>前端表单要求：为了能上传文件，必须将表单的method设置为POST，并将enctype设置为multipart/form-data。只有在这样的情况下，浏览器才会把用户选择的文件以二进制数据发送给服务器；</p>
<p><strong>对表单中的 enctype 属性做个详细的说明：</strong></p>
<ul>
<li>application/x-www=form-urlencoded：默认方式，只处理表单域中的 value 属性值，采用这种编码方式的表单会将表单域中的值处理成 URL 编码方式。</li>
<li>multipart/form-data：这种编码方式会以二进制流的方式来处理表单数据，这种编码方式会把文件域指定文件的内容也封装到请求参数中，不会对字符编码。</li>
<li>text/plain：除了把空格转换为 “+” 号外，其他字符都不做编码处理，这种方式适用直接通过表单发送邮件。</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>一旦设置了enctype为multipart/form-data，浏览器即会采用二进制流的方式来处理表单数据，而对于文件上传的处理则涉及在服务器端解析原始的HTTP响应。在2003年，Apache Software Foundation发布了开源的Commons FileUpload组件，其很快成为Servlet/JSP程序员上传文件的最佳选择。</p>
<ul>
<li><p>Servlet3.0规范已经提供方法来处理文件上传，但这种上传需要在Servlet中完成。</p>
</li>
<li><p>而Spring MVC则提供了更简单的封装。</p>
</li>
<li><p>Spring MVC为文件上传提供了直接的支持，这种支持是用即插即用的MultipartResolver实现的。</p>
</li>
<li><p>Spring MVC使用Apache Commons FileUpload技术实现了一个MultipartResolver实现类：</p>
<p>CommonsMultipartResolver。因此，SpringMVC的文件上传还需要依赖Apache Commons FileUpload的组件。</p>
</li>
</ul>
<blockquote>
<p>文件上传</p>
</blockquote>
<p>1、导入文件上传的jar包，commons-fileupload ， Maven会自动帮我们导入他的依赖包 commons-io包；</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--文件上传--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--servlet-api导入高版本的--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2、配置bean：multipartResolver</p>
<p>【<strong>注意！！！这个bena的id必须为：multipartResolver ， 否则上传文件会报400的错误！在这里栽过坑,教训！</strong>】</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--文件上传配置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;multipartResolver&quot;</span>  <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 请求的编码格式，必须和jSP的pageEncoding属性一致，以便正确读取表单的内容，默认为ISO-8859-1 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultEncoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;utf-8&quot;</span>/&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 上传文件大小上限，单位为字节（10485760=10M） --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxUploadSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10485760&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxInMemorySize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;40960&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>CommonsMultipartFile 的 常用方法：</p>
<ul>
<li><strong>String getOriginalFilename()：获取上传文件的原名</strong></li>
<li><strong>InputStream getInputStream()：获取文件流</strong></li>
<li><p><strong>void transferTo(File dest)：将上传文件保存到一个目录文件中</strong></p>
<p>我们去实际测试一下</p>
</li>
</ul>
<p>3、编写前端页面</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/upload&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;upload&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>4、<strong>Controller</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.commons.CommonsMultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileController</span> </span>&#123;</span><br><span class="line">   <span class="comment">//@RequestParam(&quot;file&quot;) 将name=file控件得到的文件封装成CommonsMultipartFile 对象</span></span><br><span class="line">   <span class="comment">//批量上传CommonsMultipartFile则为数组即可</span></span><br><span class="line">   <span class="meta">@RequestMapping(&quot;/upload&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">fileUpload</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> CommonsMultipartFile file , HttpServletRequest request)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//获取文件名 : file.getOriginalFilename();</span></span><br><span class="line">       String uploadFileName = file.getOriginalFilename();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//如果文件名为空，直接回到首页！</span></span><br><span class="line">       <span class="keyword">if</span> (<span class="string">&quot;&quot;</span>.equals(uploadFileName))&#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="string">&quot;redirect:/index.jsp&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">       System.out.println(<span class="string">&quot;上传文件名 : &quot;</span>+uploadFileName);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//上传路径保存设置</span></span><br><span class="line">       String path = request.getServletContext().getRealPath(<span class="string">&quot;/upload&quot;</span>);</span><br><span class="line">       <span class="comment">//如果路径不存在，创建一个</span></span><br><span class="line">       File realPath = <span class="keyword">new</span> File(path);</span><br><span class="line">       <span class="keyword">if</span> (!realPath.exists())&#123;</span><br><span class="line">           realPath.mkdir();</span><br><span class="line">      &#125;</span><br><span class="line">       System.out.println(<span class="string">&quot;上传文件保存地址：&quot;</span>+realPath);</span><br><span class="line"></span><br><span class="line">       InputStream is = file.getInputStream(); <span class="comment">//文件输入流</span></span><br><span class="line">       OutputStream os = <span class="keyword">new</span> FileOutputStream(<span class="keyword">new</span> File(realPath,uploadFileName)); <span class="comment">//文件输出流</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">//读取写出</span></span><br><span class="line">       <span class="keyword">int</span> len=<span class="number">0</span>;</span><br><span class="line">       <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">       <span class="keyword">while</span> ((len=is.read(buffer))!=-<span class="number">1</span>)&#123;</span><br><span class="line">           os.write(buffer,<span class="number">0</span>,len);</span><br><span class="line">           os.flush();</span><br><span class="line">      &#125;</span><br><span class="line">       os.close();</span><br><span class="line">       is.close();</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;redirect:/index.jsp&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5、测试上传文件，OK！</p>
<p><strong>采用file.Transto 来保存上传的文件</strong></p>
<p>1、编写Controller</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 采用file.Transto 来保存上传的文件</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/upload2&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String  <span class="title">fileUpload2</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> CommonsMultipartFile file, HttpServletRequest request)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//上传路径保存设置</span></span><br><span class="line">   String path = request.getServletContext().getRealPath(<span class="string">&quot;/upload&quot;</span>);</span><br><span class="line">   File realPath = <span class="keyword">new</span> File(path);</span><br><span class="line">   <span class="keyword">if</span> (!realPath.exists())&#123;</span><br><span class="line">       realPath.mkdir();</span><br><span class="line">  &#125;</span><br><span class="line">   <span class="comment">//上传文件地址</span></span><br><span class="line">   System.out.println(<span class="string">&quot;上传文件保存地址：&quot;</span>+realPath);</span><br><span class="line"></span><br><span class="line">   <span class="comment">//通过CommonsMultipartFile的方法直接写文件（注意这个时候）</span></span><br><span class="line">   file.transferTo(<span class="keyword">new</span> File(realPath +<span class="string">&quot;/&quot;</span>+ file.getOriginalFilename()));</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;redirect:/index.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、前端表单提交地址修改</p>
<p>3、访问提交测试，OK！</p>
<blockquote>
<p>文件下载</p>
</blockquote>
<p><strong>文件下载步骤：</strong></p>
<p>1、设置 response 响应头</p>
<p>2、读取文件 — InputStream</p>
<p>3、写出文件 — OutputStream</p>
<p>4、执行操作</p>
<p>5、关闭流 （先开后关）</p>
<p><strong>代码实现：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;/download&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">downloads</span><span class="params">(HttpServletResponse response ,HttpServletRequest request)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">   <span class="comment">//要下载的图片地址</span></span><br><span class="line">   String  path = request.getServletContext().getRealPath(<span class="string">&quot;/upload&quot;</span>);</span><br><span class="line">   String  fileName = <span class="string">&quot;基础语法.jpg&quot;</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//1、设置response 响应头</span></span><br><span class="line">   response.reset(); <span class="comment">//设置页面不缓存,清空buffer</span></span><br><span class="line">   response.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>); <span class="comment">//字符编码</span></span><br><span class="line">   response.setContentType(<span class="string">&quot;multipart/form-data&quot;</span>); <span class="comment">//二进制传输数据</span></span><br><span class="line">   <span class="comment">//设置响应头</span></span><br><span class="line">   response.setHeader(<span class="string">&quot;Content-Disposition&quot;</span>,</span><br><span class="line">           <span class="string">&quot;attachment;fileName=&quot;</span>+URLEncoder.encode(fileName, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line"></span><br><span class="line">   File file = <span class="keyword">new</span> File(path,fileName);</span><br><span class="line">   <span class="comment">//2、 读取文件--输入流</span></span><br><span class="line">   InputStream input=<span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">   <span class="comment">//3、 写出文件--输出流</span></span><br><span class="line">   OutputStream out = response.getOutputStream();</span><br><span class="line"></span><br><span class="line">   <span class="keyword">byte</span>[] buff =<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">   <span class="keyword">int</span> index=<span class="number">0</span>;</span><br><span class="line">   <span class="comment">//4、执行 写出操作</span></span><br><span class="line">   <span class="keyword">while</span>((index= input.read(buff))!= -<span class="number">1</span>)&#123;</span><br><span class="line">       out.write(buff, <span class="number">0</span>, index);</span><br><span class="line">       out.flush();</span><br><span class="line">  &#125;</span><br><span class="line">   out.close();</span><br><span class="line">   input.close();</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>前端</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/download&quot;</span>&gt;</span>点击下载<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试，文件下载OK，大家可以和我们之前学习的JavaWeb原生的方式对比一下，就可以知道这个便捷多了!</p>
]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>SSM</tag>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringMVC</title>
    <url>/2022/03/26/SpringMVC/</url>
    <content><![CDATA[<h1 id="JavaWeb回顾"><a href="#JavaWeb回顾" class="headerlink" title="JavaWeb回顾"></a>JavaWeb回顾</h1><h2 id="一、Servlet复习"><a href="#一、Servlet复习" class="headerlink" title="一、Servlet复习"></a>一、Servlet复习</h2><h3 id="1-1-创建maven父项目，导入依赖"><a href="#1-1-创建maven父项目，导入依赖" class="headerlink" title="1.1 创建maven父项目，导入依赖"></a>1.1 创建maven父项目，导入依赖</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-webmvc --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 打包时不包含 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet.jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp.jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="1-2-创建子项目"><a href="#1-2-创建子项目" class="headerlink" title="1.2 创建子项目"></a>1.2 创建子项目</h3><ul>
<li>这里可以直接创建普通的maven项目再添加框架，web.xml的版本就不会错</li>
</ul>
<p>​        <img src="/2022/03/26/SpringMVC/1.jpg" alt="image-20220326105930121"></p>
<p>​        <img src="/2022/03/26/SpringMVC/2.png" alt="image-20220326110027545"></p>
<ul>
<li><p>添加tomcat</p>
<p><img src="/2022/03/26/SpringMVC/3.png" alt="image-20220326112226120"></p>
</li>
</ul>
<p>​       <img src="/2022/03/26/SpringMVC/4.png" alt="image-20220326112436362"></p>
<p>​        </p>
<h3 id="1-3-编写servlet"><a href="#1-3-编写servlet" class="headerlink" title="1.3 编写servlet"></a>1.3 编写servlet</h3><p>通过前端的输入来控制后台的业务</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(name = &quot;FirstServlet&quot;,urlPatterns = &#123;&quot;/firstServlet&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FirstServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">        String method1 = request.getParameter(<span class="string">&quot;method1&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(method1!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(method1.equals(<span class="string">&quot;add&quot;</span>))&#123;</span><br><span class="line">                request.setAttribute(<span class="string">&quot;method1&quot;</span>,<span class="string">&quot;添加操作！&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(method1.equals(<span class="string">&quot;delete&quot;</span>))&#123;</span><br><span class="line">                request.setAttribute(<span class="string">&quot;method1&quot;</span>,<span class="string">&quot;删除操作！&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        request.getRequestDispatcher(<span class="string">&quot;/jsp/message.jsp&quot;</span>).forward(request,response);</span><br><span class="line">        System.out.println(<span class="string">&quot;helloWord&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>SpringMVC</category>
      </categories>
      <tags>
        <tag>SpringMVC</tag>
      </tags>
  </entry>
  <entry>
    <title>SprignMVC入门</title>
    <url>/2022/03/26/SpringMVC01/</url>
    <content><![CDATA[<h1 id="SpringMVC-入门"><a href="#SpringMVC-入门" class="headerlink" title="SpringMVC 入门"></a>SpringMVC 入门</h1><h2 id="一、配置法"><a href="#一、配置法" class="headerlink" title="一、配置法"></a>一、配置法</h2><p>1、新建一个Moudle ， springmvc02introduction ， 添加web的支持！</p>
<p>2、确定导入了SpringMVC 的依赖！</p>
<p>3、配置web.xml  ， 注册DispatcherServlet</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span>        <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>        <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span>        <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--1.注册DispatcherServlet--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--关联一个springmvc的配置文件:【servlet-name】-servlet.xml--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc-servlet.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--启动级别-1--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--/ 匹配所有的请求；（不包括.jsp）--&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--/* 匹配所有的请求；（包括.jsp）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>4、编写SpringMVC 的 配置文件！名称：springmvc-servlet.xml  : [servletname]-servlet.xml</p>
<p>说明，这里的名称要求是按照官方来的</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>      <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>      <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans       http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>5、添加 处理映射器</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>6、添加 处理器适配器</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>7、添加 视图解析器</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--视图解析器:DispatcherServlet给他的ModelAndView--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span> <span class="attr">id</span>=<span class="string">&quot;InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--前缀--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--后缀--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>8、编写我们要操作业务Controller ，要么实现Controller接口，要么增加注解；</p>
<p>需要返回一个ModelAndView，装数据，封视图；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;<span class="keyword">import</span> org.springframework.web.servlet.mvc.Controller;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;<span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="comment">//注意：这里我们先导入Controller接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> <span class="keyword">implements</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">handleRequest</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       <span class="comment">//ModelAndView 模型和视图</span></span><br><span class="line">       ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">       <span class="comment">//封装对象，放在ModelAndView中。Model</span></span><br><span class="line">       mv.addObject(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;HelloSpringMVC!&quot;</span>);</span><br><span class="line">       <span class="comment">//封装要跳转的视图，放在ModelAndView中</span></span><br><span class="line">       mv.setViewName(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">       <span class="comment">//: /WEB-INF/jsp/hello.jsp</span></span><br><span class="line">       <span class="keyword">return</span> mv;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>9、将自己的类交给SpringIOC容器，注册bean</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;!--Handler--&gt;&lt;bean id=<span class="string">&quot;/hello&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.kuang.controller.HelloController&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>10、写要跳转的jsp页面，显示ModelandView存放的数据，以及我们的正常页面；</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;Kuangshen&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        $&#123;msg&#125;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="注意：可能遇到的问题：访问出现404，"><a href="#注意：可能遇到的问题：访问出现404，" class="headerlink" title="注意：可能遇到的问题：访问出现404，"></a>注意：可能遇到的问题：访问出现404，</h3><p>排查步骤：</p>
<ol>
<li><p>查看控制台输出，看一下是不是缺少了什么jar包。</p>
</li>
<li><p>如果jar包存在，显示无法输出，就在IDEA的项目发布中，添加lib依赖！</p>
<p><img src="/2022/03/26/SpringMVC01/5.png" alt="image-20220327100033730"></p>
<ul>
<li><p>项目发布的web-inf下没有lib目录，说明发布时包没有导入</p>
</li>
<li><p>新建lib目录</p>
</li>
<li><p>导入包</p>
<p><img src="/2022/03/26/SpringMVC01/6.png" alt="image-20220327100235707"></p>
</li>
</ul>
</li>
<li><p>重启Tomcat 即可解决！</p>
</li>
</ol>
<h3 id="SpringMVC运行原理"><a href="#SpringMVC运行原理" class="headerlink" title="SpringMVC运行原理"></a>SpringMVC运行原理</h3><p><img src="/2022/03/26/SpringMVC01/7.png" alt="image-20220328160553166"></p>
<p><img src="/2022/03/26/SpringMVC01/8.png" alt="image-20220328160704206"></p>
<h2 id="二、注解法"><a href="#二、注解法" class="headerlink" title="二、注解法"></a>二、注解法</h2><ol>
<li><p>配置web.xml 配置DispatcherServlet</p>
</li>
<li><p>编写springmvc-servlet.xml配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc https://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置自动扫描包--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;cn.hestialx.controller&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置资源过滤，让Spring MVC 不处理静态资源 .cs .js .jpg 等--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置注解url mappering和 ControllerHandlerAdapter--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol>
<li><p>在视图解析器中我们把所有的视图都存放在/WEB-INF/目录下，这样可以保证视图安全，因为这个目录下的文件，客户端不能直接访问。</p>
</li>
<li><ul>
<li><p>让IOC的注解生效</p>
</li>
<li><p>静态资源过滤 ：HTML . JS . CSS . 图片 ， 视频 …..</p>
</li>
<li><p>MVC的注解驱动</p>
</li>
<li><p>配置视图解析器</p>
</li>
</ul>
</li>
</ol>
</li>
</ol>
<ol>
<li><p>编写controller类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.hestialx.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lixu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-03-28-18:12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/h1&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">firstController</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line">        model.addAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li>@Controller是为了让Spring IOC容器初始化时自动扫描到；</li>
<li>@RequestMapping是为了映射请求路径，这里因为类与方法上都有映射所以访问时应该是/HelloController/hello；</li>
<li>方法中声明Model类型的参数是为了把Action中的数据带到视图中；</li>
<li>方法返回的结果是视图的名称hello，加上配置文件中的前后缀变成WEB-INF/jsp/hello.jsp。</li>
</ul>
]]></content>
      <categories>
        <category>SpringMVC</category>
      </categories>
      <tags>
        <tag>SpringMVC</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringMVC03</title>
    <url>/2022/03/29/SpringMVC03/</url>
    <content><![CDATA[<h1 id="SpringMVC"><a href="#SpringMVC" class="headerlink" title="SpringMVC"></a>SpringMVC</h1><h2 id="一、结果跳转方式"><a href="#一、结果跳转方式" class="headerlink" title="一、结果跳转方式"></a>一、结果跳转方式</h2><h3 id="ModelAndView"><a href="#ModelAndView" class="headerlink" title="ModelAndView"></a>ModelAndView</h3><p>设置ModelAndView对象 , 根据view的名称 , 和视图解析器跳到指定的页面 .</p>
<p>页面 : {视图解析器前缀} + viewName +{视图解析器后缀}</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 视图解析器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span></span></span><br><span class="line"><span class="tag">     <span class="attr">id</span>=<span class="string">&quot;internalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 前缀 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span> /&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 后缀 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>对应的controller类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ControllerTest1</span> <span class="keyword">implements</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">handleRequest</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       <span class="comment">//返回一个模型视图对象</span></span><br><span class="line">       ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">       mv.addObject(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;ControllerTest1&quot;</span>);</span><br><span class="line">       mv.setViewName(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">       <span class="keyword">return</span> mv;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ServletAPI"><a href="#ServletAPI" class="headerlink" title="ServletAPI"></a>ServletAPI</h3><p>通过设置ServletAPI , 不需要视图解析器 .</p>
<p>1、通过HttpServletResponse进行输出</p>
<p>2、通过HttpServletResponse实现重定向</p>
<p>3、通过HttpServletResponse实现转发</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResultGo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@RequestMapping(&quot;/result/t1&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">(HttpServletRequest req, HttpServletResponse rsp)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">       rsp.getWriter().println(<span class="string">&quot;Hello,Spring BY servlet API&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@RequestMapping(&quot;/result/t2&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">(HttpServletRequest req, HttpServletResponse rsp)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">       rsp.sendRedirect(<span class="string">&quot;/index.jsp&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@RequestMapping(&quot;/result/t3&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">(HttpServletRequest req, HttpServletResponse rsp)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       <span class="comment">//转发</span></span><br><span class="line">       req.setAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;/result/t3&quot;</span>);</span><br><span class="line">       req.getRequestDispatcher(<span class="string">&quot;/WEB-INF/jsp/test.jsp&quot;</span>).forward(req,rsp);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="SpringMVC-1"><a href="#SpringMVC-1" class="headerlink" title="SpringMVC"></a>SpringMVC</h3><p><strong>通过SpringMVC来实现转发和重定向 - 无需视图解析器；</strong></p>
<p>测试前，需要将视图解析器注释掉</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResultSpringMVC</span> </span>&#123;</span><br><span class="line">   <span class="meta">@RequestMapping(&quot;/rsm/t1&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="comment">//转发</span></span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;/index.jsp&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@RequestMapping(&quot;/rsm/t2&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">test2</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="comment">//转发二</span></span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;forward:/index.jsp&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@RequestMapping(&quot;/rsm/t3&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">test3</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="comment">//重定向</span></span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;redirect:/index.jsp&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>通过SpringMVC来实现转发和重定向 - 有视图解析器；</strong></p>
<p>重定向 , 不需要视图解析器 , 本质就是重新请求一个新地方嘛 , 所以注意路径问题.</p>
<p>可以重定向到另外一个请求实现 .</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResultSpringMVC2</span> </span>&#123;</span><br><span class="line">   <span class="meta">@RequestMapping(&quot;/rsm2/t1&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="comment">//转发</span></span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;test&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@RequestMapping(&quot;/rsm2/t2&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">test2</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="comment">//重定向</span></span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;redirect:/index.jsp&quot;</span>;</span><br><span class="line">       <span class="comment">//return &quot;redirect:hello.do&quot;; //hello.do为另一个请求/</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="二、数据处理"><a href="#二、数据处理" class="headerlink" title="二、数据处理"></a>二、数据处理</h2><h3 id="处理提交数据"><a href="#处理提交数据" class="headerlink" title="处理提交数据"></a>处理提交数据</h3><p><strong>1、提交的域名称和处理方法的参数名一致</strong></p>
<p>提交数据 : <a href="http://localhost:8080/hello?name=kuangshen">http://localhost:8080/hello?name=kuangshen</a></p>
<p>处理方法 :</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">   System.out.println(name);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>后台输出 : kuangshen</p>
<p><strong>2、提交的域名称和处理方法的参数名不一致</strong></p>
<p>提交数据 : <a href="http://localhost:8080/hello?username=kuangshen">http://localhost:8080/hello?username=kuangshen</a></p>
<p>处理方法 :</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//@RequestParam(&quot;username&quot;) : username提交的域的名称 .</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(<span class="meta">@RequestParam(&quot;username&quot;)</span> String name)</span></span>&#123;</span><br><span class="line">   System.out.println(name);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>后台输出 : kuangshen</p>
<p><strong>3、提交的是一个对象</strong></p>
<p>要求提交的表单域和对象的属性名一致  , 参数使用对象即可</p>
<p>1、实体类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">   <span class="keyword">private</span> String name;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">   <span class="comment">//构造</span></span><br><span class="line">   <span class="comment">//get/set</span></span><br><span class="line">   <span class="comment">//tostring()</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、提交数据 : <a href="http://localhost:8080/mvc04/user?name=kuangshen&amp;id=1&amp;age=15">http://localhost:8080/mvc04/user?name=kuangshen&amp;id=1&amp;age=15</a></p>
<p>3、处理方法 :</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">user</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line">   System.out.println(user);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>后台输出 : User { id=1, name=’kuangshen’, age=15 }</p>
<p>说明：如果使用对象的话，前端传递的参数名和对象名必须一致，否则就是null。</p>
<h2 id="三、数据显示到前端"><a href="#三、数据显示到前端" class="headerlink" title="三、数据显示到前端"></a>三、数据显示到前端</h2><p><strong>第一种 : 通过ModelAndView</strong></p>
<p>我们前面一直都是如此 . 就不过多解释</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ControllerTest1</span> <span class="keyword">implements</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">handleRequest</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       <span class="comment">//返回一个模型视图对象</span></span><br><span class="line">       ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">       mv.addObject(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;ControllerTest1&quot;</span>);</span><br><span class="line">       mv.setViewName(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">       <span class="keyword">return</span> mv;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>第二种 : 通过ModelMap</strong></p>
<p>ModelMap</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@RequestMapping(&quot;/hello&quot;)</span><br><span class="line">public String hello(@RequestParam(&quot;username&quot;) String name, ModelMap model)&#123;</span><br><span class="line">   //封装要显示到视图中的数据</span><br><span class="line">   //相当于req.setAttribute(&quot;name&quot;,name);</span><br><span class="line">   model.addAttribute(&quot;name&quot;,name);</span><br><span class="line">   System.out.println(name);</span><br><span class="line">   return &quot;hello&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>第三种 : 通过Model</strong></p>
<p>Model</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@RequestMapping(&quot;/ct2/hello&quot;)</span><br><span class="line">public String hello(@RequestParam(&quot;username&quot;) String name, Model model)&#123;</span><br><span class="line">   //封装要显示到视图中的数据</span><br><span class="line">   //相当于req.setAttribute(&quot;name&quot;,name);</span><br><span class="line">   model.addAttribute(&quot;msg&quot;,name);</span><br><span class="line">   System.out.println(name);</span><br><span class="line">   return &quot;test&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h3><p>就对于新手而言简单来说使用区别就是：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Model 只有寥寥几个方法只适合用于储存数据，简化了新手对于Model对象的操作和理解；</span><br><span class="line"></span><br><span class="line">ModelMap 继承了 LinkedMap ，除了实现了自身的一些方法，同样的继承 LinkedMap 的方法和特性；</span><br><span class="line"></span><br><span class="line">ModelAndView 可以在储存数据的同时，可以进行设置返回的逻辑视图，进行控制展示层的跳转。</span><br></pre></td></tr></table></figure>
<p>当然更多的以后开发考虑的更多的是性能和优化，就不能单单仅限于此的了解。</p>
<p><strong>请使用80%的时间打好扎实的基础，剩下18%的时间研究框架，2%的时间去学点英文，框架的官方文档永远是最好的教程。</strong></p>
<h2 id="四、乱码问题"><a href="#四、乱码问题" class="headerlink" title="四、乱码问题"></a>四、乱码问题</h2><p>测试步骤：</p>
<p>1、我们可以在首页编写一个提交的表单</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/e/t&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2、后台编写对应的处理类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Encoding</span> </span>&#123;</span><br><span class="line">   <span class="meta">@RequestMapping(&quot;/e/t&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(Model model,String name)</span></span>&#123;</span><br><span class="line">       model.addAttribute(<span class="string">&quot;msg&quot;</span>,name); <span class="comment">//获取表单提交的值</span></span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;test&quot;</span>; <span class="comment">//跳转到test页面显示输入的值</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3、输入中文测试，发现乱码</p>
<p><img src="/2022/03/29/SpringMVC03/1.png" alt="图片"></p>
<p>不得不说，乱码问题是在我们开发中十分常见的问题，也是让我们程序猿比较头大的问题！</p>
<p>以前乱码问题通过过滤器解决 , 而SpringMVC给我们提供了一个过滤器 , 可以在web.xml中配置 .</p>
<p>修改了xml文件需要重启服务器！</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>但是我们发现 , 有些极端情况下.这个过滤器对get的支持不好 .</p>
<p>处理方法 :</p>
<p>1、修改tomcat配置文件 ：设置编码！</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">URIEncoding</span>=<span class="string">&quot;utf-8&quot;</span> <span class="attr">port</span>=<span class="string">&quot;8080&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;HTTP/1.1&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">connectionTimeout</span>=<span class="string">&quot;20000&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">redirectPort</span>=<span class="string">&quot;8443&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>2、自定义过滤器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequestWrapper;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 解决get和post请求 全部乱码的过滤器</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericEncodingFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">       <span class="comment">//处理response的字符编码</span></span><br><span class="line">       HttpServletResponse myResponse=(HttpServletResponse) response;</span><br><span class="line">       myResponse.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 转型为与协议相关对象</span></span><br><span class="line">       HttpServletRequest httpServletRequest = (HttpServletRequest) request;</span><br><span class="line">       <span class="comment">// 对request包装增强</span></span><br><span class="line">       HttpServletRequest myrequest = <span class="keyword">new</span> MyRequest(httpServletRequest);</span><br><span class="line">       chain.doFilter(myrequest, response);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//自定义request对象，HttpServletRequest的包装类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyRequest</span> <span class="keyword">extends</span> <span class="title">HttpServletRequestWrapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> HttpServletRequest request;</span><br><span class="line">   <span class="comment">//是否编码的标记</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">boolean</span> hasEncode;</span><br><span class="line">   <span class="comment">//定义一个可以传入HttpServletRequest对象的构造函数，以便对其进行装饰</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">MyRequest</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">super</span>(request);<span class="comment">// super必须写</span></span><br><span class="line">       <span class="keyword">this</span>.request = request;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 对需要增强方法 进行覆盖</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Map <span class="title">getParameterMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment">// 先获得请求方式</span></span><br><span class="line">       String method = request.getMethod();</span><br><span class="line">       <span class="keyword">if</span> (method.equalsIgnoreCase(<span class="string">&quot;post&quot;</span>)) &#123;</span><br><span class="line">           <span class="comment">// post请求</span></span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               <span class="comment">// 处理post乱码</span></span><br><span class="line">               request.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">               <span class="keyword">return</span> request.getParameterMap();</span><br><span class="line">          &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">               e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equalsIgnoreCase(<span class="string">&quot;get&quot;</span>)) &#123;</span><br><span class="line">           <span class="comment">// get请求</span></span><br><span class="line">           Map&lt;String, String[]&gt; parameterMap = request.getParameterMap();</span><br><span class="line">           <span class="keyword">if</span> (!hasEncode) &#123; <span class="comment">// 确保get手动编码逻辑只运行一次</span></span><br><span class="line">               <span class="keyword">for</span> (String parameterName : parameterMap.keySet()) &#123;</span><br><span class="line">                   String[] values = parameterMap.get(parameterName);</span><br><span class="line">                   <span class="keyword">if</span> (values != <span class="keyword">null</span>) &#123;</span><br><span class="line">                       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; values.length; i++) &#123;</span><br><span class="line">                           <span class="keyword">try</span> &#123;</span><br><span class="line">                               <span class="comment">// 处理get乱码</span></span><br><span class="line">                               values[i] = <span class="keyword">new</span> String(values[i]</span><br><span class="line">                                      .getBytes(<span class="string">&quot;ISO-8859-1&quot;</span>), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">                          &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">                               e.printStackTrace();</span><br><span class="line">                          &#125;</span><br><span class="line">                      &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">               hasEncode = <span class="keyword">true</span>;</span><br><span class="line">          &#125;</span><br><span class="line">           <span class="keyword">return</span> parameterMap;</span><br><span class="line">      &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">super</span>.getParameterMap();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//取一个值</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">getParameter</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">       Map&lt;String, String[]&gt; parameterMap = getParameterMap();</span><br><span class="line">       String[] values = parameterMap.get(name);</span><br><span class="line">       <span class="keyword">if</span> (values == <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">       <span class="keyword">return</span> values[<span class="number">0</span>]; <span class="comment">// 取回参数的第一个值</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//取所有值</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> String[] getParameterValues(String name) &#123;</span><br><span class="line">       Map&lt;String, String[]&gt; parameterMap = getParameterMap();</span><br><span class="line">       String[] values = parameterMap.get(name);</span><br><span class="line">       <span class="keyword">return</span> values;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个也是我在网上找的一些大神写的，一般情况下，SpringMVC默认的乱码处理就已经能够很好的解决了！</p>
<p><strong>然后在web.xml中配置这个过滤器即可！</strong></p>
<p>乱码问题，需要平时多注意，在尽可能能设置编码的地方，都设置为统一编码 UTF-8！</p>
<h2 id="五、JSON"><a href="#五、JSON" class="headerlink" title="五、JSON"></a>五、JSON</h2><blockquote>
<p>什么是JSON？</p>
</blockquote>
<ul>
<li>JSON(JavaScript Object Notation, JS 对象标记) 是一种轻量级的数据交换格式，目前使用特别广泛。</li>
<li>采用完全独立于编程语言的<strong>文本格式</strong>来存储和表示数据。</li>
<li>简洁和清晰的层次结构使得 JSON 成为理想的数据交换语言。</li>
<li>易于人阅读和编写，同时也易于机器解析和生成，并有效地提升网络传输效率。</li>
</ul>
<p>在 JavaScript 语言中，一切都是对象。因此，任何JavaScript 支持的类型都可以通过 JSON 来表示，例如字符串、数字、对象、数组等。看看他的要求和语法格式：</p>
<ul>
<li>对象表示为键值对，数据由逗号分隔</li>
<li>花括号保存对象</li>
<li>方括号保存数组</li>
</ul>
<p><strong>JSON 键值对</strong>是用来保存 JavaScript 对象的一种方式，和 JavaScript 对象的写法也大同小异，键/值对组合中的键名写在前面并用双引号 “” 包裹，使用冒号 : 分隔，然后紧接着值：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;name&quot;</span>: <span class="string">&quot;QinJiang&quot;</span>&#125;</span><br><span class="line">&#123;<span class="attr">&quot;age&quot;</span>: <span class="string">&quot;3&quot;</span>&#125;</span><br><span class="line">&#123;<span class="attr">&quot;sex&quot;</span>: <span class="string">&quot;男&quot;</span>&#125;</span><br></pre></td></tr></table></figure>
<p>很多人搞不清楚 JSON 和 JavaScript 对象的关系，甚至连谁是谁都不清楚。其实，可以这么理解：</p>
<p>JSON 是 JavaScript 对象的字符串表示法，它使用文本表示一个 JS 对象的信息，本质是一个字符串。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">a</span>: <span class="string">&#x27;Hello&#x27;</span>, <span class="attr">b</span>: <span class="string">&#x27;World&#x27;</span>&#125;; <span class="comment">//这是一个对象，注意键名也是可以使用引号包裹的</span></span><br><span class="line"><span class="keyword">var</span> json = <span class="string">&#x27;&#123;&quot;a&quot;: &quot;Hello&quot;, &quot;b&quot;: &quot;World&quot;&#125;&#x27;</span>; <span class="comment">//这是一个 JSON 字符串，本质是一个字符串</span></span><br></pre></td></tr></table></figure>
<p><strong>JSON 和 JavaScript 对象互转</strong></p>
<p>要实现从JSON字符串转换为JavaScript 对象，使用 JSON.parse() 方法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = <span class="built_in">JSON</span>.parse(<span class="string">&#x27;&#123;&quot;a&quot;: &quot;Hello&quot;, &quot;b&quot;: &quot;World&quot;&#125;&#x27;</span>);</span><br><span class="line"><span class="comment">//结果是 &#123;a: &#x27;Hello&#x27;, b: &#x27;World&#x27;&#125;</span></span><br></pre></td></tr></table></figure>
<p>要实现从JavaScript 对象转换为JSON字符串，使用 JSON.stringify() 方法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> json = <span class="built_in">JSON</span>.stringify(&#123;<span class="attr">a</span>: <span class="string">&#x27;Hello&#x27;</span>, <span class="attr">b</span>: <span class="string">&#x27;World&#x27;</span>&#125;);</span><br><span class="line"><span class="comment">//结果是 &#x27;&#123;&quot;a&quot;: &quot;Hello&quot;, &quot;b&quot;: &quot;World&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<p><strong>代码测试</strong></p>
<p>1、新建一个module ，springmvc-05-json ， 添加web的支持</p>
<p>2、在web目录下新建一个 json-1.html ， 编写测试内容</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">title</span>&gt;</span>JSON_秦疆<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">   <span class="comment">//编写一个js的对象</span></span></span><br><span class="line"><span class="javascript">   <span class="keyword">var</span> user = &#123;</span></span><br><span class="line"><span class="javascript">       <span class="attr">name</span>:<span class="string">&quot;秦疆&quot;</span>,</span></span><br><span class="line"><span class="javascript">       <span class="attr">age</span>:<span class="number">3</span>,</span></span><br><span class="line"><span class="javascript">       <span class="attr">sex</span>:<span class="string">&quot;男&quot;</span></span></span><br><span class="line"><span class="javascript">  &#125;;</span></span><br><span class="line"><span class="javascript">   <span class="comment">//将js对象转换成json字符串</span></span></span><br><span class="line"><span class="javascript">   <span class="keyword">var</span> str = <span class="built_in">JSON</span>.stringify(user);</span></span><br><span class="line"><span class="javascript">   <span class="built_in">console</span>.log(str);</span></span><br><span class="line"><span class="javascript">   </span></span><br><span class="line"><span class="javascript">   <span class="comment">//将json字符串转换为js对象</span></span></span><br><span class="line"><span class="javascript">   <span class="keyword">var</span> user2 = <span class="built_in">JSON</span>.parse(str);</span></span><br><span class="line"><span class="javascript">   <span class="built_in">console</span>.log(user2.age,user2.name,user2.sex);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>3、在IDEA中使用浏览器打开，查看控制台输出！</p>
<p><img src="/2022/03/29/SpringMVC03/2.png" alt="图片"></p>
<blockquote>
<p>Controller返回JSON数据</p>
</blockquote>
<p>Jackson应该是目前比较好的json解析工具了</p>
<p>当然工具不止这一个，比如还有阿里巴巴的 fastjson 等等。</p>
<p>我们这里使用Jackson，使用它需要导入它的jar包；</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-core --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>配置SpringMVC需要的配置</p>
<p>web.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--1.注册servlet--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SpringMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--通过初始化参数指定SpringMVC配置文件的位置，进行关联--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc-servlet.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 启动顺序，数字越小，启动越早 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--所有请求都会被springmvc拦截 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SpringMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>springmvc-servlet.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">       https://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">       https://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- 自动扫描指定的包，下面所有注解类交给IOC容器管理 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.kuang.controller&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- 视图解析器 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">id</span>=<span class="string">&quot;internalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 前缀 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span> /&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 后缀 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们随便编写一个User的实体类，然后我们去编写我们的测试Controller；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="comment">//需要导入lombok</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> String name;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">   <span class="keyword">private</span> String sex;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里我们需要两个新东西，一个是@ResponseBody，一个是ObjectMapper对象，我们看下具体的用法</p>
<h3 id="编写一个Controller；"><a href="#编写一个Controller；" class="headerlink" title="编写一个Controller；"></a>编写一个Controller；</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@RequestMapping(&quot;/json1&quot;)</span></span><br><span class="line">   <span class="meta">@ResponseBody</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">json1</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">       <span class="comment">//创建一个jackson的对象映射器，用来解析数据</span></span><br><span class="line">       ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">       <span class="comment">//创建一个对象</span></span><br><span class="line">       User user = <span class="keyword">new</span> User(<span class="string">&quot;秦疆1号&quot;</span>, <span class="number">3</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">       <span class="comment">//将我们的对象解析成为json格式</span></span><br><span class="line">       String str = mapper.writeValueAsString(user);</span><br><span class="line">       <span class="comment">//由于@ResponseBody注解，这里会将str转成json格式返回；十分方便</span></span><br><span class="line">       <span class="keyword">return</span> str;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置Tomcat ， 启动测试一下！</p>
<p><a href="http://localhost:8080/json1">http://localhost:8080/json1</a></p>
<p><img src="/2022/03/29/SpringMVC03/3.png" alt="图片"></p>
<p>发现出现了乱码问题，我们需要设置一下他的编码格式为utf-8，以及它返回的类型；</p>
<p>通过@RequestMaping的produces属性来实现，修改下代码</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//produces:指定响应体返回类型和编码</span><br><span class="line">@RequestMapping(value = &quot;/json1&quot;,produces = &quot;application/json;charset=utf-8&quot;)</span><br></pre></td></tr></table></figure>
<p>再次测试， <a href="http://localhost:8080/json1">http://localhost:8080/json1</a> ， 乱码问题OK！</p>
<p><img src="/2022/03/29/SpringMVC03/4.png" alt="图片"></p>
<p>【注意：使用json记得处理乱码问题】</p>
<blockquote>
<p>代码优化</p>
</blockquote>
<h3 id="乱码统一解决"><a href="#乱码统一解决" class="headerlink" title="乱码统一解决"></a><strong>乱码统一解决</strong></h3><p>上一种方法比较麻烦，如果项目中有许多请求则每一个都要添加，可以通过Spring配置统一指定，这样就不用每次都去处理了！</p>
<p>我们可以在springmvc的配置文件上添加一段消息StringHttpMessageConverter转换配置！</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">mvc:message-converters</span> <span class="attr">register-defaults</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.http.converter.StringHttpMessageConverter&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.http.converter.json.MappingJackson2HttpMessageConverter&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;objectMapper&quot;</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.http.converter.json.Jackson2ObjectMapperFactoryBean&quot;</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;failOnEmptyBeans&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="返回json字符串统一解决"><a href="#返回json字符串统一解决" class="headerlink" title="返回json字符串统一解决"></a><strong>返回json字符串统一解决</strong></h3><p>在类上直接使用 <strong>@RestController</strong> ，这样子，里面所有的方法都只会返回 json 字符串了，不用再每一个都添加@ResponseBody ！我们在前后端分离开发中，一般都使用 @RestController ，十分便捷！</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//produces:指定响应体返回类型和编码</span></span><br><span class="line">   <span class="meta">@RequestMapping(value = &quot;/json1&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">json1</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">       <span class="comment">//创建一个jackson的对象映射器，用来解析数据</span></span><br><span class="line">       ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">       <span class="comment">//创建一个对象</span></span><br><span class="line">       User user = <span class="keyword">new</span> User(<span class="string">&quot;秦疆1号&quot;</span>, <span class="number">3</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">       <span class="comment">//将我们的对象解析成为json格式</span></span><br><span class="line">       String str = mapper.writeValueAsString(user);</span><br><span class="line">       <span class="comment">//由于@ResponseBody注解，这里会将str转成json格式返回；十分方便</span></span><br><span class="line">       <span class="keyword">return</span> str;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动tomcat测试，结果都正常输出！</p>
<blockquote>
<p>测试集合输出</p>
</blockquote>
<p>增加一个新的方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/json2&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">json2</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//创建一个jackson的对象映射器，用来解析数据</span></span><br><span class="line">   ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">   <span class="comment">//创建一个对象</span></span><br><span class="line">   User user1 = <span class="keyword">new</span> User(<span class="string">&quot;秦疆1号&quot;</span>, <span class="number">3</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">   User user2 = <span class="keyword">new</span> User(<span class="string">&quot;秦疆2号&quot;</span>, <span class="number">3</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">   User user3 = <span class="keyword">new</span> User(<span class="string">&quot;秦疆3号&quot;</span>, <span class="number">3</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">   User user4 = <span class="keyword">new</span> User(<span class="string">&quot;秦疆4号&quot;</span>, <span class="number">3</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">   List&lt;User&gt; list = <span class="keyword">new</span> ArrayList&lt;User&gt;();</span><br><span class="line">   list.add(user1);</span><br><span class="line">   list.add(user2);</span><br><span class="line">   list.add(user3);</span><br><span class="line">   list.add(user4);</span><br><span class="line"></span><br><span class="line">   <span class="comment">//将我们的对象解析成为json格式</span></span><br><span class="line">   String str = mapper.writeValueAsString(list);</span><br><span class="line">   <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果 : 十分完美，没有任何问题！</p>
<p><img src="/2022/03/29/SpringMVC03/5.png" alt="图片"></p>
<h3 id="输出时间对象"><a href="#输出时间对象" class="headerlink" title="输出时间对象"></a>输出时间对象</h3><p>增加一个新的方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/json3&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">json3</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line"></span><br><span class="line">   ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line"></span><br><span class="line">   <span class="comment">//创建时间一个对象，java.util.Date</span></span><br><span class="line">   Date date = <span class="keyword">new</span> Date();</span><br><span class="line">   <span class="comment">//将我们的对象解析成为json格式</span></span><br><span class="line">   String str = mapper.writeValueAsString(date);</span><br><span class="line">   <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果 :</p>
<p><img src="/2022/03/29/SpringMVC03/6.png" alt="图片"></p>
<ul>
<li>默认日期格式会变成一个数字，是1970年1月1日到当前日期的毫秒数！</li>
<li>Jackson 默认是会把时间转成timestamps形式</li>
</ul>
<p><strong>解决方案：取消timestamps形式 ， 自定义时间格式</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/json4&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">json4</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line"></span><br><span class="line">   ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line"></span><br><span class="line">   <span class="comment">//不使用时间戳的方式</span></span><br><span class="line">   mapper.configure(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS, <span class="keyword">false</span>);</span><br><span class="line">   <span class="comment">//自定义日期格式对象</span></span><br><span class="line">   SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">   <span class="comment">//指定日期格式</span></span><br><span class="line">   mapper.setDateFormat(sdf);</span><br><span class="line"></span><br><span class="line">   Date date = <span class="keyword">new</span> Date();</span><br><span class="line">   String str = mapper.writeValueAsString(date);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果 : 成功的输出了时间！</p>
<p><img src="/2022/03/29/SpringMVC03/7.png" alt="图片"></p>
<blockquote>
<p>抽取为工具类</p>
</blockquote>
<p><strong>如果要经常使用的话，这样是比较麻烦的，我们可以将这些代码封装到一个工具类中；我们去编写下</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.SerializationFeature;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JsonUtils</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getJson</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> getJson(object,<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getJson</span><span class="params">(Object object,String dateFormat)</span> </span>&#123;</span><br><span class="line">       ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">       <span class="comment">//不使用时间差的方式</span></span><br><span class="line">       mapper.configure(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS, <span class="keyword">false</span>);</span><br><span class="line">       <span class="comment">//自定义日期格式对象</span></span><br><span class="line">       SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(dateFormat);</span><br><span class="line">       <span class="comment">//指定日期格式</span></span><br><span class="line">       mapper.setDateFormat(sdf);</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="keyword">return</span> mapper.writeValueAsString(object);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们使用工具类，代码就更加简洁了！</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/json5&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">json5</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">   Date date = <span class="keyword">new</span> Date();</span><br><span class="line">   String json = JsonUtils.getJson(date);</span><br><span class="line">   <span class="keyword">return</span> json;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>大功告成！完美！</p>
<h3 id="FastJson"><a href="#FastJson" class="headerlink" title="FastJson"></a>FastJson</h3><p>fastjson.jar是阿里开发的一款专门用于Java开发的包，可以方便的实现json对象与JavaBean对象的转换，实现JavaBean对象与json字符串的转换，实现json对象与json字符串的转换。实现json的转换方法很多，最后的实现结果都是一样的。</p>
<p>fastjson 的 pom依赖！</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.60<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>fastjson 三个主要的类：</p>
<p><strong>JSONObject  代表 json 对象</strong> </p>
<ul>
<li>JSONObject实现了Map接口, 猜想 JSONObject底层操作是由Map实现的。</li>
<li>JSONObject对应json对象，通过各种形式的get()方法可以获取json对象中的数据，也可利用诸如size()，isEmpty()等方法获取”键：值”对的个数和判断是否为空。其本质是通过实现Map接口并调用接口中的方法完成的。</li>
</ul>
<p><strong>JSONArray  代表 json 对象数组</strong></p>
<ul>
<li>内部是有List接口中的方法来完成操作的。</li>
</ul>
<p><strong>JSON代表 JSONObject和JSONArray的转化</strong></p>
<ul>
<li>JSON类源码分析与使用</li>
<li>仔细观察这些方法，主要是实现json对象，json对象数组，javabean对象，json字符串之间的相互转化。</li>
</ul>
<p><strong>代码测试，我们新建一个FastJsonDemo 类</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.kuang.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FastJsonDemo</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">       <span class="comment">//创建一个对象</span></span><br><span class="line">       User user1 = <span class="keyword">new</span> User(<span class="string">&quot;秦疆1号&quot;</span>, <span class="number">3</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">       User user2 = <span class="keyword">new</span> User(<span class="string">&quot;秦疆2号&quot;</span>, <span class="number">3</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">       User user3 = <span class="keyword">new</span> User(<span class="string">&quot;秦疆3号&quot;</span>, <span class="number">3</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">       User user4 = <span class="keyword">new</span> User(<span class="string">&quot;秦疆4号&quot;</span>, <span class="number">3</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">       List&lt;User&gt; list = <span class="keyword">new</span> ArrayList&lt;User&gt;();</span><br><span class="line">       list.add(user1);</span><br><span class="line">       list.add(user2);</span><br><span class="line">       list.add(user3);</span><br><span class="line">       list.add(user4);</span><br><span class="line"></span><br><span class="line">       System.out.println(<span class="string">&quot;*******Java对象 转 JSON字符串*******&quot;</span>);</span><br><span class="line">       String str1 = JSON.toJSONString(list);</span><br><span class="line">       System.out.println(<span class="string">&quot;JSON.toJSONString(list)==&gt;&quot;</span>+str1);</span><br><span class="line">       String str2 = JSON.toJSONString(user1);</span><br><span class="line">       System.out.println(<span class="string">&quot;JSON.toJSONString(user1)==&gt;&quot;</span>+str2);</span><br><span class="line"></span><br><span class="line">       System.out.println(<span class="string">&quot;\n****** JSON字符串 转 Java对象*******&quot;</span>);</span><br><span class="line">       User jp_user1=JSON.parseObject(str2,User.class);</span><br><span class="line">       System.out.println(<span class="string">&quot;JSON.parseObject(str2,User.class)==&gt;&quot;</span>+jp_user1);</span><br><span class="line"></span><br><span class="line">       System.out.println(<span class="string">&quot;\n****** Java对象 转 JSON对象 ******&quot;</span>);</span><br><span class="line">       JSONObject jsonObject1 = (JSONObject) JSON.toJSON(user2);</span><br><span class="line">       System.out.println(<span class="string">&quot;(JSONObject) JSON.toJSON(user2)==&gt;&quot;</span>+jsonObject1.getString(<span class="string">&quot;name&quot;</span>));</span><br><span class="line"></span><br><span class="line">       System.out.println(<span class="string">&quot;\n****** JSON对象 转 Java对象 ******&quot;</span>);</span><br><span class="line">       User to_java_user = JSON.toJavaObject(jsonObject1, User.class);</span><br><span class="line">       System.out.println(<span class="string">&quot;JSON.toJavaObject(jsonObject1, User.class)==&gt;&quot;</span>+to_java_user);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种工具类，我们只需要掌握使用就好了，在使用的时候在根据具体的业务去找对应的实现。和以前的commons-io那种工具包一样，拿来用就好了！</p>
<h2 id="六、拦截器interceptor"><a href="#六、拦截器interceptor" class="headerlink" title="六、拦截器interceptor"></a>六、拦截器interceptor</h2><h3 id="1-编写类继承HandlerInterceptor"><a href="#1-编写类继承HandlerInterceptor" class="headerlink" title="1. 编写类继承HandlerInterceptor"></a>1. 编写类继承HandlerInterceptor</h3><ul>
<li>preHandle方法返回true则进入下一个过滤器，返回false则终止访问</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;===========过滤前===========&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;===========过滤后===========&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;清理&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-配置拦截器"><a href="#2-配置拦截器" class="headerlink" title="2. 配置拦截器"></a>2. 配置拦截器</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--/**代表拦截所有请求--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/**&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置拦截器类--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;cn.hestialx.config.MyInterceptor&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>SpringMVC</category>
      </categories>
      <tags>
        <tag>SpringMVC</tag>
      </tags>
  </entry>
  <entry>
    <title>Springcloud实用篇01</title>
    <url>/2022/06/06/Springcloud/</url>
    <content><![CDATA[<h1 id="一、初识微服务"><a href="#一、初识微服务" class="headerlink" title="一、初识微服务"></a>一、初识微服务</h1><h2 id="微服务架构"><a href="#微服务架构" class="headerlink" title="微服务架构"></a>微服务架构</h2><p><img src="/2022/06/06/Springcloud/1.png" alt="image-20220606133525887"></p>
<h2 id="微服务发布"><a href="#微服务发布" class="headerlink" title="微服务发布"></a>微服务发布</h2><p><img src="/2022/06/06/Springcloud/2.png" alt="image-20220606133612972"></p>
<h2 id="微服务知识体系"><a href="#微服务知识体系" class="headerlink" title="微服务知识体系"></a>微服务知识体系</h2><p><img src="/2022/06/06/Springcloud/3.png" alt="image-20220606135811678"></p>
<h2 id="微服务技术对比"><a href="#微服务技术对比" class="headerlink" title="微服务技术对比"></a>微服务技术对比</h2><p><img src="/2022/06/06/Springcloud/4.png" alt="image-20220606135951702"></p>
<h1 id="二、运行微服务demo"><a href="#二、运行微服务demo" class="headerlink" title="二、运行微服务demo"></a>二、运行微服务demo</h1><h2 id="demo说明："><a href="#demo说明：" class="headerlink" title="demo说明："></a>demo说明：</h2><p>需求：根据订单id查询订单的同时，把订单所属的用户信息一起返回</p>
<p><img src="/2022/06/06/Springcloud/5.png" alt="image-20220606150043408"></p>
<p><img src="/2022/06/06/Springcloud/6.png" alt="image-20220606150147813"></p>
<h2 id="远程调用步骤："><a href="#远程调用步骤：" class="headerlink" title="远程调用步骤："></a>远程调用步骤：</h2><p>1）注册RestTemplate</p>
<ul>
<li>RestTemplate 是springcould提供发送http请求的类</li>
</ul>
<p>在order-service的OrderApplication中注册RestTemplate</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@MapperScan(&quot;cn.itcast.order.mapper&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(OrderApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">getRestTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2）服务远程调用RestTemplate</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Order <span class="title">queryOrderById</span><span class="params">(Long orderId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1.查询订单</span></span><br><span class="line">        Order order = orderMapper.findById(orderId);</span><br><span class="line">        <span class="comment">// 2.定义访问的url</span></span><br><span class="line">        String url = <span class="string">&quot;http://localhost:8081/user/&quot;</span>+order.getUserId();</span><br><span class="line">        <span class="comment">// 3. 调用getForObject,获取user信息</span></span><br><span class="line">        User orderuser = restTemplate.getForObject(url, User.class);</span><br><span class="line">        <span class="comment">//3.1 设置order的用户信息</span></span><br><span class="line">        order.setUser(orderuser);</span><br><span class="line">        <span class="comment">// 4.返回</span></span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="三、Eureka-注册中心"><a href="#三、Eureka-注册中心" class="headerlink" title="三、Eureka(注册中心)"></a>三、Eureka(注册中心)</h1><h2 id="3-1-服务角色"><a href="#3-1-服务角色" class="headerlink" title="3.1 服务角色"></a>3.1 服务角色</h2><ol>
<li><p>Eureka Server(服务端的注册中心)</p>
<ul>
<li>记录服务信息</li>
<li>心跳监控</li>
</ul>
</li>
<li><p>Eureka Client</p>
<p>服务提供者：暴露服务接口，供其他的服务来调用</p>
<ul>
<li>注册提供服务信息到EurekaServer</li>
<li>每隔30秒向EurekaServer发送心跳信息</li>
</ul>
<p>服务消费者：使用其他服务提供的接口</p>
<ul>
<li>根据服务名称从EurekaServer中获取服务列表</li>
<li>基于服务列表进行负载均衡</li>
</ul>
</li>
</ol>
<ul>
<li>提供者和消费者是一个相对的概念，不同服务角色不同</li>
</ul>
<h2 id="3-2-搭建Eureka注册中心"><a href="#3-2-搭建Eureka注册中心" class="headerlink" title="3.2 搭建Eureka注册中心"></a>3.2 搭建Eureka注册中心</h2><ol>
<li><p>引入EurekaServer依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>添加自动装配注解@EnableEurekaServer</p>
</li>
<li><p>在配置文件中配置服务端口、名称、地址</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10086</span> <span class="comment">#服务端口</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">eurekaserve</span> <span class="comment">#eureka服务名称</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span> <span class="comment">#eureka地址信息</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://127.0.0.1:10086/eureka</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="3-3-服务注册"><a href="#3-3-服务注册" class="headerlink" title="3.3 服务注册"></a>3.3 服务注册</h2><ol>
<li><p>引入依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--eureka client --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置服务地址</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span> </span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">orderservice</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span> <span class="comment">#eureka地址信息</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://127.0.0.1:10086/eureka</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>服务重复发布</p>
</li>
</ol>
<ul>
<li>选择服务，右键点击copy configuration</li>
</ul>
<p><img src="/2022/06/06/Springcloud/7.png" alt="image-20220721142809145"></p>
<ul>
<li>设置服务启动端口</li>
</ul>
<p><img src="/2022/06/06/Springcloud/8.png" alt="image-20220721142620586"></p>
<ol>
<li>多次发布服务后，会在Eureka中注册多个服务</li>
</ol>
<p><img src="/2022/06/06/Springcloud/9.png" alt="image-20220721143115955"></p>
<h2 id="3-4-服务发现"><a href="#3-4-服务发现" class="headerlink" title="3.4 服务发现"></a>3.4 服务发现</h2><p>在Eureka中，服务拉取是基于服务名称获取服务列表，让后对服务列表做负载均衡</p>
<ol>
<li><p>将OrderService代码中的访问路径url改为服务名称</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Order <span class="title">queryOrderById</span><span class="params">(Long orderId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1.查询订单</span></span><br><span class="line">        Order order = orderMapper.findById(orderId);</span><br><span class="line">        <span class="comment">// 2.使用RestTemplate远程调用user接口，获取user信息</span></span><br><span class="line">        String url = <span class="string">&quot;http://userservice/user/&quot;</span>+order.getUserId();</span><br><span class="line">        <span class="comment">// 3. 调用getForObject,获取user信息</span></span><br><span class="line">        User orderuser = restTemplate.getForObject(url, User.class);</span><br><span class="line">        <span class="comment">//3.1 设置order的用户信息</span></span><br><span class="line">        order.setUser(orderuser);</span><br><span class="line">        <span class="comment">// 4.返回</span></span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在RestTemplate注入时添加负载均衡注解@LoadBalanced</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalanced</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RestTemplate <span class="title">getRestTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>多次访问/order/{id}接口</p>
<ul>
<li><a href="http://localhost:8080/order/101">http://localhost:8080/order/101</a></li>
</ul>
<p><img src="/2022/06/06/Springcloud/10.png" alt="image-20220721144240884"></p>
<ul>
<li><a href="http://localhost:8080/order/102">http://localhost:8080/order/102</a></li>
</ul>
<p><img src="/2022/06/06/Springcloud/11.png" alt="image-20220721144401584"></p>
</li>
</ol>
<p>发现已经进行了负载均衡，两次请求userservice被分发给不同服务进行处理了</p>
<h1 id="四、Ribbon负载均衡"><a href="#四、Ribbon负载均衡" class="headerlink" title="四、Ribbon负载均衡"></a>四、Ribbon负载均衡</h1><p>​    在使用Eureka客户端访问注册的服务时，经过了服务名称到真实路径的转换，如果一个服务有多个实例则还需要进行负载均衡。</p>
<p><img src="/2022/06/06/Springcloud/12.png" alt="image-20220721145234930"></p>
<h2 id="4-1-源码跟踪"><a href="#4-1-源码跟踪" class="headerlink" title="4.1 源码跟踪"></a>4.1 源码跟踪</h2><p>为什么我们只输入了service名称就可以访问了呢？之前还要获取ip和端口。</p>
<p>显然有人帮我们根据service名称，获取到了服务实例的ip和端口。它就是<code>LoadBalancerInterceptor</code>，这个类会在对RestTemplate的请求进行拦截，然后从Eureka根据服务id获取服务列表，随后利用负载均衡算法得到真实的服务地址信息，替换服务id。</p>
<p>我们进行源码跟踪：</p>
<h3 id="1）LoadBalancerIntercepor"><a href="#1）LoadBalancerIntercepor" class="headerlink" title="1）LoadBalancerIntercepor"></a>1）LoadBalancerIntercepor</h3><p><img src="/2022/06/06/Springcloud/13.png" alt="1525620483637"></p>
<p>可以看到这里的intercept方法，拦截了用户的HttpRequest请求，然后做了几件事：</p>
<ul>
<li><code>request.getURI()</code>：获取请求uri，本例中就是 <a href="http://user-service/user/8">http://user-service/user/8</a></li>
<li><code>originalUri.getHost()</code>：获取uri路径的主机名，其实就是服务id，<code>user-service</code></li>
<li><code>this.loadBalancer.execute()</code>：处理服务id，和用户请求。</li>
</ul>
<p>这里的<code>this.loadBalancer</code>是<code>LoadBalancerClient</code>类型，我们继续跟入。</p>
<h3 id="2）LoadBalancerClient"><a href="#2）LoadBalancerClient" class="headerlink" title="2）LoadBalancerClient"></a>2）LoadBalancerClient</h3><p>继续跟入execute方法：</p>
<p><img src="/2022/06/06/Springcloud/14.png" alt="1525620787090"></p>
<p>代码是这样的：</p>
<ul>
<li>getLoadBalancer(serviceId)：根据服务id获取ILoadBalancer，而ILoadBalancer会拿着服务id去eureka中获取服务列表并保存起来。</li>
<li>getServer(loadBalancer)：利用内置的负载均衡算法，从服务列表中选择一个。本例中，可以看到获取了8082端口的服务</li>
</ul>
<p>放行后，再次访问并跟踪，发现获取的是8081：</p>
<p> <img src="/2022/06/06/Springcloud/15.png" alt="1525620835911"></p>
<p>果然实现了负载均衡。</p>
<h3 id="3）负载均衡策略IRule"><a href="#3）负载均衡策略IRule" class="headerlink" title="3）负载均衡策略IRule"></a>3）负载均衡策略IRule</h3><p>在刚才的代码中，可以看到获取服务使通过一个<code>getServer</code>方法来做负载均衡:</p>
<p> <img src="/2022/06/06/Springcloud/16.png" alt="1525620835911"></p>
<p>我们继续跟入：</p>
<p><img src="/2022/06/06/Springcloud/17.png" alt="1544361421671"></p>
<p>继续跟踪源码chooseServer方法，发现这么一段代码：</p>
<p> <img src="/2022/06/06/Springcloud/18.png" alt="1525622652849"></p>
<p>我们看看这个rule是谁：</p>
<p> <img src="/2022/06/06/Springcloud/19.png" alt="1525622699666"></p>
<p>这里的rule默认值是一个<code>RoundRobinRule</code>，看类的介绍：</p>
<p> <img src="/2022/06/06/Springcloud/20.png" alt="1525622754316"></p>
<p>这不就是轮询的意思嘛。</p>
<p>到这里，整个负载均衡的流程我们就清楚了。</p>
<h3 id="4）总结"><a href="#4）总结" class="headerlink" title="4）总结"></a>4）总结</h3><p>SpringCloudRibbon的底层采用了一个拦截器，拦截了RestTemplate发出的请求，对地址做了修改。用一幅图来总结一下：</p>
<p><img src="/2022/06/06/Springcloud/21.png" alt="image-20210713224724673"></p>
<p>基本流程如下：</p>
<ul>
<li>拦截我们的RestTemplate请求<a href="http://userservice/user/1">http://userservice/user/1</a></li>
<li>RibbonLoadBalancerClient会从请求url中获取服务名称，也就是user-service</li>
<li>DynamicServerListLoadBalancer根据user-service到eureka拉取服务列表</li>
<li>eureka返回列表，localhost:8081、localhost:8082</li>
<li>IRule利用内置负载均衡规则，从列表中选择一个，例如localhost:8081</li>
<li>RibbonLoadBalancerClient修改请求地址，用localhost:8081替代userservice，得到<a href="http://localhost:8081/user/1，发起真实请求">http://localhost:8081/user/1，发起真实请求</a></li>
</ul>
<h2 id="4-2-负载均衡策略"><a href="#4-2-负载均衡策略" class="headerlink" title="4.2 负载均衡策略"></a>4.2 负载均衡策略</h2><h3 id="4-2-1-负载均衡策略"><a href="#4-2-1-负载均衡策略" class="headerlink" title="4.2.1.负载均衡策略"></a>4.2.1.负载均衡策略</h3><p>负载均衡的规则都定义在IRule接口中，而IRule有很多不同的实现类：</p>
<p><img src="/2022/06/06/Springcloud/22.png" alt="image-20210713225653000"></p>
<p>不同规则的含义如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th><strong>内置负载均衡规则类</strong></th>
<th><strong>规则描述</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>RoundRobinRule</td>
<td>简单轮询服务列表来选择服务器。它是Ribbon默认的负载均衡规则。</td>
</tr>
<tr>
<td>AvailabilityFilteringRule</td>
<td>对以下两种服务器进行忽略：   （1）在默认情况下，这台服务器如果3次连接失败，这台服务器就会被设置为“短路”状态。短路状态将持续30秒，如果再次连接失败，短路的持续时间就会几何级地增加。  （2）并发数过高的服务器。如果一个服务器的并发连接数过高，配置了AvailabilityFilteringRule规则的客户端也会将其忽略。并发连接数的上限，可以由客户端的<clientName>.<clientConfigNameSpace>.ActiveConnectionsLimit属性进行配置。</clientConfigNameSpace></clientName></td>
</tr>
<tr>
<td>WeightedResponseTimeRule</td>
<td>为每一个服务器赋予一个权重值。服务器响应时间越长，这个服务器的权重就越小。这个规则会随机选择服务器，这个权重值会影响服务器的选择。</td>
</tr>
<tr>
<td><strong>ZoneAvoidanceRule</strong></td>
<td>以区域可用的服务器为基础进行服务器的选择。使用Zone对服务器进行分类，这个Zone可以理解为一个机房、一个机架等。而后再对Zone内的多个服务做轮询。</td>
</tr>
<tr>
<td>BestAvailableRule</td>
<td>忽略那些短路的服务器，并选择并发数较低的服务器。</td>
</tr>
<tr>
<td>RandomRule</td>
<td>随机选择一个可用的服务器。</td>
</tr>
<tr>
<td>RetryRule</td>
<td>重试机制的选择逻辑</td>
</tr>
</tbody>
</table>
</div>
<p>默认的实现就是ZoneAvoidanceRule，是一种轮询方案</p>
<h3 id="4-2-2-自定义负载均衡策略"><a href="#4-2-2-自定义负载均衡策略" class="headerlink" title="4.2.2.自定义负载均衡策略"></a>4.2.2.自定义负载均衡策略</h3><p>通过定义IRule实现可以修改负载均衡规则，有两种方式：</p>
<ol>
<li>代码方式：在order-service中的OrderApplication类中，定义一个新的IRule：</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> IRule <span class="title">randomRule</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> RandomRule();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>配置文件方式：在order-service的application.yml文件中，添加新的配置也可以修改规则：</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">userservice:</span> <span class="comment"># 给某个微服务配置负载均衡规则，这里是userservice服务</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">    <span class="attr">NFLoadBalancerRuleClassName:</span> <span class="string">com.netflix.loadbalancer.RandomRule</span> <span class="comment"># 负载均衡规则 </span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意</strong>，一般用默认的负载均衡规则，不做修改。</p>
</blockquote>
<h2 id="4-4-饥饿加载"><a href="#4-4-饥饿加载" class="headerlink" title="4.4.饥饿加载"></a>4.4.饥饿加载</h2><p>Ribbon默认是采用懒加载，即第一次访问时才会去创建LoadBalanceClient，请求时间会很长。</p>
<p>而饥饿加载则会在项目启动时创建，降低第一次访问的耗时，通过下面配置开启饥饿加载：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="attr">eager-load:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">clients:</span> <span class="string">userservice</span></span><br></pre></td></tr></table></figure>
<h1 id="五、Nacos"><a href="#五、Nacos" class="headerlink" title="五、Nacos"></a>五、Nacos</h1><h2 id="5-1-安装Nacos"><a href="#5-1-安装Nacos" class="headerlink" title="5.1 安装Nacos"></a>5.1 安装Nacos</h2><p>见：Nacos安装指南</p>
<h2 id="5-2-Nacos快速入门"><a href="#5-2-Nacos快速入门" class="headerlink" title="5.2 Nacos快速入门"></a>5.2 Nacos快速入门</h2><ol>
<li>引入依赖</li>
</ol>
<p>父工程：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>客户端：（去掉eureka依赖）</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- nacos客户端依赖包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>修改配置</li>
</ol>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">userservice</span> <span class="comment">#user服务名称</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span>  <span class="comment">#user服务地址</span></span><br></pre></td></tr></table></figure>
<ol>
<li>服务的注册发现</li>
</ol>
<ul>
<li>导入依赖</li>
<li>编写配置</li>
<li>编写代码（与eureka一致）</li>
</ul>
<h2 id="5-3-Nacos分级存储模型"><a href="#5-3-Nacos分级存储模型" class="headerlink" title="5.3 Nacos分级存储模型"></a>5.3 Nacos分级存储模型</h2><p> Nacos分级存储</p>
<ol>
<li>一级是服务，例如userservice</li>
<li>二级是集群，自定义配置名称</li>
<li>三级是实例，实际运行的程序</li>
</ol>
<p>使用Nacos分级存储模型可以有效的避免跨集群访问，减少访问的响应时间</p>
<ul>
<li>集群的配置：</li>
</ul>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">userservice</span> <span class="comment">#user服务名称</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span>  <span class="comment">#user服务地址</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">HZ</span> <span class="comment">#集群配置</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/06/06/Springcloud/23.png" alt="image-20220723142053919"></p>
<ul>
<li>配置负载均衡策略</li>
</ul>
<p>如果不进行配置则还是会按照默认轮询的方式进行负载均衡，不能达到优先访问相同集群的效果</p>
<p>NacosRule优先访问本地集群，在本地集群的多个服务中进行随机访问，如果本地集群服务全部失效则会尝试访问其他集群的服务</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">userservice</span> <span class="comment">#user服务名称</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span>  <span class="comment">#user服务地址</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">HZ</span> <span class="comment">#集群配置</span></span><br><span class="line"><span class="attr">userservice:</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">    <span class="attr">NFLoadBalancerRuleClassName:</span> <span class="string">com.alibaba.cloud.nacos.ribbon.NacosRule</span></span><br></pre></td></tr></table></figure>
<ul>
<li>nacos控制台进行权重设置</li>
</ul>
<p><img src="/2022/06/06/Springcloud/24.png" alt="image-20220723144006495"></p>
<p><img src="/2022/06/06/Springcloud/25.png" alt="image-20220723144036908" style="zoom:50%;"></p>
<p>nacos设置权重后，NacosRule会根据设置权重对请求进行负载均衡，如果设置为0则不会被访问</p>
<h2 id="5-4-环境隔离"><a href="#5-4-环境隔离" class="headerlink" title="5.4 环境隔离"></a>5.4 环境隔离</h2><p>Nacos提供了namespace来实现环境隔离功能。</p>
<ul>
<li>nacos中可以有多个namespace</li>
<li>namespace下可以有group、service等</li>
<li>不同namespace之间相互隔离，例如不同namespace的服务互相不可见</li>
</ul>
<p><img src="/2022/06/06/Springcloud/26.png" alt="image-20210714000101516"></p>
<h3 id="5-5-1-创建namespace"><a href="#5-5-1-创建namespace" class="headerlink" title="5.5.1.创建namespace"></a>5.5.1.创建namespace</h3><p>默认情况下，所有service、data、group都在同一个namespace，名为public：</p>
<p><img src="/2022/06/06/Springcloud/27.png" alt="image-20210714000414781"></p>
<p>我们可以点击页面新增按钮，添加一个namespace：</p>
<p><img src="/2022/06/06/Springcloud/28.png" alt="image-20210714000440143"></p>
<p>然后，填写表单：</p>
<p><img src="/2022/06/06/Springcloud/29.png" alt="image-20210714000505928"></p>
<p>就能在页面看到一个新的namespace：</p>
<p><img src="/2022/06/06/Springcloud/30.png" alt="image-20210714000522913"></p>
<h3 id="5-5-2-给微服务配置namespace"><a href="#5-5-2-给微服务配置namespace" class="headerlink" title="5.5.2.给微服务配置namespace"></a>5.5.2.给微服务配置namespace</h3><p>给微服务配置namespace只能通过修改配置来实现。</p>
<p>例如，修改order-service的application.yml文件：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">HZ</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">492a7d5d-237b-46a1-a99a-fa8e98e4b0f9</span> <span class="comment"># 命名空间，填ID</span></span><br></pre></td></tr></table></figure>
<p>重启order-service后，访问控制台，可以看到下面的结果：</p>
<p><img src="/2022/06/06/Springcloud/31.png" alt="image-20210714000830703"></p>
<p><img src="/2022/06/06/Springcloud/32.png" alt="image-20210714000837140"></p>
<p>此时访问order-service，因为namespace不同，会导致找不到userservice，控制台会报错：</p>
<p><img src="/2022/06/06/Springcloud/33.png" alt="image-20210714000941256"></p>
<h2 id="5-6-Nacos与Eureka的区别"><a href="#5-6-Nacos与Eureka的区别" class="headerlink" title="5.6.Nacos与Eureka的区别"></a>5.6.Nacos与Eureka的区别</h2><p>Nacos的服务实例分为两种l类型：</p>
<ul>
<li><p>临时实例：如果实例宕机超过一定时间，会从服务列表剔除，默认的类型。</p>
</li>
<li><p>非临时实例：如果实例宕机，不会从服务列表剔除，也可以叫永久实例。</p>
</li>
</ul>
<p>配置一个服务实例为永久实例：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">ephemeral:</span> <span class="literal">false</span> <span class="comment"># 设置为非临时实例</span></span><br></pre></td></tr></table></figure>
<p>Nacos和Eureka整体结构类似，服务注册、服务拉取、心跳等待，但是也存在一些差异：</p>
<p><img src="/2022/06/06/Springcloud/34.png" alt="image-20210714001728017"></p>
<ul>
<li><p>Nacos与eureka的共同点</p>
<ul>
<li>都支持服务注册和服务拉取</li>
<li>都支持服务提供者心跳方式做健康检测</li>
</ul>
</li>
<li><p>Nacos与Eureka的区别</p>
<ul>
<li>Nacos支持服务端主动检测提供者状态：临时实例采用心跳模式，非临时实例采用主动检测模式</li>
<li>临时实例心跳不正常会被剔除，非临时实例则不会被剔除</li>
<li>Nacos支持服务列表变更的消息推送模式，服务列表更新更及时</li>
<li>Nacos集群默认采用AP方式，当集群中存在非临时实例时，采用CP模式；Eureka采用AP方式</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>SpringCloud</category>
      </categories>
      <tags>
        <tag>SpringCloud</tag>
      </tags>
  </entry>
  <entry>
    <title>javaweb问题汇总</title>
    <url>/2021/12/28/attention1/</url>
    <content><![CDATA[<h3 id="1、el表达式作为JavaScript参数"><a href="#1、el表达式作为JavaScript参数" class="headerlink" title="1、el表达式作为JavaScript参数"></a>1、el表达式作为JavaScript参数</h3><p>​    编写分页项目时，在实现每一行点击删除按钮实现删除功能时使用了el表达式向deletefun(id,nowPage)进行参数传递，发现参数为“undefined”。</p>
<p>（<strong>错误</strong>代码如下）</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;a href=<span class="string">&quot;javascript:deletefun($&#123;user.id&#125;,$&#123;nowPage&#125;)&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;btn btn-default&quot;</span> id=<span class="string">&quot;del3&quot;</span>&gt;删除&lt;/a&gt; </span><br></pre></td></tr></table></figure>
<p>​    <strong>查阅相关资料发现，使用el表达式进行JavaScript参数传递，需要将el表达式用引号包裹 </strong>eg: ‘${user.id}’</p>
<p>(修改后代码如下)</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;a href=<span class="string">&quot;javascript:deletefun(&#x27;$&#123;user.id&#125;&#x27;,&#x27;$&#123;nowPage&#125;&#x27;)&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;btn btn-default&quot;</span> id=<span class="string">&quot;del3&quot;</span>&gt;删除&lt;/a&gt; </span><br></pre></td></tr></table></figure>
<h3 id="2、修改用户表单中隐藏提交id（主键）"><a href="#2、修改用户表单中隐藏提交id（主键）" class="headerlink" title="2、修改用户表单中隐藏提交id（主键）"></a>2、修改用户表单中隐藏提交id（主键）</h3><p>​    在修改信息时，表单往往不会显示id值，但是后台在修改用户时要使用到其唯一标识，因此往往隐藏提交id</p>
<p>(使用input type=”hidden” value=”${user.id})。</p>
<p>（代码如下）</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;id&quot;</span> value=<span class="string">&quot;$&#123;user.id&#125;&quot;</span>&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span> id=<span class="string">&quot;username&quot;</span> placeholder=<span class="string">&quot;username&quot;</span> readonly=<span class="string">&quot;readonly&quot;</span>&gt;</span><br></pre></td></tr></table></figure>
<h3 id="3、前端div居中，和div中内容居中"><a href="#3、前端div居中，和div中内容居中" class="headerlink" title="3、前端div居中，和div中内容居中"></a>3、前端div居中，和div中内容居中</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--div居中--&gt;</span></span><br><span class="line">让div水准居中，设置css margin:0 auto;</span><br><span class="line"><span class="comment">&lt;!--内容居中--&gt;</span></span><br><span class="line">1、div内容水平居中CSS：</span><br><span class="line">text-align:center</span><br><span class="line">不论是p或其他div均能够对其设置此CSS完成对应对象内的形式水平居中。</span><br><span class="line"></span><br><span class="line">2、div模式垂直居中 行高属性：</span><br><span class="line">line-height</span><br><span class="line">要让div内只有一行的形式垂直居中，通常对div设置的height(高)与line-height(行高)相似，便可实现div形式垂直居中。</span><br></pre></td></tr></table></figure>
<h3 id="4-重定向连接参数中文乱码问题"><a href="#4-重定向连接参数中文乱码问题" class="headerlink" title="4. 重定向连接参数中文乱码问题"></a>4. 重定向连接参数中文乱码问题</h3><p>在使用response.sendRedirect(url)进行重定向时，遇到中文字符，如果不做任何处理，则在后台无法得到正确的中文字符，为了解决这一问题，今天尝试了好多次方法，这里记录一下我实测通过的方法： </p>
<p>使用response.sendredirect()时的处理 </p>
<p>（URLEncoder.encode转码为页面相应的编码）</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String encoder = &quot;utf-8&quot;;</span><br><span class="line">String s = URLEncoder.encode(&quot;中国必胜&quot;,encoder); </span><br><span class="line">String url = Util.newPath+&quot;/getDemandListInter.do?s=&quot;+s;</span><br><span class="line">		</span><br><span class="line">response.sendRedirect(url);</span><br></pre></td></tr></table></figure>
<p>接收端的处理： </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String s = new String(request.getParameter(&quot;s&quot;).getBytes(&quot;iso-8859-1&quot;));</span><br></pre></td></tr></table></figure>
<p>浏览器端使用的编码风格是iso-8859-1，所以才会出现这种错误。</p>
]]></content>
      <categories>
        <category>遇到的问题</category>
      </categories>
      <tags>
        <tag>attention</tag>
        <tag>problem</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3</title>
    <url>/2022/04/07/Vue3/</url>
    <content><![CDATA[<h1 id="Vue3学习"><a href="#Vue3学习" class="headerlink" title="Vue3学习"></a>Vue3学习</h1><h2 id="一、入门"><a href="#一、入门" class="headerlink" title="一、入门"></a>一、入门</h2><h3 id="1-1-引入vue支持"><a href="#1-1-引入vue支持" class="headerlink" title="1.1. 引入vue支持"></a>1.1. 引入vue支持</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/vue@next&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="1-2-入门代码"><a href="#1-2-入门代码" class="headerlink" title="1.2. 入门代码"></a>1.2. 入门代码</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;counter&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">            Counter: &#123;&#123; counter &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> Counter = &#123;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="attr">counter</span>: <span class="number">0</span></span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    Vue.createApp(Counter).mount(<span class="string">&#x27;#counter&#x27;</span>)</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>vue3通过定义const并将const绑定到对应id的html模板上，来实现数据的动态展示<ul>
<li>const中可以定义data()，data中return的键值对可以在绑定的html模板中使用： 的形式取出</li>
<li>定义的const可以通过Vue.createApp(const名称).(“#id值”)与对应的html模板绑定</li>
</ul>
</li>
</ul>
<h3 id="1-3-Vue响应式体验"><a href="#1-3-Vue响应式体验" class="headerlink" title="1.3. Vue响应式体验"></a>1.3. Vue响应式体验</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;counter&quot;</span>&gt;</span></span><br><span class="line">  Counter: &#123;&#123; counter &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> Counter = &#123;</span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="attr">counter</span>: <span class="number">0</span></span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">  &#125;,</span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.counter++</span></span><br><span class="line"><span class="javascript">    &#125;, <span class="number">1000</span>)</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript">Vue.createApp(Counter).mount(<span class="string">&#x27;#counter&#x27;</span>)</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>上述代码较1.2中 在const 中增加了mounted()，并在其中编写了一个定时器函数，没过一秒使得定义的const Counter 中的counter值加一，一旦counter值更新，页面上的对应值也会更新，实现了前端的动态。</li>
</ul>
<h3 id="1-4-属性绑定和事件绑定"><a href="#1-4-属性绑定和事件绑定" class="headerlink" title="1.4. 属性绑定和事件绑定"></a>1.4. 属性绑定和事件绑定</h3><h4 id="1-4-1-属性绑定"><a href="#1-4-1-属性绑定" class="headerlink" title="1.4.1 属性绑定"></a>1.4.1 属性绑定</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;bind-attribute&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-bind:title</span>=<span class="string">&quot;message&quot;</span>&gt;</span></span><br><span class="line">    鼠标悬停几秒钟查看此处动态绑定的提示信息！</span><br><span class="line">  <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> AttributeBinding = &#123;</span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="attr">message</span>: <span class="string">&#x27;You loaded this page on &#x27;</span> + <span class="keyword">new</span> <span class="built_in">Date</span>().toLocaleString()</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">Vue.createApp(AttributeBinding).mount(<span class="string">&#x27;#bind-attribute&#x27;</span>)</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>在已经和const绑定的html元素的子元素中，我们可以通过<strong>v-bind:属性值=“key”</strong> 对属性进行赋值</li>
</ul>
<h4 id="1-4-2-事件绑定"><a href="#1-4-2-事件绑定" class="headerlink" title="1.4.2 事件绑定"></a>1.4.2 事件绑定</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;event-handling&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;reverseMessage&quot;</span>&gt;</span>反转 Message<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> EventHandling = &#123;</span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="attr">message</span>: <span class="string">&#x27;Hello Vue.js!&#x27;</span></span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">  &#125;,</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">reverseMessage</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.message = <span class="built_in">this</span>.message</span></span><br><span class="line"><span class="javascript">        .split(<span class="string">&#x27;&#x27;</span>)</span></span><br><span class="line"><span class="javascript">        .reverse()</span></span><br><span class="line"><span class="javascript">        .join(<span class="string">&#x27;&#x27;</span>)</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">Vue.createApp(EventHandling).mount(<span class="string">&#x27;#event-handling&#x27;</span>)</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>const中可以通过methods：{ 方法} 来定义待使用的方法</p>
</li>
<li><p>在已经和const绑定的html元素的子元素中，我们可以通过<strong>v-on:事件名称=“methods中定义的方法名称”</strong> 来对dom元素进行事件绑定。</p>
</li>
</ul>
<h3 id="1-5-双向绑定"><a href="#1-5-双向绑定" class="headerlink" title="1.5 双向绑定"></a>1.5 双向绑定</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;doubleBind&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;message&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> vmodel = &#123;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="attr">message</span>: <span class="string">&quot;666&quot;</span></span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    Vue.createApp(vmodel).mount(<span class="string">&quot;#doubleBind&quot;</span>)</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>在已经和const绑定的html元素的子元素中，我们可以通过<strong>v-model=”key”</strong> 对表单value和数据进行双向绑定</li>
<li>绑定后，修改key对应的value值，表单数据会改变，修改表单value，数据也会改变</li>
</ul>
<h3 id="1-6-条件和循环"><a href="#1-6-条件和循环" class="headerlink" title="1.6 条件和循环"></a>1.6 条件和循环</h3><h4 id="1-6-1-实现if-else-if-else"><a href="#1-6-1-实现if-else-if-else" class="headerlink" title="1.6.1 实现if/else if/else"></a>1.6.1 实现if/else if/else</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;iftest&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;seen&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-if</span>=<span class="string">&quot;seen===&#x27;A&#x27;&quot;</span>&gt;</span>显示A<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-else-if</span>=<span class="string">&quot;seen===&#x27;B&#x27;&quot;</span>&gt;</span>显示B<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-else</span>&gt;</span>显示C<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;seen&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> ifTest = &#123;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="attr">seen</span>: <span class="string">&quot;A&quot;</span></span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    Vue.createApp(ifTest).mount(<span class="string">&quot;#iftest&quot;</span>)</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>在已经和const绑定的html元素的子元素中，可以通过在属性栏中使用<strong>v-if,v-else-if,v-else=“逻辑表达式”</strong> 来实现元素的动态显示。逻辑表达式为true则显示，为false则不显示</li>
</ul>
<h4 id="1-6-2-实现for循环"><a href="#1-6-2-实现for循环" class="headerlink" title="1.6.2 实现for循环"></a>1.6.2 实现for循环</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;for&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-for</span>=<span class="string">&quot;item in books&quot;</span>&gt;</span></span><br><span class="line">            &#123;&#123;item.name&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> fortest = &#123;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="attr">books</span>: [&#123;<span class="attr">name</span>:<span class="string">&quot;三国演义&quot;</span>&#125;,</span></span><br><span class="line"><span class="javascript">                &#123;<span class="attr">name</span>:<span class="string">&quot;水浒传&quot;</span>&#125;,</span></span><br><span class="line"><span class="javascript">                &#123;<span class="attr">name</span>:<span class="string">&quot;西游记&quot;</span>&#125;</span></span><br><span class="line"><span class="javascript">            ]</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    Vue.createApp(fortest).mount(<span class="string">&quot;#for&quot;</span>)</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>其中<strong>v-for=”item in books”</strong> 中的第一个参数可以写成<strong>v-for=”(item,index) in books</strong>，这样就可以获取遍历的下标，从0开始</li>
<li>还可以写成<strong>v-for=”(value,name,index) in books</strong>，直接将value和key取出</li>
</ul>
<h4 id="1-6-3-注意事项"><a href="#1-6-3-注意事项" class="headerlink" title="1.6.3 注意事项"></a>1.6.3 注意事项</h4><ul>
<li><p>不推荐在同一元素上同时使用v-if 和 v-for ，因为v-if的优先级比v-for高，同时使用在同一元素上，v-if无法获取v-for遍历的值</p>
</li>
<li><p>在使用v-for时最好同时绑定一个key属性，并将遍历对象的唯一值赋值给key，例如：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-for</span>=<span class="string">&quot;item in books&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="二、组件"><a href="#二、组件" class="headerlink" title="二、组件"></a>二、组件</h2><h3 id="2-1-定义使用组件"><a href="#2-1-定义使用组件" class="headerlink" title="2.1 定义使用组件"></a>2.1 定义使用组件</h3><p>​    组件系统是 Vue 的一个重要概念，因为它是一种抽象，允许我们使用小型、独立和通常可复用的组件构建大型应用。</p>
<p>​    在 Vue 中，组件本质上是一个具有预定义选项的实例。在 Vue 中注册组件很简单：如对 <code>app</code> 对象所做的那样创建一个组件对象，并将其定义在父级组件的 <code>components</code> 选项中：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;template&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">temp-test</span> <span class="attr">v-for</span>=<span class="string">&quot;book in books&quot;</span> <span class="attr">v-bind:items</span>=<span class="string">&quot;book&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">temp-test</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> tempTest = &#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">props</span>:[<span class="string">&#x27;items&#x27;</span>],</span></span><br><span class="line"><span class="javascript">        <span class="attr">template</span>: <span class="string">`&lt;li&gt;模板:&#123;&#123;items.name&#125;&#125;&lt;/li&gt;`</span></span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> templatetest = &#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="javascript">            tempTest</span></span><br><span class="line"><span class="javascript">        &#125;,</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="attr">message</span>: <span class="string">&quot;asds&quot;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="attr">books</span>: [&#123;<span class="attr">name</span>: <span class="string">&quot;西游记&quot;</span>&#125;,</span></span><br><span class="line"><span class="javascript">                &#123;<span class="attr">name</span>: <span class="string">&quot;三国演义&quot;</span>&#125;,</span></span><br><span class="line"><span class="javascript">                &#123;<span class="attr">name</span>: <span class="string">&quot;水浒传&quot;</span>&#125;</span></span><br><span class="line"><span class="javascript">            ]</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    Vue.createApp(templatetest).mount(<span class="string">&quot;#template&quot;</span>)</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>其中tempTest是定义的组件对象，在其中使用<strong>template: `html内容` </strong>定义组件内容，使用<strong>props: [‘参数名称1’] </strong>接收参数。</p>
<p>在想传入参数时，通过<strong>v-bind:参数名称1=’key值’ </strong>对参数1与根组件定义的data进行绑定。</p>
</li>
<li><p>templatetest是根组件，在其中可以使用<strong>components: {组件名称} </strong>绑定需要使用的组件。</p>
<p>在其挂载的元素中通过<strong>&lt;组件名称 [v-bind:组件参数名=‘key’]&gt;&lt;组件名称/&gt;</strong> 来使用绑定的模板</p>
</li>
<li><p><strong>注意！</strong></p>
<p>所有的组件中都可以定义并使用data()、methods 等属性！</p>
</li>
</ul>
<h3 id="2-2-根组件"><a href="#2-2-根组件" class="headerlink" title="2.2 根组件"></a>2.2 根组件</h3><h4 id="2-2-1-概念"><a href="#2-2-1-概念" class="headerlink" title="2.2.1 概念"></a>2.2.1 概念</h4><ul>
<li>每个 Vue 应用都是通过用 <code>createApp</code> 函数创建一个新的<strong>应用实例</strong>开始的：</li>
</ul>
<p>​        应用实例暴露的大多数方法都会返回该同一实例，允许链式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Vue.createApp(&#123;&#125;)</span><br><span class="line">  .component(<span class="string">&#x27;SearchInput&#x27;</span>, SearchInputComponent)</span><br><span class="line">  .directive(<span class="string">&#x27;focus&#x27;</span>, FocusDirective)</span><br><span class="line">  .use(LocalePlugin)</span><br></pre></td></tr></table></figure>
<ul>
<li>传递给 <code>createApp</code> 的选项用于配置<strong>根组件</strong>。当我们<strong>挂载</strong>应用时，该组件被用作渲染的起点。叫做根组件。</li>
</ul>
<p>​        与大多数应用方法不同的是，<code>mount</code> 不返回应用本身。相反，它返回的是根组件实例。</p>
<h4 id="2-2-2-组件树"><a href="#2-2-2-组件树" class="headerlink" title="2.2.2 组件树"></a>2.2.2 组件树</h4><p>尽管本页面上的所有示例都只需要一个单一的组件就可以，但是大多数的真实应用都是被组织成一个嵌套的、可重用的组件树。举个例子，一个 todo 应用组件树可能是这样的：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Root Component</span><br><span class="line">└─ TodoList</span><br><span class="line">   ├─ TodoItem</span><br><span class="line">   │  ├─ DeleteTodoButton</span><br><span class="line">   │  └─ EditTodoButton</span><br><span class="line">   └─ TodoListFooter</span><br><span class="line">      ├─ ClearTodosButton</span><br><span class="line">      └─ TodoListStatistics</span><br></pre></td></tr></table></figure>
<h3 id="2-3-组件实例-property"><a href="#2-3-组件实例-property" class="headerlink" title="2.3 组件实例 property"></a>2.3 组件实例 property</h3><p>在前面的指南中，我们认识了 <code>data</code> property。在 <code>data</code> 中定义的 property 是通过组件实例暴露的：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> app = Vue.createApp(&#123;</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">count</span>: <span class="number">4</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vm = app.mount(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(vm.count) <span class="comment">// =&gt; 4</span></span><br></pre></td></tr></table></figure>
<p>还有各种其他的组件选项，可以将用户定义的 property 添加到组件实例中，例如 <code>methods</code>，<code>props</code>，<code>computed</code>，<code>inject</code> 和 <code>setup</code>。</p>
<h3 id="2-4-生命周期钩子函数"><a href="#2-4-生命周期钩子函数" class="headerlink" title="2.4 生命周期钩子函数"></a>2.4 生命周期钩子函数</h3><ul>
<li><p>每个组件在被创建时都要经过一系列的初始化过程——例如，需要设置数据监听、编译模板、将实例挂载到 DOM 并在数据变化时更新 DOM 等。同时在这个过程中也会运行一些叫做<strong>生命周期钩子</strong>的函数，这给了用户在不同阶段添加自己的代码的机会。</p>
</li>
<li><p>也有一些其它的钩子，在实例生命周期的不同阶段被调用，如 <strong>mounted（）</strong> 和 <strong>created（）</strong>分别在组件实例创建和应用实例创建完毕后调用。</p>
</li>
<li>生命周期钩子的 <code>this</code> 上下文指向调用它的当前活动实例。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> roottem = &#123;</span><br><span class="line">        <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&quot;lx&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;created----&quot;</span>+<span class="built_in">this</span>.name)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">beforeCreate</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;beforeCreate--------&quot;</span>+<span class="built_in">this</span>.name)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;mounted----------&quot;</span>+<span class="built_in">this</span>.name)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> temimp = Vue.createApp(roottem).mount(<span class="string">&quot;#head&quot;</span>);</span><br></pre></td></tr></table></figure>
<h2 id="三、模板语法"><a href="#三、模板语法" class="headerlink" title="三、模板语法"></a>三、模板语法</h2><p>Vue.js 使用了基于 HTML 的模板语法，允许开发者声明式地将 DOM 绑定至底层组件实例的数据。所有 Vue.js 的模板都是合法的 HTML，所以能被遵循规范的浏览器和 HTML 解析器解析。</p>
<p>在底层的实现上，Vue 将模板编译成虚拟 DOM 渲染函数。结合响应性系统，Vue 能够智能地计算出最少需要重新渲染多少组件，并把 DOM 操作次数减到最少。</p>
<h3 id="3-1-插值"><a href="#3-1-插值" class="headerlink" title="3.1 插值"></a>3.1 插值</h3><h4 id="3-1-1-插入文本"><a href="#3-1-1-插入文本" class="headerlink" title="3.1.1 插入文本"></a>3.1.1 插入文本</h4><ul>
<li>数据绑定最常见的形式就是使用双大括号语法的文本插值：</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>Message: &#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Mustache 标签将会被替代为对应组件实例中 <code>msg</code> property 的值。无论何时，绑定的组件实例上 <code>msg</code> property 发生了改变，插值处的内容都会更新。</p>
<p>通过使用 <strong>v-once</strong> 指令，你也能执行一次性地插值，当数据改变时，插值处的内容不会更新。但请留心这会影响到该节点上的其它数据绑定：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">v-once</span>&gt;</span>这个将不会改变: &#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-1-2-插入html"><a href="#3-1-2-插入html" class="headerlink" title="3.1.2 插入html"></a>3.1.2 插入html</h4><p>双大括号会将数据解释为普通文本，而非 HTML 代码。为了输出真正的 HTML，你需要使用<code>v-html</code> 指令</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Using mustaches: &#123;&#123; rawHtml &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Using v-html directive: <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-html</span>=<span class="string">&quot;rawHtml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">	<span class="keyword">const</span> RenderHtmlApp = &#123;</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="attr">rawHtml</span>: <span class="string">&#x27;&lt;span style=&quot;color: red&quot;&gt;This should be red.&lt;/span&gt;&#x27;</span></span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">Vue.createApp(RenderHtmlApp).mount(<span class="string">&#x27;#example1&#x27;</span>)</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>第一个p标签输出的是纯文本信息</li>
<li>第二个p标签输出的是html解析后的信息</li>
</ul>
<h4 id="3-1-3-属性插值"><a href="#3-1-3-属性插值" class="headerlink" title="3.1.3 属性插值"></a>3.1.3 属性插值</h4><ul>
<li>双大括号语法不能在 HTML 属性中使用，然而，可以使用 <code>v-bind</code> 指令：</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-bind:id</span>=<span class="string">&quot;dynamicId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果绑定的值是 <code>null</code> 或 <code>undefined</code>，那么该 attribute 将不会被包含在渲染的元素上。</p>
<h4 id="3-1-4-插值语法中可以使用js表达式"><a href="#3-1-4-插值语法中可以使用js表达式" class="headerlink" title="3.1.4 插值语法中可以使用js表达式"></a>3.1.4 插值语法中可以使用js表达式</h4><ul>
<li>迄今为止，在我们的模板中，我们一直都只绑定简单的 property 键值。但实际上，对于所有的数据绑定，Vue.js 都提供了完全的 JavaScript 表达式支持。</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;&#123; number + 1 &#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123; ok ? &#x27;YES&#x27; : &#x27;NO&#x27; &#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123; message.split(&#x27;&#x27;).reverse().join(&#x27;&#x27;) &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-bind:id</span>=<span class="string">&quot;&#x27;list-&#x27; + id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-2-动态参数"><a href="#3-2-动态参数" class="headerlink" title="3.2 动态参数"></a>3.2 动态参数</h3><h3 id="动态参数"><a href="#动态参数" class="headerlink" title="动态参数"></a>动态参数</h3><p>也可以在指令参数中使用 JavaScript 表达式，方法是用方括号括起来：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">注意，参数表达式的写法存在一些约束，如之后的“对动态参数表达式的约束”章节所述。</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-bind:</span>[<span class="attr">attributeName</span>]=<span class="string">&quot;url&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里的 <code>attributeName</code> 会被作为一个 JavaScript 表达式进行动态求值，求得的值将会作为最终的参数来使用。例如，如果你的组件实例有一个 data property <code>attributeName</code>，其值为 <code>&quot;href&quot;</code>，那么这个绑定将等价于 <code>v-bind:href</code>。</p>
<h3 id="3-3-指令缩写"><a href="#3-3-指令缩写" class="headerlink" title="3.3 指令缩写"></a>3.3 指令缩写</h3><h4 id="3-2-1-v-bind缩写"><a href="#3-2-1-v-bind缩写" class="headerlink" title="3.2.1 v-bind缩写"></a>3.2.1 v-bind缩写</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 完整语法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-bind:href</span>=<span class="string">&quot;url&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 缩写 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">:href</span>=<span class="string">&quot;url&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 动态参数的缩写 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">:</span>[<span class="attr">key</span>]=<span class="string">&quot;url&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-2-2-v-on缩写"><a href="#3-2-2-v-on缩写" class="headerlink" title="3.2.2 v-on缩写"></a>3.2.2 v-on缩写</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 完整语法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-on:click</span>=<span class="string">&quot;doSomething&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 缩写 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> @<span class="attr">click</span>=<span class="string">&quot;doSomething&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 动态参数的缩写 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> @[<span class="attr">event</span>]=<span class="string">&quot;doSomething&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="四、data属性和方法"><a href="#四、data属性和方法" class="headerlink" title="四、data属性和方法"></a>四、data属性和方法</h2><h4 id="Data-属性"><a href="#Data-属性" class="headerlink" title="Data 属性"></a>Data 属性</h4><p>组件的 <code>data</code> 选项是一个函数。Vue 会在创建新组件实例的过程中调用此函数。它应该返回一个对象，然后 Vue 会通过响应性系统将其包裹起来，并以 <code>$data</code> 的形式存储在组件实例中。为方便起见，该对象的任何顶级属性也会直接通过组件实例暴露出来（可以通过组件实例直接调用）：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> app = Vue.createApp(&#123;</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">count</span>: <span class="number">4</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vm = app.mount(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(vm.$data.count) <span class="comment">// =&gt; 4</span></span><br><span class="line"><span class="built_in">console</span>.log(vm.count)       <span class="comment">// =&gt; 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改 vm.count 的值也会更新 $data.count</span></span><br><span class="line">vm.count = <span class="number">5</span></span><br><span class="line"><span class="built_in">console</span>.log(vm.$data.count) <span class="comment">// =&gt; 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 反之亦然</span></span><br><span class="line">vm.$data.count = <span class="number">6</span></span><br><span class="line"><span class="built_in">console</span>.log(vm.count) <span class="comment">// =&gt; 6</span></span><br></pre></td></tr></table></figure>
<p>这些实例 属性仅在实例首次创建时被添加，所以你需要确保它们都在 <code>data</code> 函数返回的对象中。必要时，要对尚未提供所需值的 属性使用 <code>null</code>、<code>undefined</code> 或其他占位的值。</p>
<p>直接将不包含在 <code>data</code> 中的新 属性添加到组件实例是可行的。但由于该 属性不在背后的响应式 <code>$data</code> 对象内，所以 Vue 的响应性系统不会自动跟踪它。</p>
<p>Vue 使用 <code>$</code> 前缀通过组件实例暴露自己的内置 API。它还为内部 属性保留 <code>_</code> 前缀。你应该避免使用这两个字符开头的顶级 <code>data</code> 属性名称。</p>
<h4 id="方法方法"><a href="#方法方法" class="headerlink" title="方法方法"></a>方法方法</h4><p>我们用 <code>methods</code> 选项向组件实例添加方法，它应该是一个包含所需方法的对象：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> app = Vue.createApp(&#123;</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">count</span>: <span class="number">4</span> &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="function"><span class="title">increment</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="comment">// `this` 指向该组件实例</span></span><br><span class="line">      <span class="built_in">this</span>.count++</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vm = app.mount(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(vm.count) <span class="comment">// =&gt; 4</span></span><br><span class="line"></span><br><span class="line">vm.increment()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(vm.count) <span class="comment">// =&gt; 5</span></span><br></pre></td></tr></table></figure>
<p>Vue 自动为 <code>methods</code> 绑定 <code>this</code>，以便于它始终指向组件实例。这将确保方法在用作事件监听或回调时保持正确的 <code>this</code> 指向。在定义 <code>methods</code> 时应避免使用箭头函数，因为这会阻止 Vue 绑定恰当的 <code>this</code> 指向。</p>
<p>这些 <code>methods</code> 和组件实例的其它所有 属性一样可以在组件的模板中被访问。在模板中，它们通常被当做事件监听使用：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;increment&quot;</span>&gt;</span>Up vote<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在上面的例子中，点击 <code>&lt;button&gt;</code> 时，会调用 <code>increment</code> 方法。</p>
<p>也可以直接从模板中调用。你也可以在模板支持 JavaScript 表达式的任何地方调用方法：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">:title</span>=<span class="string">&quot;toTitleDate(date)&quot;</span>&gt;</span></span><br><span class="line">  &#123;&#123; formatDate(date) &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="五、计算属性和侦听器"><a href="#五、计算属性和侦听器" class="headerlink" title="五、计算属性和侦听器"></a>五、计算属性和侦听器</h2><h3 id="5-1-计算属性"><a href="#5-1-计算属性" class="headerlink" title="5.1 计算属性"></a>5.1 计算属性</h3><p>模板内的表达式非常便利，但是设计它们的初衷是用于简单运算的。</p>
<p>对于任何包含响应式数据的复杂逻辑，你都应该使用<strong>计算属性</strong>。</p>
<p>计算属性带有缓存，如果请求的参数没有改变，则会从缓存中直接返回结果，减少了计算开销</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>输入是否是lx:&#123;&#123;nameislx&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> nameTem = &#123;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="attr">name</span>: <span class="string">&#x27;lx&#x27;</span></span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;,</span></span><br><span class="line"><span class="javascript">        <span class="comment">//定义计算属性</span></span></span><br><span class="line"><span class="javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="javascript">            <span class="function"><span class="title">nameislx</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">return</span> <span class="built_in">this</span>.name===<span class="string">&#x27;lx&#x27;</span>?<span class="string">&#x27;yes&#x27;</span>:<span class="string">&#x27;no&#x27;</span>;</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> vm = Vue.createApp(nameTem).mount(<span class="string">&quot;#name&quot;</span>);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="5-2-侦听器"><a href="#5-2-侦听器" class="headerlink" title="5.2 侦听器"></a>5.2 侦听器</h3><p>Vue 通过 <code>watch</code> 选项提供了一个更通用的方法来响应数据的变化。</p>
<p>当需要在数据变化时执行异步或开销较大的操作时，这个方式是最有用的。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;watch-example&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    Ask a yes/no question:</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;question&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; answer &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 因为 AJAX 库和通用工具的生态已经相当丰富，Vue 核心代码没有重复 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 提供这些功能以保持精简。这也可以让你自由选择自己更熟悉的工具。 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/axios@0.12.0/dist/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> watchExampleVM = Vue.createApp(&#123;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">question</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="attr">answer</span>: <span class="string">&#x27;Questions usually contain a question mark. ;-)&#x27;</span></span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript">    &#125;,</span></span><br><span class="line"><span class="javascript">    <span class="attr">watch</span>: &#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 每当 question 发生变化时，该函数将会执行</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">question</span>(<span class="params">newQuestion, oldQuestion</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (newQuestion.indexOf(<span class="string">&#x27;?&#x27;</span>) &gt; -<span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.getAnswer()</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript">    &#125;,</span></span><br><span class="line"><span class="javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="title">getAnswer</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.answer = <span class="string">&#x27;Thinking...&#x27;</span></span></span><br><span class="line"><span class="javascript">        axios</span></span><br><span class="line"><span class="javascript">          .get(<span class="string">&#x27;https://yesno.wtf/api&#x27;</span>)</span></span><br><span class="line"><span class="javascript">          .then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.answer = response.data.answer</span></span><br><span class="line"><span class="javascript">          &#125;)</span></span><br><span class="line"><span class="javascript">          .catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.answer = <span class="string">&#x27;Error! Could not reach the API. &#x27;</span> + error</span></span><br><span class="line"><span class="javascript">          &#125;)</span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">  &#125;).mount(<span class="string">&#x27;#watch-example&#x27;</span>)</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="六、Class-与-Style-绑定"><a href="#六、Class-与-Style-绑定" class="headerlink" title="六、Class 与 Style 绑定"></a>六、Class 与 Style 绑定</h2><p><strong>核心</strong>：通过对Class 的改变来控制样式</p>
<p>我们可以传给 <code>:class</code> (<code>v-bind:class</code> 的简写) 一个对象，以动态地切换 class：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">&quot;&#123; active: isActive &#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="6-1-有三种不同的绑定方式"><a href="#6-1-有三种不同的绑定方式" class="headerlink" title="6.1 有三种不同的绑定方式"></a>6.1 有三种不同的绑定方式</h3><p>例子：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.active</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">background-color</span>: skyblue;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.fontblue</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">color</span>: blue;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;classbind&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">:class</span>=<span class="string">&quot;&#123;active: isactive&#125;&quot;</span>&gt;</span>通过参数true or false控制是否添加class<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeactive&quot;</span>&gt;</span>切换class<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">&quot;[style1,style2]&quot;</span>&gt;</span>通过参数值添加class<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">&quot;objectstyle&quot;</span>&gt;</span>通过对象来控制class,对象中的键为class名称，值为true or false<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> classbindtem = &#123;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="attr">isactive</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">                <span class="attr">style1</span>: <span class="string">&quot;fontblue&quot;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="attr">style2</span>: <span class="string">&quot;active&quot;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="attr">objectstyle</span>: &#123;</span></span><br><span class="line"><span class="javascript">                    <span class="attr">active</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">fontblue</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">                &#125;</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;,</span></span><br><span class="line"><span class="javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="javascript">            <span class="function"><span class="title">changeactive</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.isactive = !<span class="built_in">this</span>.isactive;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="built_in">this</span>.isactive);</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    Vue.createApp(classbindtem).mount(<span class="string">&quot;#classbind&quot;</span>);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="6-2-内联样式绑定："><a href="#6-2-内联样式绑定：" class="headerlink" title="6.2 内联样式绑定："></a>6.2 内联样式绑定：</h3><p>即绑定style属性：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;stylebind&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">:style</span>=<span class="string">&quot;obj1&quot;</span>&gt;</span>通过对象绑定样式参数<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;color:colorval,width:widthval,height:heightval,backgroundColor:bcval&#125;&quot;</span>&gt;</span>通过属性值绑定样式参数<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> styletem = &#123;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="attr">obj1</span>: &#123;</span></span><br><span class="line"><span class="javascript">                    <span class="attr">color</span>: <span class="string">&quot;blue&quot;</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">backgroundColor</span>: <span class="string">&quot;black&quot;</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">height</span>: <span class="string">&quot;200px&quot;</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">width</span>: <span class="string">&quot;200px&quot;</span></span></span><br><span class="line"><span class="javascript">                &#125;,</span></span><br><span class="line"><span class="javascript">                <span class="attr">colorval</span>: <span class="string">&quot;skyblue&quot;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="attr">widthval</span>: <span class="string">&quot;100px&quot;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="attr">heightval</span>: <span class="string">&quot;100px&quot;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="attr">bcval</span>: <span class="string">&quot;green&quot;</span></span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    Vue.createApp(styletem).mount(<span class="string">&quot;#stylebind&quot;</span>);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="七、事件"><a href="#七、事件" class="headerlink" title="七、事件"></a>七、事件</h2><h3 id="7-1-监听事件"><a href="#7-1-监听事件" class="headerlink" title="7.1 监听事件"></a>7.1 监听事件</h3><p>我们可以使用 <code>v-on</code> 指令 (通常缩写为 <code>@</code> 符号) 来监听 DOM 事件，并在触发事件时执行一些 JavaScript。用法为 <code>v-on:click=&quot;methodName&quot;</code> 或使用快捷方式 <code>@click=&quot;methodName&quot;</code></p>
<p>例如：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;basic-event&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;counter += 1&quot;</span>&gt;</span>Add 1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>The button above has been clicked &#123;&#123; counter &#125;&#125; times.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Vue.createApp(&#123;</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">counter</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).mount(<span class="string">&#x27;#basic-event&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="7-2-事件处理方法"><a href="#7-2-事件处理方法" class="headerlink" title="7.2 事件处理方法"></a>7.2 事件处理方法</h3><p>然而许多事件处理逻辑会更为复杂，所以直接把 JavaScript 代码写在 <code>v-on</code> 指令中是不可行的。因此 <code>v-on</code> 还可以接收一个需要调用的方法名称。</p>
<p>例如：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;event-with-method&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- `greet` 是在下面定义的方法名 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;greet&quot;</span>&gt;</span>Greet<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Vue.createApp(&#123;</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Vue.js&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="function"><span class="title">greet</span>(<span class="params">event</span>)</span> &#123;</span><br><span class="line">      <span class="comment">// `methods` 内部的 `this` 指向当前活动实例</span></span><br><span class="line">      alert(<span class="string">&#x27;Hello &#x27;</span> + <span class="built_in">this</span>.name + <span class="string">&#x27;!&#x27;</span>)</span><br><span class="line">      <span class="comment">// `event` 是原生 DOM event</span></span><br><span class="line">      <span class="keyword">if</span> (event) &#123;</span><br><span class="line">        alert(event.target.tagName)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).mount(<span class="string">&#x27;#event-with-method&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="7-3-内联处理器中的方法"><a href="#7-3-内联处理器中的方法" class="headerlink" title="7.3 内联处理器中的方法"></a>7.3 内联处理器中的方法</h3><p>除了直接绑定到一个方法，也可以在内联 JavaScript 语句中调用方法：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;inline-handler&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;say(&#x27;hi&#x27;)&quot;</span>&gt;</span>Say hi<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;say(&#x27;what&#x27;)&quot;</span>&gt;</span>Say what<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Vue.createApp(&#123;</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="function"><span class="title">say</span>(<span class="params">message</span>)</span> &#123;</span><br><span class="line">      alert(message)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).mount(<span class="string">&#x27;#inline-handler&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>有时也需要在内联语句处理器中访问原始的 DOM 事件。可以用特殊变量 <code>$event</code> 把它传入方法：</p>
<p><strong>注意</strong> ：绑定方法会自动传入event，而内联语句中需要手动传入</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;warn(&#x27;Form cannot be submitted yet.&#x27;, $event)&quot;</span>&gt;</span></span><br><span class="line">  Submit</span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="function"><span class="title">warn</span>(<span class="params">message, event</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 现在可以访问到原生事件</span></span><br><span class="line">    <span class="keyword">if</span> (event) &#123;</span><br><span class="line">      event.preventDefault()</span><br><span class="line">    &#125;</span><br><span class="line">    alert(message)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-4-多事件处理器"><a href="#7-4-多事件处理器" class="headerlink" title="7.4 多事件处理器"></a>7.4 多事件处理器</h3><p>事件处理程序中可以有多个方法，这些方法由逗号运算符分隔：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这两个 one() 和 two() 将执行按钮点击事件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;one($event), two($event)&quot;</span>&gt;</span></span><br><span class="line">  Submit</span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="function"><span class="title">one</span>(<span class="params">event</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 第一个事件处理器逻辑...</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">two</span>(<span class="params">event</span>)</span> &#123;</span><br><span class="line">   <span class="comment">// 第二个事件处理器逻辑...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-5-事件修饰符"><a href="#7-5-事件修饰符" class="headerlink" title="7.5 事件修饰符"></a>7.5 事件修饰符</h3><p>在事件处理程序中调用 <code>event.preventDefault()</code> 或 <code>event.stopPropagation()</code> 是非常常见的需求。尽管我们可以在方法中轻松实现这点，但更好的方式是：方法只有纯粹的数据逻辑，而不是去处理 DOM 事件细节。</p>
<p>为了解决这个问题，Vue.js 为 <code>v-on</code> 提供了<strong>事件修饰符</strong>。之前提过，修饰符是由点开头的指令后缀来表示的。</p>
<ul>
<li><code>.stop</code></li>
<li><code>.prevent</code></li>
<li><code>.capture</code></li>
<li><code>.self</code></li>
<li><code>.once</code></li>
<li><code>.passive</code></li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 阻止单击事件继续冒泡 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> @<span class="attr">click.stop</span>=<span class="string">&quot;doThis&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 提交事件不再重载页面 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> @<span class="attr">submit.prevent</span>=<span class="string">&quot;onSubmit&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 修饰符可以串联 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> @<span class="attr">click.stop.prevent</span>=<span class="string">&quot;doThat&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 只有修饰符 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> @<span class="attr">submit.prevent</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 添加事件监听器时使用事件捕获模式 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 即内部元素触发的事件先在此处理，然后才交由内部元素进行处理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> @<span class="attr">click.capture</span>=<span class="string">&quot;doThis&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 只当在 event.target 是当前元素自身时触发处理函数 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 即事件不是从内部元素触发的 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> @<span class="attr">click.self</span>=<span class="string">&quot;doThat&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>使用修饰符时，顺序很重要；相应的代码会以同样的顺序产生。因此，用 <code>@click.prevent.self</code> 会阻止<strong>元素本身及其子元素的点击的默认行为</strong>，而 <code>@click.self.prevent</code> 只会阻止对元素自身的点击的默认行为。</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 点击事件将只会触发一次 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> @<span class="attr">click.once</span>=<span class="string">&quot;doThis&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>不像其它只能对原生的 DOM 事件起作用的修饰符，<code>.once</code> 修饰符还能被用到自定义的<a href="https://v3.cn.vuejs.org/guide/component-custom-events.html">组件事件</a>上。如果你还没有阅读关于组件的文档，现在大可不必担心。</p>
</li>
<li><p>Vue 还对应 <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener#Parameters"><code>addEventListener</code> 中的 passive 选项</a>提供了 <code>.passive</code> 修饰符。</p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 滚动事件的默认行为 (即滚动行为) 将会立即触发，   --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 而不会等待 `onScroll` 完成，                    --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 以防止其中包含 `event.preventDefault()` 的情况  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> @<span class="attr">scroll.passive</span>=<span class="string">&quot;onScroll&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个 <code>.passive</code> 修饰符尤其能够提升移动端的性能。</p>
<p>不要把 <code>.passive</code> 和 <code>.prevent</code> 一起使用，因为 <code>.prevent</code> 将会被忽略，同时浏览器可能会向你展示一个警告。请记住，<code>.passive</code> 会告诉浏览器你<em>不想</em>阻止事件的默认行为。</p>
<h3 id="7-6-按键修饰符"><a href="#7-6-按键修饰符" class="headerlink" title="7.6 按键修饰符"></a>7.6 按键修饰符</h3><p>在监听键盘事件时，我们经常需要检查特定的按键。Vue 允许为 <code>v-on</code> 或者 <code>@</code> 在监听键盘事件时添加按键修饰符：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 只有在 `key` 是 `Enter` 时调用 `vm.submit()` --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> @<span class="attr">keyup.enter</span>=<span class="string">&quot;submit&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>你可以直接将 <a href="https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key/Key_Values"><code>KeyboardEvent.key</code></a> 暴露的任意有效按键名转换为 kebab-case 来作为修饰符。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> @<span class="attr">keyup.page-down</span>=<span class="string">&quot;onPageDown&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>在上述示例中，处理函数只会在 <code>$event.key</code> 等于 <code>&#39;PageDown&#39;</code> 时被调用。</p>
<h4 id="按键别名"><a href="#按键别名" class="headerlink" title="按键别名"></a>按键别名</h4><p>Vue 为最常用的键提供了别名：</p>
<ul>
<li><code>.enter</code></li>
<li><code>.tab</code></li>
<li><code>.delete</code> (捕获“删除”和“退格”键)</li>
<li><code>.esc</code></li>
<li><code>.space</code></li>
<li><code>.up</code></li>
<li><code>.down</code></li>
<li><code>.left</code></li>
<li><code>.right</code></li>
</ul>
<h3 id="7-7-系统修饰键"><a href="#7-7-系统修饰键" class="headerlink" title="7.7 系统修饰键"></a>7.7 系统修饰键</h3><p>可以用如下修饰符来实现仅在按下相应按键时才触发鼠标或键盘事件的监听器。</p>
<ul>
<li><code>.ctrl</code></li>
<li><code>.alt</code></li>
<li><code>.shift</code></li>
<li><code>.meta</code></li>
</ul>
<p>提示</p>
<p>注意：在 Mac 系统键盘上，meta 对应 command 键 (⌘)。在 Windows 系统键盘 meta 对应 Windows 徽标键 (⊞)。在 Sun 操作系统键盘上，meta 对应实心宝石键 (◆)。在其他特定键盘上，尤其在 MIT 和 Lisp 机器的键盘、以及其后继产品，比如 Knight 键盘、space-cadet 键盘，meta 被标记为“META”。在 Symbolics 键盘上，meta 被标记为“META”或者“Meta”。</p>
<p>例如：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Alt + Enter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> @<span class="attr">keyup.alt.enter</span>=<span class="string">&quot;clear&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Ctrl + Click --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> @<span class="attr">click.ctrl</span>=<span class="string">&quot;doSomething&quot;</span>&gt;</span>Do something<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>请注意修饰键与常规按键不同，在和 <code>keyup</code> 事件一起用时，事件触发时修饰键必须处于按下状态。换句话说，只有在按住 <code>ctrl</code> 的情况下释放其它按键，才能触发 <code>keyup.ctrl</code>。而单单释放 <code>ctrl</code> 也不会触发事件。</p>
<h3 id="7-8-exact-修饰符"><a href="#7-8-exact-修饰符" class="headerlink" title="7.8 .exact 修饰符"></a>7.8 <code>.exact</code> 修饰符</h3><p><code>.exact</code> 修饰符允许你控制由精确的系统修饰符组合触发的事件。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 即使 Alt 或 Shift 被一同按下时也会触发 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click.ctrl</span>=<span class="string">&quot;onClick&quot;</span>&gt;</span>A<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 有且只有 Ctrl 被按下的时候才触发 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click.ctrl.exact</span>=<span class="string">&quot;onCtrlClick&quot;</span>&gt;</span>A<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 没有任何系统修饰符被按下的时候才触发 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click.exact</span>=<span class="string">&quot;onClick&quot;</span>&gt;</span>A<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="7-9-鼠标按钮修饰符"><a href="#7-9-鼠标按钮修饰符" class="headerlink" title="7.9 鼠标按钮修饰符"></a>7.9 鼠标按钮修饰符</h3><ul>
<li><code>.left</code></li>
<li><code>.right</code></li>
<li><code>.middle</code></li>
</ul>
<p>这些修饰符会限制处理函数仅响应特定的鼠标按钮。</p>
<h2 id="八、表单输入绑定"><a href="#八、表单输入绑定" class="headerlink" title="八、表单输入绑定"></a>八、表单输入绑定</h2><h3 id="8-1-基础用法"><a href="#8-1-基础用法" class="headerlink" title="8.1 基础用法"></a>8.1 基础用法</h3><ul>
<li>你可以用 v-model 指令在表单 <code>&lt;input&gt;</code>、<code>&lt;textarea&gt;</code> 及 <code>&lt;select&gt;</code> 元素上创建双向数据绑定。它会根据控件类型自动选取正确的方法来更新元素。尽管有些神奇，但 <code>v-model</code> 本质上不过是语法糖。它负责监听用户的输入事件来更新数据，并在某种极端场景下进行一些特殊处理。</li>
</ul>
<h4 id="提示："><a href="#提示：" class="headerlink" title="提示："></a><strong>提示</strong>：</h4><p><code>v-model</code> 会忽略所有表单元素的 <code>value</code>、<code>checked</code>、<code>selected</code> attribute 的初始值。它将始终将当前活动实例的数据作为数据来源。你应该通过 JavaScript 在组件的 <code>data</code> 选项中声明初始值。</p>
<p><code>v-model</code> 在内部为不同的输入元素使用不同的 property 并抛出不同的事件：</p>
<ul>
<li>text 和 textarea 元素使用 <code>value</code> property 和 <code>input</code> 事件；</li>
<li>checkbox 和 radio 使用 <code>checked</code> property 和 <code>change</code> 事件；</li>
<li>select 字段将 <code>value</code> 作为 prop 并将 <code>change</code> 作为事件。</li>
</ul>
<p>注意：</p>
<ul>
<li>对于需要使用<a href="https://en.wikipedia.org/wiki/Input_method">输入法</a> (如中文、日文、韩文等) 的语言，你会发现 <code>v-model</code> 不会在输入法组织文字过程中得到更新。如果你也想响应这些更新，请使用 <code>input</code> 事件监听器和 <code>value</code> 绑定来替代 <code>v-model</code>。</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;input1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">input</span>=<span class="string">&quot;inputmethod&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> inputtem = &#123;</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="attr">msg</span>: <span class="string">&#x27;输入&#x27;</span></span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;,</span></span><br><span class="line"><span class="javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="javascript">            <span class="function"><span class="title">inputmethod</span>(<span class="params">event</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.msg = event.target.value;</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    Vue.createApp(inputtem).mount(<span class="string">&quot;#input1&quot;</span>);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>其他用法详情见：<a href="https://v3.cn.vuejs.org/guide/forms.html#基础用法">表单输入绑定 | Vue.js (vuejs.org)</a></p>
<h3 id="修饰符"><a href="#修饰符" class="headerlink" title="修饰符"></a>修饰符</h3><h4 id="lazy"><a href="#lazy" class="headerlink" title=".lazy"></a><code>.lazy</code></h4><p>在默认情况下，<code>v-model</code> 在每次 <code>input</code> 事件触发后将输入框的值与数据进行同步 (除了<a href="https://v3.cn.vuejs.org/guide/forms.html#vmodel-ime-tip">上述</a>输入法组织文字时)。你可以添加 <code>lazy</code> 修饰符，从而转为在 <code>change</code> 事件之后进行同步：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在“change”时而非“input”时更新 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model.lazy</span>=<span class="string">&quot;msg&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="number"><a href="#number" class="headerlink" title=".number"></a><code>.number</code></h4><p>如果想自动将用户的输入值转为数值类型，可以给 <code>v-model</code> 添加 <code>number</code> 修饰符：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model.number</span>=<span class="string">&quot;age&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>当输入类型为 <code>text</code> 时这通常很有用。如果输入类型是 <code>number</code>，Vue 能够自动将原始字符串转换为数字，无需为 <code>v-model</code> 添加 <code>.number</code> 修饰符。如果这个值无法被 <code>parseFloat()</code> 解析，则返回原始的值。</p>
<h4 id="trim"><a href="#trim" class="headerlink" title=".trim"></a><code>.trim</code></h4><p>如果要自动过滤用户输入的首尾空白字符，可以给 <code>v-model</code> 添加 <code>trim</code> 修饰符：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model.trim</span>=<span class="string">&quot;msg&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="九、axios发送ajax请求"><a href="#九、axios发送ajax请求" class="headerlink" title="九、axios发送ajax请求"></a>九、axios发送ajax请求</h2><p>导入：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/vue@next&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/axios/dist/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>创建data.json作为异步获取数据的数据源</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;狂神说java&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;http://baidu.com&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;page&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;isNonProfit&quot;</span>:<span class="string">&quot;true&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;address&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;street&quot;</span>: <span class="string">&quot;含光门&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;city&quot;</span>:<span class="string">&quot;陕西西安&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;country&quot;</span>: <span class="string">&quot;中国&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;links&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;B站&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;https://www.bilibili.com/&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;4399&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;https://www.4399.com/&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;百度&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;https://www.baidu.com/&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>异步获取json数据并显示到页面：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/vue@next&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/axios/dist/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;axiostest&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> axiostem = &#123;</span></span><br><span class="line"><span class="javascript">            <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">return</span>&#123; </span></span><br><span class="line"><span class="javascript">                    <span class="attr">msg</span>: <span class="literal">null</span></span></span><br><span class="line"><span class="javascript">                &#125;</span></span><br><span class="line"><span class="javascript">            &#125;,</span></span><br><span class="line"><span class="javascript">            <span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">                axios.get(<span class="string">&#x27;data.json&#x27;</span>).then(<span class="function"><span class="params">response</span>=&gt;</span>(<span class="built_in">this</span>.msg = response.data.name))</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">        Vue.createApp(axiostem).mount(<span class="string">&quot;#axiostest&quot;</span>);</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="十、slot插槽"><a href="#十、slot插槽" class="headerlink" title="十、slot插槽"></a>十、slot插槽</h2><p>将 <code>&lt;slot&gt;</code> 元素作为承载分发内容的出口。</p>
<p>它允许你像这样合成组件：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slots</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>实例：</p>
<ul>
<li><p>多组件问题，在定义 <slot>&lt;/slots&gt;时声明name属性</slot></p>
</li>
<li><p>在外部使用 <template v-slot:name> 获取</template></p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;whole&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">whole-temp</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:head1</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">head1</span> <span class="attr">:title</span>=<span class="string">&quot;title&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">head1</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:content</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">content</span> <span class="attr">v-for</span>=<span class="string">&quot;(content,index) in user&quot;</span> <span class="attr">:content</span>=<span class="string">&quot;content&quot;</span> <span class="attr">:index</span>=<span class="string">&quot;index&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">content</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:foot1</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">foot1</span> <span class="attr">:footmsg</span>=<span class="string">&quot;footmsg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">foot1</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">whole-temp</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="handlebars"><span class="xml"></span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        const head1 = &#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            props: [&#x27;title&#x27;],</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            template: `<span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><span class="template-variable">&#123;&#123;<span class="name">title</span>&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span>`</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        &#125;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        const content = &#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            props: [&#x27;content&#x27;, &#x27;index&#x27;],</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            template: `<span class="tag">&lt;<span class="name">li</span>&gt;</span></span><span class="template-variable">&#123;&#123;<span class="name">index</span>&#125;&#125;</span><span class="xml">--------</span><span class="template-variable">&#123;&#123;<span class="name">content.name</span>&#125;&#125;</span><span class="xml">-----</span><span class="template-variable">&#123;&#123;<span class="name">content.age</span>&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span>`</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        &#125;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        const foot1 = &#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            props: [&#x27;footmsg&#x27;],</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            template: `<span class="tag">&lt;<span class="name">p</span>&gt;</span></span><span class="template-variable">&#123;&#123;<span class="name">footmsg</span>&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span>`</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        &#125;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        const wholeTemp = &#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            template: `<span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                            <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&#x27;head1&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                                <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&#x27;content&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                            <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&#x27;foot1&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span>`</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        &#125;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        const webpage = &#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            data() &#123; </span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                return &#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    title: &quot;组件组合&quot;,</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    user: [&#123; name: &#x27;lx&#x27;, age: 12 &#125;,</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    &#123; name: &#x27;xx&#x27;, age: 18 &#125;,</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    &#123; name: &#x27;hhh&#x27;, age: 20 &#125;,</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    &#123; name: &#x27;lx&#x27;, age: 25 &#125;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    ],</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    footmsg: &#x27;结束&#x27;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                &#125;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            &#125;,</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            components: &#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                head1,</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                content,</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                foot1,</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                wholeTemp</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            &#125;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        &#125;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        Vue.createApp(webpage).mount(&quot;#whole&quot;);</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">    </span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="十一、自定义事件"><a href="#十一、自定义事件" class="headerlink" title="十一、自定义事件"></a>十一、自定义事件</h2><ol>
<li><p>使用  <strong>@自定义事件名称=’方法名称‘</strong>  定义自定义事件</p>
</li>
<li><p>在需要使用的组件中使用：</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">emits: [<span class="string">&#x27;自定义事件名称&#x27;</span>] 声明自定义事件</span><br></pre></td></tr></table></figure>
<ol>
<li><p>在方法中使用：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">this</span>.$emit(<span class="string">&#x27;事件名称&#x27;</span>,自定义事件调用的方法参数) 来激活自定义事件</span><br></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;whole&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">whole-temp</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:head1</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">head1</span> <span class="attr">:title</span>=<span class="string">&quot;title&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">head1</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:content</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">content</span> <span class="attr">v-for</span>=<span class="string">&quot;(content,index) in user&quot;</span> <span class="attr">:content</span>=<span class="string">&quot;content&quot;</span> <span class="attr">:index</span>=<span class="string">&quot;index&quot;</span> @<span class="attr">removethis</span>=<span class="string">&quot;removeitem&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">content</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:foot1</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">foot1</span> <span class="attr">:footmsg</span>=<span class="string">&quot;footmsg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">foot1</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">whole-temp</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="handlebars"><span class="xml"></span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        const head1 = &#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            props: [&#x27;title&#x27;],</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            template: `<span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><span class="template-variable">&#123;&#123;<span class="name">title</span>&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span>`</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        &#125;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        const content = &#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            emits: [&#x27;removethis&#x27;],</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            props: [&#x27;content&#x27;, &#x27;index&#x27;],</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            template: `<span class="tag">&lt;<span class="name">li</span>&gt;</span></span><span class="template-variable">&#123;&#123;<span class="name">index</span>&#125;&#125;</span><span class="xml">--------</span><span class="template-variable">&#123;&#123;<span class="name">content.name</span>&#125;&#125;</span><span class="xml">-----</span><span class="template-variable">&#123;&#123;<span class="name">content.age</span>&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span> <span class="tag">&lt;<span class="name">button</span> <span class="attr">:index</span>=<span class="string">&#x27;index&#x27;</span> @<span class="attr">click</span>=<span class="string">&#x27;removeinparent&#x27;</span>&gt;</span>删除一条记录<span class="tag">&lt;/<span class="name">button</span>&gt;</span>`,</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                methods: &#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    removeinparent(index)&#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                        this.$emit(&#x27;removethis&#x27;,index)</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    &#125;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                &#125;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        &#125;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        const foot1 = &#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            props: [&#x27;footmsg&#x27;],</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            template: `<span class="tag">&lt;<span class="name">p</span>&gt;</span></span><span class="template-variable">&#123;&#123;<span class="name">footmsg</span>&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span>`</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        &#125;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        const wholeTemp = &#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            template: `<span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                            <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&#x27;head1&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                                <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&#x27;content&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                            <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&#x27;foot1&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span>`</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        &#125;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        const webpage = &#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            data() &#123; </span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                return &#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    title: &quot;组件组合&quot;,</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    user: [&#123; name: &#x27;lx&#x27;, age: 12 &#125;,</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    &#123; name: &#x27;xx&#x27;, age: 18 &#125;,</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    &#123; name: &#x27;hhh&#x27;, age: 20 &#125;,</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    &#123; name: &#x27;lx&#x27;, age: 25 &#125;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    ],</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    footmsg: &#x27;结束&#x27;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                &#125;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            &#125;,</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            components: &#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                head1,</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                content,</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                foot1,</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                wholeTemp</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            &#125;,</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            methods: &#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                removeitem(index)&#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    this.user.splice(index,1);</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                &#125;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            &#125;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        &#125;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        Vue.createApp(webpage).mount(&quot;#whole&quot;);</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">    </span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Vue3</category>
      </categories>
      <tags>
        <tag>Vue3</tag>
      </tags>
  </entry>
  <entry>
    <title>bootstrap-1</title>
    <url>/2021/11/28/bootstrap-1/</url>
    <content><![CDATA[<h3 id="一、响应式布局"><a href="#一、响应式布局" class="headerlink" title="一、响应式布局"></a>一、响应式布局</h3><h5 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h5><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">注意：jquery 的引入要在bootstrap.min.js前</span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;resource/css/bootstrap.min.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;resource/js/jquery-3.4.1.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;resource/js/bootstrap.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>同一套页面可以兼容不同分辨率的设备。</li>
</ul>
<p>实现∶依赖于栅格系统∶将一行平均分成12个格子，可以指定元秦占几个格子</p>
<p>步骤∶</p>
<ol>
<li><p>定义容器。相当于之前的 table</p>
<ul>
<li><p>容器分类(样式)</p>
<ul>
<li><p>container</p>
<p>固定宽度</p>
</li>
<li><p>container-fluid</p>
<p>自适应宽度</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>定义行。相当于之前的 tr  </p>
<ul>
<li>样式：row</li>
</ul>
</li>
<li><p>定义元素。指定该元素秦在不同的设备上，所占的格子数目</p>
<ul>
<li>样式：col-设备代号-格子数目<ul>
<li>xs : 超小屏幕 （&lt;768px）</li>
<li>sm : 小屏幕平板(≥768px)</li>
<li>md :中等屏幕桌面显示器(&gt;992px)</li>
<li>lg :大屏幕大桌面显示器(≥1200px)</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>eg:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span> = <span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-1 col-md-2 col-sm-3 col-xs-4 inner&quot;</span>&gt;</span>格子<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-1 col-md-2 col-sm-3 col-xs-4 inner&quot;</span>&gt;</span>格子<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-1 col-md-2 col-sm-3 col-xs-4 inner&quot;</span>&gt;</span>格子<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-1 col-md-2 col-sm-3 col-xs-4 inner&quot;</span>&gt;</span>格子<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-1 col-md-2 col-sm-3 col-xs-4 inner&quot;</span>&gt;</span>格子<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-1 col-md-2 col-sm-3 col-xs-4 inner&quot;</span>&gt;</span>格子<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-1 col-md-2 col-sm-3 col-xs-4 inner&quot;</span>&gt;</span>格子<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-1 col-md-2 col-sm-3 col-xs-4 inner&quot;</span>&gt;</span>格子<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-1 col-md-2 col-sm-3 col-xs-4 inner&quot;</span>&gt;</span>格子<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-1 col-md-2 col-sm-3 col-xs-4 inner&quot;</span>&gt;</span>格子<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-1 col-md-2 col-sm-3 col-xs-4 inner&quot;</span>&gt;</span>格子<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-1 col-md-2 col-sm-3 col-xs-4 inner&quot;</span>&gt;</span>格子<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="二、图片样式"><a href="#二、图片样式" class="headerlink" title="二、图片样式"></a>二、图片样式</h3><p>常用的全局css样式：</p>
<ul>
<li><p>按钮：class= “btn btn-default”</p>
</li>
<li><p>图片：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">class = &quot;img-responsive&quot;：图片在任意尺寸都占100%</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;...&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;...&quot;</span> <span class="attr">class</span>=<span class="string">&quot;img-rounded&quot;</span>&gt;</span> 圆角</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;...&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;...&quot;</span> <span class="attr">class</span>=<span class="string">&quot;img-circle&quot;</span>&gt;</span>  圆形</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;...&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;...&quot;</span> <span class="attr">class</span>=<span class="string">&quot;img-thumbnail&quot;</span>&gt;</span> 正方形</span><br></pre></td></tr></table></figure>
</li>
<li><p>表格</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;table table-bordered&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>表单</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;form-horizontal&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;inputEmail3&quot;</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-2 control-label&quot;</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-10&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">id</span>=<span class="string">&quot;inputEmail3&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Email&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;inputPassword3&quot;</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-2 control-label&quot;</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-10&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">id</span>=<span class="string">&quot;inputPassword3&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Password&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-offset-2 col-sm-10&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;checkbox&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span>&gt;</span> Remember me</span><br><span class="line">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-offset-2 col-sm-10&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-default&quot;</span>&gt;</span>Sign in<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="三、组件"><a href="#三、组件" class="headerlink" title="三、组件"></a>三、组件</h3><p>常用组件</p>
<ol>
<li><p>分页</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">aria-label</span>=<span class="string">&quot;Page navigation&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;pagination&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">aria-label</span>=<span class="string">&quot;Previous&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="symbol">&amp;laquo;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>4<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">aria-label</span>=<span class="string">&quot;Next&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="symbol">&amp;raquo;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"></span><br><span class="line">禁用和激活状态</span><br><span class="line">链接在不同情况下可以定制。你可以给不能点击的链接添加 .disabled 类、给当前页添加 .active 类。</span><br><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">aria-label</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;pagination&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;disabled&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">aria-label</span>=<span class="string">&quot;Previous&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="symbol">&amp;laquo;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;active&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>1 <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span>&gt;</span>(current)<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>轮播图</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">图片居中（将此部分添加到div,设置div class属性container）</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;carousel-example-generic&quot;</span> <span class="attr">class</span>=<span class="string">&quot;carousel slide&quot;</span> <span class="attr">data-ride</span>=<span class="string">&quot;carousel&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Indicators --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ol</span> <span class="attr">class</span>=<span class="string">&quot;carousel-indicators&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-target</span>=<span class="string">&quot;#carousel-example-generic&quot;</span> <span class="attr">data-slide-to</span>=<span class="string">&quot;0&quot;</span> <span class="attr">class</span>=<span class="string">&quot;active&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-target</span>=<span class="string">&quot;#carousel-example-generic&quot;</span> <span class="attr">data-slide-to</span>=<span class="string">&quot;1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-target</span>=<span class="string">&quot;#carousel-example-generic&quot;</span> <span class="attr">data-slide-to</span>=<span class="string">&quot;2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- Wrapper for slides --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;carousel-inner&quot;</span> <span class="attr">role</span>=<span class="string">&quot;listbox&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item active&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;...&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;carousel-caption&quot;</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;...&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;carousel-caption&quot;</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- Controls --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;left carousel-control&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#carousel-example-generic&quot;</span> <span class="attr">role</span>=<span class="string">&quot;button&quot;</span> <span class="attr">data-slide</span>=<span class="string">&quot;prev&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;glyphicon glyphicon-chevron-left&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span>&gt;</span>Previous<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;right carousel-control&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#carousel-example-generic&quot;</span> <span class="attr">role</span>=<span class="string">&quot;button&quot;</span> <span class="attr">data-slide</span>=<span class="string">&quot;next&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;glyphicon glyphicon-chevron-right&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span>&gt;</span>Next<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>导航栏</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">&quot;navbar navbar-default&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container-fluid&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Brand and toggle get grouped for better mobile display --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;navbar-header&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;navbar-toggle collapsed&quot;</span> <span class="attr">data-toggle</span>=<span class="string">&quot;collapse&quot;</span> <span class="attr">data-target</span>=<span class="string">&quot;#bs-example-navbar-collapse-1&quot;</span> <span class="attr">aria-expanded</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span>&gt;</span>Toggle navigation<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;icon-bar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;icon-bar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;icon-bar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;navbar-brand&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Brand<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Collect the nav links, forms, and other content for toggling --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;collapse navbar-collapse&quot;</span> <span class="attr">id</span>=<span class="string">&quot;bs-example-navbar-collapse-1&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;nav navbar-nav&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;active&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Link <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span>&gt;</span>(current)<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Link<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;dropdown&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dropdown-toggle&quot;</span> <span class="attr">data-toggle</span>=<span class="string">&quot;dropdown&quot;</span> <span class="attr">role</span>=<span class="string">&quot;button&quot;</span> <span class="attr">aria-haspopup</span>=<span class="string">&quot;true&quot;</span> <span class="attr">aria-expanded</span>=<span class="string">&quot;false&quot;</span>&gt;</span>Dropdown <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;caret&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;dropdown-menu&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Action<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Another action<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Something else here<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">role</span>=<span class="string">&quot;separator&quot;</span> <span class="attr">class</span>=<span class="string">&quot;divider&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Separated link<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">role</span>=<span class="string">&quot;separator&quot;</span> <span class="attr">class</span>=<span class="string">&quot;divider&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>One more separated link<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;navbar-form navbar-left&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Search&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-default&quot;</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;nav navbar-nav navbar-right&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Link<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;dropdown&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dropdown-toggle&quot;</span> <span class="attr">data-toggle</span>=<span class="string">&quot;dropdown&quot;</span> <span class="attr">role</span>=<span class="string">&quot;button&quot;</span> <span class="attr">aria-haspopup</span>=<span class="string">&quot;true&quot;</span> <span class="attr">aria-expanded</span>=<span class="string">&quot;false&quot;</span>&gt;</span>Dropdown <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;caret&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;dropdown-menu&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Action<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Another action<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Something else here<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">role</span>=<span class="string">&quot;separator&quot;</span> <span class="attr">class</span>=<span class="string">&quot;divider&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Separated link<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="comment">&lt;!-- /.navbar-collapse --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="comment">&lt;!-- /.container-fluid --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
]]></content>
      <categories>
        <category>bootstrap</category>
      </categories>
      <tags>
        <tag>bootstrap</tag>
      </tags>
  </entry>
  <entry>
    <title>cookieAndSession</title>
    <url>/2021/12/12/cookieAndSession/</url>
    <content><![CDATA[<h3 id="一、servlet会话技术"><a href="#一、servlet会话技术" class="headerlink" title="一、servlet会话技术"></a>一、servlet会话技术</h3><p>概述：一次会话包含浏览器第一次给服务器发送请求（会话建立），到有一方断开（会话结束）</p>
<ul>
<li>一次会话中包含多次请求和响应。</li>
</ul>
<p>功能：</p>
<ul>
<li>在一次会话请求中的多次访问中共享数据</li>
</ul>
<p>方式：</p>
<p>cookie和session</p>
<h5 id="1-Cookie（客户端会话技术，将数据保存到客户端）"><a href="#1-Cookie（客户端会话技术，将数据保存到客户端）" class="headerlink" title="1. Cookie（客户端会话技术，将数据保存到客户端）"></a>1. Cookie（客户端会话技术，将数据保存到客户端）</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//创建cookie对象，绑定数据</span></span><br><span class="line"><span class="keyword">new</span> Cookie(String name,String value);</span><br><span class="line"><span class="comment">//发送cookie对象</span></span><br><span class="line">response.addCookie(Cookie cookie);</span><br><span class="line"><span class="comment">//获取Cookie数据</span></span><br><span class="line">Cookie[] request.getCookies();</span><br><span class="line"><span class="keyword">for</span>(Cookie c: CookieList)&#123;</span><br><span class="line">    String name = c.getName();</span><br><span class="line">    String value = c.getValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Cookie原理:</li>
</ul>
<p>基于响应头set-cookie和请求头cookie实现</p>
<p><img src="/2021/12/12/cookieAndSession/1.png" alt></p>
<ul>
<li><p>cookie细节</p>
<ol>
<li><p>一次可以发送多个cookie</p>
<ul>
<li>创建多个Cookie对象，使用response对象调用多次addCookie()方法</li>
</ul>
</li>
<li><p>cookie在浏览器中保存时间</p>
<ul>
<li><p>默认情况下，当浏览器关闭后，cookie数据被销毁</p>
</li>
<li><p>持久化存储：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//cookie对象的方法</span><br><span class="line">setMaxAge(int seconds)</span><br><span class="line">参数：</span><br><span class="line">	1. 正数：将cookie数据写入到硬盘文件中。持久化存储。cookie存活时间seconds。</span><br><span class="line">	2. 负数：默认值</span><br><span class="line">	3. 0：删除cookie信息</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>cookie能否存储中文（tomcat8之后可以直接存储中文，但是特殊字符仍要使用URLEncoder编码，URLDecoder解码）</p>
<ul>
<li><p>在tomcat8之前cookie中不能直存储中文数据。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">此时需要将中文进行转码--- 一般采用URL编码</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>cookie共享问题</p>
<ul>
<li><p>如果在一个tomcat服务器中部署了多个项目</p>
<ol>
<li><p>默认请况下cookie数据不能共享</p>
</li>
<li><p>如果需要共享则需要设置路径</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//cookie对象方法</span></span><br><span class="line">setPath(String path) <span class="comment">//设置cookie获取范围。默认情况下设置为当前的虚拟目录</span></span><br><span class="line"><span class="comment">//如果要共享则设置：path=&quot;/&quot;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>不同的tomcat服务器间的cookie共享问题</p>
<ol>
<li><p>调用cookie方法 setDomain(String path): 如果设置一级域名相同，那么多个服务器之间的cookie可以共享</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//eg:</span></span><br><span class="line">setDomain(<span class="string">&quot;.baidu.com&quot;</span>);</span><br><span class="line"><span class="comment">//则 tieba.baidu.com 和 news.baidu.com 中cookie可以共享</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
</li>
</ol>
</li>
<li><p>注意点：</p>
<ol>
<li>cookie存储数据在客户端，不安全</li>
<li>浏览器对单个cookie的大小有限制，对同一个域名下cookie存储个数有限制</li>
<li>cookie存储数据包含特殊字符如：空格等，则要进行url编解码操作</li>
<li>cookie存储数据同名，则会覆盖</li>
</ol>
</li>
<li><p>作用：</p>
<ol>
<li>用于存储少量的不太重要的数据到浏览器</li>
<li>在不登录的情况下，进行用户身份识别</li>
</ol>
</li>
<li><p>案例：记录上次访问时间</p>
<ol>
<li>访问一个servlet，如果是第一次访问，则提示：欢迎首次访问！</li>
<li>如果不是则提示：欢迎回来！，您上次访问时间为：…</li>
</ol>
<p>实现：</p>
<p>在服务器中的servlet判断是否有一个名为lastTime的cookie</p>
<p>有:不是第一次访问</p>
<ol>
<li>响应数据:欢迎回来，您上次访问时间为:显示时间字符串</li>
<li>写回cookie : lastTime=…</li>
</ol>
<p>没有∶是第一次访问</p>
<ol>
<li>响应数据∶您好，欢迎您首次访问</li>
<li>写回cookie : lastTime=…</li>
</ol>
</li>
</ul>
<h5 id="2-Session"><a href="#2-Session" class="headerlink" title="2. Session"></a>2. Session</h5><h6 id="概念："><a href="#概念：" class="headerlink" title="概念："></a>概念：</h6><p>服务器端会话技术，在一次会话的多次请求间共享数据，将数据保存在服务器的对象中。HttpSession</p>
<h6 id="快速入门："><a href="#快速入门：" class="headerlink" title="快速入门："></a>快速入门：</h6><ol>
<li><p>获取session</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">request.getSession();</span><br></pre></td></tr></table></figure>
</li>
<li><p>存储数据</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">session.setAttribute(String name,Object value);</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取数据</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Object session.getAttribute(String name);</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除数据</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">removeAttribute(String name);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h6 id="session对象唯一（cookie保证）"><a href="#session对象唯一（cookie保证）" class="headerlink" title="session对象唯一（cookie保证）"></a>session对象唯一（cookie保证）</h6><p>（客户端与服务器通过传递JSESSIONID找到对应id的session）</p>
<p>通过cookie传递JSESSIONID来确保每次会话的session唯一</p>
<p><img src="/2021/12/12/cookieAndSession/2.png" alt></p>
]]></content>
      <categories>
        <category>servlet</category>
      </categories>
      <tags>
        <tag>servlet</tag>
        <tag>cookie</tag>
        <tag>session</tag>
      </tags>
  </entry>
  <entry>
    <title>css-1</title>
    <url>/2021/11/23/css-1/</url>
    <content><![CDATA[<h3 id="css语法"><a href="#css语法" class="headerlink" title="css语法"></a>css语法</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">css语法:</span><br><span class="line"></span><br><span class="line">*格式:</span><br><span class="line">    选择器&#123;</span><br><span class="line">        属性名1:属性值1;属性名2:属性值2;</span><br><span class="line">    &#125;</span><br><span class="line">*选择器:筛选具有相似特征的元秦</span><br><span class="line">*注意:</span><br><span class="line">	每一对属性需要使用;隔开，最后一对属性可以不加;</span><br></pre></td></tr></table></figure>
<h3 id="css选择器"><a href="#css选择器" class="headerlink" title="css选择器"></a>css选择器</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">选择器︰筛选具有相似特征的元素</span><br><span class="line">分类︰</span><br><span class="line">一．基础选择器</span><br><span class="line">1.id选择器∶选择具体的id属性值的元秦.建议在一个html页面中id值唯一</span><br><span class="line">	语法:#id属性值&#123;&#125;</span><br><span class="line">	</span><br><span class="line">2．元素选择器∶选择具有相同标签名称的元素</span><br><span class="line">	*语法: 标签名称&#123;&#125;</span><br><span class="line">	*注意:id选择器优先级高于元素选择器</span><br><span class="line"></span><br><span class="line">3．类选择器∶选择具有相同的class属性值的元素。</span><br><span class="line">	*语法: .class属性值&#123;&#125;</span><br><span class="line">	*注意:类选择器选择器优先级高于元秦选择器</span><br><span class="line"></span><br><span class="line">二. 扩展选择器</span><br><span class="line"></span><br><span class="line">1．选择所有元素∶</span><br><span class="line">	语法︰ *&#123;&#125;2．</span><br><span class="line"></span><br><span class="line">2. 并集选择器︰</span><br><span class="line">	语法：选择器1,选择器2&#123;&#125;</span><br><span class="line"></span><br><span class="line">3．后代选择器: 筛选1元素下的2元素</span><br><span class="line">	语法: 选择器1 选择器2&#123;&#125;</span><br><span class="line"></span><br><span class="line">4．子元素选择器: 筛选父元素是1的2元素</span><br><span class="line">	语法: 选择器1&gt;选择器2&#123;&#125;</span><br><span class="line">	</span><br><span class="line">5. 属性选择器：选择元素名称，属性名称=属性值的元素</span><br><span class="line">	语法: 元素名称[属性名=&quot;属性值&quot;]&#123;&#125;</span><br><span class="line"></span><br><span class="line">6．伪类选择器∶选择一些元素具有的状态</span><br><span class="line">    语法: 元素:状态&#123;&#125;</span><br><span class="line">    如: &lt;a&gt;</span><br><span class="line">状态∶</span><br><span class="line">    link: 初始化的状态</span><br><span class="line">    visited: 被访问过的状态</span><br><span class="line">    active: 正在访问状态</span><br><span class="line">    hover: 鼠标悬浮状态</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h3 id="css属性"><a href="#css属性" class="headerlink" title="css属性"></a>css属性</h3><ol>
<li><p>字体</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">font-size : 字体大小</span><br><span class="line">color : 文本颜色</span><br><span class="line">text-align : 对齐方式</span><br><span class="line">line-height : 行高</span><br></pre></td></tr></table></figure>
</li>
<li><p>背景</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">background: 设置背景，复合属性 </span><br><span class="line">eg:</span><br><span class="line">background: url(&quot;&quot;) no-repeat center;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>边框</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">border: 设置边框，复合属性（同时设置四边）</span><br><span class="line">eg:</span><br><span class="line">	border: 1px solid red;</span><br></pre></td></tr></table></figure>
</li>
<li><p>尺寸</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">height: 高度</span><br><span class="line">width: 宽度</span><br></pre></td></tr></table></figure>
</li>
<li><p>盒子模型</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">margin: 外边距</span><br><span class="line">padding: 内边距</span><br><span class="line">	默认情况下内边距会影响整个盒子的大小</span><br><span class="line"></span><br><span class="line">float: 浮动</span><br><span class="line">	left</span><br><span class="line">		eg:float:left</span><br><span class="line">	right</span><br></pre></td></tr></table></figure>
</li>
</ol>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>css学习</tag>
      </tags>
  </entry>
  <entry>
    <title>数据库基本概念和安装</title>
    <url>/2021/11/15/database-1/</url>
    <content><![CDATA[<h2 id="一、数据库基本概念"><a href="#一、数据库基本概念" class="headerlink" title="一、数据库基本概念"></a>一、数据库基本概念</h2><ol>
<li><p>数据库的基本概念</p>
<ul>
<li>数据库的英文单词:DataBase简称:DB。</li>
</ul>
</li>
<li><p>什么数据库?</p>
<ul>
<li>用于存储和管理数据的仓库。</li>
</ul>
</li>
<li><p>数据库的特点∶</p>
<ul>
<li><p>持久化存储数据的。其实数据库就是一个文件系统</p>
</li>
<li><p>方便存储和管理数据</p>
</li>
<li><p>使用了统一的方式操作数据库— SQL</p>
</li>
</ul>
</li>
<li><p>常见的数据库软件</p>
<ul>
<li>oracle:收费的大型数据库，Oracle公司的产品。Oracle收购SUN公司，收购MYSQL。</li>
<li>DB2 :IBM公司的数据库产品,收费的。常应用在银行系统中.</li>
<li>SQLServer: MicroSoft公司收费的中型的数据库。C#、.net等语言常使用。</li>
<li>SyBase:已经淡出历史舞台。提供了一个非常专业数据建模的工具PowerDesigner。</li>
<li>sQLite:嵌入式的小型数据库，应用在手机端。</li>
<li>常用数据库:MYSQL，Oracle</li>
</ul>
<h2 id="二、基础指令"><a href="#二、基础指令" class="headerlink" title="二、基础指令"></a>二、基础指令</h2></li>
</ol>
<ul>
<li>登录退出数据库</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">远程登陆：mysql -hyour_ip -uroot -p</span><br><span class="line">		mysql --host=ip --user=root --password=root</span><br><span class="line">登录：mysql -uroot -p</span><br><span class="line">退出：ctrl+c/exit/quit</span><br></pre></td></tr></table></figure>
<ul>
<li>卸载mysql</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1、去mysql的安装目录找到my.ini文件</span><br><span class="line">复制datadir=&quot;C: / ProgramData/MysQL/ MysQL Server 5.5/Data/&quot;</span><br><span class="line">2、直接卸载mysql（删除软件）</span><br><span class="line">3、到C:/ ProgramData/路径，删除MysQL文件（删除数据）</span><br></pre></td></tr></table></figure>
<ul>
<li>mysql配置</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">开启MySQL服务</span><br><span class="line">方法一、cmd 运行 services.msc 打开系统服务窗口，手动开关</span><br><span class="line">方法二、</span><br><span class="line">1. 管理员运行cmd</span><br><span class="line">2. cmd net stop mysql</span><br><span class="line">3. cmd net start mysql</span><br></pre></td></tr></table></figure>
<h2 id="三、mysql目录结构"><a href="#三、mysql目录结构" class="headerlink" title="三、mysql目录结构"></a>三、mysql目录结构</h2><h4 id="安装目录"><a href="#安装目录" class="headerlink" title="安装目录"></a>安装目录</h4><ol>
<li>bin目录<ul>
<li>二进制可执行文件</li>
</ul>
</li>
<li>data目录<ul>
<li>mysql日志文件，数据文件</li>
</ul>
</li>
<li>include目录<ul>
<li>c语言头信息</li>
</ul>
</li>
<li>lib目录<ul>
<li>运行所需的库文件</li>
</ul>
</li>
<li>share目录<ul>
<li>用于存放字符集、语言等信息</li>
</ul>
</li>
<li>my.ini 配置信息</li>
<li><p>my-huge.ini</p>
<ul>
<li>适合超大型数据库的配置文件</li>
</ul>
</li>
<li><p>my-large.ini</p>
<ul>
<li>适合大型数据库的配置文件。</li>
</ul>
</li>
<li><p>my-medium.ini</p>
<ul>
<li>适合中型数据库的配置文件。</li>
</ul>
</li>
<li><p>my-small.ini</p>
<ul>
<li>适合小型数据库的配置文件。</li>
</ul>
</li>
<li><p>my-template.ini</p>
<ul>
<li>是配置文件的模板，MySQL配置向导将该配置文件中选择项写入到my.ini文件。</li>
</ul>
</li>
<li><p>my-innodb-heavy-4G.ini</p>
<ul>
<li>表示该配置文件只对于InnoDB存储引擎有效，而且服务器的内存不能小于4GB。</li>
</ul>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">配置文件参数详解</span><br><span class="line">[client]</span><br><span class="line">port = 3306</span><br><span class="line">socket = /tmp/mysql.sock</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">port = 3306</span><br><span class="line">socket = /tmp/mysql.sock</span><br><span class="line"></span><br><span class="line">basedir = /usr/local/mysql</span><br><span class="line">datadir = /data/mysql</span><br><span class="line">pid-file = /data/mysql/mysql.pid</span><br><span class="line">user = mysql</span><br><span class="line">bind-address = 0.0.0.0</span><br><span class="line">server-id = 1 #表示是本机的序号为1,一般来讲就是master的意思</span><br><span class="line"></span><br><span class="line">skip-name-resolve</span><br><span class="line"># 禁止MySQL对外部连接进行DNS解析，使用这一选项可以消除MySQL进行DNS解析的时间。但需要注意，如果开启该选项，</span><br><span class="line"># 则所有远程主机连接授权都要使用IP地址方式，否则MySQL将无法正常处理连接请求</span><br><span class="line"></span><br><span class="line">#skip-networking</span><br><span class="line"></span><br><span class="line">back_log = 600</span><br><span class="line"># MySQL能有的连接数量。当主要MySQL线程在一个很短时间内得到非常多的连接请求，这就起作用，</span><br><span class="line"># 然后主线程花些时间(尽管很短)检查连接并且启动一个新线程。back_log值指出在MySQL暂时停止回答新请求之前的短时间内多少个请求可以被存在堆栈中。</span><br><span class="line"># 如果期望在一个短时间内有很多连接，你需要增加它。也就是说，如果MySQL的连接数据达到max_connections时，新来的请求将会被存在堆栈中，</span><br><span class="line"># 以等待某一连接释放资源，该堆栈的数量即back_log，如果等待连接的数量超过back_log，将不被授予连接资源。</span><br><span class="line"># 另外，这值（back_log）限于您的操作系统对到来的TCP/IP连接的侦听队列的大小。</span><br><span class="line"># 你的操作系统在这个队列大小上有它自己的限制（可以检查你的OS文档找出这个变量的最大值），试图设定back_log高于你的操作系统的限制将是无效的。</span><br><span class="line"></span><br><span class="line">max_connections = 1000</span><br><span class="line"># MySQL的最大连接数，如果服务器的并发连接请求量比较大，建议调高此值，以增加并行连接数量，当然这建立在机器能支撑的情况下，因为如果连接数越多，介于MySQL会为每个连接提供连接缓冲区，就会开销越多的内存，所以要适当调整该值，不能盲目提高设值。可以过&#x27;conn%&#x27;通配符查看当前状态的连接数量，以定夺该值的大小。</span><br><span class="line"></span><br><span class="line">max_connect_errors = 6000</span><br><span class="line"># 对于同一主机，如果有超出该参数值个数的中断错误连接，则该主机将被禁止连接。如需对该主机进行解禁，执行：FLUSH HOST。</span><br><span class="line"></span><br><span class="line">open_files_limit = 65535</span><br><span class="line"># MySQL打开的文件描述符限制，默认最小1024;当open_files_limit没有被配置的时候，比较max_connections*5和ulimit -n的值，哪个大用哪个，</span><br><span class="line"># 当open_file_limit被配置的时候，比较open_files_limit和max_connections*5的值，哪个大用哪个。</span><br><span class="line"></span><br><span class="line">table_open_cache = 128</span><br><span class="line"># MySQL每打开一个表，都会读入一些数据到table_open_cache缓存中，当MySQL在这个缓存中找不到相应信息时，才会去磁盘上读取。默认值64</span><br><span class="line"># 假定系统有200个并发连接，则需将此参数设置为200*N(N为每个连接所需的文件描述符数目)；</span><br><span class="line"># 当把table_open_cache设置为很大时，如果系统处理不了那么多文件描述符，那么就会出现客户端失效，连接不上</span><br><span class="line"></span><br><span class="line">max_allowed_packet = 4M</span><br><span class="line"># 接受的数据包大小；增加该变量的值十分安全，这是因为仅当需要时才会分配额外内存。例如，仅当你发出长查询或MySQLd必须返回大的结果行时MySQLd才会分配更多内存。</span><br><span class="line"># 该变量之所以取较小默认值是一种预防措施，以捕获客户端和服务器之间的错误信息包，并确保不会因偶然使用大的信息包而导致内存溢出。</span><br><span class="line"></span><br><span class="line">binlog_cache_size = 1M</span><br><span class="line"># 一个事务，在没有提交的时候，产生的日志，记录到Cache中；等到事务提交需要提交的时候，则把日志持久化到磁盘。默认binlog_cache_size大小32K</span><br><span class="line"></span><br><span class="line">max_heap_table_size = 8M</span><br><span class="line"># 定义了用户可以创建的内存表(memory table)的大小。这个值用来计算内存表的最大行数值。这个变量支持动态改变</span><br><span class="line"></span><br><span class="line">tmp_table_size = 16M</span><br><span class="line"># MySQL的heap（堆积）表缓冲大小。所有联合在一个DML指令内完成，并且大多数联合甚至可以不用临时表即可以完成。</span><br><span class="line"># 大多数临时表是基于内存的(HEAP)表。具有大的记录长度的临时表 (所有列的长度的和)或包含BLOB列的表存储在硬盘上。</span><br><span class="line"># 如果某个内部heap（堆积）表大小超过tmp_table_size，MySQL可以根据需要自动将内存中的heap表改为基于硬盘的MyISAM表。还可以通过设置tmp_table_size选项来增加临时表的大小。也就是说，如果调高该值，MySQL同时将增加heap表的大小，可达到提高联接查询速度的效果</span><br><span class="line"></span><br><span class="line">read_buffer_size = 2M</span><br><span class="line"># MySQL读入缓冲区大小。对表进行顺序扫描的请求将分配一个读入缓冲区，MySQL会为它分配一段内存缓冲区。read_buffer_size变量控制这一缓冲区的大小。</span><br><span class="line"># 如果对表的顺序扫描请求非常频繁，并且你认为频繁扫描进行得太慢，可以通过增加该变量值以及内存缓冲区大小提高其性能</span><br><span class="line"></span><br><span class="line">read_rnd_buffer_size = 8M</span><br><span class="line"># MySQL的随机读缓冲区大小。当按任意顺序读取行时(例如，按照排序顺序)，将分配一个随机读缓存区。进行排序查询时，</span><br><span class="line"># MySQL会首先扫描一遍该缓冲，以避免磁盘搜索，提高查询速度，如果需要排序大量数据，可适当调高该值。但MySQL会为每个客户连接发放该缓冲空间，所以应尽量适当设置该值，以避免内存开销过大</span><br><span class="line"></span><br><span class="line">sort_buffer_size = 8M</span><br><span class="line"># MySQL执行排序使用的缓冲大小。如果想要增加ORDER BY的速度，首先看是否可以让MySQL使用索引而不是额外的排序阶段。</span><br><span class="line"># 如果不能，可以尝试增加sort_buffer_size变量的大小</span><br><span class="line"></span><br><span class="line">join_buffer_size = 8M</span><br><span class="line"># 联合查询操作所能使用的缓冲区大小，和sort_buffer_size一样，该参数对应的分配内存也是每连接独享</span><br><span class="line"></span><br><span class="line">thread_cache_size = 8</span><br><span class="line"># 这个值（默认8）表示可以重新利用保存在缓存中线程的数量，当断开连接时如果缓存中还有空间，那么客户端的线程将被放到缓存中，</span><br><span class="line"># 如果线程重新被请求，那么请求将从缓存中读取,如果缓存中是空的或者是新的请求，那么这个线程将被重新创建,如果有很多新的线程，</span><br><span class="line"># 增加这个值可以改善系统性能.通过比较Connections和Threads_created状态的变量，可以看到这个变量的作用。(–&gt;表示要调整的值)</span><br><span class="line"># 根据物理内存设置规则如下：</span><br><span class="line"># 1G  —&gt; 8</span><br><span class="line"># 2G  —&gt; 16</span><br><span class="line"># 3G  —&gt; 32</span><br><span class="line"># 大于3G  —&gt; 64</span><br><span class="line"></span><br><span class="line">query_cache_size = 8M</span><br><span class="line">#MySQL的查询缓冲大小（从4.0.1开始，MySQL提供了查询缓冲机制）使用查询缓冲，MySQL将SELECT语句和查询结果存放在缓冲区中，</span><br><span class="line"># 今后对于同样的SELECT语句（区分大小写），将直接从缓冲区中读取结果。根据MySQL用户手册，使用查询缓冲最多可以达到238%的效率。</span><br><span class="line"># 通过检查状态值&#x27;Qcache_%&#x27;，可以知道query_cache_size设置是否合理：如果Qcache_lowmem_prunes的值非常大，则表明经常出现缓冲不够的情况，</span><br><span class="line"># 如果Qcache_hits的值也非常大，则表明查询缓冲使用非常频繁，此时需要增加缓冲大小；如果Qcache_hits的值不大，则表明你的查询重复率很低，</span><br><span class="line"># 这种情况下使用查询缓冲反而会影响效率，那么可以考虑不用查询缓冲。此外，在SELECT语句中加入SQL_NO_CACHE可以明确表示不使用查询缓冲</span><br><span class="line"></span><br><span class="line">query_cache_limit = 2M</span><br><span class="line">#指定单个查询能够使用的缓冲区大小，默认1M</span><br><span class="line"></span><br><span class="line">key_buffer_size = 4M</span><br><span class="line">#指定用于索引的缓冲区大小，增加它可得到更好处理的索引(对所有读和多重写)，到你能负担得起那样多。如果你使它太大，</span><br><span class="line"># 系统将开始换页并且真的变慢了。对于内存在4GB左右的服务器该参数可设置为384M或512M。通过检查状态值Key_read_requests和Key_reads，</span><br><span class="line"># 可以知道key_buffer_size设置是否合理。比例key_reads/key_read_requests应该尽可能的低，</span><br><span class="line"># 至少是1:100，1:1000更好(上述状态值可以使用SHOW STATUS LIKE &#x27;key_read%&#x27;获得)。注意：该参数值设置的过大反而会是服务器整体效率降低</span><br><span class="line"></span><br><span class="line">ft_min_word_len = 4</span><br><span class="line"># 分词词汇最小长度，默认4</span><br><span class="line"></span><br><span class="line">transaction_isolation = REPEATABLE-READ</span><br><span class="line"># MySQL支持4种事务隔离级别，他们分别是：</span><br><span class="line"># READ-UNCOMMITTED, READ-COMMITTED, REPEATABLE-READ, SERIALIZABLE.</span><br><span class="line"># 如没有指定，MySQL默认采用的是REPEATABLE-READ，ORACLE默认的是READ-COMMITTED</span><br><span class="line"></span><br><span class="line">log_bin = mysql-bin</span><br><span class="line">binlog_format = mixed</span><br><span class="line">expire_logs_days = 30 #超过30天的binlog删除</span><br><span class="line"></span><br><span class="line">log_error = /data/mysql/mysql-error.log #错误日志路径</span><br><span class="line">slow_query_log = 1</span><br><span class="line">long_query_time = 1 #慢查询时间 超过1秒则为慢查询</span><br><span class="line">slow_query_log_file = /data/mysql/mysql-slow.log</span><br><span class="line"></span><br><span class="line">performance_schema = 0</span><br><span class="line">explicit_defaults_for_timestamp</span><br><span class="line"></span><br><span class="line">#lower_case_table_names = 1 #不区分大小写</span><br><span class="line"></span><br><span class="line">skip-external-locking #MySQL选项以避免外部锁定。该选项默认开启</span><br><span class="line"></span><br><span class="line">default-storage-engine = InnoDB #默认存储引擎</span><br><span class="line"></span><br><span class="line">innodb_file_per_table = 1</span><br><span class="line"># InnoDB为独立表空间模式，每个数据库的每个表都会生成一个数据空间</span><br><span class="line"># 独立表空间优点：</span><br><span class="line"># 1．每个表都有自已独立的表空间。</span><br><span class="line"># 2．每个表的数据和索引都会存在自已的表空间中。</span><br><span class="line"># 3．可以实现单表在不同的数据库中移动。</span><br><span class="line"># 4．空间可以回收（除drop table操作处，表空不能自已回收）</span><br><span class="line"># 缺点：</span><br><span class="line"># 单表增加过大，如超过100G</span><br><span class="line"># 结论：</span><br><span class="line"># 共享表空间在Insert操作上少有优势。其它都没独立表空间表现好。当启用独立表空间时，请合理调整：innodb_open_files</span><br><span class="line"></span><br><span class="line">innodb_open_files = 500</span><br><span class="line"># 限制Innodb能打开的表的数据，如果库里的表特别多的情况，请增加这个。这个值默认是300</span><br><span class="line"></span><br><span class="line">innodb_buffer_pool_size = 64M</span><br><span class="line"># InnoDB使用一个缓冲池来保存索引和原始数据, 不像MyISAM.</span><br><span class="line"># 这里你设置越大,你在存取表里面数据时所需要的磁盘I/O越少.</span><br><span class="line"># 在一个独立使用的数据库服务器上,你可以设置这个变量到服务器物理内存大小的80%</span><br><span class="line"># 不要设置过大,否则,由于物理内存的竞争可能导致操作系统的换页颠簸.</span><br><span class="line"># 注意在32位系统上你每个进程可能被限制在 2-3.5G 用户层面内存限制,</span><br><span class="line"># 所以不要设置的太高.</span><br><span class="line"></span><br><span class="line">innodb_write_io_threads = 4</span><br><span class="line">innodb_read_io_threads = 4</span><br><span class="line"># innodb使用后台线程处理数据页上的读写 I/O(输入输出)请求,根据你的 CPU 核数来更改,默认是4</span><br><span class="line"># 注:这两个参数不支持动态改变,需要把该参数加入到my.cnf里，修改完后重启MySQL服务,允许值的范围从 1-64</span><br><span class="line"></span><br><span class="line">innodb_thread_concurrency = 0</span><br><span class="line"># 默认设置为 0,表示不限制并发数，这里推荐设置为0，更好去发挥CPU多核处理能力，提高并发量</span><br><span class="line"></span><br><span class="line">innodb_purge_threads = 1</span><br><span class="line"># InnoDB中的清除操作是一类定期回收无用数据的操作。在之前的几个版本中，清除操作是主线程的一部分，这意味着运行时它可能会堵塞其它的数据库操作。</span><br><span class="line"># 从MySQL5.5.X版本开始，该操作运行于独立的线程中,并支持更多的并发数。用户可通过设置innodb_purge_threads配置参数来选择清除操作是否使用单</span><br><span class="line"># 独线程,默认情况下参数设置为0(不使用单独线程),设置为 1 时表示使用单独的清除线程。建议为1</span><br><span class="line"></span><br><span class="line">innodb_flush_log_at_trx_commit = 2</span><br><span class="line"># 0：如果innodb_flush_log_at_trx_commit的值为0,log buffer每秒就会被刷写日志文件到磁盘，提交事务的时候不做任何操作（执行是由mysql的master thread线程来执行的。</span><br><span class="line"># 主线程中每秒会将重做日志缓冲写入磁盘的重做日志文件(REDO LOG)中。不论事务是否已经提交）默认的日志文件是ib_logfile0,ib_logfile1</span><br><span class="line"># 1：当设为默认值1的时候，每次提交事务的时候，都会将log buffer刷写到日志。</span><br><span class="line"># 2：如果设为2,每次提交事务都会写日志，但并不会执行刷的操作。每秒定时会刷到日志文件。要注意的是，并不能保证100%每秒一定都会刷到磁盘，这要取决于进程的调度。</span><br><span class="line"># 每次事务提交的时候将数据写入事务日志，而这里的写入仅是调用了文件系统的写入操作，而文件系统是有 缓存的，所以这个写入并不能保证数据已经写入到物理磁盘</span><br><span class="line"># 默认值1是为了保证完整的ACID。当然，你可以将这个配置项设为1以外的值来换取更高的性能，但是在系统崩溃的时候，你将会丢失1秒的数据。</span><br><span class="line"># 设为0的话，mysqld进程崩溃的时候，就会丢失最后1秒的事务。设为2,只有在操作系统崩溃或者断电的时候才会丢失最后1秒的数据。InnoDB在做恢复的时候会忽略这个值。</span><br><span class="line"># 总结</span><br><span class="line"># 设为1当然是最安全的，但性能页是最差的（相对其他两个参数而言，但不是不能接受）。如果对数据一致性和完整性要求不高，完全可以设为2，如果只最求性能，例如高并发写的日志服务器，设为0来获得更高性能</span><br><span class="line"></span><br><span class="line">innodb_log_buffer_size = 2M</span><br><span class="line"># 此参数确定些日志文件所用的内存大小，以M为单位。缓冲区更大能提高性能，但意外的故障将会丢失数据。MySQL开发人员建议设置为1－8M之间</span><br><span class="line"></span><br><span class="line">innodb_log_file_size = 32M</span><br><span class="line"># 此参数确定数据日志文件的大小，更大的设置可以提高性能，但也会增加恢复故障数据库所需的时间</span><br><span class="line"></span><br><span class="line">innodb_log_files_in_group = 3</span><br><span class="line"># 为提高性能，MySQL可以以循环方式将日志文件写到多个文件。推荐设置为3</span><br><span class="line"></span><br><span class="line">innodb_max_dirty_pages_pct = 90</span><br><span class="line"># innodb主线程刷新缓存池中的数据，使脏数据比例小于90%</span><br><span class="line"></span><br><span class="line">innodb_lock_wait_timeout = 120 </span><br><span class="line"># InnoDB事务在被回滚之前可以等待一个锁定的超时秒数。InnoDB在它自己的锁定表中自动检测事务死锁并且回滚事务。InnoDB用LOCK TABLES语句注意到锁定设置。默认值是50秒</span><br><span class="line"></span><br><span class="line">bulk_insert_buffer_size = 8M</span><br><span class="line"># 批量插入缓存大小， 这个参数是针对MyISAM存储引擎来说的。适用于在一次性插入100-1000+条记录时， 提高效率。默认值是8M。可以针对数据量的大小，翻倍增加。</span><br><span class="line"></span><br><span class="line">myisam_sort_buffer_size = 8M</span><br><span class="line"># MyISAM设置恢复表之时使用的缓冲区的尺寸，当在REPAIR TABLE或用CREATE INDEX创建索引或ALTER TABLE过程中排序 MyISAM索引分配的缓冲区</span><br><span class="line"></span><br><span class="line">myisam_max_sort_file_size = 10G</span><br><span class="line"># 如果临时文件会变得超过索引，不要使用快速排序索引方法来创建一个索引。注释：这个参数以字节的形式给出</span><br><span class="line"></span><br><span class="line">myisam_repair_threads = 1</span><br><span class="line"># 如果该值大于1，在Repair by sorting过程中并行创建MyISAM表索引(每个索引在自己的线程内) </span><br><span class="line"></span><br><span class="line">interactive_timeout = 28800</span><br><span class="line"># 服务器关闭交互式连接前等待活动的秒数。交互式客户端定义为在mysql_real_connect()中使用CLIENT_INTERACTIVE选项的客户端。默认值：28800秒（8小时）</span><br><span class="line"></span><br><span class="line">wait_timeout = 28800</span><br><span class="line"># 服务器关闭非交互连接之前等待活动的秒数。在线程启动时，根据全局wait_timeout值或全局interactive_timeout值初始化会话wait_timeout值，</span><br><span class="line"># 取决于客户端类型(由mysql_real_connect()的连接选项CLIENT_INTERACTIVE定义)。参数默认值：28800秒（8小时）</span><br><span class="line"># MySQL服务器所支持的最大连接数是有上限的，因为每个连接的建立都会消耗内存，因此我们希望客户端在连接到MySQL Server处理完相应的操作后，</span><br><span class="line"># 应该断开连接并释放占用的内存。如果你的MySQL Server有大量的闲置连接，他们不仅会白白消耗内存，而且如果连接一直在累加而不断开，</span><br><span class="line"># 最终肯定会达到MySQL Server的连接上限数，这会报&#x27;too many connections&#x27;的错误。对于wait_timeout的值设定，应该根据系统的运行情况来判断。</span><br><span class="line"># 在系统运行一段时间后，可以通过show processlist命令查看当前系统的连接状态，如果发现有大量的sleep状态的连接进程，则说明该参数设置的过大，</span><br><span class="line"># 可以进行适当的调整小些。要同时设置interactive_timeout和wait_timeout才会生效。</span><br><span class="line"></span><br><span class="line">[mysqldump]</span><br><span class="line">quick</span><br><span class="line">max_allowed_packet = 16M #服务器发送和接受的最大包长度</span><br><span class="line"></span><br><span class="line">[myisamchk]</span><br><span class="line">key_buffer_size = 8M</span><br><span class="line">sort_buffer_size = 8M</span><br><span class="line">read_buffer = 4M</span><br><span class="line">write_buffer = 4M</span><br></pre></td></tr></table></figure>
<h4 id="数据目录"><a href="#数据目录" class="headerlink" title="数据目录"></a>数据目录</h4><p>数据库存储持久化的信息</p>
<p>数据库-表-记录</p>
]]></content>
      <categories>
        <category>database</category>
      </categories>
      <tags>
        <tag>database_Basic_knowledge</tag>
      </tags>
  </entry>
  <entry>
    <title>sql基础</title>
    <url>/2021/11/15/database-2/</url>
    <content><![CDATA[<h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>什么是SQL ?</p>
<p>structured Query Language∶结构化查询语言</p>
<p>其实就是定义了操作所有关系型数据库的规则。每一种数据库操作的方式存在不一样的地方，称为“方言”。</p>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><p>SQL通用语法</p>
<ol>
<li>sQL语句可以单行或多行书写，以分号结尾。</li>
<li>2．可使用空格和缩进来增强语句的可读性。</li>
<li>MysQL数据库的sQL语句不区分大小写，关键字建议使用大写。</li>
<li>3种注释</li>
</ol>
<ul>
<li><p>单行注释:   —注释内容 或  # 注释内容</p>
</li>
<li><p>(mysql 特有) 多行注释:/*注释*/ </p>
</li>
</ul>
<p>SQL分类</p>
<ul>
<li><p>DDL (Data Definition Language)数据定义语言用来定义数据库对象∶数据库，表，列等。关键字:create，drop，alter等</p>
</li>
<li><p>DML(Data Manipulation Language)数据操作语言，用来对数据库中表的数据进行增删改。关键字:insert，delete，update 等</p>
</li>
<li>DQL(Data Query Language)数据查询语言用来查询数据库中表的记录(数据)。关键字: select，where等</li>
<li>DCL(Data control Language)数据控制语言(了解)用来定义数据库的访问权限和安全级别，及创建用户。关键字:GRANT，REVOKE等</li>
</ul>
<p><img src="/2021/11/15/database-2/1.png" alt="img"></p>
<h3 id="操作数据库-CRUD"><a href="#操作数据库-CRUD" class="headerlink" title="操作数据库:CRUD"></a>操作数据库:CRUD</h3><ol>
<li><p>c(create):创建</p>
<ul>
<li><p>创建数据库students</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create database students;</span><br><span class="line">create database if not exists students;</span><br><span class="line">create database db3 character set gbk; //指定字符集</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>R(Retrieve) :查询</p>
<ul>
<li><p>查询所有数据库的名称：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> databases;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看对应数据库的字符集（创建语句）</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> database mysql;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>u(Update):修改4. </p>
<ul>
<li><p>修改数据库字符集</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> database students <span class="type">character</span> <span class="keyword">set</span> utf8;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>D(Delete):删除5．使用数据库</p>
<ul>
<li><p>删除数据库</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> database students;</span><br><span class="line"><span class="keyword">drop</span> database if <span class="keyword">exists</span> students;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<ol>
<li><p>使用数据库</p>
<ul>
<li><p>查询当前正在使用的数据库</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> database();</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用数据库students</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">use students;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h3 id="操作表-CRUD"><a href="#操作表-CRUD" class="headerlink" title="操作表:CRUD"></a>操作表:CRUD</h3><ol>
<li><p>c(create):创建</p>
<ul>
<li><p>创建表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名(</span><br><span class="line">	列名<span class="number">1</span> 数据类型<span class="number">1</span>,</span><br><span class="line">	列名<span class="number">2</span> 数据类型<span class="number">2</span>,</span><br><span class="line">	列名<span class="number">3</span> 数据类型<span class="number">3</span></span><br><span class="line">);<span class="operator">/</span><span class="operator">/</span>最后一列不用加&quot;,&quot;</span><br><span class="line">数据类型：</span><br><span class="line">    <span class="number">1.</span> <span class="type">int</span> : 整数类型</span><br><span class="line">    <span class="number">2.</span> <span class="keyword">double</span>(<span class="number">5</span>,<span class="number">2</span>) : 小数类型，长度为<span class="number">5</span>，小数点后最多保留<span class="number">2</span>位</span><br><span class="line">    <span class="number">3.</span> <span class="type">date</span> : 日期类型，年月日，yyyy:MM:dd</span><br><span class="line">    <span class="number">4.</span> datetime : 日期类型，年月日时分秒，yyyy<span class="operator">-</span>MM<span class="operator">-</span>dd HH:mm:ss</span><br><span class="line">    <span class="operator">/</span><span class="operator">/</span>如果将来不给这个字段赋值，或赋值为<span class="keyword">null</span>，则默认使用当前的系统时间，来自动赋值</span><br><span class="line">    <span class="number">5.</span> <span class="type">timestamp</span> : 时间戳类型，年月日时分秒，yyyy<span class="operator">-</span>MM<span class="operator">-</span>dd HH:mm:ss </span><br><span class="line">    <span class="number">6.</span> <span class="type">varchar</span>(<span class="number">255</span>) : 字符串类型，字符长度<span class="number">255</span>，<span class="number">0</span><span class="number">-65535</span></span><br><span class="line">    <span class="number">7.</span> text : 文本类型，存储大型字符串 长度：<span class="number">0</span><span class="number">-65535</span></span><br><span class="line">    <span class="number">8.</span> <span class="type">binary</span>() : 字节类型</span><br><span class="line">    <span class="number">9.</span> tinyint(<span class="number">1</span>) : <span class="number">1</span>个字节的<span class="type">int</span>类型，用于表示bool类型</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>复制表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名 <span class="keyword">like</span> 待复制的表名;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<ol>
<li><p>R(Retrieve) :查询</p>
<ul>
<li><p>查询数据库中所有表名称</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> tables;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询表结构</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">desc</span> 表名;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看表字符集（显示创建表的SQL语句）</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> 表名;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<ol>
<li><p>u(Update):修改</p>
<ul>
<li><p>修改表名</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 rename <span class="keyword">to</span> 新表名;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改字符集</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="type">character</span> <span class="keyword">set</span> utf8;</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加一列</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">add</span> 列名 数据类型;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改一列</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 change 列名 新列名 数据类型; <span class="operator">/</span><span class="operator">/</span>全改</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 modify 列名 新数据类型;  <span class="operator">/</span><span class="operator">/</span>只改类型</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除列</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">drop</span> 列名;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<ol>
<li><p>D(Delete):删除</p>
<ul>
<li><p>删除表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> 表名;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> 表名;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h3 id="DML-增删改表中数据"><a href="#DML-增删改表中数据" class="headerlink" title="DML:增删改表中数据"></a>DML:增删改表中数据</h3><ol>
<li><p>添加语法</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">语法：</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表名(列名<span class="number">1</span>,列名<span class="number">2</span>,...列名n) <span class="keyword">values</span>(值<span class="number">1</span>,值<span class="number">2</span>,...值n);</span><br><span class="line">注意：</span><br><span class="line">	<span class="number">1</span>．列名和值要一一对应。</span><br><span class="line">	<span class="number">2</span>．如果表名后，不定义列名，则默认给所有列添加值</span><br><span class="line">	<span class="number">3.</span> 除了数字类型外，其他的数据类型要使用引号引起来 eg:<span class="type">date</span>类型添加：<span class="number">1999</span><span class="number">-9</span><span class="number">-6</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>删除数据</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">语法：</span><br><span class="line">delect <span class="keyword">from</span> 表名 [<span class="keyword">where</span> 条件]; <span class="operator">/</span><span class="operator">/</span> 不指明条件则全部删除</span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> 表名;  <span class="operator">/</span><span class="operator">/</span>删除表，再创建一个结构一样的空表</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改数据</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">语法：</span><br><span class="line">update 表名 <span class="keyword">set</span> 列名<span class="number">1</span><span class="operator">=</span>值<span class="number">1</span>,列名<span class="number">2</span><span class="operator">=</span>值<span class="number">2</span>,... [<span class="keyword">Where</span> 条件];<span class="operator">/</span><span class="operator">/</span>不加条件会将所有数据全部修改</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="DQL-查询表中记录"><a href="#DQL-查询表中记录" class="headerlink" title="DQL : 查询表中记录"></a>DQL : 查询表中记录</h3><h5 id="查询基础"><a href="#查询基础" class="headerlink" title="查询基础"></a>查询基础</h5><ol>
<li><p>语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">	字段列表 </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">	表名列表</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">	条件列表</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">	分组字段</span><br><span class="line"><span class="keyword">having</span></span><br><span class="line">	分组之后的条件</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">	排序</span><br><span class="line">limit</span><br><span class="line">	分页限定</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询指定列：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段<span class="number">1</span>,字段<span class="number">2.</span>.. <span class="keyword">from</span> 表名;</span><br></pre></td></tr></table></figure>
</li>
<li><p>去除重复的结果集</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> 字段<span class="number">1</span> <span class="keyword">from</span> 表名; <span class="operator">/</span><span class="operator">/</span>使用<span class="keyword">distinct</span>字段修饰 字段</span><br></pre></td></tr></table></figure>
</li>
<li><p>列之间计算值，并输出（null值处理）</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段<span class="number">1</span>（数字类型）<span class="operator">+</span>字段<span class="number">2</span>（数字类型）<span class="keyword">from</span> 表名;</span><br><span class="line"><span class="comment">--如果有null参与的计算,结果都为null</span></span><br><span class="line">优化： </span><br><span class="line">使用ifnull字段修饰列名，将列名与默认值用括号包裹，</span><br><span class="line">eg:ifnull(socrd,<span class="number">0</span>)</span><br><span class="line">如果为<span class="keyword">null</span> 则使用默认值替代。</span><br><span class="line">	<span class="keyword">select</span> ifnull(字段<span class="number">1</span>,<span class="number">0</span>)（数字类型）<span class="operator">+</span>ifnull(字段<span class="number">2</span>,<span class="number">0</span>)（数字类型）<span class="keyword">from</span> 表名;</span><br></pre></td></tr></table></figure>
</li>
<li><p>给列起别名</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段<span class="number">1</span> <span class="keyword">as</span> 别名,字段<span class="number">2</span> <span class="keyword">as</span> 别名 <span class="keyword">from</span> 表名; <span class="operator">/</span><span class="operator">/</span> 列名 <span class="keyword">as</span> 别名</span><br><span class="line"><span class="keyword">select</span> 字段<span class="number">1</span> 别名,字段<span class="number">2</span> 别名 <span class="keyword">from</span> 表名;   <span class="operator">/</span><span class="operator">/</span>列名 空格 别名</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h5><ol>
<li><p>where字句后跟条件</p>
</li>
<li><p>运算符</p>
<ul>
<li><p>> 、\&lt; 、\&lt;= 、>=、=、\&lt;>//不等于</p>
</li>
<li><p>between…and</p>
</li>
<li><p>in(集合) eg: in(1,8,9,5),in(“asd”,”神”)</p>
</li>
<li><p>like：模糊查询 “_sad%”</p>
<ul>
<li><p>“_”代表任意的一个字符,</p>
</li>
<li><p>“%”代表任意字符</p>
</li>
<li>“%神%” 含有’’神’’的字符串</li>
</ul>
</li>
<li><p>is null       //判断null 只能用语句 不能用=</p>
</li>
<li><p>is not null</p>
</li>
<li><p>or 或 ||</p>
</li>
<li><p>and 或 &amp;&amp;</p>
</li>
<li><p>not 或 ！</p>
</li>
</ul>
</li>
</ol>
<h5 id="排序查询"><a href="#排序查询" class="headerlink" title="排序查询"></a>排序查询</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">语法：</span><br><span class="line">	<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> 表名 <span class="keyword">order</span> <span class="keyword">by</span> 排序字段<span class="number">1</span> 排序方式<span class="number">1</span>,排序字段<span class="number">2</span> 排序方式<span class="number">2.</span>..;</span><br><span class="line">	字段在前的先排序，如果相同则再按后面的字段进行排序。</span><br><span class="line">排序方式字段：</span><br><span class="line">	<span class="keyword">ASC</span> : 升序 默认</span><br><span class="line">	<span class="keyword">DESC</span> : 降序</span><br></pre></td></tr></table></figure>
<h5 id="聚合函数：将一列数据作为一个整体进行纵向计算"><a href="#聚合函数：将一列数据作为一个整体进行纵向计算" class="headerlink" title="聚合函数：将一列数据作为一个整体进行纵向计算"></a>聚合函数：将一列数据作为一个整体进行纵向计算</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">注意：所有聚合函数计算会排除<span class="keyword">null</span>,可以进行解决:在计数列名使用ifnull(列名,<span class="number">0</span>)</span><br><span class="line"><span class="number">1.</span> <span class="built_in">count</span>(列名) : 计算个数</span><br><span class="line"><span class="number">2.</span> <span class="built_in">max</span>(列名) : 计算最大值</span><br><span class="line"><span class="number">3.</span> <span class="built_in">min</span>(列名) : 计算最小值</span><br><span class="line"><span class="number">4.</span> <span class="built_in">avg</span>(列名) ： 计算平均值</span><br><span class="line"><span class="number">5.</span> <span class="built_in">sum</span>(列名) ： 计算和</span><br></pre></td></tr></table></figure>
<h5 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> 语法：<span class="keyword">group</span> <span class="keyword">by</span> 分组列名;</span><br><span class="line"><span class="number">2.</span> 注意：</span><br><span class="line">	<span class="number">1.</span> 分组后的查询字段：分组字段，聚合函数（其他的无意义）</span><br><span class="line">	<span class="number">2.</span> 限定分组的数据：</span><br><span class="line">		<span class="operator">*</span> 分组前使用<span class="keyword">where</span>进行限定，不满足结果不参与分组</span><br><span class="line">		<span class="keyword">select</span> 字段 <span class="keyword">from</span> 表名 <span class="keyword">where</span> 条件 <span class="keyword">group</span> <span class="keyword">by</span>;</span><br><span class="line">		<span class="operator">*</span> 分组后使用<span class="keyword">having</span>进行限定，不满足条件不会被查询</span><br><span class="line">		<span class="keyword">select</span> 字段 <span class="keyword">from</span> 表名 <span class="keyword">where</span> 条件 <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">having</span> 条件;</span><br><span class="line"></span><br><span class="line"><span class="keyword">where</span> 和 <span class="keyword">having</span> 的区别</span><br><span class="line">答：<span class="number">1.</span> <span class="keyword">where</span>在分组之前进行限定，如果不满足条件，则不参与分组。<span class="keyword">having</span>在分组之后进行限定，如果不满足结果，则不会被查询出来</span><br><span class="line">！！！<span class="number">2.</span> <span class="keyword">where</span>后不可以跟聚合函数，<span class="keyword">having</span>向以进行聚合函数的判断。	</span><br></pre></td></tr></table></figure>
<h5 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">语法：limit 开始的索引，每页查询的条数;</span><br><span class="line">eg:</span><br><span class="line"> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> course limit <span class="number">3</span>,<span class="number">3</span>;</span><br><span class="line">注意：limit语法是mysql 的方言</span><br><span class="line">	 其他数据库有不同的实现</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>database</category>
      </categories>
      <tags>
        <tag>sql</tag>
      </tags>
  </entry>
  <entry>
    <title>约束与级联</title>
    <url>/2021/11/16/database-3/</url>
    <content><![CDATA[<h3 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h3><h5 id="概念︰"><a href="#概念︰" class="headerlink" title="概念︰"></a>概念︰</h5><p>对表中的数据进行限定，保证数据的正确性、有效性和完整性。</p>
<h5 id="分类："><a href="#分类：" class="headerlink" title="分类："></a>分类：</h5><ol>
<li><p>主键约束：primary key</p>
<p>删除：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">drop</span> <span class="keyword">primary</span> key;</span><br></pre></td></tr></table></figure>
<p>联合主键：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名(</span><br><span class="line">	uid <span class="type">varchar</span>(<span class="number">32</span>),</span><br><span class="line">	cid <span class="type">varchar</span>(<span class="number">32</span>),</span><br><span class="line">	<span class="keyword">primary</span> key (uid,cid), <span class="operator">/</span><span class="operator">/</span>uid和cid共同构成主键约束，即 uid和cid不能同时相同</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>非空约束：not null</p>
<p>删除：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 modify 列名;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>唯一约束：unique  //可以有多个约束</p>
<p>删除：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">drop</span> index 列名;</span><br></pre></td></tr></table></figure>
</li>
<li><p>外键约束：foreign key</p>
<p>语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">建表前添加</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名(</span><br><span class="line">	...,</span><br><span class="line">	外键列,</span><br><span class="line">	<span class="keyword">constraint</span> 外键名 <span class="keyword">foreign</span> key (外键名称) <span class="keyword">references</span> 外表表名(主键列名)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">建表后添加</span><br><span class="line">alert <span class="keyword">table</span> 表名 <span class="keyword">add</span> <span class="keyword">constraint</span> 外键名称 <span class="keyword">foreign</span> key(外键列名) <span class="keyword">references</span> 外表表名(主键字段名)</span><br><span class="line"></span><br><span class="line">删除外键</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">drop</span> <span class="keyword">foreign</span> key 外键名;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>自动增长：auto_increment</p>
<p>删除：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 modify 列名;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="添加约束"><a href="#添加约束" class="headerlink" title="添加约束"></a>添加约束</h3><ol>
<li><p>创建表时添加约束</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span>(</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> id <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">primary</span> key,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> name <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">not</span> <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建表后修改约束</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 modify 列名 约束;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="级联操作"><a href="#级联操作" class="headerlink" title="级联操作"></a>级联操作</h3><ul>
<li><p>级联操作（外键关联列的修改问题）</p>
<ul>
<li><p>on update cascade //级联更新</p>
</li>
<li><p>on delete cascade  //级联删除</p>
</li>
</ul>
</li>
</ul>
<ol>
<li>建表前添加<br>create table 表名(<br> …,<br> 外键列,<br> constraint 外键名 foreign key (外键名称) references 外表表名(主键列名) on update cascade on delete cascade<br>)</li>
<li>建表后添加<br>alert table 表名 add constraint 外键名称 foreign key(外键列名) references 外表表名(主键字段名) on update cascade on delete cascade;</li>
</ol>
]]></content>
      <categories>
        <category>database</category>
      </categories>
      <tags>
        <tag>数据库_表的约束</tag>
      </tags>
  </entry>
  <entry>
    <title>数据库三大范式和备份还原</title>
    <url>/2021/11/17/database-4/</url>
    <content><![CDATA[<h3 id="一、多表操作"><a href="#一、多表操作" class="headerlink" title="一、多表操作"></a>一、多表操作</h3><h5 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h5><ol>
<li>一对一（eg:人和身份证）</li>
<li>一对多（eg:班级和学生）</li>
<li>多对多（eg:学生和课程）</li>
</ol>
<h5 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h5><ol>
<li><p>一对一</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.1. 在任意一方添加外键，指向另一方的主键，并且将外键设置为唯一：unique</span><br><span class="line">1.2. 合成一张表</span><br></pre></td></tr></table></figure>
</li>
<li><p>一对多</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">在多的一方建立外键，指向一的一方的主键</span><br></pre></td></tr></table></figure>
</li>
<li><p>多对多</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">建立第三张中间表，记录多对多表的主键，表示多对多关系</span><br><span class="line">eg:学生和选课</span><br></pre></td></tr></table></figure>
<p>| 选课id | 学生id | 课程id |<br>| ——— | ——— | ——— |<br>| 1      | 2      | 1      |<br>| 2      | 2      | 2      |</p>
</li>
</ol>
<h3 id="二、三大范式"><a href="#二、三大范式" class="headerlink" title="二、三大范式"></a>二、三大范式</h3><h5 id="1-数据库范式分类"><a href="#1-数据库范式分类" class="headerlink" title="1. 数据库范式分类"></a>1. 数据库范式分类</h5><p>​        设计关系<a href="https://baike.baidu.com/item/数据库/103728">数据库</a>时，遵从不同的规范<a href="https://baike.baidu.com/item/要求/3598753">要求</a>，设计出合理的<a href="https://baike.baidu.com/item/关系型数据库/8999831">关系型数据库</a>，这些不同的规范要求被称为不同的范式，各种范式呈递次规范，越高的范式数据库冗余越小。</p>
<p><a href="https://baike.baidu.com/item/关系数据库/1237340">关系数据库</a>有六种范式：第一范式（1NF）、第二范式（2NF）、<a href="https://baike.baidu.com/item/第三范式/3193798">第三范式</a>（3NF）、巴斯-科德范式（BCNF）、<a href="https://baike.baidu.com/item/第四范式/3193985">第四范式</a>(4NF）和<a href="https://baike.baidu.com/item/第五范式/5025271">第五范式</a>（5NF，又称完美范式）。</p>
<h5 id="2-数据库范式"><a href="#2-数据库范式" class="headerlink" title="2. 数据库范式"></a>2. 数据库范式</h5><ul>
<li><p>第一范式（1NF）</p>
<p>要求：数据库每一列都是不可分割的原子数据项，而不能是集合，数组，记录等非原子数据项。即实体中的某个属性有多个值时，必须拆分为不同的属性。简而言之，第一范式就是无重复的域。</p>
<p><img src="/2021/11/17/database-4/1.png" alt></p>
<p><img src="/2021/11/17/database-4/2.png" alt></p>
</li>
<li><p>第二范式（2NF）（消除部分依赖）</p>
<p>要求：在1NF的基础上，非码属性必须完全依赖于候选码（在1NF基础上消除非主属性对主码的部分函数依赖），第二范式（2NF）要求数据库表中的每个实例或记录必须可以被唯一地区分。选取一个能区分每个实体的属性或属性组，作为实体的唯一标识。</p>
<p><img src="/2021/11/17/database-4/3.png" alt></p>
<p>概念：</p>
<p>a—&gt;b:     a确定b</p>
<ol>
<li>依赖：a—&gt;b， 如果通过A的主属性（主属性组）的值，可以唯一确定B的值。则称B依赖于A。</li>
<li>完全依赖：a—&gt;b，如果A是一个属性组，则B属性值的确定需要依赖A属性组中的所有属性值。则称B完全依赖于A。</li>
<li>部分函数依赖：如果A是一个属性组，则B属性值的确定只需要依赖A属性组中的部分值。则称B部分依赖于A。</li>
<li>传递依赖：a—-&gt;b,b—-&gt;c。如果A属性（属性组）可以唯一确定B属性，B属性可以唯一确定C，则称C传递依赖A。</li>
<li>码：如果在一张表中，一个属性或者属性组，被其他所有属性完全依赖，则称这个属性（属性码）为该表的码。<ul>
<li>主属性：码属性组中的所有属性</li>
<li>非主属性：除码以外的属性</li>
</ul>
</li>
</ol>
</li>
<li><p>第三范式（3NF）（消除传递依赖）</p>
<p>在2NF基础上，任何非主属性不依赖于其它非主属性（在2NF基础上消除传递依赖）</p>
<p><img src="/2021/11/17/database-4/4.png" alt></p>
</li>
</ul>
<h3 id="三、数据库备份、还原"><a href="#三、数据库备份、还原" class="headerlink" title="三、数据库备份、还原"></a>三、数据库备份、还原</h3><h5 id="备份数据库"><a href="#备份数据库" class="headerlink" title="备份数据库"></a>备份数据库</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cmd命令</span><br><span class="line">语法：</span><br><span class="line">	备份：mysqldump -uroot -p密码 数据库名称 &gt; 保存路径</span><br><span class="line">	还原：</span><br><span class="line">		1. 登录数据库</span><br><span class="line">		2. 创建数据库</span><br><span class="line">		3. 使用数据库</span><br><span class="line">		4. 执行文件：source 文件路径 //eg: source d:a.sql</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>database</category>
      </categories>
      <tags>
        <tag>多表关系</tag>
        <tag>范式</tag>
        <tag>备份还原</tag>
      </tags>
  </entry>
  <entry>
    <title>多表查询</title>
    <url>/2021/11/17/database-5/</url>
    <content><![CDATA[<h3 id="数据库生成"><a href="#数据库生成" class="headerlink" title="数据库生成"></a>数据库生成</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">create</span> <span class="keyword">table</span> dept(</span><br><span class="line">     did <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">     dname <span class="type">varchar</span>(<span class="number">10</span>)</span><br><span class="line"> );</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">create</span> <span class="keyword">table</span> emp(</span><br><span class="line">     eid <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">     name <span class="type">varchar</span>(<span class="number">10</span>),</span><br><span class="line">     salary <span class="type">int</span>,</span><br><span class="line">     dno <span class="type">int</span>,</span><br><span class="line">     <span class="keyword">foreign</span> key emp(dno)  <span class="keyword">references</span> dept(did)</span><br><span class="line">);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept <span class="keyword">values</span>(<span class="keyword">null</span>,<span class="string">&#x27;市场部&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept <span class="keyword">values</span>(<span class="keyword">null</span>,<span class="string">&#x27;研发部&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept <span class="keyword">values</span>(<span class="keyword">null</span>,<span class="string">&#x27;财务部&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept <span class="keyword">values</span>(<span class="keyword">null</span>,<span class="string">&#x27;后勤部&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp <span class="keyword">values</span>(<span class="keyword">null</span>,<span class="string">&#x27;邓西&#x27;</span>,<span class="number">15000</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp <span class="keyword">values</span>(<span class="keyword">null</span>,<span class="string">&#x27;李贤敬&#x27;</span>,<span class="number">8000</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp <span class="keyword">values</span>(<span class="keyword">null</span>,<span class="string">&#x27;杨明明&#x27;</span>,<span class="number">7000</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp <span class="keyword">values</span>(<span class="keyword">null</span>,<span class="string">&#x27;尹正杰&#x27;</span>,<span class="number">100000000</span>,<span class="number">3</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp <span class="keyword">values</span>(<span class="keyword">null</span>,<span class="string">&#x27;陶涛&#x27;</span>,<span class="number">10000</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp <span class="keyword">values</span>(<span class="keyword">null</span>,<span class="string">&#x27;方合意&#x27;</span>,<span class="number">9800</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp <span class="keyword">values</span> (<span class="keyword">null</span>,<span class="string">&#x27;邓聪聪&#x27;</span>,<span class="number">13000</span>,<span class="keyword">null</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp <span class="keyword">values</span> (<span class="keyword">null</span>,<span class="string">&#x27;李亚超&#x27;</span>,<span class="number">15000</span>,<span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>
<h3 id="一、多表查询"><a href="#一、多表查询" class="headerlink" title="一、多表查询"></a>一、多表查询</h3><h5 id="1-直接查询两表"><a href="#1-直接查询两表" class="headerlink" title="1.直接查询两表"></a>1.直接查询两表</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> 表<span class="number">1</span>,表<span class="number">2</span>;   <span class="operator">/</span><span class="operator">/</span>表<span class="number">1</span>和表<span class="number">2</span>的笛卡尔集</span><br></pre></td></tr></table></figure>
<p><img src="/2021/11/17/database-5/2.png" alt></p>
<p><img src="/2021/11/17/database-5/3.png" alt></p>
<p><img src="/2021/11/17/database-5/1.png" alt></p>
<ul>
<li>会产生无用数据，</li>
</ul>
<h5 id="2-多表查询分类"><a href="#2-多表查询分类" class="headerlink" title="2.多表查询分类"></a>2.多表查询分类</h5><ul>
<li><p>内连接查询：</p>
<ul>
<li><p>隐式内连接：使用where条件消除无用字段。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>查询所有员工和对应部门的信息</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept,emp <span class="keyword">where</span> dept.did <span class="operator">=</span> emp.dno;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>查询所有员工名称、工资。部门表名称</span><br><span class="line"><span class="keyword">select</span> emp.name,emp.salary,dept.dname <span class="keyword">from</span> dept,emp <span class="keyword">where</span> dept.did <span class="operator">=</span> emp.dno;</span><br><span class="line"></span><br><span class="line"><span class="operator">!</span><span class="operator">!</span><span class="operator">!</span> 可以使用别名进行查询，简化代码</span><br><span class="line">eg: <span class="operator">/</span><span class="operator">/</span>便于观察，进行了换行</span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">	t1.name,</span><br><span class="line">	t1.salary,</span><br><span class="line">	t2.dname</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">	emp t1,   <span class="comment">--起别名</span></span><br><span class="line">	dept t2</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">	t1.dno<span class="operator">=</span>t2.did;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/11/17/database-5/4.png" alt></p>
<p><img src="/2021/11/17/database-5/5.png" alt></p>
</li>
<li><p>显式内连结：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">语法：</span><br><span class="line">	<span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表名<span class="number">1</span> [<span class="keyword">inner</span>] <span class="keyword">join</span> 表名<span class="number">2</span> <span class="keyword">on</span> 条件</span><br><span class="line">eg:</span><br><span class="line">	<span class="operator">/</span><span class="operator">/</span>查询所有员工和对应部门的信息</span><br><span class="line">	<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">inner</span> <span class="keyword">join</span> dept <span class="keyword">on</span> emp.dno <span class="operator">=</span> dept.did;</span><br><span class="line">	<span class="operator">/</span><span class="operator">/</span>查询所有员工名称、工资。部门表名称</span><br><span class="line">	<span class="keyword">select</span> </span><br><span class="line">		t1.name,t1.salary,t2.dname</span><br><span class="line">	<span class="keyword">from</span> </span><br><span class="line">		emp t1 </span><br><span class="line">	<span class="keyword">join</span> </span><br><span class="line">		dept t2 </span><br><span class="line">	<span class="keyword">on</span></span><br><span class="line">		t1.dno <span class="operator">=</span> t2.did</span><br></pre></td></tr></table></figure>
</li>
<li><p>内连接查询：</p>
<ul>
<li>从哪些表中查询数据</li>
<li>条件是什么</li>
<li>查询哪些字段</li>
</ul>
</li>
</ul>
</li>
<li><p>外连接查询：</p>
<ul>
<li><p>左外链接：(查询的是左表所有数据，以及其交集部分，包含左表中外键为空的部分)</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">语法：</span><br><span class="line">	<span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表<span class="number">1</span> <span class="keyword">left</span> [<span class="keyword">outer</span>] <span class="keyword">join</span> 表<span class="number">2</span> <span class="keyword">on</span> 条件;</span><br></pre></td></tr></table></figure>
</li>
<li><p>右外连接：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">语法：</span><br><span class="line">	<span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表<span class="number">1</span> <span class="keyword">right</span> [<span class="keyword">outer</span>] <span class="keyword">join</span> 表<span class="number">2</span> <span class="keyword">on</span> 条件;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>子查询：</p>
<ul>
<li><p>概念：查询中嵌套查询，称为查询的子查询。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 使用括号包裹子查询内容</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">		t1.name,</span><br><span class="line">		t1.salary,</span><br><span class="line">		t2.dname</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">		emp t1,</span><br><span class="line">		dept t2</span><br><span class="line"><span class="keyword">where</span> </span><br><span class="line">        t1.dno<span class="operator">=</span>t2.did</span><br><span class="line">        <span class="keyword">and</span> t1.salary<span class="operator">=</span></span><br><span class="line">        (<span class="keyword">select</span> <span class="built_in">max</span>(salary) <span class="keyword">from</span> emp);</span><br></pre></td></tr></table></figure>
</li>
<li><p>子查询分类</p>
<ul>
<li><p>子查询结果为单行单列</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">可以作为条件，使用运算符去判断。 <span class="operator">&gt;</span> <span class="operator">&gt;=</span> <span class="operator">&lt;</span> <span class="operator">&lt;=</span> <span class="operator">=</span></span><br><span class="line">eg:</span><br><span class="line"><span class="comment">-- 使用括号包裹子查询内容</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">		t1.name,</span><br><span class="line">		t1.salary,</span><br><span class="line">		t2.dname</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">		emp t1,</span><br><span class="line">		dept t2</span><br><span class="line"><span class="keyword">where</span> </span><br><span class="line">        t1.dno<span class="operator">=</span>t2.did</span><br><span class="line">        <span class="keyword">and</span> t1.salary<span class="operator">=</span></span><br><span class="line">        (<span class="keyword">select</span> <span class="built_in">max</span>(salary) <span class="keyword">from</span> emp);</span><br></pre></td></tr></table></figure>
</li>
<li><p>子查询结果为多行单列</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"> 可以作为条件，使用运算符 <span class="keyword">in</span> 来判断</span><br><span class="line"> <span class="keyword">select</span> </span><br><span class="line">		t1.name,t1.salary,t2.dname</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">		emp t1 <span class="keyword">join</span> dept t2</span><br><span class="line"><span class="keyword">on</span> </span><br><span class="line">		t1.dno<span class="operator">=</span>t2.did </span><br><span class="line"><span class="keyword">and</span></span><br><span class="line">		t1.dno <span class="keyword">in</span> (<span class="keyword">select</span> did <span class="keyword">from</span> dept <span class="keyword">where</span> dname <span class="operator">=</span> &quot;市场部&quot; <span class="keyword">or</span> dname <span class="operator">=</span> &quot;财务部&quot;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>* 子查询结果为多行多

  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">子查询结果为多行多,可以视为一张临时的表，括号括起来，取别名后，与其他的表进行连接查询。</span><br><span class="line">eg:</span><br><span class="line"><span class="comment">-- 查询入职时间为2020/2/1号以后的员工姓名，薪水，入职时间，部门名称</span></span><br><span class="line"><span class="comment">-- 注意：时间可以直接和字符串进行比较</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">	t2.name,t2.salary,t2.entry_time,t1.dname</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">	dept t1,(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> entry_time<span class="operator">&gt;</span>&quot;2020-2-1&quot;) t2</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">	t1.did<span class="operator">=</span>t2.dno;</span><br></pre></td></tr></table></figure>

  ![](database-5/6.png)
</code></pre><h3 id="二、练习"><a href="#二、练习" class="headerlink" title="二、练习"></a>二、练习</h3><ol>
<li><p>查询，部门编号，部门名称，部门人数</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">	t1.did,t1.dname,<span class="built_in">count</span>(t2.dno) sum</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">	dept t1,emp t2</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">	t1.did <span class="operator">=</span> t2.dno</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> </span><br><span class="line">	t2.dno;</span><br></pre></td></tr></table></figure>
</li>
</ol>
]]></content>
      <categories>
        <category>database</category>
      </categories>
      <tags>
        <tag>多表查询</tag>
        <tag>事务</tag>
        <tag>用户权限管理</tag>
      </tags>
  </entry>
  <entry>
    <title>事务与授权</title>
    <url>/2021/11/18/database-6/</url>
    <content><![CDATA[<h3 id="一、事务"><a href="#一、事务" class="headerlink" title="一、事务"></a>一、事务</h3><h5 id="1-概念"><a href="#1-概念" class="headerlink" title="1. 概念"></a>1. 概念</h5><p>如果一个包含多个步骤的业务操作，被事务管理，那么这些操作要么同时成功，要么同时失败。</p>
<h5 id="2-操作"><a href="#2-操作" class="headerlink" title="2. 操作"></a>2. 操作</h5><ul>
<li>开启事务：start transaction;</li>
<li>回滚：rollback;</li>
<li>提交：commit;</li>
</ul>
<h5 id="MySQL数据库中事务默认自动提交"><a href="#MySQL数据库中事务默认自动提交" class="headerlink" title="MySQL数据库中事务默认自动提交"></a>MySQL数据库中事务默认自动提交</h5><p>事务提交的两种方式:</p>
<ul>
<li><p>自动提交∶</p>
<p>mysql就是自动提交的</p>
<p>一条DML(增删改)语句会自动提交一次事务。</p>
</li>
<li><p>手动提交∶</p>
<p>Oracle数据库是手动提交的</p>
<p>需要先开启事务，再提交</p>
</li>
<li><p>修改事务的默认提交方式︰</p>
<ul>
<li><p>查看事务的默认提交方式</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> @<span class="variable">@autocommit</span>; <span class="comment">-- 1 代表自动提交 0 代表手动提交</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改默认提交方式</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> @<span class="variable">@autocommit</span> <span class="operator">=</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h5 id="事务的四大特征"><a href="#事务的四大特征" class="headerlink" title="事务的四大特征"></a>事务的四大特征</h5><ol>
<li>原子性：是不分割的最操作小单元，要么同时成功，要么同时失败</li>
<li>持久性：对于任意已提交事务，系统必须保证该事务对数据库的改变不被丢失，即使数据库出现故障。</li>
<li>隔离性：事务的执行不受其他事务的干扰，事务执行的中间结果对其他事务必须是透明的。</li>
<li>一致性：：几个并行执行的事务，其执行结果必须与按某一顺序 串行执行的结果相一致。</li>
</ol>
<h5 id="事务的隔离级别"><a href="#事务的隔离级别" class="headerlink" title="事务的隔离级别"></a>事务的隔离级别</h5><ul>
<li><p>概念:</p>
<p>多个事务之间隔离的，相互独立的。但是如果多个事务操作同一批数据，则会引发一些问题，设置不同的隔离级别就可以解决这些问题。</p>
</li>
<li><p>存在的问题</p>
<ol>
<li>脏读：读取到一个事务中没有提交的数据</li>
<li>不可重复读（虚读）：在同一个事务中，两次读取到数据的结果不一样</li>
<li>幻读：一个事物操作（DML）数据表中所有的记录，另一个事务添加了一条数据，则第一个事务查询不到自己的修改。一个事务在前后两次查询同一个范围的时候、后一次查询看到了前一次查询未看到的行. <ul>
<li>幻读问题产生的本质原因是什么?<br>如果事务中进行操作的都是快照读，是不会产生幻读问题的，但是当快照读和当前读一起使用的时候才会产生幻读问题</li>
</ul>
</li>
</ol>
</li>
</ul>
<p>隔离级别</p>
<ol>
<li><p>read uncommitted : 读未提交</p>
<p>问题：脏读，不可重复读，幻读</p>
</li>
<li><p>read committed : 读已提交（Oracle默认）</p>
<p>问题：不可重复读，幻读</p>
</li>
<li><p>repeatable read : 可重复读（MySQL默认）</p>
<p>问题：幻读</p>
</li>
<li><p>serializable : 串行化</p>
<p>没有问题：安全性最高，但是效率最低</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">在RC隔离级别里，每次进行快照读操作的时候都会重新生成新的readview，所以每次可以查询到最新的结果记录</span><br><span class="line">在RR隔离级别里，只有当前事务在第一次进行快照读的时候才会生成readview，之后进行的快照读操作都会沿用之前的readview</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="数据库设置隔离级别"><a href="#数据库设置隔离级别" class="headerlink" title="数据库设置隔离级别"></a>数据库设置隔离级别</h5><ol>
<li><p>数据库查询隔离级别</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> @<span class="variable">@tx</span>_isolation;</span><br></pre></td></tr></table></figure>
</li>
<li><p>数据库设置隔离级别</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">global</span> transaction isolation level 级别字符串</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="DCL-管理用户，授权"><a href="#DCL-管理用户，授权" class="headerlink" title="DCL:管理用户，授权"></a>DCL:管理用户，授权</h3><h5 id="1-管理用户"><a href="#1-管理用户" class="headerlink" title="1. 管理用户"></a>1. 管理用户</h5><ul>
<li><p>查询用户</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> 切换到mysql数据库</span><br><span class="line">use mysql;</span><br><span class="line"><span class="number">2.</span> 查询<span class="keyword">user</span>表</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建用户</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;密码&#x27;</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;zhangsan&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;密码&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除用户</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span>;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> <span class="string">&#x27;zhangsan&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改用户密码</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">update <span class="keyword">user</span> <span class="keyword">set</span> password <span class="operator">=</span> password(<span class="string">&#x27;新密码&#x27;</span>) <span class="keyword">where</span> <span class="keyword">user</span> <span class="operator">=</span> <span class="string">&#x27;用户名&#x27;</span>;</span><br><span class="line"><span class="keyword">set</span> password <span class="keyword">for</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span> <span class="operator">=</span> password(<span class="string">&#x27;新密码&#x27;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>忘记root密码如何修改密码</p>
<p><img src="/2021/11/18/database-6/1.png" alt></p>
</li>
</ul>
<h5 id="2-授权"><a href="#2-授权" class="headerlink" title="2. 授权"></a>2. 授权</h5><ul>
<li><p>查询权限</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> grants <span class="keyword">for</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置权限</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">grant</span> 授权列表 <span class="keyword">on</span> 数据库.表名 <span class="keyword">to</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span>;</span><br><span class="line">eg:</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span>,delect,update <span class="keyword">on</span> 数据库.表名 <span class="keyword">to</span> <span class="string">&#x27;zhangsan&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="comment">-- 授予所有权限</span></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>撤销权限</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">revoke</span> 授权列表 <span class="keyword">on</span> 数据库.表名 <span class="keyword">from</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
]]></content>
      <categories>
        <category>database</category>
      </categories>
      <tags>
        <tag>数据库事务</tag>
        <tag>数据库用户和权限管理</tag>
      </tags>
  </entry>
  <entry>
    <title>deepLeaning-3</title>
    <url>/2021/10/19/deepLeaning-3/</url>
    <content><![CDATA[<h1 id="改善深层神经网络"><a href="#改善深层神经网络" class="headerlink" title="改善深层神经网络"></a>改善深层神经网络</h1><h2 id="一、归一化"><a href="#一、归一化" class="headerlink" title="一、归一化"></a>一、归一化</h2><h3 id="1-概念"><a href="#1-概念" class="headerlink" title="1 概念"></a>1 概念</h3><p>  归一化：</p>
<p>１）把数据变成(０，１)或者（1,1）之间的小数。主要是为了数据处理方便提出来的，把数据映射到0～1范围之内处理，更加便捷快速。</p>
<p>２）把有量纲表达式变成无量纲表达式，便于不同单位或量级的指标能够进行比较和加权。归一化是一种简化计算的方式，即将有量纲的表达式，经过变换，化为无量纲的表达式，成为纯量。</p>
<h3 id="1-1-线性函数归一化-Min-Max-scaling"><a href="#1-1-线性函数归一化-Min-Max-scaling" class="headerlink" title="1.1 线性函数归一化(Min-Max scaling)"></a>1.1 线性函数归一化(Min-Max scaling)</h3><p>线性函数将原始数据线性化的方法转换到[0 1]的范围，归一化公式如下：</p>
<script type="math/tex; mode=display">x = \frac {x-x_{min}}{x_{max}-x_{min}}</script><p>该方法实现对原始数据的等比例缩放，其中Xnorm为归一化后的数据，X为原始数据，Xmax、Xmin分别为原始数据集的最大值和最小值。</p>
<h3 id="2-1-0均值标准化-Z-score-standardization-，"><a href="#2-1-0均值标准化-Z-score-standardization-，" class="headerlink" title="2.1 0均值标准化(Z-score standardization)，"></a>2.1 0均值标准化(Z-score standardization)，</h3><p>0均值归一化方法将原始数据集归一化为均值为0、方差1的数据集，归一化公式如下：</p>
<script type="math/tex; mode=display">x=\frac {x-\mu}{\sigma}</script><p>其中，μ、σ分别为原始数据集的均值和方差。该种归一化方式要求原始数据的分布可以近似为高斯分布，否则归一化的效果会变得很糟糕。</p>
<p>以上为两种比较普通但是常用的归一化技术，那这两种归一化的应用场景是怎么样的呢？什么时候第一种方法比较好、什么时候第二种方法比较好呢？下面做一个简要的分析概括：</p>
<p>1、在分类、聚类算法中，需要使用距离来度量相似性的时候、或者使用PCA技术进行降维的时候，第二种方法(Z-score standardization)表现更好。</p>
<p>2、在不涉及距离度量、协方差计算、数据不符合正太分布的时候，可以使用第一种方法或其他归一化方法。比如图像处理中，将RGB图像转换为灰度图像后将其值限定在[0 255]的范围。</p>
<h2 id="二、神经网络的权重初始化"><a href="#二、神经网络的权重初始化" class="headerlink" title="二、神经网络的权重初始化"></a>二、神经网络的权重初始化</h2><h4 id="1-权重初始化的重要性"><a href="#1-权重初始化的重要性" class="headerlink" title="1.权重初始化的重要性"></a>1.权重初始化的重要性</h4><ul>
<li>神经网络的训练过程中的参数学习时基于梯度下降算法进行优化的。梯度下降法需要在开始训练时给每个参数赋予一个初始值。这个初始值的选取十分重要。在神经网络的训练中如果将权重全部初始化为0，则第一遍前向传播过程中，所有隐藏层神经元的激活函数值都相同，导致深层神经元可有可无，这一现象称为<strong>对称权重</strong>现象。</li>
<li>为了打破这个平衡，比较好的方法是对每层的权重都进行随机初始化，这样使得不同层的神经元之间有很好的区分性。但是，<strong>随机初始化参数的一个问题是如何选择随机初始化的区间</strong>。如果权重初始化太小，会导致神经元的输入过小，随着层数的不断增加，会出现信号消失的问题；也会导致sigmoid激活函数丢失非线性的能力，因为在0附件sigmoid函数近似是线性的。如果参数初始化太大，会导致输入状态太大。对sigmoid激活函数来说，激活函数的值会变得饱和，从而出现梯度消失的问题。</li>
</ul>
<h4 id="2-常用的参数初始化方法"><a href="#2-常用的参数初始化方法" class="headerlink" title="2.常用的参数初始化方法"></a>2.常用的参数初始化方法</h4><ul>
<li>高斯分布初始化：参数从一个固定均值(比如0)和固定方差(比如0.01)的高斯分布进行随机初始化。</li>
<li>均匀分布初始化：在一个给定的区间[-r,r]内采用均匀分布来初始化参数。超参数r的设置可以按照神经元的连接数量进行自适应的调整。</li>
<li><strong>初始化一个深层神经网络时，一个比较好的初始化策略是保持每个神经元输入和输出的方差一致</strong>。</li>
</ul>
<h4 id="3-He初始化"><a href="#3-He初始化" class="headerlink" title="3.He初始化"></a>3.He初始化</h4><ul>
<li><p>当第l层神经元使用ReLU激活函数时，通常有一般的神经元输出为0，因此其分布的方差也近似为使用logistic作为激活函数时的一半。这样，只考虑前向传播时，参数$w_i^l$的理想方差为</p>
</li>
<li><script type="math/tex; mode=display">var[w_i^l] = \frac 2 {n^{l-1}}</script></li>
<li><p>其中$n^{l-1}$是第l-1层的神经元个数。</p>
<p> 即在对数据集进行0均值标准化(Z-score standardization)后在进行$x=x*{\sqrt\frac{2}{n^{(l-1)}}}$操作</p>
</li>
<li><p>因此，当使用ReLU激活函数时，如果采用高斯分布来初始化参数$w_i^l$，其方差为$ \frac 2 {n^{l-1}}$如果采用区间为[-r,r]的均匀分布来初始化参数$w_i^l$时，则$r = \sqrt \frac{6} {n^{l-1}}$。</p>
</li>
</ul>
]]></content>
      <categories>
        <category>deepLearning</category>
      </categories>
      <tags>
        <tag>归一化和神经网络的权重初始化</tag>
      </tags>
  </entry>
  <entry>
    <title>deepLearning_1</title>
    <url>/2021/09/24/deepLearning-1/</url>
    <content><![CDATA[<p><img src="/2021/09/24/deepLearning-1/123.png" alt="1"></p>
<h1 id="一-基于数值微分的KNN手写数字识别"><a href="#一-基于数值微分的KNN手写数字识别" class="headerlink" title="一.基于数值微分的KNN手写数字识别"></a>一.基于数值微分的KNN手写数字识别</h1><p>进行深度学习训练的基本步骤</p>
<p><img src="/2021/09/24/deepLearning-1/1.png" alt="img_1"></p>
<h3 id="1-minist数据集"><a href="#1-minist数据集" class="headerlink" title="1. minist数据集"></a>1. minist数据集</h3><h4 id="获取数据集"><a href="#获取数据集" class="headerlink" title="获取数据集"></a>获取数据集</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"><span class="keyword">import</span> torchvision.datasets <span class="keyword">as</span> dsets</span><br><span class="line">batch_size = <span class="number">100</span></span><br><span class="line"><span class="comment"># MNIST dataset</span></span><br><span class="line">train_dataset = dsets.MNIST(root = <span class="string">&#x27;ml/pymnist&#x27;</span>, <span class="comment">#选择数据的根目录，</span></span><br><span class="line">                            train = <span class="literal">True</span>, <span class="comment">#选择训练集</span></span><br><span class="line">                            transform = <span class="literal">None</span>, <span class="comment">#不考虑使用任何数据预处理</span></span><br><span class="line">                            download = <span class="literal">False</span>) <span class="comment">#从网络上下载图片</span></span><br><span class="line">test_dataset = dsets.MNIST(root = <span class="string">&#x27;ml/pymnist&#x27;</span>, <span class="comment">#选择数据的根目录</span></span><br><span class="line">                            train = <span class="literal">False</span>, <span class="comment">#选择测试集</span></span><br><span class="line">                            transform = <span class="literal">None</span>, <span class="comment">#不考虑使用任何数据预处理</span></span><br><span class="line">                            download = <span class="literal">False</span>) <span class="comment">#从网络上下载图片</span></span><br><span class="line"><span class="comment">#加载数据</span></span><br><span class="line">train_loader = torch.utils.data.DataLoader(dataset = train_dataset,</span><br><span class="line">                                            batch_size = batch_size,</span><br><span class="line">                                            shuffle = <span class="literal">True</span>) <span class="comment">#将数据打乱</span></span><br><span class="line">test_loader = torch.utils.data.DataLoader(dataset = test_dataset,</span><br><span class="line">                                            batch_size = batch_size,</span><br><span class="line">                                            shuffle = <span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<h3 id="2-函数知识点"><a href="#2-函数知识点" class="headerlink" title="2.函数知识点"></a>2.函数知识点</h3><h4 id="scatter-（）函数使用"><a href="#scatter-（）函数使用" class="headerlink" title="scatter_（）函数使用"></a>scatter_（）函数使用</h4><ul>
<li><p>注意：在对一维array转置的时候，x = np.array([1, 2, 3]).T 是无效的，需要进行一些处理才可以转置。</p>
<p>eg:x = np.array([[1,2,3]])//扩充维度</p>
</li>
<li><p>scatter_(dim, index, src)<br>dim：维度，表示在第几维上操作；<br>index：索引，后面再解释；<br>src：用来填充的tensor。</p>
</li>
<li><p><strong>index 和 src维度要相同</strong></p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#例子：使用scatter_()生成one-hot编码</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">a = torch.zeros(<span class="number">10</span>,<span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line">labels = np.random.randint(<span class="number">0</span>,<span class="number">5</span>,(<span class="number">10</span>,<span class="number">1</span>))</span><br><span class="line">labels = torch.LongTensor(labels)</span><br><span class="line"><span class="built_in">print</span>(labels)</span><br><span class="line">a.scatter_(<span class="number">1</span>,labels,<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(a.data)</span><br><span class="line"><span class="comment">#输出</span></span><br><span class="line">tensor([[<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">        [<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">        [<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">        [<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">        [<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">        [<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">        [<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">        [<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">        [<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">        [<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>]])</span><br><span class="line">tensor([[<span class="number">2</span>],</span><br><span class="line">        [<span class="number">3</span>],</span><br><span class="line">        [<span class="number">1</span>],</span><br><span class="line">        [<span class="number">0</span>],</span><br><span class="line">        [<span class="number">1</span>],</span><br><span class="line">        [<span class="number">3</span>],</span><br><span class="line">        [<span class="number">2</span>],</span><br><span class="line">        [<span class="number">2</span>],</span><br><span class="line">        [<span class="number">4</span>],</span><br><span class="line">        [<span class="number">3</span>]])</span><br><span class="line">tensor([[<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">1.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">        [<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">1.</span>, <span class="number">0.</span>],</span><br><span class="line">        [<span class="number">0.</span>, <span class="number">1.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">        [<span class="number">1.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">        [<span class="number">0.</span>, <span class="number">1.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">        [<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">1.</span>, <span class="number">0.</span>],</span><br><span class="line">        [<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">1.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">        [<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">1.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">        [<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">1.</span>],</span><br><span class="line">        [<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">1.</span>, <span class="number">0.</span>]])</span><br><span class="line"></span><br><span class="line">Process finished <span class="keyword">with</span> exit code <span class="number">0</span></span><br></pre></td></tr></table></figure>
<h4 id="np-nditer-多维迭代器使用"><a href="#np-nditer-多维迭代器使用" class="headerlink" title="np.nditer()多维迭代器使用"></a>np.nditer()多维迭代器使用</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">a = np.random.randint(<span class="number">0</span>,<span class="number">9</span>,<span class="number">6</span>).reshape(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">x = np.nditer(a,flags=[<span class="string">&#x27;multi_index&#x27;</span>],op_flags=[<span class="string">&#x27;readwrite&#x27;</span>])</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> x.finished:</span><br><span class="line">    <span class="built_in">print</span>(x.multi_index)</span><br><span class="line">    x.iternext()</span><br><span class="line">x.iternext()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> x:</span><br><span class="line">    <span class="built_in">print</span>(x.multi_index)</span><br><span class="line"><span class="comment">#输出：</span></span><br><span class="line">[<span class="number">0</span> <span class="number">0</span> <span class="number">4</span>]</span><br><span class="line">[<span class="number">0</span> <span class="number">4</span> <span class="number">2</span>]</span><br><span class="line">(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">(<span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line">(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>flags=[‘multi_index’]表示对a进行多重索引，具体解释请看下面的示例代码。<br>上述代码段中参数的解释如下。</li>
<li>op_flags=[‘readwrite’]表示不仅可以对a进行read（读取），还可以write（写入），即相当于在创建这个迭代器的时候，我们就规定好了其具有哪些权限。</li>
<li>print(it.multi_index)表示输出元素的索引，可以看到输出的结果都是index。</li>
<li>it.iternext()表示进入下一次迭代，如果不加这一条语句的话，输出的结果就会一直都是(0，0)。</li>
</ul>
<h3 id="3-构建神经网络"><a href="#3-构建神经网络" class="headerlink" title="3.构建神经网络"></a>3.构建神经网络</h3><p>在pytorch中构建网络模型类，继承torch.nn.Module，在init函数中设计网络层数结构，实现forward函数进行前向传播。</p>
<p>eg:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Model</span>(<span class="params">torch.nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(Model,self).__init__()</span><br><span class="line">        self.linear_1 = torch.nn.Linear(<span class="number">8</span>,<span class="number">1</span>)</span><br><span class="line">        self.sigmoid_1 = torch.nn.Sigmoid()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self,x</span>):</span></span><br><span class="line">        x = self.sigmoid_1(self.linear_1(x))</span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure>
<h3 id="4-损失函数"><a href="#4-损失函数" class="headerlink" title="4.损失函数"></a>4.损失函数</h3><p>BCELoss与CrossEntropyLoss都是用于分类问题。可以知道，BCELoss是Binary CrossEntropyLoss的缩写，BCELoss　CrossEntropyLoss的一个特例，只用于二分类问题，而CrossEntropyLoss可以用于二分类，也可以用于多分类。</p>
<p>不过我重新查阅了一下资料，发现同样是处理二分类问题，BCELoss与CrossEntropyLoss是不同的。下面我详细讲一下哪里不同。</p>
<p>１．　使用nn.BCELoss需要在该层前面加上Sigmoid函数。</p>
<p>２．　使用nn.CrossEntropyLoss会自动加上Sofrmax层。</p>
<p>可以看出，这两个计算损失的函数使用的激活函数不同，故而最后的计算公式不同。</p>
]]></content>
      <categories>
        <category>deepLearning_practice</category>
      </categories>
      <tags>
        <tag>minist手写数字识别</tag>
      </tags>
  </entry>
  <entry>
    <title>deepLearning-4</title>
    <url>/2021/10/19/deepLearning-4/</url>
    <content><![CDATA[<h1 id="优化算法"><a href="#优化算法" class="headerlink" title="优化算法"></a>优化算法</h1><h2 id="一、mini-batch"><a href="#一、mini-batch" class="headerlink" title="一、mini_batch"></a>一、mini_batch</h2><p>​    我们已知在梯度下降中需要对所有样本进行处理过后然后走一步，那么如果我们的样本规模的特别大的话效率就会比较低。假如有500万，甚至5000万个样本(在我们的业务场景中，一般有几千万行，有些大数据有10亿行)的话走一轮迭代就会非常的耗时。这个时候的梯度下降叫做full batch。</p>
<p>​     所以为了提高效率，我们可以把样本分成等量的子集。 例如我们把100万样本分成1000份， 每份1000个样本， 这些子集就称为mini batch。然后我们分别用一个for循环遍历这1000个子集。 针对每一个子集做一次梯度下降。 然后更新参数w和b的值。接着到下一个子集中继续进行梯度下降。 这样在遍历完所有的mini batch之后我们相当于在梯度下降中做了1000次迭代。</p>
<p>​     我们将遍历一次所有样本的行为叫做一个 epoch，也就是一个世代。 在mini batch下的梯度下降中做的事情其实跟full batch一样，只不过我们训练的数据不再是所有的样本，而是一个个的子集。 这样在mini batch我们在一个epoch中就能进行1000次的梯度下降，而在full batch中只有一次。 这样就大大的提高了我们算法的运行速度。</p>
<h2 id="二、momentum梯度下降法"><a href="#二、momentum梯度下降法" class="headerlink" title="二、momentum梯度下降法"></a>二、momentum梯度下降法</h2><h3 id="2-1-指数加权平均"><a href="#2-1-指数加权平均" class="headerlink" title="2.1 指数加权平均"></a>2.1 指数加权平均</h3><p><strong>平均数求法</strong></p>
<p>比如我们现在有100天的温度值，要求这100天的平均温度值。</p>
<p>24，25，24，26，34，28，33，33，34，35……….32。</p>
<p><strong><em>我们直接可以用公式：\</em></strong></p>
<p><img src="/2021/10/19/deepLearning-4/1.png" alt></p>
<p>通过上面的公式就可以直接求出10天的平均值。<strong><em>而我们要介绍的指数加权平均本质上就是一种近似求平均的方法。\</em></strong></p>
<p><strong>指数加权平均</strong></p>
<p><strong>我们现在直接给出公式：</strong><img src="/2021/10/19/deepLearning-4/2.png" alt></p>
<p>其中 $v_t$代表第t天平均温度 ， $\theta_t$ 代表第t天的温度，$\beta$是超参数</p>
<p>假如$\beta=0.9$则：</p>
<p><img src="/2021/10/19/deepLearning-4/3.png" alt></p>
<p>化简开得到如下表达式：</p>
<p><img src="/2021/10/19/deepLearning-4/4.png" alt></p>
<p>通过上面表达式，我们可以看到，V100等于每一个时刻天数的温度值再乘以一个权值。</p>
<p><strong>本质就是以指数式递减加权的移动平均。各数值的加权而随时间而指数式递减，越近期的数据加权越重，但较旧的数据也给予一定的加权。</strong></p>
<p>而在我们上面提到的普通平均数求法，它的每一项的权值都是一样的，如果有n项，权值都为1/n。</p>
<p>指数加权平均的结果是由当天温度值乘以指数衰减函数值，然后类和求得！</p>
<p><strong>指数加权平均的优势</strong></p>
<p>那么指数加权平均法有什么好处呢？首先我们来看它的实现：</p>
<p><img src="/2021/10/19/deepLearning-4/5.png" alt></p>
<p><strong><em>我们可以看到指数加权平均的求解过程实际上是一个递推的过程，那么这样就会有一个非常大的好处，每当我要求从0到某一时刻（n）的平均值的时候，我并不需要像普通求解平均值的作为，保留所有的时刻值，类和然后除以n。\</em></strong></p>
<p><strong><em>而是只需要保留0-(n-1)时刻的平均值和n时刻的温度值即可。也就是每次只需要保留常数值，然后进行运算即可，这对于深度学习中的海量数据来说，是一个很好的减少内存和空间的做法。\</em></strong></p>
<h3 id="2-2-动量梯度下降"><a href="#2-2-动量梯度下降" class="headerlink" title="2.2 动量梯度下降"></a>2.2 动量梯度下降</h3><p>梯度下降是机器学习中用来使模型逼近真实分布的最小偏差的优化方法。<br>在普通的随机梯度下降和批梯度下降当中，参数的更新是按照如下公式进行的：</p>
<p>W = W - αdW<br>b = b - αdb</p>
<p>其中α是学习率，dW、db是cost function对w和b的偏导数。<br>随机梯度下降和批梯度下降的区别只是输入的数据分别是mini-batch和all。</p>
<p>在随机梯度下降训练中参数是曲折的接近最优点，使用动量梯度下降可以加快参数训练</p>
<p>动量梯度下降更新公式如下：</p>
<p><img src="/2021/10/19/deepLearning-4/6.png" alt><br>我们可以看出，在这个公式中，并不是直接减去αdW和αdb，而是计算出了一个vdW和vdb。</p>
<p>​    使用这个公式，可以将之前的dW和db都联系起来，不再是每一次梯度都是独立的情况。其中β是可以自行设置的超参数，一般情况下默认为0.9（也可以设置为其他数值）。β代表了现在的vdW和vdb与之前的1 / (1 - β)个vdW和vdb有关。0.9就是现在的vdW和vdb是平均了之前10天的vdW和vdb的结果。<br>​    此时的梯度不再只是我现在的数据的梯度，而是有一定权重的之前的梯度</p>
<p>​    每一次梯度下降都会有一个之前的速度的作用，如果我这次的方向与之前相同，则会因为之前的速度继续加速；如果这次的方向与之前相反，则会由于之前存在速度的作用不会产生一个急转弯，而是尽量把路线向一条直线拉过去。</p>
<h3 id="2-3-RMSprop算法"><a href="#2-3-RMSprop算法" class="headerlink" title="2.3 RMSprop算法"></a>2.3 RMSprop算法</h3><p><img src="/2021/10/19/deepLearning-4/7.png" alt></p>
<p>于上面的这个椭圆形的抛物面（图中的椭圆代表等高线），沿着横轴收敛速度是最快的，所以我们希望在横轴（假设记为w1）方向步长大一些，在纵轴（假设记为w2）方向步长小一些。这时候可以通过RMSprop实现，迭代更新公式如下：</p>
<p><img src="/2021/10/19/deepLearning-4/8.png" alt></p>
<p>观察上面的公式可以看到，s是对梯度的平方做了一次平滑。在更新w时，先用梯度除以$\sqrt{s_1+\epsilon}$，相当于对梯度做了一次归一化。如果某个方向上梯度震荡很大，应该减小其步长；而震荡大，则这个方向的s也较大，除完之后，归一化的梯度就小了；如果某个方向上梯度震荡很小，应该增大其步长；而震荡小，则这个方向的s也较小，归一化的梯度就大了。因此，通过RMSprop，我们可以调整不同维度上的步长，加快收敛速度。把上式合并后，RMSprop迭代更新公式如下：</p>
<p><img src="/2021/10/19/deepLearning-4/9.png" alt></p>
<p>β的典型值是0.999。公式中还有一个ϵ，这是一个很小的数，典型值是$10^{-8}$。</p>
<h3 id="2-4-Adam算法"><a href="#2-4-Adam算法" class="headerlink" title="2.4 Adam算法"></a>2.4 Adam算法</h3><p>Adam算法则是以上二者动量梯度下降和RMSprop算法的结合。先看迭代更新公式：</p>
<p><img src="/2021/10/19/deepLearning-4/10.png" alt></p>
<p>典型值：β1=0.9,β2=0.999,ϵ=$10^{-8}$。Adam算法相当于先把原始梯度做一个指数加权平均，再做一次归一化处理，然后再更新梯度值。</p>
<h3 id="2-5优化算法"><a href="#2-5优化算法" class="headerlink" title="2.5优化算法"></a>2.5优化算法</h3><p>在使用<strong>mini-batch</strong>梯度下降法时，<strong>mini-batch</strong>数量不大，大概64或者128个样本，在迭代过程中会有噪音（蓝色线），下降朝向最小值，但是不会精确地收敛，所以你的算法最后在附近摆动，并不会真正收敛，因为你用的<img src="https://private.codecogs.com/gif.latex?%5Calpha" alt="\alpha">是固定值，不同的<strong>mini-batch</strong>中有噪音。</p>
<p>但要慢慢减少学习率的话，在初期的时候，学习率还较大，你的学习还是相对较快，但随着变小，你的步伐也会变慢变小，所以最后你的曲线（绿色线）会在最小值附近的一小块区域里摆动，而不是在训练过程中，大幅度在最小值附近摆动。</p>
<p>所以慢慢减少的本质在于，在学习初期，你能承受较大的步伐，但当开始收敛的时候，小一些的学习率能让你步伐小一些。</p>
<p><strong>方法1：</strong></p>
<p><img src="/2021/10/19/deepLearning-4/11.png" alt></p>
<p><strong>方法2：</strong></p>
<p><img src="/2021/10/19/deepLearning-4/12.png" alt></p>
<p><strong>方法3：</strong></p>
<p><img src="/2021/10/19/deepLearning-4/13.png" alt></p>
<p><strong>方法4：</strong></p>
<p><img src="/2021/10/19/deepLearning-4/14.png" alt></p>
]]></content>
      <categories>
        <category>deepLearning</category>
      </categories>
      <tags>
        <tag>优化算法</tag>
      </tags>
  </entry>
  <entry>
    <title>deepLearning-5</title>
    <url>/2021/10/21/deepLearning-5/</url>
    <content><![CDATA[<h2 id="一、超参数范围设置"><a href="#一、超参数范围设置" class="headerlink" title="一、超参数范围设置"></a>一、超参数范围设置</h2><p>在超参数设置的时候通常采用随机的方式进行，但是在随机的范围以及不同范围区间的概率要慎重选择。</p>
<p>eg:在选择超参数$\alpha$时可以选择在0.001到1随机，但是如果$\alpha$选择0.001到0.01的变化很大，选择0.1到1的变化很小，则可以进行变化，将随机到0.1到1的概率减小，将选择0.001到0.01的概率提升</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">a = -<span class="number">4</span>*np.random.rand()</span><br><span class="line">a = <span class="number">10</span>**a</span><br></pre></td></tr></table></figure>
<h2 id="二、bath-norm"><a href="#二、bath-norm" class="headerlink" title="二、bath norm"></a>二、bath norm</h2><p>Batchnorm是深度网络中经常用到的加速神经网络训练，加速收敛速度及稳定性的算法，可以说是目前深度网络必不可少的一部分。</p>
<p>首先，此部分也即是讲为什么深度网络会需要batchnorm</p>
<p>，我们都知道，深度学习的话尤其是在CV上都需要对数据做归一化，因为深度神经网络主要就是为了学习训练数据的分布，并在测试集上达到很好的泛化效果，但是，如果我们每一个batch输入的数据都具有不同的分布，显然会给网络的训练带来困难。另一方面，数据经过一层层网络计算后，其数据分布也在发生着变化，此现象称为Internal Covariate Shift，接下来会详细解释，会给下一层的网络学习带来困难。batchnorm</p>
<p>直译过来就是批规范化，就是为了解决这个分布变化问题。</p>
<p>为了减小Internal Covariate Shift，可以对神经网络的每一层做归一化，例如：将每一层输出后的数据都归一化到0均值，1方差，满足正太分布，但是，此时有一个问题，每一层的数据分布都是标准正太分布，导致其完全学习不到输入数据的特征，因为，费劲心思学习到的特征分布被归一化了，因此，直接对每一层做归一化显然是不合理的。但是如果稍作修改，加入可训练的参数做归一化，那就是BatchNorm实现的了，接下来结合下图的伪代码做详细的分析：</p>
<p><img src="/2021/10/21/deepLearning-5/1.png" alt></p>
<p>之所以称之为batchnorm是因为所norm的数据是一个batch的，假设输入数据是β=x1…m</p>
<p>共m个数据，输出是yi=BN(x)，batchnorm</p>
<p>的步骤如下：</p>
<p>1.先求出此次批量数据x</p>
<p>的均值，μβ=1m∑mi=1xi<br>2.求出此次batch的方差，σ2β=1m∑i=1m(xi−μβ)2<br>3.接下来就是对x做归一化，得到x−i<br>4.最重要的一步，引入缩放和平移变量γ和β ,计算归一化后的值，yi=γx−i +β</p>
<p>接下来详细介绍一下这额外的两个参数，之前也说过如果直接做归一化不做其他处理，神经网络是学不到任何东西的，但是加入这两个参数后，事情就不一样了，先考虑特殊情况下，如果γ</p>
<p>和β分别等于此batch的方差和均值，那么yi不就还原到归一化前的x了吗，也即是缩放平移到了归一化前的分布，相当于batchnorm没有起作用，β 和γ</p>
<p>分别称之为 平移参数和缩放参数 。这样就保证了每一次数据经过归一化后还保留的有学习来的特征，同时又能完成归一化这个操作，加速训练。</p>
]]></content>
      <categories>
        <category>deepLearning</category>
      </categories>
      <tags>
        <tag>超参数和bath norm</tag>
      </tags>
  </entry>
  <entry>
    <title>deeplearning2</title>
    <url>/2021/09/24/deeplearning2/</url>
    <content><![CDATA[<h1 id="改善深层神经网络"><a href="#改善深层神经网络" class="headerlink" title="改善深层神经网络"></a>改善深层神经网络</h1><h2 id="一、正则化"><a href="#一、正则化" class="headerlink" title="一、正则化"></a>一、正则化</h2><h3 id="1-1-L2正则"><a href="#1-1-L2正则" class="headerlink" title="1.1 L2正则"></a>1.1 L2正则</h3><p><img src="/2021/09/24/deeplearning2/1.png" alt></p>
<h3 id="1-2-Dropout正则化"><a href="#1-2-Dropout正则化" class="headerlink" title="1.2 Dropout正则化"></a>1.2 Dropout正则化</h3><p>Dropout提供了正则化一大类模型的方法，计算方便但功能强大。简单来说Dropout可以理解为在概率意义上随机删除神经网络中的节点，以此简化神经网络模型来防止过拟合的一种正则化方法，下图说明了Dropout的处理过程。</p>
<p><img src="/2021/09/24/deeplearning2/2.png" alt></p>
<p>Dropout会在每次迭代中随机关闭一些神经元,其中涉及到正则化参数keep_prob,keep_prob是一个随机数，在正向传播时，我们给每一个神经元赋予一个概率，通过比较keep_prob与神经元的随机概率大小来给出决策。当该概率小于keep_prob时，我们关闭该神经元。做法是通过应用掩码来关闭正向传播过程中的某些神经元。<br>对于反向传播，将用相同的掩码重新来关闭相同的神经元，进而进行导数的计算。</p>
<h3 id="1-3-其他正则化方法"><a href="#1-3-其他正则化方法" class="headerlink" title="1.3 其他正则化方法"></a>1.3 其他正则化方法</h3><p>正则化的目的是为了防止过拟合带来的高方差，我们可以考虑采用数据扩增和提早结束训练来防止过拟合。<br><strong><em>数据扩增</em></strong><br>假设我们的数据集是图片，那对图片进行旋转、裁剪等可以达到数据扩增的目的，如下图所示。</p>
<p><img src="/2021/09/24/deeplearning2/3.png" alt></p>
<p><strong><em>提早结束训练</em></strong><br>过拟合一定程度上是由于训练过度导致的，为了防止过拟合带了的高方差，把方差和损失函数作为训练结束的评判标准可以一定程度上减少过拟合。下图是该方法的体现。</p>
<p><img src="/2021/09/24/deeplearning2/4.png" alt></p>
<h2 id="二、正则化能减少过拟合的原因"><a href="#二、正则化能减少过拟合的原因" class="headerlink" title="二、正则化能减少过拟合的原因"></a>二、正则化能减少过拟合的原因</h2><p><strong>2.1 过拟合</strong><br>过拟合是指为了得到一致假设而使假设变得过度严格，如下图所示：</p>
<p><img src="/2021/09/24/deeplearning2/5.png" alt></p>
<p>上图反映了对二维数据的分类，该分类器看似很好的拟合的边缘，达到的分类的目的，但是分类边界过于严格，这样的分类模型虽然在训练集中表现得很好，当把它应用到测试集中，预测结果却不会很好。<br>从上图来看，过拟合往往带着非线性性与复杂性，为了减少过拟合，我们采取某种方法来减少它的非线性性与复杂性。</p>
<p>2.2 正则化减少过拟合<br>以L2正则化为例，我们通过对权重项施以惩罚，在参数更新时，达到权重衰减的目的。权重衰减意味着衰减的神经元对神经网络的影响减小，使得原本复杂的神经网络变得简单，甚至简单到像Logistic回归一样，每层只具有一个神经元。<br>神经元作用的衰减让原本非线性的分类趋于线性分类，这样就一定程度避免了过拟合。<br>下图反映了神经网络正则化的过程，以及分类效果。<br><img src="/2021/09/24/deeplearning2/6.png" alt></p>
]]></content>
      <categories>
        <category>deepLearning</category>
      </categories>
      <tags>
        <tag>正则化</tag>
      </tags>
  </entry>
  <entry>
    <title>elementplus</title>
    <url>/2022/04/12/elementplus/</url>
    <content><![CDATA[<h1 id="一、elementplus"><a href="#一、elementplus" class="headerlink" title="一、elementplus"></a>一、elementplus</h1><h2 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h2><h3 id="1-1-包管理器安装"><a href="#1-1-包管理器安装" class="headerlink" title="1.1. 包管理器安装"></a>1.1. 包管理器安装</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 选择一个你喜欢的包管理器</span><br><span class="line"></span><br><span class="line"># NPM</span><br><span class="line">$ npm install element-plus --save</span><br><span class="line"></span><br><span class="line"># Yarn</span><br><span class="line">$ yarn add element-plus</span><br><span class="line"></span><br><span class="line"># pnpm</span><br><span class="line">$ pnpm install element-plus</span><br></pre></td></tr></table></figure>
<h3 id="1-2-浏览器直接引入"><a href="#1-2-浏览器直接引入" class="headerlink" title="1.2. 浏览器直接引入"></a>1.2. 浏览器直接引入</h3><p>直接通过浏览器的 HTML 标签导入 Element Plus，然后就可以使用全局变量 <code>ElementPlus</code>了。</p>
<p>根据不同的 CDN 提供商有不同的引入方式， 根据不同的 CDN 提供商有不同的引入方式， 我们在这里以 <a href="https://unpkg.com/">unpkg</a> 和 <a href="https://jsdelivr.com/">jsDelivr</a> 举例。 你也可以使用其它的 CDN 供应商。</p>
<h3 id="unpkg"><a href="#unpkg" class="headerlink" title="unpkg"></a>unpkg</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 导入样式 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;//unpkg.com/element-plus/dist/index.css&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 导入 Vue 3 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//unpkg.com/vue@next&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 导入组件库 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//unpkg.com/element-plus&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="jsDelivr"><a href="#jsDelivr" class="headerlink" title="jsDelivr"></a>jsDelivr</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 导入样式 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span></span></span><br><span class="line"><span class="tag">    <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">href</span>=<span class="string">&quot;//cdn.jsdelivr.net/npm/element-plus/dist/index.css&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 导入 Vue 3 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//cdn.jsdelivr.net/npm/vue@next&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 导入组件库 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//cdn.jsdelivr.net/npm/element-plus&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-快速开始"><a href="#2-快速开始" class="headerlink" title="2. 快速开始"></a>2. 快速开始</h2><p>本节将介绍如何在项目中使用 Element Plus。</p>
<h3 id="2-1-完整引入（全局引入）"><a href="#2-1-完整引入（全局引入）" class="headerlink" title="2.1 完整引入（全局引入）"></a>2.1 完整引入（全局引入）</h3><p>如果你对打包后的文件大小不是很在乎，那么使用完整导入会更方便。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ElementPlus <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-plus/dist/index.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = createApp(App)</span><br><span class="line"></span><br><span class="line">app.use(ElementPlus)</span><br><span class="line">app.mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="2-2-按需导入"><a href="#2-2-按需导入" class="headerlink" title="2.2 按需导入#"></a>2.2 按需导入<a href="https://element-plus.gitee.io/zh-CN/guide/quickstart.html#按需导入">#</a></h3><p>您需要使用额外的插件来导入要使用的组件。</p>
<h4 id="自动导入推荐"><a href="#自动导入推荐" class="headerlink" title="自动导入推荐#"></a>自动导入推荐<a href="https://element-plus.gitee.io/zh-CN/guide/quickstart.html#自动导入-推荐">#</a></h4><p>首先你需要安装<code>unplugin-vue-components</code> 和 <code>unplugin-auto-import</code>这两款插件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install -D unplugin-vue-components unplugin-auto-import</span><br></pre></td></tr></table></figure>
<p>然后把下列代码插入到你的 <code>Vite</code> 或 <code>Webpack</code> 的配置文件中</p>
<h5 id="Vite"><a href="#Vite" class="headerlink" title="Vite#"></a>Vite<a href="https://element-plus.gitee.io/zh-CN/guide/quickstart.html#vite">#</a></h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// vite.config.ts</span></span><br><span class="line"><span class="keyword">import</span> AutoImport <span class="keyword">from</span> <span class="string">&#x27;unplugin-auto-import/vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Components <span class="keyword">from</span> <span class="string">&#x27;unplugin-vue-components/vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ElementPlusResolver &#125; <span class="keyword">from</span> <span class="string">&#x27;unplugin-vue-components/resolvers&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    AutoImport(&#123;</span><br><span class="line">      <span class="attr">resolvers</span>: [ElementPlusResolver()],</span><br><span class="line">    &#125;),</span><br><span class="line">    Components(&#123;</span><br><span class="line">      <span class="attr">resolvers</span>: [ElementPlusResolver()],</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Webpack"><a href="#Webpack" class="headerlink" title="Webpack#"></a>Webpack<a href="https://element-plus.gitee.io/zh-CN/guide/quickstart.html#webpack">#</a></h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> AutoImport = <span class="built_in">require</span>(<span class="string">&#x27;unplugin-auto-import/webpack&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> Components = <span class="built_in">require</span>(<span class="string">&#x27;unplugin-vue-components/webpack&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; ElementPlusResolver &#125; = <span class="built_in">require</span>(<span class="string">&#x27;unplugin-vue-components/resolvers&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    AutoImport(&#123;</span><br><span class="line">      <span class="attr">resolvers</span>: [ElementPlusResolver()],</span><br><span class="line">    &#125;),</span><br><span class="line">    Components(&#123;</span><br><span class="line">      <span class="attr">resolvers</span>: [ElementPlusResolver()],</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>想了解更多打包 (<a href="https://rollupjs.org/">Rollup</a>, <a href="https://cli.vuejs.org/">Vue CLI</a>) 和配置工具，请参考 <a href="https://github.com/antfu/unplugin-vue-components#installation">unplugin-vue-components</a> 和 <a href="https://github.com/antfu/unplugin-auto-import#install">unplugin-auto-import</a>。</p>
<h3 id="2-3-手动导入"><a href="#2-3-手动导入" class="headerlink" title="2.3 手动导入#"></a>2.3 手动导入<a href="https://element-plus.gitee.io/zh-CN/guide/quickstart.html#手动导入">#</a></h3><p>Element Plus 提供了基于 ES Module 开箱即用的 <a href="https://webpack.js.org/guides/tree-shaking/">Tree Shaking</a> 功能。</p>
<p>但是你需要安装 <a href="https://github.com/element-plus/unplugin-element-plus">unplugin-element-plus</a> 来导入样式。 请参考 <a href="https://github.com/element-plus/unplugin-element-plus#readme">文档</a> 了解如何配置它。</p>
<blockquote>
<p>App.vue</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">el-button</span>&gt;</span>I am ElButton<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span></span><br><span class="line"><span class="javascript"><span class="xml">  <span class="keyword">import</span> &#123; ElButton &#125; <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="attr">components</span>: &#123; ElButton &#125;,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  &#125;</span></span></span><br><span class="line"><span class="javascript"><span class="xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="comment">// vite.config.ts</span></span><br><span class="line"><span class="keyword">import</span> ElementPlus <span class="keyword">from</span> <span class="string">&#x27;unplugin-element-plus/vite&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [ElementPlus()],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-组合式api"><a href="#3-组合式api" class="headerlink" title="3. 组合式api"></a>3. 组合式api</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><ul>
<li><p>通过创建 Vue 组件，我们可以将界面中重复的部分连同其功能一起提取为可重用的代码段。但是复杂的组件中的各种不同的功能还是耦合在一起，不方便维护和重用。</p>
</li>
<li><p>我们可以在组件中使用setup将组件中同类型的操作集中抽取到一起，方便将复杂的组件功能进行进一步的封装解耦。</p>
</li>
</ul>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>假设我们的应用中有一个显示某个用户的仓库列表的视图。此外，我们还希望有搜索和筛选功能。实现此视图组件的代码可能如下所示：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// src/components/UserRepositories.vue</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">components</span>: &#123; RepositoriesFilters, RepositoriesSortBy, RepositoriesList &#125;,</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">user</span>: &#123; </span><br><span class="line">      <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">repositories</span>: [], <span class="comment">// 1</span></span><br><span class="line">      <span class="attr">filters</span>: &#123; ... &#125;, <span class="comment">// 3</span></span><br><span class="line">      <span class="attr">searchQuery</span>: <span class="string">&#x27;&#x27;</span> <span class="comment">// 2</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">computed</span>: &#123;</span><br><span class="line">    filteredRepositories () &#123; ... &#125;, <span class="comment">// 3</span></span><br><span class="line">    repositoriesMatchingSearchQuery () &#123; ... &#125;, <span class="comment">// 2</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">watch</span>: &#123;</span><br><span class="line">    <span class="attr">user</span>: <span class="string">&#x27;getUserRepositories&#x27;</span> <span class="comment">// 1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    getUserRepositories () &#123;</span><br><span class="line">      <span class="comment">// 使用 `this.user` 获取用户仓库</span></span><br><span class="line">    &#125;, <span class="comment">// 1</span></span><br><span class="line">    updateFilters () &#123; ... &#125;, <span class="comment">// 3</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mounted () &#123;</span><br><span class="line">    <span class="built_in">this</span>.getUserRepositories() <span class="comment">// 1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该组件有以下几个职责：</p>
<ol>
<li>从假定的外部 API 获取该用户的仓库，并在用户有任何更改时进行刷新</li>
<li>使用 <code>searchQuery</code> 字符串搜索仓库</li>
<li>使用 <code>filters</code> 对象筛选仓库</li>
</ol>
<p>使用 (<code>data</code>、<code>computed</code>、<code>methods</code>、<code>watch</code>) 组件选项来组织逻辑通常都很有效。然而，当我们的组件开始变得更大时，<strong>逻辑关注点</strong>的列表也会增长。尤其对于那些一开始没有编写这些组件的人来说，这会导致组件难以阅读和理解。</p>
<p><img src="https://v3.cn.vuejs.org/images/options-api.png" alt="Vue 选项式 API: 按选项类型分组的代码"></p>
<p>这是一个大型组件的示例，其中<strong>逻辑关注点</strong>按颜色进行分组。</p>
<p>这种碎片化使得理解和维护复杂组件变得困难。选项的分离掩盖了潜在的逻辑问题。此外，在处理单个逻辑关注点时，我们必须不断地“跳转”相关代码的选项块。</p>
<p>如果能够将同一个逻辑关注点相关代码收集在一起会更好。而这正是组合式 API 使我们能够做到的。</p>
<ul>
<li><p><code>setup</code> 选项在组件创建<strong>之前</strong>执行，一旦 <code>props</code> 被解析，就将作为组合式 API 的入口。</p>
</li>
<li><p>setup中可以 通过return{}将其中定义的参数返回，<code>setup</code> 返回的所有内容都暴露给组件的其余部分 (计算属性、方法、生命周期钩子等等) 以及组件的模板。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// src/components/UserRepositories.vue</span></span><br><span class="line"><span class="keyword">import</span> &#123; toRefs &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> useUserRepositories <span class="keyword">from</span> <span class="string">&#x27;@/composables/useUserRepositories&#x27;</span></span><br><span class="line"><span class="keyword">import</span> useRepositoryNameSearch <span class="keyword">from</span> <span class="string">&#x27;@/composables/useRepositoryNameSearch&#x27;</span></span><br><span class="line"><span class="keyword">import</span> useRepositoryFilters <span class="keyword">from</span> <span class="string">&#x27;@/composables/useRepositoryFilters&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">components</span>: &#123; RepositoriesFilters, RepositoriesSortBy, RepositoriesList &#125;,</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">user</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">setup</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; user &#125; = toRefs(props)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; repositories, getUserRepositories &#125; = useUserRepositories(user)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      searchQuery,</span><br><span class="line">      repositoriesMatchingSearchQuery</span><br><span class="line">    &#125; = useRepositoryNameSearch(repositories)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      filters,</span><br><span class="line">      updateFilters,</span><br><span class="line">      filteredRepositories</span><br><span class="line">    &#125; = useRepositoryFilters(repositoriesMatchingSearchQuery)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">// 因为我们并不关心未经过滤的仓库</span></span><br><span class="line">      <span class="comment">// 我们可以在 `repositories` 名称下暴露过滤后的结果</span></span><br><span class="line">      <span class="attr">repositories</span>: filteredRepositories,</span><br><span class="line">      getUserRepositories,</span><br><span class="line">      searchQuery,</span><br><span class="line">      filters,</span><br><span class="line">      updateFilters</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>vue</category>
      </categories>
      <tags>
        <tag>vue</tag>
        <tag>vue组件库</tag>
      </tags>
  </entry>
  <entry>
    <title>fileUpload</title>
    <url>/2022/03/11/fileUpload/</url>
    <content><![CDATA[<h1 id="web项目文件上传"><a href="#web项目文件上传" class="headerlink" title="web项目文件上传"></a>web项目文件上传</h1><h3 id="1-需要用到的类详解"><a href="#1-需要用到的类详解" class="headerlink" title="1. 需要用到的类详解"></a>1. 需要用到的类详解</h3><p>​    ServletFileUpload负责处理上传的文件数据,并将表单中每个输入项封装成一个Fileltem对象，在使用ServletFileUpload对象解析请求时需要DiskFileltemFactory对象。</p>
<p>​    所以，我们需要在进行解析工作前构造好DiskFileltemFactory对象，通过ServletFileUpload对象的构造方法或setFileltemFactory()方法设置ServletFileUpload对象的fileltemFactory属性。</p>
<h3 id="2-FileItem类"><a href="#2-FileItem类" class="headerlink" title="2. FileItem类"></a>2. FileItem类</h3><p>如果表单包含一个文件上传，则这个表单的enctype属性必须设置为mutipart/form-data </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-具体操作"><a href="#3-具体操作" class="headerlink" title="3. 具体操作"></a>3. 具体操作</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//1.判断上传表单是普通表单还是文件表单</span></span><br><span class="line">        <span class="keyword">if</span>(!ServletFileUpload.isMultipartContent(request))&#123;</span><br><span class="line">            <span class="keyword">return</span>;<span class="comment">//普通表单则之间返回</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//2.创建上传文件保存路径，建议放在web-inf文件下，外界无法访问</span></span><br><span class="line">        String uploadPath = <span class="keyword">this</span>.getServletContext().getRealPath(<span class="string">&quot;/WEB-INF/upload&quot;</span>);</span><br><span class="line">        File uploadFile = <span class="keyword">new</span> File(uploadPath);</span><br><span class="line">        <span class="keyword">if</span>(!uploadFile.exists())&#123;</span><br><span class="line">            uploadFile.mkdir();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//缓存，临时文件</span></span><br><span class="line">        <span class="comment">//临时路径，假如文件超过了预期大小，我们就将其放到一个临时文件中</span></span><br><span class="line">        <span class="comment">//临时文件过几天自动删除，或者提醒用户保存</span></span><br><span class="line">        String tmpPath = <span class="keyword">this</span>.getServletContext().getRealPath(<span class="string">&quot;/WEB-INF/tmp&quot;</span>);</span><br><span class="line">        File tmpFile = <span class="keyword">new</span> File(tmpPath);</span><br><span class="line">        <span class="keyword">if</span>(!tmpFile.exists())&#123;</span><br><span class="line">            tmpFile.mkdir();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//处理上传文件，一般都需要通过流来获取，我们可以使用request.getInputStream()获取</span></span><br><span class="line">        <span class="comment">//但是建议使用common-fileupload，他需要commons-io包</span></span><br><span class="line">        <span class="comment">//1. 创建DiskFileItemFactory对象，处理文件上传路径或者大小限制</span></span><br><span class="line">        DiskFileItemFactory factory = <span class="keyword">new</span> DiskFileItemFactory();</span><br><span class="line">        <span class="comment">//1.1 通过工厂设置缓冲区，当上传文件大于缓冲区，会存储到临时文件目录中</span></span><br><span class="line">        factory.setSizeThreshold(<span class="number">1024</span>*<span class="number">1024</span>);<span class="comment">//1M</span></span><br><span class="line">        factory.setRepository(tmpFile);<span class="comment">//设置临时保存目录</span></span><br><span class="line">        <span class="comment">//2. 获取servletFileUpload</span></span><br><span class="line">        ServletFileUpload fup = <span class="keyword">new</span> ServletFileUpload(factory);</span><br><span class="line">        <span class="comment">//2.1 监听文件上传进度</span></span><br><span class="line">        fup.setProgressListener(<span class="keyword">new</span> ProgressListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="comment">//pBytesRead:以及读取到的文件大小</span></span><br><span class="line">            <span class="comment">//pContentLength:文件大小</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">long</span> pBytesRead, <span class="keyword">long</span> pContentLength, <span class="keyword">int</span> pItems)</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;总大小：&quot;</span>+pContentLength+<span class="string">&quot;已上传：&quot;</span>+pBytesRead);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//2.2 处理乱码问题</span></span><br><span class="line">        fup.setHeaderEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">//2.3 设置单个文件的最大值</span></span><br><span class="line">        fup.setFileSizeMax(<span class="number">1024</span>*<span class="number">1024</span>*<span class="number">10</span>);<span class="comment">//10M</span></span><br><span class="line">        <span class="comment">//2.4 设置总共能够上传的文件大小</span></span><br><span class="line">        fup.setSizeMax(<span class="number">1024</span>*<span class="number">1024</span>*<span class="number">10</span>);<span class="comment">//10M</span></span><br><span class="line">        <span class="comment">//3. 处理上传文件</span></span><br><span class="line">        <span class="comment">//3.1 把前端请求封装为FileItem 对象</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;FileItem&gt; fileItems = fup.parseRequest(request);</span><br><span class="line">            <span class="keyword">for</span> (FileItem fileItem : fileItems) &#123;</span><br><span class="line">                <span class="comment">//3.2 判断是文件还是普通表单</span></span><br><span class="line">                <span class="keyword">if</span>(fileItem.isFormField())&#123;</span><br><span class="line">                    <span class="comment">//getFieldName是表单的name属性</span></span><br><span class="line">                    String fieldName = fileItem.getFieldName();</span><br><span class="line">                    <span class="comment">//获取值并处理乱码</span></span><br><span class="line">                    String value = fileItem.getString(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">                    System.out.println(fieldName+<span class="string">&quot;:&quot;</span>+value);</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;<span class="comment">//如果是文件</span></span><br><span class="line">                    <span class="comment">//3.3 ======处理文件=========</span></span><br><span class="line">                    String uploadFName = fileItem.getName();</span><br><span class="line">                    <span class="comment">//3.3.1 判断文件路径名是否合法</span></span><br><span class="line">                    <span class="keyword">if</span>(uploadFName.trim().equals(<span class="string">&quot;&quot;</span>)||uploadFName==<span class="keyword">null</span>)&#123;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//3.3.2 获取上传文件名(将url处理为文件名和扩展名)</span></span><br><span class="line">                    String FileName = uploadFName.substring(uploadFName.lastIndexOf(<span class="string">&quot;/&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">                    String FileExtName = uploadFName.substring(uploadFName.lastIndexOf(<span class="string">&quot;.&quot;</span>) + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//3.4 ======存放地址=========</span></span><br><span class="line">                    <span class="comment">//3.4.1 保证文件名唯一（UUID.randomUUID）</span></span><br><span class="line">                    UUID uuid = UUID.randomUUID();</span><br><span class="line">                    <span class="comment">//3.4.2 拼接文件存储路径</span></span><br><span class="line">                    String realPath = uploadPath+<span class="string">&quot;/&quot;</span>+uuid;</span><br><span class="line">                    File saveDir = <span class="keyword">new</span> File(realPath);</span><br><span class="line">                    <span class="keyword">if</span>(!saveDir.exists())&#123;</span><br><span class="line">                        saveDir.mkdir();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//3.5 ======文件传输=========</span></span><br><span class="line">                    <span class="comment">//3.5.1 获取文件上传流</span></span><br><span class="line">                    InputStream is = fileItem.getInputStream();</span><br><span class="line">                    FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(saveDir + <span class="string">&quot;/&quot;</span> + FileName);</span><br><span class="line">                    <span class="comment">//3.5.2 将文件存入saveDir</span></span><br><span class="line">                    <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span> * <span class="number">1024</span>];</span><br><span class="line">                    <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">while</span>((len=is.read(buffer))&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                        fos.write(buffer,<span class="number">0</span>,len);</span><br><span class="line">                    &#125;</span><br><span class="line">                    fos.close();</span><br><span class="line">                    is.close();</span><br><span class="line">                    fileItem.delete();<span class="comment">//文件上传成功，清除临时文件</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-封装为方法"><a href="#4-封装为方法" class="headerlink" title="4. 封装为方法"></a>4. 封装为方法</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DiskFileItemFactory <span class="title">getDiskFileItemFactory</span><span class="params">(File tmpfile)</span></span>&#123;</span><br><span class="line">        <span class="comment">//1. 创建DiskFileItemFactory对象，处理文件上传路径或者大小限制</span></span><br><span class="line">        DiskFileItemFactory factory = <span class="keyword">new</span> DiskFileItemFactory();</span><br><span class="line">        <span class="comment">//1.1 通过工厂设置缓冲区，当上传文件大于缓冲区，会存储到临时文件目录中</span></span><br><span class="line">        factory.setSizeThreshold(<span class="number">1024</span>*<span class="number">1024</span>);<span class="comment">//1M</span></span><br><span class="line">        factory.setRepository(tmpfile);<span class="comment">//设置临时保存目录</span></span><br><span class="line">        <span class="keyword">return</span> factory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ServletFileUpload <span class="title">getServletFileUpload</span><span class="params">(DiskFileItemFactory factory)</span></span>&#123;</span><br><span class="line">        ServletFileUpload upload = <span class="keyword">new</span> ServletFileUpload(factory);</span><br><span class="line">        upload.setProgressListener(<span class="keyword">new</span> ProgressListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="comment">//pBytesRead:以及读取到的文件大小</span></span><br><span class="line">            <span class="comment">//pContentLength:文件大小</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">long</span> pBytesRead, <span class="keyword">long</span> pContentLength, <span class="keyword">int</span> pItems)</span> </span>&#123;</span><br><span class="line"><span class="comment">//                System.out.println(&quot;总大小：&quot;+pContentLength+&quot;已上传：&quot;+pBytesRead);</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//2.2 处理乱码问题</span></span><br><span class="line">        upload.setHeaderEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">//2.3 设置单个文件的最大值</span></span><br><span class="line">        upload.setFileSizeMax(<span class="number">1024</span>*<span class="number">1024</span>*<span class="number">10</span>);<span class="comment">//10M</span></span><br><span class="line">        <span class="comment">//2.4 设置总共能够上传的文件大小</span></span><br><span class="line">        upload.setSizeMax(<span class="number">1024</span>*<span class="number">1024</span>*<span class="number">10</span>);<span class="comment">//10M</span></span><br><span class="line">        <span class="keyword">return</span> upload;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">uploadParseRequest</span><span class="params">(ServletFileUpload upload,HttpServletRequest request,String uploadPath)</span></span>&#123;</span><br><span class="line">        String msg = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="comment">//3. 处理上传文件</span></span><br><span class="line">        <span class="comment">//3.1 把前端请求封装为FileItem 对象</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;FileItem&gt; fileItems = upload.parseRequest(request);</span><br><span class="line">            <span class="keyword">for</span> (FileItem fileItem : fileItems) &#123;</span><br><span class="line">                <span class="comment">//3.2 判断是文件还是普通表单</span></span><br><span class="line">                <span class="keyword">if</span>(fileItem.isFormField())&#123;</span><br><span class="line">                    <span class="comment">//getFieldName是表单的name属性</span></span><br><span class="line">                    String fieldName = fileItem.getFieldName();</span><br><span class="line">                    <span class="comment">//获取值并处理乱码</span></span><br><span class="line">                    String value = fileItem.getString(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">                    System.out.println(fieldName+<span class="string">&quot;:&quot;</span>+value);</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;<span class="comment">//如果是文件</span></span><br><span class="line">                    <span class="comment">//3.3 ======处理文件=========</span></span><br><span class="line">                    String uploadFName = fileItem.getName();</span><br><span class="line">                    <span class="comment">//3.3.1 判断文件路径名是否合法</span></span><br><span class="line">                    <span class="keyword">if</span>(uploadFName.trim().equals(<span class="string">&quot;&quot;</span>)||uploadFName==<span class="keyword">null</span>)&#123;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//3.3.2 获取上传文件名(将url处理为文件名和扩展名)</span></span><br><span class="line">                    String FileName = uploadFName.substring(uploadFName.lastIndexOf(<span class="string">&quot;/&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">                    String FileExtName = uploadFName.substring(uploadFName.lastIndexOf(<span class="string">&quot;.&quot;</span>) + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//3.4 ======存放地址=========</span></span><br><span class="line">                    <span class="comment">//3.4.1 保证文件名唯一（UUID.randomUUID）</span></span><br><span class="line">                    UUID uuid = UUID.randomUUID();</span><br><span class="line">                    <span class="comment">//3.4.2 拼接文件存储路径</span></span><br><span class="line">                    String realPath = uploadPath+<span class="string">&quot;/&quot;</span>+uuid;</span><br><span class="line">                    File saveDir = <span class="keyword">new</span> File(realPath);</span><br><span class="line">                    <span class="keyword">if</span>(!saveDir.exists())&#123;</span><br><span class="line">                        saveDir.mkdir();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//3.5 ======文件传输=========</span></span><br><span class="line">                    <span class="comment">//3.5.1 获取文件上传流</span></span><br><span class="line">                    InputStream is = fileItem.getInputStream();</span><br><span class="line">                    FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(saveDir + <span class="string">&quot;/&quot;</span> + FileName);</span><br><span class="line">                    <span class="comment">//3.5.2 将文件存入saveDir</span></span><br><span class="line">                    <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span> * <span class="number">1024</span>];</span><br><span class="line">                    <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">while</span>((len=is.read(buffer))&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                        fos.write(buffer,<span class="number">0</span>,len);</span><br><span class="line">                    &#125;</span><br><span class="line">                    fos.close();</span><br><span class="line">                    is.close();</span><br><span class="line">                    fileItem.delete();<span class="comment">//文件上传成功，清除临时文件</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        msg = <span class="string">&quot;上传成功&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-ajax实现进度条"><a href="#5-ajax实现进度条" class="headerlink" title="5. ajax实现进度条"></a>5. ajax实现进度条</h3><p>前端：点击事件后，通过导入ajax.form.js的ajaxSubmit（）方法异步的提交表单信息，并开启定时器，在其中定时的与后端发送ajax请求，获取上传进度信息，改变当前进度条状态。并在进度到100%时清除定时器</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;%--</span><br><span class="line">  Created by IntelliJ IDEA.</span><br><span class="line">  User: 天罡剑f</span><br><span class="line">  Date: 2022/3/11</span><br><span class="line">  Time: 16:17</span><br><span class="line">  To change this template use File | Settings | File Templates.</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;</span><br><span class="line">&lt;%@taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>fileUpload<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./resources/js/jquery-3.4.1.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./resources/js/jquery.form.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./resources/js/bootstrap.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./resources/css/bootstrap.min.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">&quot;#upButton&quot;</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> startID;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#jindu&quot;</span>).show();</span></span><br><span class="line"><span class="javascript">            startID = <span class="built_in">setInterval</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                $.get(<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/uploadPro&quot;</span>,<span class="literal">null</span>,<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    $(<span class="string">&quot;#processRow&quot;</span>).attr(<span class="string">&quot;aria-valuenow&quot;</span>,data);</span></span><br><span class="line"><span class="javascript">                    $(<span class="string">&quot;#processRow&quot;</span>).css(<span class="string">&quot;width&quot;</span>,data+<span class="string">&quot;%&quot;</span>);</span></span><br><span class="line"><span class="javascript">                    $(<span class="string">&quot;#processRow&quot;</span>).html(data);</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">if</span> (<span class="built_in">Number</span>(data)==<span class="number">100</span>)&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">clearInterval</span>(startID);</span></span><br><span class="line"><span class="javascript">                    &#125;</span></span><br><span class="line"><span class="javascript">                &#125;,<span class="string">&quot;text&quot;</span>);</span></span><br><span class="line"><span class="javascript">            &#125;,<span class="number">500</span>);</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#fileUp&quot;</span>).ajaxSubmit(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">// alert(&quot;提交成功2&quot;);</span></span></span><br><span class="line"><span class="javascript">             &#125;);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript">        &#125;);</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>文件上传<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/fileUpload&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span> <span class="attr">id</span>=<span class="string">&quot;fileUp&quot;</span>&gt;</span></span><br><span class="line">    &lt;%--<span class="tag">&lt;<span class="name">div</span>&gt;</span>--%&gt;</span><br><span class="line">        &lt;%--上传用户：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span>--%&gt;</span><br><span class="line">    &lt;%--<span class="tag">&lt;/<span class="name">div</span>&gt;</span>--%&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;file1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;upButton&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;progress&quot;</span>  <span class="attr">id</span>=<span class="string">&quot;jindu&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;progress-bar&quot;</span> <span class="attr">id</span>=<span class="string">&quot;processRow&quot;</span> <span class="attr">role</span>=<span class="string">&quot;progressbar&quot;</span> <span class="attr">aria-valuenow</span>=<span class="string">&quot;0&quot;</span> <span class="attr">aria-valuemin</span>=<span class="string">&quot;0&quot;</span> <span class="attr">aria-valuemax</span>=<span class="string">&quot;100&quot;</span> <span class="attr">style</span>=<span class="string">&quot;min-width: 2em;&quot;</span>&gt;</span></span><br><span class="line">        0%</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>后端：发送上传进度信息</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lixu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-03-11-19:28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(name = &quot;uploadProServlet&quot;,urlPatterns = &#123;&quot;/uploadPro&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">uploadProServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(request.getSession().getAttribute(<span class="string">&quot;filePer&quot;</span>)!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">long</span> filePer = (<span class="keyword">long</span>)request.getSession().getAttribute(<span class="string">&quot;filePer&quot;</span>);</span><br><span class="line">            request.setAttribute(<span class="string">&quot;filePer&quot;</span>,filePer);</span><br><span class="line">            response.getWriter().write(filePer+<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            response.getWriter().write(<span class="string">&quot;100&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>javaweb</category>
      </categories>
      <tags>
        <tag>fileUpload</tag>
      </tags>
  </entry>
  <entry>
    <title>filterAndListener</title>
    <url>/2021/12/31/filterAndListener/</url>
    <content><![CDATA[<h3 id="一、filter过滤器"><a href="#一、filter过滤器" class="headerlink" title="一、filter过滤器"></a>一、filter过滤器</h3><p>概念：</p>
<p>web中的过滤器:当访问服务器的资源时，过滤器可以将请求拦截下来，完成一些特殊的功能。</p>
<p>过滤器的作用:</p>
<ul>
<li>一般用于完成通用的操作。如∶登录验证、统一编码处理、敏感字符过滤…</li>
</ul>
<h5 id="1-快速入门"><a href="#1-快速入门" class="headerlink" title="1. 快速入门"></a>1. 快速入门</h5><p>步骤:</p>
<p>1．定义一个类，实现接口Filter</p>
<p>2．复写方法</p>
<p>3．配置拦截路径</p>
<ol>
<li>web.xml</li>
<li>注解</li>
</ol>
<p>代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebFilter(filterName = &quot;AllFilter&quot;,urlPatterns = &#123;&quot;/*&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AllFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest req, ServletResponse resp, FilterChain chain)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//放行</span></span><br><span class="line">        chain.doFilter(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig config)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-过滤器细节"><a href="#2-过滤器细节" class="headerlink" title="2. 过滤器细节"></a>2. 过滤器细节</h5><ol>
<li><p>web.xml配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span><span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span><span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span><span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span><span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol>
<li><p>过滤器执行流程<br>1．执行过滤器<br>2．执行放行后的资源<br>3．回来执行过滤器放行代码下边的代码</p>
</li>
<li><p>过滤器生命周期方法</p>
<ol>
<li>init: 在服务器启动后，会创建Filter对象，然后调用init方法。只执行一次。用于加载资源</li>
<li><p>doFilter:每一次请求被拦截资源时，会执行。执行多次</p>
</li>
<li><p>destroy: 在服务器关闭后，Filter对象被销毁。如果服务器是正常关闭，则会执行destroy方法。只执行<br>-次。用于释放资源</p>
</li>
</ol>
</li>
<li><p>过滤器配置详解</p>
<ul>
<li><p>拦截路径配置：</p>
<ol>
<li>具体资源路径：/index.jsp       只有访问index.jsp资源时，过滤器才会被执行。</li>
<li>目录拦截：/user/*                    访问/user下所有的资源时，过滤器都会被执行</li>
<li>后缀名拦截：*.jsp                     访问所有后缀名为.jsp 的资源</li>
<li>拦截所有资源：/*                       访问所有资源时，过滤器都会被执行</li>
</ol>
</li>
<li><p>拦截方式配置：资源被访问的方式</p>
<ol>
<li><p>注解配置：</p>
<ul>
<li>设置dispatcherTypes 属性（可以配置多个值）<ol>
<li>REQUEST: 默认值。表示浏览器直接请求资源</li>
<li>FORWARD: 转发访问资源</li>
<li>INCLUDE: 包含访问资源</li>
<li>ERROR: 错误跳转</li>
<li>ASYNC: 异步访问</li>
</ol>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebFilter(filterName = &quot;AllFilter&quot;,urlPatterns = &#123;&quot;/*&quot;&#125;,dispatcherTypes = &#123;DispatcherType.REQUEST,DispatcherType.FORWARD&#125;)</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>web.xml注解</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span><span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span><span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span><span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span><span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dispatcher</span>&gt;</span><span class="tag">&lt;/<span class="name">dispatcher</span>&gt;</span>         ！！！</span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
</li>
<li><p>过滤器链（配置多个过滤器）</p>
<p><strong>重点关注执行顺序</strong></p>
<ul>
<li>如果有两个过滤器1和2（如果1先执行）<ol>
<li>执行过滤器1</li>
<li>执行过滤器2</li>
<li>执行资源</li>
<li>执行过滤器2</li>
<li>执行过滤器1</li>
</ol>
</li>
<li>执行先后关系：<ol>
<li>注解配置：按照类名的字符串比较规则比较，值小的先执行<ul>
<li>eg: AFilter 和 BFilter , AFilter 先执行</li>
</ul>
</li>
<li>web.xml配置：谁配置在上面谁先执行</li>
</ol>
</li>
</ul>
</li>
</ol>
</li>
</ol>
<h5 id="案例1-：-登录验证"><a href="#案例1-：-登录验证" class="headerlink" title="案例1 ： 登录验证"></a>案例1 ： 登录验证</h5><p>需求：</p>
<ol>
<li>访问资源验证其是否登录</li>
<li>登录则放行</li>
<li>没有登陆则跳转登录界面</li>
</ol>
<h5 id="案例2：敏感词汇过滤"><a href="#案例2：敏感词汇过滤" class="headerlink" title="案例2：敏感词汇过滤"></a>案例2：敏感词汇过滤</h5><p>需求：</p>
<ol>
<li>对录入数据进行敏感词替换过滤</li>
<li>根据敏感词字典判断是否为敏感词汇</li>
<li>是则替换为*</li>
</ol>
<p>！！！注意：request对象没有setParameter方法，因此无法直接进行操作</p>
<p><strong>方法：对request进行增强</strong></p>
<p><img src="/2021/12/31/filterAndListener/1.png" alt></p>
<p>增强对象功能：</p>
<ul>
<li><p>设计模式</p>
<ol>
<li><p>装饰模式</p>
</li>
<li><p>代理模式</p>
<p>概念：</p>
<ol>
<li>真实对象：</li>
<li>代理对象：</li>
<li>代理模式：代理真实对象，达到增强真实对象功能的目的</li>
</ol>
<p>实现方式：</p>
<ol>
<li><p>静态代理：有一个类文件描述代理模式</p>
</li>
<li><p>动态代理：在内存中形成代理</p>
<ul>
<li><p>实现步骤：</p>
<ol>
<li><p>代理对象和真实对象实现相同接口</p>
</li>
<li><p>代理对象 = Proxy.newProxyInstance();</p>
</li>
<li><p>使用代理对象调用方法</p>
</li>
<li><p>增强方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建真实对象</span></span><br><span class="line">        legion l= <span class="keyword">new</span> legion();</span><br><span class="line">        <span class="comment">//创建代理对象</span></span><br><span class="line">        <span class="comment">/*  Proxy.newProxyInstance()</span></span><br><span class="line"><span class="comment">        * 1.类加载器：真实对象.getClass().getClassLoader()</span></span><br><span class="line"><span class="comment">        * 2.接口数组：真实对象.getClass().getInterfaces()</span></span><br><span class="line"><span class="comment">        * 3.处理器：new InvocationHandler()</span></span><br><span class="line"><span class="comment">        *</span></span><br><span class="line"><span class="comment">        * */</span></span><br><span class="line">        saleComputer s = (saleComputer) Proxy.newProxyInstance(l.getClass().getClassLoader(), 			l.getClass().getInterfaces(), <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">            <span class="comment">//代理对象调用的所有方法都会触发该方法执行</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                *  1. proxy：一般不用</span></span><br><span class="line"><span class="comment">                *  2. method：代理对象调用的方法，被封装为对象</span></span><br><span class="line"><span class="comment">                *  3. args: 代理对象调用方法，传递的实际参数</span></span><br><span class="line"><span class="comment">                * */</span></span><br><span class="line">                String name = method.getName();</span><br><span class="line">                System.out.println(name);</span><br><span class="line">                <span class="comment">//使用真实对象调用该方法</span></span><br><span class="line">                Object invoke = method.invoke(l, args);</span><br><span class="line">                <span class="keyword">return</span> invoke;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        s.sale(<span class="number">98989</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
</li>
</ol>
</li>
</ol>
</li>
</ul>
<h3 id="二、listener监听器"><a href="#二、listener监听器" class="headerlink" title="二、listener监听器"></a>二、listener监听器</h3><h6 id="概念：web三大组件之一"><a href="#概念：web三大组件之一" class="headerlink" title="概念：web三大组件之一"></a>概念：web三大组件之一</h6><ul>
<li><p>事件监听机制</p>
<ul>
<li>事件：一件事情</li>
<li>事件源： 事件发生的地方</li>
<li>监听器： 一个对象</li>
<li>注册监听：将事件，事件源，监听器绑定在一起。当事件源上发生某个事件后，执行监听器代码。</li>
</ul>
</li>
<li><p>servletContextListener(监听器接口):</p>
<ul>
<li>void contextDestroyed(ServletContextEvent sce) : ServletContext对象被销毁之前会调用该方法</li>
<li>void contextInitialized(ServletContextEvent sce) : ServletContext对象创建后会调用该方法</li>
<li>通过servletContextEvent来获取servletContext</li>
</ul>
</li>
<li><p>步骤：</p>
<ol>
<li>定义一个类，实现ServletContextListener接口</li>
<li>复写方法</li>
<li><p>配置</p>
<ol>
<li><p>web.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>类路径<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">* 指定初始化参数</span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param-name</span>&gt;</span><span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param-value</span>&gt;</span><span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>注解：</p>
<ul>
<li>@WebListener</li>
</ul>
</li>
</ol>
</li>
</ol>
</li>
</ul>
]]></content>
      <categories>
        <category>servlet</category>
      </categories>
      <tags>
        <tag>filter</tag>
        <tag>listener</tag>
      </tags>
  </entry>
  <entry>
    <title>git_idea</title>
    <url>/2022/02/25/git-idea/</url>
    <content><![CDATA[<h1 id="在idea中使用git"><a href="#在idea中使用git" class="headerlink" title="在idea中使用git"></a>在idea中使用git</h1><h2 id="一、idea集成git"><a href="#一、idea集成git" class="headerlink" title="一、idea集成git"></a>一、idea集成git</h2><ol>
<li><p>点击file—-&gt;settings—-&gt;version control，选择git</p>
<p><img src="/2022/02/25/git-idea/1.png" alt></p>
</li>
<li><p>选择git安装目录</p>
</li>
</ol>
<p>​        <img src="/2022/02/25/git-idea/2.png" alt></p>
<h2 id="二、本地库初始化"><a href="#二、本地库初始化" class="headerlink" title="二、本地库初始化"></a>二、本地库初始化</h2><ol>
<li>点击vcs </li>
</ol>
<p>​    <img src="/2022/02/25/git-idea/3.png" alt></p>
<p>​    <img src="/2022/02/25/git-idea/4.png" alt></p>
<h2 id="三、idea使用git"><a href="#三、idea使用git" class="headerlink" title="三、idea使用git"></a>三、idea使用git</h2><ol>
<li><p>对java项目进行本地库初始化</p>
</li>
<li><p>新建文件后idea会提示是否add（如果add则文件颜色变绿）</p>
<p><img src="/2022/02/25/git-idea/5.png" alt></p>
</li>
<li><p>新建模块或者文件后，右键文件选择git，选择add</p>
<p><img src="/2022/02/25/git-idea/6.png" alt></p>
</li>
<li><p>再次右键，选择commit </p>
<p><img src="/2022/02/25/git-idea/7.png" alt></p>
</li>
<li><p>选择需要提交的文件，添加commit注释</p>
<p><img src="/2022/02/25/git-idea/8.png" alt></p>
<p><img src="/2022/02/25/git-idea/9.png" alt></p>
</li>
<li><p>修改文件后，文件变蓝，add后，commit</p>
<p><img src="/2022/02/25/git-idea/10.png" alt></p>
</li>
</ol>
<h2 id="四、idea与远程库交互"><a href="#四、idea与远程库交互" class="headerlink" title="四、idea与远程库交互"></a>四、idea与远程库交互</h2><h3 id="1-关联本地库与远程库"><a href="#1-关联本地库与远程库" class="headerlink" title="1. 关联本地库与远程库"></a>1. 关联本地库与远程库</h3><ol>
<li><p>关联本地库与远程库</p>
<p>git pull [远程库ssh/url/别名] [分支] —allow-unrelated-histories </p>
<ul>
<li>如果出错，则git reset (清除暂存区的数据)</li>
</ul>
</li>
</ol>
<p>​    <img src="/2022/02/25/git-idea/11.png" style="zoom:150%;"></p>
<ol>
<li><p>添加备注(i:insert,esc,:wq)操作同vim</p>
<p><img src="/2022/02/25/git-idea/12.png" alt></p>
</li>
<li><p>重新推送到GitHub远程库</p>
<p> git push -u [远程库] master -f</p>
<p><img src="/2022/02/25/git-idea/13.png" alt></p>
</li>
<li><p>回到idea进行操作</p>
</li>
</ol>
<h3 id="2-在idea中进行推送"><a href="#2-在idea中进行推送" class="headerlink" title="2. 在idea中进行推送"></a>2. 在idea中进行推送</h3><ol>
<li><p>修改idea中与远程库关联的工作区文件</p>
</li>
<li><p>提交工作区修改的文件到本地库</p>
</li>
<li><p>提交本地库文件到远程库</p>
<p><img src="/2022/02/25/git-idea/14.png" alt></p>
</li>
<li><p>点击定义远程库（初始化远程库信息）</p>
<p><img src="/2022/02/25/git-idea/15.png" alt></p>
</li>
<li><p>点击push</p>
<p><img src="/2022/02/25/git-idea/16.png" alt></p>
</li>
<li><p>在以上步骤完成后，以后的修改提交到远程库可以一步完成（一般不建议）</p>
<p><img src="/2022/02/25/git-idea/17.png" alt></p>
</li>
</ol>
<ul>
<li>！！！之后在修改文件后，一般先pull拉取，确认无冲突后，再进行push操作</li>
</ul>
<h2 id="五、流程"><a href="#五、流程" class="headerlink" title="五、流程"></a>五、流程</h2><h3 id="1-一般流程"><a href="#1-一般流程" class="headerlink" title="1. 一般流程"></a>1. 一般流程</h3><ol>
<li><p>idea新建直接clone远程仓库</p>
<p><img src="/2022/02/25/git-idea/18.png" alt></p>
</li>
<li><p>点击test测试链接</p>
<p><img src="/2022/02/25/git-idea/19.png" alt></p>
</li>
<li><p>点击clone</p>
<ul>
<li>此时项目即是仓库又是idea工作空间</li>
</ul>
</li>
</ol>
<h2 id="六、冲突解决"><a href="#六、冲突解决" class="headerlink" title="六、冲突解决"></a>六、冲突解决</h2><h3 id="1-场景描述"><a href="#1-场景描述" class="headerlink" title="1. 场景描述"></a>1. 场景描述</h3><ol>
<li><p>A和B同时开发一个项目，都和远程仓库c进行了关联</p>
</li>
<li><p>A添加1.txt第一行，push到c</p>
</li>
<li><p>B也添加了1.txt第一行，此时使用idea push产生冲突</p>
<p><img src="/2022/02/25/git-idea/20.png" alt></p>
</li>
<li><p>进行合并操作merge</p>
<p><img src="/2022/02/25/git-idea/21.png" alt></p>
</li>
<li><p>显示冲突信息，判断如何处理冲突</p>
<p><img src="/2022/02/25/git-idea/22.png" alt></p>
<ul>
<li><p>accept yours :使用你的版本</p>
</li>
<li><p>accept Theirs:使用它们的</p>
</li>
<li><p>Merge</p>
<p><img src="/2022/02/25/git-idea/23.png" alt></p>
</li>
</ul>
</li>
<li><p>合并后再进行push</p>
</li>
</ol>
]]></content>
      <categories>
        <category>git</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2021/09/24/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo基础命令</tag>
      </tags>
  </entry>
  <entry>
    <title>html-1</title>
    <url>/2021/11/21/html-1/</url>
    <content><![CDATA[<h1 id="html常用标签整理"><a href="#html常用标签整理" class="headerlink" title="html常用标签整理"></a>html常用标签整理</h1><h3 id="html文档结构"><a href="#html文档结构" class="headerlink" title="html文档结构"></a>html文档结构</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"> 1 <span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span> </span><br><span class="line"> 2 <span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span>   #这个lang表示语言，zh-CN中文的意思，整个文档的内容以中文为主，如果以英文为主，就写成lang=&#x27;en&#x27;</span><br><span class="line"> 3 </span><br><span class="line"> 4 <span class="tag">&lt;<span class="name">head</span>&gt;</span> </span><br><span class="line"> 5   <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"> 6   <span class="tag">&lt;<span class="name">title</span>&gt;</span>css样式优先级<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"> 7 <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> 8 <span class="tag">&lt;<span class="name">body</span>&gt;</span> </span><br><span class="line"> 9 </span><br><span class="line">10 <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">11 <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>1.&lt;!doctype html&gt;声明为html5文件，必须是html文档的第一行，在<html>标签之前;</html></p>
<p>2.<html>、</html>是文档开始和结束的标记,是HTML页面的根元素，在它们之间是文档的头部（head）和主体（body);</p>
<p>3.<head>、</head>定义HTML文档开头部分,内容不会在浏览器窗口显示,包含文档元（meta）数据，配置信息等，是给浏览器看的;</p>
<p>4.<title>、</title>定义了网页标题，在浏览器标题栏显示（修改一下title中的内容，然后看一下浏览器，你就会发现title是什么了）;</p>
<p>5.<body>、</body>之间的内容是可见的网页主体内容;</p>
<p>注意：中文网页需要使用 <meta charset="utf-8"> 声明编码，否则会出现乱码;有些浏览器是gbk，需手动设置为 <meta charset="gbk">；</p>
<h3 id="html标签格式"><a href="#html标签格式" class="headerlink" title="html标签格式"></a>html标签格式</h3><p>1.html标签是由尖括号包围的关键字，如：<html>,<div>,<span>等;</span></div></html></p>
<p>2.html标签通常是成对出现，如：<div></div>,第一个是开始，第二个有斜线的是结束；</p>
<p>3.有些标签是单独呈现的，如：<br> <hr></p>
<p>4.标签里面带有若干属性，也有不带的；</p>
<p>标签语法：</p>
<p>&lt;标签名 属性1=“属性值1” 属性2=“属性值2”……&gt;内容部分&lt;/标签名&gt;<br>&lt;标签名 属性1=“属性值1” 属性2=“属性值2”…… /&gt;</p>
<p>html注释：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--注释内容--&gt; #找到一行内容ctrl+/能快捷注释，注释的内容不会在网页上显示出来</span><br></pre></td></tr></table></figure>
<p>head内常用标签</p>
<p><img src="/2021/11/21/html-1/1.png" alt="img"></p>
<p>meta标签：</p>
<p>　　01.<meta>元素可提供有关页面的元信息（meta-information）,针对搜索引擎和更新频度的描述和关键词；</p>
<p>　　02.标签位于文档的头部，不包含任何内容,提供的信息用户是看不见的；</p>
<p>meta标签组成：</p>
<p>　　http-equiv属性和name属性：</p>
<p>　　1.http-equiv属性：相当于http的文件头作用，向浏览器传回一些有用的信息，正确显示网页内容，与之对应的属性值content，content中的内容是各个参数的变量值；</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--2秒后跳转到对应的网址，注意引号--&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;refresh&quot; content=&quot;2;URL=https://www.mi.com&quot;&gt; #如果把URL和后面的内容去掉，就是2秒钟刷新一次，做了解;</span><br><span class="line">&lt;!--指定文档的编码类型--&gt; </span><br><span class="line">&lt;meta http-equiv=&quot;content-Type&quot; charset=UTF8&quot;&gt;</span><br><span class="line">&lt;!--告诉IE以最高级模式渲染文档--&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;x-ua-compatible&quot; content=&quot;IE=edge&quot;&gt; #edge是微软的一个全新的浏览器,其实就是告诉IE浏览器，你按照最高标准来渲染我的页面，做了解；</span><br></pre></td></tr></table></figure>
<p>　　2.name属性：主要用于描述网页，与之对应的属性值为content，content中的内容主要是便于搜索引擎查找信息和分类信息用的；</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;meta name=&quot;keywords&quot; content=&quot;meta总结,html meta,meta属性,meta跳转&quot;&gt; </span><br><span class="line">&lt;!-- 关键字，也就是别人是可以通过这些关键字搜索到我的这个文章的，搜索引擎就是能够这个content内容来帮别人搜索到你的这个文档的,SEO就是专门做这些搜索优化的；--&gt;</span><br><span class="line"></span><br><span class="line">&lt;meta name=&quot;description&quot; content=&quot;xxxxxpythonxxx学习&quot;&gt;  #是对这个文档的描述，在百度一些内容的页面上，f12打开看看</span><br></pre></td></tr></table></figure>
<h3 id="body常用标签"><a href="#body常用标签" class="headerlink" title="body常用标签"></a>body常用标签</h3><p>基本标签</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">不加标签的纯文字也是可以在body中写的</span><br><span class="line"><span class="tag">&lt;<span class="name">b</span>&gt;</span>加粗<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">i</span>&gt;</span>斜体<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">u</span>&gt;</span>下划线<span class="tag">&lt;/<span class="name">u</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">s</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>段落标签<span class="tag">&lt;/<span class="name">p</span>&gt;</span> #独占一个段落</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>标题1<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>标题2<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>标题3<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h4</span>&gt;</span>标题4<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h5</span>&gt;</span>标题5<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h6</span>&gt;</span>标题6<span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--换行--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--水平线--&gt;</span><span class="tag">&lt;<span class="name">hr</span>&gt;</span> #就是单独个一个水平线</span><br></pre></td></tr></table></figure>
<p>每次加上一些内容，记得保存再刷新一下才会显示出效果来；</p>
<p>常用特殊字符</p>
<p><img src="/2021/11/21/html-1/2.png" alt="img"></p>
<p>div标签和span标签</p>
<p>这两个标签没有特别的样式,<div>xxxx</div>，<span>xxx</span>这是两个标签最大的特点，可以通过CSS来控制,网站中多数是他们;</p>
<p>div标签用来定义一个块级元素，并无实际的意义。主要通过CSS样式为其赋予不同的表现;</p>
<p>span标签用来定义内联(行内)元素，并无实际的意义。主要通过CSS样式为其赋予不同的表现;</p>
<p>块级元素与行内元素的区别：</p>
<p>块元素，是另起一行开始渲染的元素，行内元素则不需另起一行。单独在网页中插入这两个元素，不会对页面产生任何的影响；</p>
<p>这两个元素是专门为定义CSS样式而生的；</p>
<p>块级标签：p、h1—h6、hr、div</p>
<p>内联标签：b、i、u、s</p>
<p>注意：</p>
<p>标签嵌套：通常块级元素可以包含内联元素或某些块级元素，但内联元素不能包含块级元素，它只能包含其它内联元素;div是可以包含div的;</p>
<p>p标签比较特殊，不能包含块级标签，p标签也不能包含p标签;可以试一下p标签套p标签，f12你会发现三个p标签;</p>
<p> img标签 </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;图片的路径&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;图片未加载成功时的提示&quot;</span> <span class="attr">title</span>=<span class="string">&quot;鼠标悬浮时提示信息&quot;</span> <span class="attr">width</span>=<span class="string">&quot;宽&quot;</span> <span class="attr">height</span>=<span class="string">&quot;高(宽高两个属性只用一个会自动等比缩放)&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>src的路径分为两种：网上的图片路径和本地的图片路径(本地路径又包括相对路径和绝对路径)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&quot;.&quot; -- 代表目前所在的目录，相对路径。 如：<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;./abc&quot;</span>&gt;</span>文本<span class="tag">&lt;/<span class="name">a</span>&gt;</span> 或 <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./abc&quot;</span> /&gt;</span></span><br><span class="line">&quot;..&quot; -- 代表上一层目录，相对路径。 如：<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;../abc&quot;</span>&gt;</span>文本<span class="tag">&lt;/<span class="name">a</span>&gt;</span> 或 <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;../abc&quot;</span> /&gt;</span></span><br><span class="line">&quot;../../&quot; -- 代表的是上一层目录的上一层目录，相对路径。 如：<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;../../abc&quot;</span> /&gt;</span></span><br><span class="line">&quot;/&quot; -- 代表根目录,绝对路径。 如：<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/abc&quot;</span>&gt;</span>文本<span class="tag">&lt;/<span class="name">a</span>&gt;</span> 或 <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/abc&quot;</span> /&gt;</span></span><br><span class="line">&quot;D:/abc/&quot; -- 代表根目录,绝对路径</span><br></pre></td></tr></table></figure>
<p><img src="/2021/11/21/html-1/3.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/blog/1513655/201812/1513655-20181222100900346-1041321850.png" alt="img"></p>
<p>a标签 </p>
<p> 超链接标签:指从一个网页指向一个目标的连接关系，这个目标可以是另一个网页，也可以是相同网页上的不同位置，还可以是一个图片，一个电子邮件地址，一个文件，甚至是一个应用程序。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.oldboyedu.com&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> &gt;</span>点我<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p> target:</p>
<p>　　_blank表示在新标签页中打开目标网页</p>
<p>　　_self表示在当前标签页中打开目标网页</p>
<p>href属性指定目标网页地址。该地址可以有几种类型：</p>
<p>　　绝对URL - 指向另一个站点（比如 href=”<a href="http://www.jd.com）">http://www.jd.com）</a><br>　　相对URL - 指当前站点中确切的路径（href=”index.htm”） #学django的时候会用的比较多<br>　　锚URL - 指向页面中的锚（href=”#top”），博客的目录经常用到，还可以跳转到 name属性为p1的a标签上，<a name="top">xxx</a></p>
<p>列表 </p>
<p>1.无序列表</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">type</span>=<span class="string">&quot;disc&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>第一项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>第二项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>type属性：</p>
<p>　　disc（实心圆点，默认值）<br>　　circle（空心圆圈）<br>　　square（实心方块）<br>　　none（无样式）</p>
<p>2.有序列表</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ol</span> <span class="attr">type</span>=<span class="string">&quot;1&quot;</span> <span class="attr">start</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>第一项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>第二项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>type属性： start是从数字几开始</p>
<p>　　1 数字列表，默认值<br>　　A 大写字母<br>　　a 小写字母<br>　　Ⅰ大写罗马<br>　　ⅰ小写罗马</p>
<p>3.标题列表</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dt</span>&gt;</span>标题1<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>内容1<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dt</span>&gt;</span>标题2<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>内容1<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>内容2<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2021/11/21/html-1/4.png" alt="img"><img src="/2021/11/21/html-1/5.png" alt="img"></p>
<p>表格 </p>
<p>表格是一个二维数据空间，一个表格由若干行组成，一个行又有若干单元格组成，单元格里可以包含文字、列表、图案、表单、数字符号、预置文本和其它的表格等内容。</p>
<p>　　表格最重要的目的是显示表格类数据。表格类数据是指最适合组织为表格格式（即按行和列组织）的数据。</p>
<p>　　表格的基本结构：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">thead</span>&gt;</span> <span class="comment">&lt;!-- 标题部分 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span> <span class="comment">&lt;!-- 表示一行 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>序号<span class="tag">&lt;/<span class="name">th</span>&gt;</span> <span class="comment">&lt;!-- 一个单元表格 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>爱好<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tbody</span>&gt;</span> <span class="comment">&lt;!-- 内容部分 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span> <span class="comment">&lt;!-- 一个单元表格 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>老李<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>写代码<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>老王<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>打游戏<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p> 效果如图：</p>
<p><img src="/2021/11/21/html-1/6.png" alt="img"></p>
<p>属性:<br>　　border: 表格边框.<br>　　cellpadding: 内边距 （内边框和内容的距离）<br>　　cellspacing: 外边距.（内外边框的距离）<br>　　width: 像素 百分比.（最好通过css来设置长宽）<br>　　rowspan: 单元格竖跨多少行<br>　　colspan: 单元格横跨多少列（即合并单元格）</p>
<p><img src="/2021/11/21/html-1/7.png" alt="img" style="zoom:80%;"><img src="/2021/11/21/html-1/8.png" alt="img"></p>
<p><img src="/2021/11/21/html-1/9.png" alt="img"><img src="/2021/11/21/html-1/10.png" alt="img"></p>
<p>一般很少用上面这些属性</p>
<p>input标签 </p>
<p><input>元素会根据不同的 type 属性，变化为多种形态</p>
<p><img src="/2021/11/21/html-1/11.png" alt="img"></p>
<p>input属性说明：</p>
<p>　　name：表单提交时的“键”，注意和id的区别<br>　　value：表单提交时对应项的值<br>　　　　type=”button”, “reset”, “submit”时，为按钮上显示的文本年内容<br>　　　　type=”text”,”password”,”hidden”时，为输入框的初始值<br>　　　　type=”checkbox”, “radio”, “file”，为输入相关联的值<br>　　checked：radio和checkbox默认被选中的项<br>　　readonly：text和password设置只读<br>　　disabled：所有input均适用</p>
<p>代码示例：</p>
<p><img src="https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="img"> input</p>
<p>显示效果：</p>
<p><img src="/2021/11/21/html-1/12.png" alt="img"></p>
<p> 综合练习代码：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">  1 <span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line">  2 <span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  3 <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  4     <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  5     <span class="tag">&lt;<span class="name">title</span>&gt;</span>qd0201<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  6     <span class="comment">&lt;!-- &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;qd0203.css&quot;&gt; --&gt;</span></span><br><span class="line">  7     <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">  <span class="number">8</span>         <span class="selector-tag">ul</span>&#123;</span></span><br><span class="line"><span class="css">  <span class="number">9</span>         <span class="attribute">background</span>: <span class="number">#3CDAE5</span>;<span class="attribute">color</span>: <span class="number">#FBF9F9</span></span></span><br><span class="line"><span class="css"> <span class="number">10</span>     &#125;</span></span><br><span class="line"><span class="css"> <span class="number">11</span> </span></span><br><span class="line"><span class="css"> <span class="number">12</span>     </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"> 13 <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> 14 <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"> 15     <span class="comment">&lt;!-- form标签实现与服务器数据交流 --&gt;</span></span><br><span class="line"> 16     <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://127.0.0.1:8001&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line"> 17         <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.mi.com&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span>点我传送<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"> 18         <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#username&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_self&quot;</span>&gt;</span>点我传送<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"> 19         <span class="tag">&lt;<span class="name">div</span>&gt;</span>我是div<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> 20         <span class="tag">&lt;<span class="name">span</span>&gt;</span>我是span<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"> 21 </span><br><span class="line"> 22         <span class="comment">&lt;!-- ul无序、ol有序、dl标题 列表 --&gt;</span></span><br><span class="line"> 23         <span class="tag">&lt;<span class="name">ul</span> <span class="attr">type</span>=<span class="string">&quot;disc&quot;</span>&gt;</span></span><br><span class="line"> 24             <span class="tag">&lt;<span class="name">li</span>&gt;</span>Mysql从删库到跑路<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"> 25             <span class="tag">&lt;<span class="name">li</span>&gt;</span>C++从入门到入土<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"> 26         <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"> 27         <span class="comment">&lt;!-- &lt;ul type=&quot;circle&quot;&gt; --&gt;</span></span><br><span class="line"> 28         <span class="tag">&lt;<span class="name">ul</span> <span class="attr">type</span>=<span class="string">&quot;square&quot;</span>&gt;</span></span><br><span class="line"> 29             <span class="tag">&lt;<span class="name">li</span>&gt;</span>大数据<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"> 30             <span class="tag">&lt;<span class="name">li</span>&gt;</span>Python<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"> 31         <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"> 32         <span class="tag">&lt;<span class="name">ol</span> <span class="attr">type</span>=<span class="string">&quot;I&quot;</span> <span class="attr">start</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line"> 33             <span class="tag">&lt;<span class="name">li</span>&gt;</span>我信你个鬼<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"> 34             <span class="tag">&lt;<span class="name">li</span>&gt;</span>下水道三帅<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"> 35         <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line"> 36         <span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line"> 37             <span class="tag">&lt;<span class="name">dt</span>&gt;</span>标题1<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line"> 38             <span class="tag">&lt;<span class="name">dd</span>&gt;</span>内容1<span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;lt;</span><span class="symbol">&amp;gt;</span><span class="symbol">&amp;copy;</span><span class="symbol">&amp;amp;</span><span class="symbol">&amp;yen;</span><span class="symbol">&amp;reg;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line"> 39             <span class="tag">&lt;<span class="name">dt</span>&gt;</span>标题2<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line"> 40             <span class="tag">&lt;<span class="name">dd</span>&gt;</span>内容2<span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;gt;</span><span class="symbol">&amp;lt;</span><span class="symbol">&amp;amp;</span><span class="symbol">&amp;copy;</span><span class="symbol">&amp;yen;</span><span class="symbol">&amp;reg;</span><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line"> 41         <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line"> 42         </span><br><span class="line"> 43         <span class="comment">&lt;!-- 表格 --&gt;</span></span><br><span class="line"> 44         <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&quot;1&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;3&quot;</span> <span class="attr">cellspacing</span>=<span class="string">&quot;3&quot;</span> &gt;</span></span><br><span class="line"> 45             <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line"> 46                 <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"> 47                     <span class="tag">&lt;<span class="name">th</span>&gt;</span>序号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"> 48                     <span class="tag">&lt;<span class="name">th</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"> 49                     <span class="tag">&lt;<span class="name">th</span>&gt;</span>爱好<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"> 50                 <span class="tag">&lt;/<span class="name">tr</span>&gt;</span>    </span><br><span class="line"> 51             <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line"> 52             <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line"> 53                 <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"> 54                     <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"> 55                     <span class="tag">&lt;<span class="name">td</span>&gt;</span>狗子<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"> 56                     <span class="tag">&lt;<span class="name">td</span>&gt;</span>宝剑<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"> 57                 <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"> 58                 <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"> 59                     <span class="tag">&lt;<span class="name">td</span>&gt;</span>2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"> 60                     <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span>二蛋<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"> 61                     <span class="comment">&lt;!-- &lt;td&gt;日天&lt;/td&gt; --&gt;</span></span><br><span class="line"> 62                 <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"> 63             <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"> 64             </span><br><span class="line"> 65         <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"> 66 </span><br><span class="line"> 67         <span class="comment">&lt;!-- input输入、单选、多选、文件上传、日期时间、下拉选项 --&gt;</span></span><br><span class="line"> 68         <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"> 69             <span class="comment">&lt;!-- label for属性和id一样就关联在一起 点击获得光标--&gt;</span></span><br><span class="line"> 70             <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span>&gt;</span>账户<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"> 71             <span class="comment">&lt;!-- disabled放在form表单中提交后得不到该值</span></span><br><span class="line"><span class="comment"> 72             将disabled=&quot;disabled&quot; 改为 readonly = &quot;readonly&quot;只读即可</span></span><br><span class="line"><span class="comment"> 73             --&gt;</span></span><br><span class="line"> 74             <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;zh&quot;</span>&gt;</span></span><br><span class="line"> 75         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> 76         <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"> 77             <span class="comment">&lt;!-- label另一种转到光标方法 --&gt;</span></span><br><span class="line"> 78             <span class="tag">&lt;<span class="name">label</span>&gt;</span>密码</span><br><span class="line"> 79                 <span class="comment">&lt;!-- password不显示明文 --&gt;</span></span><br><span class="line"> 80             <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;mm&quot;</span>&gt;</span></span><br><span class="line"> 81             <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"> 82         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> 83         <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"> 84             <span class="tag">&lt;<span class="name">label</span>&gt;</span>头像</span><br><span class="line"> 85                 <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;avatar&quot;</span>&gt;</span></span><br><span class="line"> 86             <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"> 87         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> 88 </span><br><span class="line"> 89         <span class="tag">&lt;<span class="name">div</span>&gt;</span>日期</span><br><span class="line"> 90             <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;date&quot;</span> <span class="attr">name</span>=<span class="string">&quot;date&quot;</span>&gt;</span></span><br><span class="line"> 91         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> 92         <span class="tag">&lt;<span class="name">p</span>&gt;</span>时间</span><br><span class="line"> 93             <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;time&quot;</span> <span class="attr">name</span>=<span class="string">&quot;time&quot;</span>&gt;</span></span><br><span class="line"> 94         <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"> 95         <span class="tag">&lt;<span class="name">P</span>&gt;</span>性别</span><br><span class="line"> 96             <span class="comment">&lt;!-- type=&quot;radio&quot;单选框 --&gt;</span></span><br><span class="line"> 97             <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;boy&quot;</span>&gt;</span>男</span><br><span class="line"> 98             <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;girl&quot;</span>&gt;</span>女</span><br><span class="line"> 99         <span class="tag">&lt;/<span class="name">P</span>&gt;</span></span><br><span class="line">100         <span class="tag">&lt;<span class="name">p</span>&gt;</span>爱好</span><br><span class="line">101             <span class="comment">&lt;!-- type=&quot;checkbox&quot;复选框 checked设置默认选项--&gt;</span></span><br><span class="line">102             <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hobby&quot;</span> <span class="attr">checked</span> <span class="attr">value</span>=<span class="string">&quot;girl&quot;</span>&gt;</span>女</span><br><span class="line">103             <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hobby&quot;</span> <span class="attr">value</span>=<span class="string">&quot;boy&quot;</span>&gt;</span>男</span><br><span class="line">104             <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hobby&quot;</span> <span class="attr">value</span>=<span class="string">&quot;baoj&quot;</span>&gt;</span>宝剑</span><br><span class="line">105             <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hobby&quot;</span> <span class="attr">value</span>=<span class="string">&quot;dy&quot;</span>&gt;</span>电影</span><br><span class="line">106         <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">107         <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line">108         <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;reset&quot;</span> <span class="attr">value</span>=<span class="string">&quot;重置&quot;</span>&gt;</span></span><br><span class="line">109         <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;普通按钮&quot;</span>&gt;</span></span><br><span class="line">110         <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">value</span>=<span class="string">&quot;隐藏输入框&quot;</span>&gt;</span></span><br><span class="line">111         <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;文本框&quot;</span>&gt;</span></span><br><span class="line">112 </span><br><span class="line">113         <span class="comment">&lt;!-- select下拉选项 --&gt;</span></span><br><span class="line">114         <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">115             <span class="comment">&lt;!-- &lt;select name=&quot;city&quot; id=&quot;city&quot; multiple&gt; 设置成多选--&gt;</span></span><br><span class="line">116             <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;city&quot;</span> <span class="attr">id</span>=<span class="string">&quot;city&quot;</span>&gt;</span></span><br><span class="line">117                 <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span>北京<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">118                 <span class="comment">&lt;!-- selected=&quot;selected&quot;设置成default--&gt;</span></span><br><span class="line">119                 <span class="tag">&lt;<span class="name">option</span> <span class="attr">selected</span>=<span class="string">&quot;selected&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span>上海<span class="tag">&lt;/<span class="name">option</span>&gt;</span>  </span><br><span class="line">120                 <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>&gt;</span>广州<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">121                 <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;4&quot;</span>&gt;</span>深圳<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">122             <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">123         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">124 </span><br><span class="line">125         <span class="comment">&lt;!-- textarea 多行文本 rows行数 cols列数 disabled=&quot;disabled&quot; 禁用--&gt;</span></span><br><span class="line">126         <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">&quot;多行文本&quot;</span> <span class="attr">rows</span>=<span class="string">&quot;10px&quot;</span> <span class="attr">cols</span>=<span class="string">&quot;20px&quot;</span> &gt;</span></span><br><span class="line">127             ...</span><br><span class="line">128         <span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">129     <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">130     </span><br><span class="line">131 <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">132 <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>html</category>
      </categories>
      <tags>
        <tag>html常用标签</tag>
      </tags>
  </entry>
  <entry>
    <title>html-tip</title>
    <url>/2021/11/23/html-tip/</url>
    <content><![CDATA[<h3 id="html遇到的问题"><a href="#html遇到的问题" class="headerlink" title="html遇到的问题"></a>html遇到的问题</h3><h5 id="1-body设置background图片的问题"><a href="#1-body设置background图片的问题" class="headerlink" title="1. body设置background图片的问题"></a>1. body设置background图片的问题</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 在html内部设置背景图片(在body标签设置属性background=相对与html的路径)</span><br><span class="line">&lt;body background =resource\imgs\1.jpg &gt; </span><br><span class="line"></span><br><span class="line">2. 在html外的css定义</span><br><span class="line">注意：此时图片的相对路径为，相对与css文件的路径，并且要使用’/‘,\会无法识别</span><br><span class="line">background: url(&#x27;../imgs/1.jpg&#x27;);</span><br></pre></td></tr></table></figure>
<h5 id="2-JavaScript编写的位置"><a href="#2-JavaScript编写的位置" class="headerlink" title="2. JavaScript编写的位置"></a>2. JavaScript编写的位置</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">html页面是顺序加载的：</span><br><span class="line">直接编写的 JavaScript语句如果需要获取页面元素，则要写在页面元素代码的后面（推荐写在body标签的最后）</span><br></pre></td></tr></table></figure>
<h5 id="3-超链接禁止跳转"><a href="#3-超链接禁止跳转" class="headerlink" title="3. 超链接禁止跳转"></a>3. 超链接禁止跳转</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=&quot;javascript:void(0)&quot;&gt;&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<h5 id="4-文字居中"><a href="#4-文字居中" class="headerlink" title="4.文字居中"></a>4.文字居中</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">text-align:center</span><br><span class="line">line-height: 行高px  -- 设置行高与当前行相等</span><br></pre></td></tr></table></figure>
<h5 id="5-get提交表单中文乱码问题"><a href="#5-get提交表单中文乱码问题" class="headerlink" title="5. get提交表单中文乱码问题"></a>5. get提交表单中文乱码问题</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">request.setCharacterEncoding(&quot;utf-8&quot;);不生效</span><br><span class="line">与tomcat配置有关</span><br><span class="line">改为post提交</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>html问题汇总</tag>
      </tags>
  </entry>
  <entry>
    <title>http</title>
    <url>/2021/12/05/http/</url>
    <content><![CDATA[<h3 id="一、http概念"><a href="#一、http概念" class="headerlink" title="一、http概念"></a>一、http概念</h3><ul>
<li>概念：超文本传输协议（Hyper Text Transfer Protocol，HTTP）是一个简单的请求-响应协议，它通常运行在TCP之上。它指定了客户端可能发送给服务器什么样的消息以及得到什么样的响应。</li>
</ul>
<ul>
<li>特点<ol>
<li>基于tcp/ip协议</li>
<li>默认端口号：80</li>
<li>基于请求响应模型：一次请求对应一次响应</li>
<li>无状态的：每次请求间相互独立，不能进行信息交互</li>
</ol>
</li>
<li>历史版本<ol>
<li>http1.0：每次请求都会新建连接</li>
<li>http1.1：复用连接，缓存优化等…</li>
</ol>
</li>
</ul>
<h5 id="1-请求消息数据格式"><a href="#1-请求消息数据格式" class="headerlink" title="1. 请求消息数据格式"></a>1. 请求消息数据格式</h5><ol>
<li><p>请求行</p>
<ul>
<li><p>请求方式 请求url 请求协议/版本</p>
<p>GET /www.baidu.com HTTP/1.1</p>
</li>
<li><p>请求方式</p>
<ul>
<li>get：<ol>
<li>页面传递参数在请求行中</li>
<li>请求url长度有限制</li>
</ol>
</li>
<li>post：<ol>
<li>页面传递参数在请求体中</li>
<li>参数长度无限制</li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
<li><p>请求头</p>
<ul>
<li><p>请求头名称：请求头值</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 浏览器引擎（可以针对解决兼容问题）：User-Agent:内容</span><br><span class="line">2. Referer: https://www.baidu.com/?tn=15007414_5_dg</span><br><span class="line">	告诉服务器，当前请求从哪里来</span><br><span class="line">		1. 防止盗链接</span><br><span class="line">		2. 统计</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<ol>
<li><p>请求空行</p>
<ul>
<li>空行</li>
</ul>
</li>
<li><p>请求体（正文）</p>
<ul>
<li><p>get方式没有请求体</p>
</li>
<li><p>post方式请求体是页面传输的参数</p>
</li>
<li>参数名称：请求头值</li>
</ul>
</li>
<li><p>请求字符串：</p>
</li>
</ol>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>www.baidu.com</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"><span class="attribute">sec-ch-ua</span><span class="punctuation">: </span>&quot; Not A;Brand&quot;;v=&quot;99&quot;, &quot;Chromium&quot;;v=&quot;96&quot;, &quot;Microsoft Edge&quot;;v=&quot;96&quot;</span><br><span class="line"><span class="attribute">sec-ch-ua-mobile</span><span class="punctuation">: </span>?0</span><br><span class="line"><span class="attribute">sec-ch-ua-platform</span><span class="punctuation">: </span>&quot;Windows&quot;</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.55 Safari/537.36 Edg/96.0.1054.43</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Sec-Fetch-Site</span><span class="punctuation">: </span>same-origin</span><br><span class="line"><span class="attribute">Sec-Fetch-Mode</span><span class="punctuation">: </span>navigate</span><br><span class="line"><span class="attribute">Sec-Fetch-User</span><span class="punctuation">: </span>?1</span><br><span class="line"><span class="attribute">Sec-Fetch-Dest</span><span class="punctuation">: </span>document</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>https://www.baidu.com/?tn=15007414_5_dg</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate, br</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span><br></pre></td></tr></table></figure>
<h5 id="2-响应消息数据格式"><a href="#2-响应消息数据格式" class="headerlink" title="2. 响应消息数据格式"></a>2. 响应消息数据格式</h5><ol>
<li>响应行<ol>
<li>组成：协议/版本  响应状态码 状态码描述</li>
<li>响应状态码：服务器告诉客户端浏览器本次请求和响应的一个状态。<ol>
<li>状态码是3位数字</li>
<li>分类：<ol>
<li>1xx：这一类型的状态码，代表请求已被接受，需要继续处理。这类响应是临时响应，只包含状态行和某些可选的响应头信息，并以空行结束。</li>
<li>2xx：这一类型的状态码，代表请求已成功被服务器接收、理解、并接受。</li>
<li>3xx：这类状态码代表需要客户端采取进一步的操作才能完成请求。通常，这些状态码用来重定向，后续的请求地址（重定向目标）在本次响应的 Location 域中指明。302:重定向，304（访问缓存）</li>
<li>4xx：请求错误。这类的状态码代表了客户端看起来可能发生了错误，妨碍了服务器的处理。404：资源找不到，405：没有对应的doGet或doPost方法</li>
<li>5xx/6xx：服务器错误。这类状态码代表了服务器在处理请求的过程中有错误或者异常状态发生，也有可能是服务器意识到以当前的软硬件资源无法完成对请求的处理。</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>响应头<ol>
<li>格式：头名称：值</li>
<li>常见的头：<ol>
<li>Content-Type：本次响应体的数据格式和编码格式。</li>
<li>Content-disposition：服务器告诉客户端以什么格式打开响应体数据<ol>
<li>值：<ul>
<li>in-line：默认值，当前页面内打开</li>
<li>attachment;filename=xxx：以附件形式打开响应体。文件下载</li>
</ul>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>响应空行</li>
<li>响应体（传输的数据）</li>
</ol>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span></span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html;charset=UTF-8</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>890</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Mon, 06 Dec 2021 01:41:47 GMT</span><br><span class="line"><span class="attribute">Keep-Alive</span><span class="punctuation">: </span>timeout=20</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br></pre></td></tr></table></figure>
<h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><p>servlet访问流程</p>
<p><img src="http/1.png" alt></p>
<ul>
<li>request对象和response对象是服务器创建，我们进行使用</li>
<li>request对象获取请求消息</li>
<li>response对象设置响应消息</li>
</ul>
<h5 id="3-request对象"><a href="#3-request对象" class="headerlink" title="3. request对象"></a>3. request对象</h5><ol>
<li><p>继承结构</p>
<p>ServletRequest —-接口</p>
<p>⬆   继承</p>
<p>HttpServletRequest —-接口</p>
<p>⬆   实现</p>
<p>org.apache.catalina.connector.RequestFacade</p>
</li>
<li><p>request功能</p>
<ul>
<li><p><strong>获取请求消息</strong></p>
<ul>
<li><p>获取请求行数据(eg: /demo1/login?name = 神仙)</p>
<ol>
<li><p>获取请求方式：get</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">String <span class="title">getMethod</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>(* 重要)   获取虚拟目录：/demo1</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">String <span class="title">getContextPath</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>获取servlet路径：/login</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">String <span class="title">getServletPath</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>获取get方式请求参数：name = 神仙</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">String <span class="title">getQueryString</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>(* 重要)    获取请求uri/url</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String getRequestURI() // /demo1/login</span><br><span class="line">String getRequestURL() // http://localhost/demo1/login</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取协议及版本：http/1.1</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">String <span class="title">getProtocol</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>获取客户端ip地址</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">getRemoteAddr()</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>获取请求头数据</p>
<ol>
<li><p><strong>String getHeader(String name)</strong> 以字符串形式返回指定的请求头的值。（<strong>重要</strong>）</p>
</li>
<li><p><strong>Enumeration getHeaderNames()</strong> 返回一个枚举，包含在该请求中包含的所有的头名。（了解）</p>
<p>Enumeration 相当于迭代器</p>
<ul>
<li>Enumeration .hasmoreElements() 判断是否有下一个</li>
<li>Enumeration .nextElement() 获取下一个元素名称</li>
<li>getHeader(String name)  将名称传入getHeader方法，获取值</li>
</ul>
</li>
</ol>
</li>
<li><p>获取请求体消息</p>
<ol>
<li><p>获取流对象</p>
<ul>
<li><p>BufferedReader getReader)l:获取字符输入流，只能操作字符数据</p>
</li>
<li><p>ServletInputStream getInputstream():获取字节输入流，可以操作所有类型数据</p>
<p>用于文件上传</p>
</li>
</ul>
</li>
<li><p>从流中获取数据</p>
</li>
</ol>
</li>
</ul>
</li>
<li><p><strong>其他功能</strong>（重点）</p>
<ul>
<li><p>获取请求参数通用方法：不论get还是post请求方式都可以使用下列方法来获取请求参数</p>
<ol>
<li>String getParameter(String name)：根据参数名称获取参数值</li>
<li>String getParameterValues(String name)：根据参数名称获取参数值的数组（复选框的value值）</li>
<li>Enumeration<String> getParameterNames()：获取所有请求参数的名称</String></li>
<li>Map<String,String[]> getParameterMap()：获取所有参数的map集合</String,String[]></li>
</ol>
<p>中文乱码问题：</p>
<ul>
<li><p>get方式：tomcat8 已经将乱码问题解决</p>
</li>
<li><p>post方式：中文乱码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">request.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>请求转发：一种在服务器中资源跳转的方式（浏览器路径栏不变，一次访问，在服务器内部进行）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">req.getRequestDispatcher(<span class="string">&quot;/login.jsp&quot;</span>).forward(req,resp);</span><br></pre></td></tr></table></figure>
<p>特点：</p>
<ol>
<li>浏览器地址栏不变</li>
<li>一次访问，资源跳转在服务器内部进行</li>
<li>只能访问当前服务器内部资源</li>
<li>可以使用request域对象共享数据</li>
</ol>
</li>
<li><p>共享数据</p>
<ol>
<li><p>request域：一次请求的范围，一般用于请求转发的多个资源中共享数据</p>
<p>方法：</p>
<ul>
<li>setAttribute(String name,Object obj)：向域中存储数据</li>
<li>Object getAttribute(String name)：通过建获取值 </li>
<li>removeAttribute(String name)：通过键删除值</li>
</ul>
</li>
</ol>
</li>
<li><p>获取ServletContext</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">ServletContext <span class="title">getServletContext</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h5 id="4-response对象"><a href="#4-response对象" class="headerlink" title="4. response对象"></a>4. response对象</h5><p>设置响应消息</p>
<ol>
<li><p>设置响应行</p>
<ul>
<li>设置状态码</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">setStatus(<span class="keyword">int</span> sc)</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置响应头</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">setHeader(String name,String value)</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置响应体</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> 获取输出流</span><br><span class="line">	* 字符输出流：<span class="function">printWriter <span class="title">getWriter</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	* 字节输出流：ServletOutputStream <span class="title">getOutputStream</span><span class="params">()</span></span></span><br><span class="line"><span class="function">2. 使用输出流，将数据输出到浏览器</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>案例：</p>
<ul>
<li><p>重定向</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1. 方式1</span></span><br><span class="line"><span class="comment">//设置响应行的响应状态码</span></span><br><span class="line">resp.setStatus(<span class="number">302</span>);</span><br><span class="line"><span class="comment">//设置响应头的，响应路径进行重定向</span></span><br><span class="line">resp.setHeader(<span class="string">&quot;location&quot;</span>,<span class="string">&quot;/login.jsp&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.封装方式2</span></span><br><span class="line">resp.sendRedirect(<span class="string">&quot;/login.jsp&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>特点：</p>
<ul>
<li>转发地址栏改变</li>
<li>可以访问其他站点资源</li>
<li>是两次访问</li>
<li>不能使用request域对象共享数据</li>
</ul>
</li>
<li><p>服务器输出字符数据到浏览器</p>
</li>
<li><p>服务器输出字节数据到浏览器</p>
</li>
</ul>
<h3 id="二、W3Cschool教程"><a href="#二、W3Cschool教程" class="headerlink" title="二、W3Cschool教程"></a>二、W3Cschool教程</h3><h5 id="1-Servlet-客户端-HTTP-请求"><a href="#1-Servlet-客户端-HTTP-请求" class="headerlink" title="1. Servlet 客户端 HTTP 请求"></a>1. Servlet 客户端 HTTP 请求</h5><p>当浏览器请求网页时，它会向 Web 服务器发送特定信息，这些信息不能被直接读取，因为这些信息是作为 HTTP 请求的头的一部分进行传输的。您可以查看 <a href="https://www.w3cschool.cn/http/http-tutorial.html">HTTP 协议</a> 了解更多相关信息。</p>
<p>以下是来自于浏览器端的重要头信息，您可以在 Web 编程中频繁使用：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">头信息</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Accept</td>
<td style="text-align:left">这个头信息指定浏览器或其他客户端可以处理的 MIME 类型。值 <strong>image/png</strong> 或 <strong>image/jpeg</strong> 是最常见的两种可能值。</td>
</tr>
<tr>
<td style="text-align:left">Accept-Charset</td>
<td style="text-align:left">这个头信息指定浏览器可以用来显示信息的字符集。例如 ISO-8859-1。</td>
</tr>
<tr>
<td style="text-align:left">Accept-Encoding</td>
<td style="text-align:left">这个头信息指定浏览器知道如何处理的编码类型。值 <strong>gzip</strong> 或 <strong>compress</strong> 是最常见的两种可能值。</td>
</tr>
<tr>
<td style="text-align:left">Accept-Language</td>
<td style="text-align:left">这个头信息指定客户端的首选语言，在这种情况下，Servlet 会产生多种语言的结果。例如，en、en-us、ru 等。</td>
</tr>
<tr>
<td style="text-align:left">Authorization</td>
<td style="text-align:left">这个头信息用于客户端在访问受密码保护的网页时识别自己的身份。</td>
</tr>
<tr>
<td style="text-align:left">Connection</td>
<td style="text-align:left">这个头信息指示客户端是否可以处理持久 HTTP 连接。持久连接允许客户端或其他浏览器通过单个请求来检索多个文件。值 <strong>Keep-Alive</strong> 意味着使用了持续连接。</td>
</tr>
<tr>
<td style="text-align:left">Content-Length</td>
<td style="text-align:left">这个头信息只适用于 POST 请求，并给出 POST 数据的大小（以字节为单位）。</td>
</tr>
<tr>
<td style="text-align:left">Cookie</td>
<td style="text-align:left">这个头信息把之前发送到浏览器的 cookies 返回到服务器。</td>
</tr>
<tr>
<td style="text-align:left">Host</td>
<td style="text-align:left">这个头信息指定原始的 URL 中的主机和端口。</td>
</tr>
<tr>
<td style="text-align:left">If-Modified-Since</td>
<td style="text-align:left">这个头信息表示只有当页面在指定的日期后已更改时，客户端想要的页面。如果没有新的结果可以使用，服务器会发送一个 304 代码，表示 <strong>Not Modified</strong> 头信息。</td>
</tr>
<tr>
<td style="text-align:left">If-Unmodified-Since</td>
<td style="text-align:left">这个头信息是 If-Modified-Since 的对立面，它指定只有当文档早于指定日期时，操作才会成功。</td>
</tr>
<tr>
<td style="text-align:left">Referer</td>
<td style="text-align:left">这个头信息指示所指向的 Web 页的 URL。例如，如果您在网页 1，点击一个链接到网页 2，当浏览器请求网页 2 时，网页 1 的 URL 就会包含在 Referer 头信息中。</td>
</tr>
<tr>
<td style="text-align:left">User-Agent</td>
<td style="text-align:left">这个头信息识别发出请求的浏览器或其他客户端，并可以向不同类型的浏览器返回不同的内容。</td>
</tr>
</tbody>
</table>
</div>
<h5 id="2-读取-HTTP-头的方法"><a href="#2-读取-HTTP-头的方法" class="headerlink" title="2. 读取 HTTP 头的方法"></a>2. 读取 HTTP 头的方法</h5><p>下面的方法可用在 Servlet 程序中读取 HTTP 头。这些方法通过 <em>HttpServletRequest</em> 对象可用。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">序号</th>
<th style="text-align:left">方法 &amp; 描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left"><strong>Cookie[] getCookies()</strong> 返回一个数组，包含客户端发送该请求的所有的 Cookie 对象。</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left"><strong>Enumeration getAttributeNames()</strong> 返回一个枚举，包含提供给该请求可用的属性名称。</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td style="text-align:left"><strong>Enumeration getHeaderNames()</strong> 返回一个枚举，包含在该请求中包含的所有的头名。</td>
</tr>
<tr>
<td style="text-align:left">4</td>
<td style="text-align:left"><strong>Enumeration getParameterNames()</strong> 返回一个 String 对象的枚举，包含在该请求中包含的参数的名称。</td>
</tr>
<tr>
<td style="text-align:left">5</td>
<td style="text-align:left"><strong>HttpSession getSession()</strong> 返回与该请求关联的当前 session 会话，或者如果请求没有 session 会话，则创建一个。</td>
</tr>
<tr>
<td style="text-align:left">6</td>
<td style="text-align:left"><strong>HttpSession getSession(boolean create)</strong> 返回与该请求关联的当前 HttpSession，或者如果没有当前会话，且创建是真的，则返回一个新的 session 会话。</td>
</tr>
<tr>
<td style="text-align:left">7</td>
<td style="text-align:left"><strong>Locale getLocale()</strong> 基于 Accept-Language 头，返回客户端接受内容的首选的区域设置。</td>
</tr>
<tr>
<td style="text-align:left">8</td>
<td style="text-align:left"><strong>Object getAttribute(String name)</strong> 以对象形式返回已命名属性的值，如果没有给定名称的属性存在，则返回 null。</td>
</tr>
<tr>
<td style="text-align:left">9</td>
<td style="text-align:left"><strong>ServletInputStream getInputStream()</strong> 使用 ServletInputStream，以二进制数据形式检索请求的主体。</td>
</tr>
<tr>
<td style="text-align:left">10</td>
<td style="text-align:left"><strong>String getAuthType()</strong> 返回用于保护 Servlet 的身份验证方案的名称，例如，”BASIC” 或 “SSL”，如果JSP没有受到保护则返回 null。</td>
</tr>
<tr>
<td style="text-align:left">11</td>
<td style="text-align:left"><strong>String getCharacterEncoding()</strong> 返回请求主体中使用的字符编码的名称。</td>
</tr>
<tr>
<td style="text-align:left">12</td>
<td style="text-align:left"><strong>String getContentType()</strong> 返回请求主体的 MIME 类型，如果不知道类型则返回 null。</td>
</tr>
<tr>
<td style="text-align:left">13</td>
<td style="text-align:left"><strong>String getContextPath()</strong> 返回指示请求上下文的请求 URI 部分。</td>
</tr>
<tr>
<td style="text-align:left">14</td>
<td style="text-align:left"><strong>String getHeader(String name)</strong> 以字符串形式返回指定的请求头的值。</td>
</tr>
<tr>
<td style="text-align:left">15</td>
<td style="text-align:left"><strong>String getMethod()</strong> 返回请求的 HTTP 方法的名称，例如，GET、POST 或 PUT。</td>
</tr>
<tr>
<td style="text-align:left">16</td>
<td style="text-align:left"><strong>String getParameter(String name)</strong> 以字符串形式返回请求参数的值，或者如果参数不存在则返回 null。</td>
</tr>
<tr>
<td style="text-align:left">17</td>
<td style="text-align:left"><strong>String getPathInfo()</strong> 当请求发出时，返回与客户端发送的 URL 相关的任何额外的路径信息。</td>
</tr>
<tr>
<td style="text-align:left">18</td>
<td style="text-align:left"><strong>String getProtocol()</strong> 返回请求协议的名称和版本。</td>
</tr>
<tr>
<td style="text-align:left">19</td>
<td style="text-align:left"><strong>String getQueryString()</strong> 返回包含在路径后的请求 URL 中的查询字符串。</td>
</tr>
<tr>
<td style="text-align:left">20</td>
<td style="text-align:left"><strong>String getRemoteAddr()</strong> 返回发送请求的客户端的互联网协议（IP）地址。</td>
</tr>
<tr>
<td style="text-align:left">21</td>
<td style="text-align:left"><strong>String getRemoteHost()</strong> 返回发送请求的客户端的完全限定名称。</td>
</tr>
<tr>
<td style="text-align:left">22</td>
<td style="text-align:left"><strong>String getRemoteUser()</strong> 如果用户已通过身份验证，则返回发出请求的登录用户，或者如果用户未通过身份验证，则返回 null。</td>
</tr>
<tr>
<td style="text-align:left">23</td>
<td style="text-align:left"><strong>String getRequestURI()</strong> 从协议名称直到 HTTP 请求的第一行的查询字符串中，返回该请求的 URL 的一部分。</td>
</tr>
<tr>
<td style="text-align:left">24</td>
<td style="text-align:left"><strong>String getRequestedSessionId()</strong> 返回由客户端指定的 session 会话 ID。</td>
</tr>
<tr>
<td style="text-align:left">25</td>
<td style="text-align:left"><strong>String getServletPath()</strong> 返回调用 JSP 的请求的 URL 的一部分。</td>
</tr>
<tr>
<td style="text-align:left">26</td>
<td style="text-align:left"><strong>String[] getParameterValues(String name)</strong> 返回一个字符串对象的数组，包含所有给定的请求参数的值，如果参数不存在则返回 null。</td>
</tr>
<tr>
<td style="text-align:left">27</td>
<td style="text-align:left"><strong>boolean isSecure()</strong> 返回一个布尔值，指示请求是否使用安全通道，如 HTTPS。</td>
</tr>
<tr>
<td style="text-align:left">28</td>
<td style="text-align:left"><strong>int getContentLength()</strong> 以字节为单位返回请求主体的长度，并提供输入流，或者如果长度未知则返回 -1。</td>
</tr>
<tr>
<td style="text-align:left">29</td>
<td style="text-align:left"><strong>int getIntHeader(String name)</strong> 返回指定的请求头的值为一个 int 值。</td>
</tr>
<tr>
<td style="text-align:left">30</td>
<td style="text-align:left"><strong>int getServerPort()</strong> 返回接收到这个请求的端口号。</td>
</tr>
</tbody>
</table>
</div>
<h5 id="3-Servlet-服务器-HTTP-响应"><a href="#3-Servlet-服务器-HTTP-响应" class="headerlink" title="3. Servlet 服务器 HTTP 响应"></a>3. Servlet 服务器 HTTP 响应</h5><p>正如前面的章节中讨论的那样，当一个 Web 服务器响应一个 HTTP 请求时，响应通常包括一个状态行、一些响应报头、一个空行和文档。一个典型的响应如下所示：</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html</span><br><span class="line"><span class="attribute">Header2</span><span class="punctuation">: </span>...</span><br><span class="line">...</span><br><span class="line"><span class="attribute">HeaderN</span><span class="punctuation">: </span>...</span><br><span class="line">  (Blank Line)</span><br><span class="line">&lt;!doctype ...&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;...&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">...</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>状态行包括 HTTP 版本（在本例中为 HTTP/1.1）、一个状态码（在本例中为 200）和一个对应于状态码的短消息（在本例中为 OK）。</p>
<p>下表总结了从 Web 服务器端返回到浏览器的最有用的 HTTP 1.1 响应报头，您会在 Web 编程中频繁地使用它们：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">头信息</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Allow</td>
<td style="text-align:left">这个头信息指定服务器支持的请求方法（GET、POST 等）。</td>
</tr>
<tr>
<td style="text-align:left">Cache-Control</td>
<td style="text-align:left">这个头信息指定响应文档在何种情况下可以安全地缓存。可能的值有：<strong>public、private</strong> 或 <strong>no-cache</strong> 等。Public 意味着文档是可缓存，Private 意味着文档是单个用户私用文档，且只能存储在私有（非共享）缓存中，no-cache 意味着文档不应被缓存。</td>
</tr>
<tr>
<td style="text-align:left">Connection</td>
<td style="text-align:left">这个头信息指示浏览器是否使用持久 HTTP 连接。值 <strong>close</strong> 指示浏览器不使用持久 HTTP 连接，值 <strong>keep-alive</strong> 意味着使用持久连接。</td>
</tr>
<tr>
<td style="text-align:left">Content-Disposition</td>
<td style="text-align:left">这个头信息可以让您请求浏览器要求用户以给定名称的文件把响应保存到磁盘。</td>
</tr>
<tr>
<td style="text-align:left">Content-Encoding</td>
<td style="text-align:left">在传输过程中，这个头信息指定页面的编码方式。</td>
</tr>
<tr>
<td style="text-align:left">Content-Language</td>
<td style="text-align:left">这个头信息表示文档编写所使用的语言。例如，en、en-us、ru 等。</td>
</tr>
<tr>
<td style="text-align:left">Content-Length</td>
<td style="text-align:left">这个头信息指示响应中的字节数。只有当浏览器使用持久（keep-alive）HTTP 连接时才需要这些信息。</td>
</tr>
<tr>
<td style="text-align:left">Content-Type</td>
<td style="text-align:left">这个头信息提供了响应文档的 MIME（Multipurpose Internet Mail Extension）类型。</td>
</tr>
<tr>
<td style="text-align:left">Expires</td>
<td style="text-align:left">这个头信息指定内容过期的时间，在这之后内容不再被缓存。</td>
</tr>
<tr>
<td style="text-align:left">Last-Modified</td>
<td style="text-align:left">这个头信息指示文档的最后修改时间。然后，客户端可以缓存文件，并在以后的请求中通过 <strong>If-Modified-Since</strong> 请求头信息提供一个日期。</td>
</tr>
<tr>
<td style="text-align:left">Location</td>
<td style="text-align:left">这个头信息应被包含在所有的带有状态码的响应中。在 300s 内，这会通知浏览器文档的地址。浏览器会自动重新连接到这个位置，并获取新的文档。</td>
</tr>
<tr>
<td style="text-align:left">Refresh</td>
<td style="text-align:left">这个头信息指定浏览器应该如何尽快请求更新的页面。您可以指定页面刷新的秒数。</td>
</tr>
<tr>
<td style="text-align:left">Retry-After</td>
<td style="text-align:left">这个头信息可以与 503（Service Unavailable 服务不可用）响应配合使用，这会告诉客户端多久就可以重复它的请求。</td>
</tr>
<tr>
<td style="text-align:left">Set-Cookie</td>
<td style="text-align:left">这个头信息指定一个与页面关联的 cookie。</td>
</tr>
</tbody>
</table>
</div>
<h5 id="4-设置-HTTP-响应报头的方法"><a href="#4-设置-HTTP-响应报头的方法" class="headerlink" title="4. 设置 HTTP 响应报头的方法"></a>4. 设置 HTTP 响应报头的方法</h5><p>下面的方法可用于在 Servlet 程序中设置 HTTP 响应报头。这些方法通过 <em>HttpServletResponse</em> 对象可用。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">序号</th>
<th style="text-align:left">方法 &amp; 描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left"><strong>String encodeRedirectURL(String url)</strong> 为 sendRedirect 方法中使用的指定的 URL 进行编码，或者如果编码不是必需的，则返回 URL 未改变。</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left"><strong>String encodeURL(String url)</strong> 对包含 session 会话 ID 的指定 URL 进行编码，或者如果编码不是必需的，则返回 URL 未改变。</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td style="text-align:left"><strong>boolean containsHeader(String name)</strong> 返回一个布尔值，指示是否已经设置已命名的响应报头。</td>
</tr>
<tr>
<td style="text-align:left">4</td>
<td style="text-align:left"><strong>boolean isCommitted()</strong> 返回一个布尔值，指示响应是否已经提交。</td>
</tr>
<tr>
<td style="text-align:left">5</td>
<td style="text-align:left"><strong>void addCookie(Cookie cookie)</strong> 把指定的 cookie 添加到响应。</td>
</tr>
<tr>
<td style="text-align:left">6</td>
<td style="text-align:left"><strong>void addDateHeader(String name, long date)</strong> 添加一个带有给定的名称和日期值的响应报头。</td>
</tr>
<tr>
<td style="text-align:left">7</td>
<td style="text-align:left"><strong>void addHeader(String name, String value)</strong> 添加一个带有给定的名称和值的响应报头。</td>
</tr>
<tr>
<td style="text-align:left">8</td>
<td style="text-align:left"><strong>void addIntHeader(String name, int value)</strong> 添加一个带有给定的名称和整数值的响应报头。</td>
</tr>
<tr>
<td style="text-align:left">9</td>
<td style="text-align:left"><strong>void flushBuffer()</strong> 强制任何在缓冲区中的内容被写入到客户端。</td>
</tr>
<tr>
<td style="text-align:left">10</td>
<td style="text-align:left"><strong>void reset()</strong> 清除缓冲区中存在的任何数据，包括状态码和头。</td>
</tr>
<tr>
<td style="text-align:left">11</td>
<td style="text-align:left"><strong>void resetBuffer()</strong> 清除响应中基础缓冲区的内容，不清除状态码和头。</td>
</tr>
<tr>
<td style="text-align:left">12</td>
<td style="text-align:left"><strong>void sendError(int sc)</strong> 使用指定的状态码发送错误响应到客户端，并清除缓冲区。</td>
</tr>
<tr>
<td style="text-align:left">13</td>
<td style="text-align:left"><strong>void sendError(int sc, String msg)</strong> 使用指定的状态发送错误响应到客户端。</td>
</tr>
<tr>
<td style="text-align:left">14</td>
<td style="text-align:left"><strong>void sendRedirect(String location)</strong> 使用指定的重定向位置 URL 发送临时重定向响应到客户端。</td>
</tr>
<tr>
<td style="text-align:left">15</td>
<td style="text-align:left"><strong>void setBufferSize(int size)</strong> 为响应主体设置首选的缓冲区大小。</td>
</tr>
<tr>
<td style="text-align:left">16</td>
<td style="text-align:left"><strong>void setCharacterEncoding(String charset)</strong> 设置被发送到客户端的响应的字符编码（MIME 字符集）例如，UTF-8。</td>
</tr>
<tr>
<td style="text-align:left">17</td>
<td style="text-align:left"><strong>void setContentLength(int len)</strong> 设置在 HTTP Servlet 响应中的内容主体的长度，该方法设置 HTTP Content-Length 头。</td>
</tr>
<tr>
<td style="text-align:left">18</td>
<td style="text-align:left"><strong>void setContentType(String type)</strong> 如果响应还未被提交，设置被发送到客户端的响应的内容类型。</td>
</tr>
<tr>
<td style="text-align:left">19</td>
<td style="text-align:left"><strong>void setDateHeader(String name, long date)</strong> 设置一个带有给定的名称和日期值的响应报头。</td>
</tr>
<tr>
<td style="text-align:left">20</td>
<td style="text-align:left"><strong>void setHeader(String name, String value)</strong> 设置一个带有给定的名称和值的响应报头。</td>
</tr>
<tr>
<td style="text-align:left">21</td>
<td style="text-align:left"><strong>void setIntHeader(String name, int value)</strong> 设置一个带有给定的名称和整数值的响应报头。</td>
</tr>
<tr>
<td style="text-align:left">22</td>
<td style="text-align:left"><strong>void setLocale(Locale loc)</strong> 如果响应还未被提交，设置响应的区域。</td>
</tr>
<tr>
<td style="text-align:left">23</td>
<td style="text-align:left"><strong>void setStatus(int sc)</strong> 为该响应设置状态码。</td>
</tr>
</tbody>
</table>
</div>
]]></content>
      <categories>
        <category>servlet</category>
      </categories>
      <tags>
        <tag>http学习</tag>
        <tag>request</tag>
        <tag>response</tag>
      </tags>
  </entry>
  <entry>
    <title>javaScript-1</title>
    <url>/2021/11/25/javaScript-1/</url>
    <content><![CDATA[<h3 id="一、DOM简单实现"><a href="#一、DOM简单实现" class="headerlink" title="一、DOM简单实现"></a>一、DOM简单实现</h3><ul>
<li>功能：控制html文档内容</li>
<li>代码： 获取页面标签(元素)对象 Element<ul>
<li>document.getElementById(“id值”)：通过元素的id值获取元素对象</li>
</ul>
</li>
<li>操作Element对象:<ul>
<li>设置属性值：<ul>
<li>明确获取的对象</li>
<li>查看文档，设置其拥有的属性</li>
</ul>
</li>
<li>修改标签内容：<ul>
<li>Element.innerHTML = “内容”;</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="二、事件的简单学习"><a href="#二、事件的简单学习" class="headerlink" title="二、事件的简单学习"></a>二、事件的简单学习</h3><ul>
<li><p>常用的事件:</p>
<ul>
<li><p>onload 加载完成事件:</p>
<p>页面加载完成之后，常用于做页面js 代码初始化操作</p>
</li>
<li><p>onclick单击事件:<br>常用于按钮的点击响应操作。</p>
</li>
<li><p>onblur失去焦点事件:<br>常用用于输入框失去焦点后验证其输入内容是否合法。</p>
</li>
<li><p>onchange内容发生改变事件:<br>常用于下拉列表和输入框内容发生改变后操作</p>
</li>
<li><p>onsubmit表单提交事件:<br>常用于表单提交前，验证所有表单项是否合法。</p>
</li>
</ul>
</li>
<li><p>功能：某些组件被执行了某些操作后，触发某些代码的执行。</p>
</li>
<li><p>如何绑定事件</p>
<ul>
<li><p>直接在html标签上，指定事件的属性值，属性值就是js代码或者函数</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">eg:&lt;p onclick=&quot;alert(&#x27;点击&#x27;);&quot;&gt;sada&lt;/p&gt;</span><br><span class="line">&lt;p onclick=&quot;fun();&quot;&gt;sada&lt;/p&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过js获取元素对象，指定事件属性，设置一个函数</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Element.onclick = fun;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="三、BOM"><a href="#三、BOM" class="headerlink" title="三、BOM"></a>三、BOM</h3><h5 id="1-概念"><a href="#1-概念" class="headerlink" title="1. 概念"></a>1. 概念</h5><ul>
<li>Browser object Model 浏览器对象模型、将浏览器的各个组成部分封装成对象。</li>
</ul>
<h5 id="2-对象"><a href="#2-对象" class="headerlink" title="2. 对象"></a>2. 对象</h5><ul>
<li>Window(窗口)</li>
<li>Navigator(浏览器)</li>
<li>Screen (客户端屏幕)</li>
<li>History(访问历史)</li>
<li>Location(浏览器地址)</li>
</ul>
<h5 id="3-Window-窗口-对象"><a href="#3-Window-窗口-对象" class="headerlink" title="3. Window(窗口)对象"></a>3. Window(窗口)对象</h5><ul>
<li><p>创建</p>
</li>
<li><p>方法</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 与弹出有关的方法</span><br><span class="line">    alert()		显示带有一段消息和—个确认按钮的警告框。</span><br><span class="line">    confirm()	显示带有一段消息以及确认按钮和取消按钮的对话框。（返回用户点击true和false）</span><br><span class="line">    prompt()	显示可提示用户输入的对话框。（返回用户输入值）</span><br><span class="line">2. 与打开有关的方法</span><br><span class="line">	close()关闭当前浏览器窗口。（谁调用关闭谁）</span><br><span class="line">	open()打开一个新的浏览器窗口。（返回一个window对象）</span><br><span class="line">3. 与定时器有关的方法</span><br><span class="line">	setTimeout()在指定的毫秒数后调用函数或计算表达式。(返回一个唯一标识)</span><br><span class="line">		参数：</span><br><span class="line">			1. js代码或者方法对象</span><br><span class="line">			2. 毫秒值</span><br><span class="line">	clearTimeout()取消申setTimeout()方法设置的timeout。</span><br><span class="line">		eg:</span><br><span class="line">            var id = setTimeout(&quot;alert(&#x27;dsada&#x27;)&quot;,2000);</span><br><span class="line">            clearTimeout(id);</span><br><span class="line">            </span><br><span class="line">	setInterval()按照指定的周期（以毫秒计）来调用函数或计算表达式。</span><br><span class="line">	clearInterval()取消由setInterval()设置的 timeout。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>属性</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">使用：</span><br><span class="line">window.属性	</span><br><span class="line">直接使用</span><br><span class="line">1. 获取其他的BOM对象</span><br><span class="line">	navigator(浏览器)</span><br><span class="line">    screen (客户端屏幕)</span><br><span class="line">    history(访问历史)</span><br><span class="line">    location(浏览器地址)</span><br><span class="line">2. 获取DOM对象</span><br><span class="line">	document</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>特点</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. Window对象不需要创建可以直接使用window使用。window.方法名();</span><br><span class="line">2. window引用可以省略。方法名();</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="4-Location-浏览器地址"><a href="#4-Location-浏览器地址" class="headerlink" title="4. Location(浏览器地址)"></a>4. Location(浏览器地址)</h5><p><strong>window.location 对象可用于获取当前页面地址（URL）并把浏览器重定向到新页面。</strong></p>
<ul>
<li><p>创建</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. window.location</span><br><span class="line">2. location</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">location.reload(); 重新加载页面</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>属性</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">window.location.href 返回当前页面的 href (URL)</span><br><span class="line">	* location.href = &quot;url&quot;; //设置页面</span><br><span class="line">window.location.hostname 返回 web 主机的域名</span><br><span class="line">window.location.pathname 返回当前页面的路径或文件名</span><br><span class="line">window.location.protocol 返回使用的 web 协议（http: 或 https:）</span><br><span class="line">window.location.assign 加载新文档</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="5-History：历史记录对象"><a href="#5-History：历史记录对象" class="headerlink" title="5. History：历史记录对象"></a>5. History：历史记录对象</h5><ol>
<li><p>创建(获取)：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. window.history;</span><br><span class="line">2. history</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">* back()	加载history列表中的前一个URL。</span><br><span class="line">* forward()	加载history 列表中的下一个URL。</span><br><span class="line">* go()		加载history列表中的某个具体页面。</span><br><span class="line">	*参数:</span><br><span class="line">		正数:前进几个历史记录</span><br><span class="line">		负数:后退几个历史记录</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>属性</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">*length    返回当前窗口历史列表中的URL数量。</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="四、DOM对象"><a href="#四、DOM对象" class="headerlink" title="四、DOM对象"></a>四、DOM对象</h3><h5 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h5><p><strong>通过 HTML DOM，JavaScript 能够访问和改变 HTML 文档的所有元素。</strong></p>
<p><strong>HTML DOM（文档对象模型）</strong></p>
<p>​    当网页被加载时，浏览器会创建页面的文档对象模型（<em>D</em>ocument <em>O</em>bject <em>M</em>odel）。</p>
<p><em>HTML DOM</em> 模型被结构化为<em>对象树</em>：</p>
<p><img src="/2021/11/25/javaScript-1/1.gif" alt></p>
<p>DOM 是一项 W3C (World Wide Web Consortium) 标准。</p>
<p>DOM 定义了访问文档的标准：</p>
<blockquote>
<p>“W3C 文档对象模型（DOM）是中立于平台和语言的接口，它允许程序和脚本动态地访问、更新文档的内容、结构和样式。”</p>
</blockquote>
<p>W3C DOM 标准被分为 3 个不同的部分：</p>
<ul>
<li>Core DOM - 所有文档类型的标准模型<ul>
<li>document    对象</li>
<li>element        对象</li>
<li>attribute       属性对象</li>
<li>text                对象</li>
<li>comment      注释对象</li>
<li>node              其他对象的父对象</li>
</ul>
</li>
<li>XML DOM - XML 文档的标准模型</li>
<li>HTML DOM - HTML 文档的标准模型</li>
</ul>
<h5 id="2-作用"><a href="#2-作用" class="headerlink" title="2. 作用"></a>2. 作用</h5><p>通过这个对象模型，JavaScript 获得创建动态 HTML 的所有力量：</p>
<ul>
<li>JavaScript 能改变页面中的所有 HTML 元素</li>
<li>JavaScript 能改变页面中的所有 HTML 属性</li>
<li>JavaScript 能改变页面中的所有 CSS 样式</li>
<li>JavaScript 能删除已有的 HTML 元素和属性</li>
<li>JavaScript 能添加新的 HTML 元素和属性</li>
<li>JavaScript 能对页面中所有已有的 HTML 事件作出反应</li>
<li>JavaScript 能在页面中创建新的 HTML 事件</li>
</ul>
<h5 id="3-核心DOM"><a href="#3-核心DOM" class="headerlink" title="3. 核心DOM"></a>3. 核心DOM</h5><ul>
<li><p>document对象</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 创建</span><br><span class="line">	window.document</span><br><span class="line">	document</span><br><span class="line">2. 方法</span><br><span class="line">	获取Element对象∶（数组元素.length,获取长度）</span><br><span class="line">        1. getElementById()︰根据id属性值获取元素对象。id属性值一般唯一</span><br><span class="line">        2. getElementsByTagName():根据元秦名称获取元秦对象们。返回值是一个数组</span><br><span class="line">        3. getElementseyclassName():根掘class属性值获取元素对象们。返回值是一个数组</span><br><span class="line">        4. getElementsByName(): 根据name属性值获取元素对象们。返回值是一个数组</span><br><span class="line">	创建其他DOM对象</span><br><span class="line">        createAttribute(name)</span><br><span class="line">        createComment()</span><br><span class="line">        createElement()</span><br><span class="line">        createTextNode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>element元素对象</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 获取/创建：通过document来获取和创建</span><br><span class="line">2. 方法：</span><br><span class="line">	1. removeAttribute(): 删除属性</span><br><span class="line">	2. setAttribute(): 设置属性</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>node节点对象</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">*特点:所有dom对象都可以被认为是一个节点</span><br><span class="line">*方法∶</span><br><span class="line">    CRUD dom 树:</span><br><span class="line">        * appendChild():向节点的子节点列表的结尾添加新的子节点。</span><br><span class="line">        * removeChild() :删除(并返回)当前节点的指定子节点。</span><br><span class="line">        * replaceChild() :用新节点替换一个子节点。</span><br><span class="line">*属性︰</span><br><span class="line">	parentNode : 获取父节点</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="4-html-DOM"><a href="#4-html-DOM" class="headerlink" title="4. html DOM"></a>4. html DOM</h5><p>1．标签体的设置和获取:innerHTML</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">元素.innerHTML = &quot;&quot;</span><br><span class="line">元素.innerHTML += &quot;&quot;</span><br></pre></td></tr></table></figure>
<p>2．使用html元素对象的属性</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">查看元素属性</span><br></pre></td></tr></table></figure>
<p>3．控制样式</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">设置样式</span><br><span class="line">	* 使用元素style属性</span><br><span class="line">		1. 元素.style.样式 = &quot;&quot;</span><br><span class="line">		eg:</span><br><span class="line">		div1.style.border = &quot;1px solid black&quot;</span><br><span class="line">		div1.style.fontSize = &quot;20px&quot;   ---注意font-size 设置时去掉&quot;-&quot;第二个单词大写</span><br><span class="line">	* 定义类选择器，使用className设置元素属性值</span><br><span class="line">		div2.className = &quot;&quot;</span><br><span class="line">		</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>javaScript</category>
      </categories>
      <tags>
        <tag>DOM</tag>
        <tag>BOM</tag>
        <tag>事件</tag>
      </tags>
  </entry>
  <entry>
    <title>javaScript</title>
    <url>/2021/11/24/javaScript/</url>
    <content><![CDATA[<h3 id="javaScript-基础"><a href="#javaScript-基础" class="headerlink" title="javaScript 基础"></a>javaScript 基础</h3><ol>
<li><p>定义及引入</p>
<ul>
<li><p>内部Js : 定义<script>，标签体内容就是js代码</p>
</li>
<li><p>外部Js : 定义外部js文件，使用<script src=""></script></p>
</li>
</ul>
</li>
<li><p>注释</p>
<ul>
<li>单行注释： //</li>
<li>多行注释：/**/</li>
</ul>
</li>
<li><p>数据类型</p>
<ul>
<li><p>原始数据类型（基本数据类型）</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.number:数字。 ---整数/小数/NaN(not a number一个不是数字的数字类型)</span><br><span class="line">2.string:字符串。</span><br><span class="line">3.boolean: true和false</span><br><span class="line">4.null: 一个对象为空的占位符</span><br><span class="line">5.undefined: 未定义。 如果一个变量没有给初始化值，则会被默认赋值为undefined</span><br></pre></td></tr></table></figure>
</li>
<li><p>引用数据类型（对象）</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">     </span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>变量</p>
<ul>
<li><p>在函数内部定义的变量称为局部变量，其作用域为该函数内部，在该函数外部不能被访问。</p>
</li>
<li><p>定义在函数外部的变量称为全局变量，，其作用域是整个JavaScript代码块。</p>
</li>
<li><p>弱类型的，使用（var 变量名=初始值） ，函数内部不使用var是全局变量</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">定义，输出(document.write())，查看类型（typeof()）</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var num = 1;</span><br><span class="line">    var num1 = 3;</span><br><span class="line">    var num3 = NaN;</span><br><span class="line">    document.write(num+&quot;----&quot;+typeof(num)+&quot;&lt;br&gt;&quot;)</span><br><span class="line">    document.write(num1+&quot;&lt;br&gt;&quot;)</span><br><span class="line">    document.write(num3+&quot;&lt;br&gt;&quot;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<ol>
<li><p>运算符</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 一元运算符：</span><br><span class="line">	* ++</span><br><span class="line">	* --</span><br><span class="line">	* +（-）</span><br><span class="line">		var= +123456”“（字符串转数字）</span><br><span class="line">2. 算术运算符：</span><br><span class="line">	* +、-、*、/、%...</span><br><span class="line">3. 赋值运算符</span><br><span class="line">	* =、+=、-= ...</span><br><span class="line">4. 比较运算符</span><br><span class="line">	1. 字符串比较是，按位比较ASCII码 </span><br><span class="line">	2. 类型不同，先转换类型在比较</span><br><span class="line">	3. 全等于先判断类型，类型相同再比较</span><br><span class="line">	&gt;、 &lt;、 &gt;=、 &lt;=、 ==、 ===(全等于)</span><br><span class="line">5. 逻辑运算符</span><br><span class="line">	&amp;&amp;、||、！</span><br><span class="line">	注意：其他类型转boolean:(语法：!!其他类型)</span><br><span class="line">		1. number: 0或NAN为假，其他为真</span><br><span class="line">		2. string: 除了空字符串(&quot;&quot;)，其他都是true</span><br><span class="line">		3. null&amp;&amp;undefined 都是false</span><br><span class="line">		4. 对象：所有对象都为true</span><br><span class="line">		</span><br><span class="line">6. 三元运算符</span><br><span class="line">	逻辑表达式?a:b</span><br></pre></td></tr></table></figure>
</li>
<li><p>对象</p>
<ul>
<li><p>function对象：函数对象</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">* 创建：</span><br><span class="line">	1. var fun = new Function(形式参数列表，方法体)---基本不用</span><br><span class="line">	2. Function 方法名 (参数列表)&#123;</span><br><span class="line">		方法体</span><br><span class="line">	&#125;</span><br><span class="line">* 方法：	</span><br><span class="line">* 属性：</span><br><span class="line">	length:代表形参个数</span><br><span class="line">* 特点：</span><br><span class="line">	1. 方法定义时，形参类型不用写</span><br><span class="line">	2. 方法是一个对象，如果定义名称相同的方法，会覆盖</span><br><span class="line">	3．在JS中，方法的调用只与方法的名称有关，和参数列表无关</span><br><span class="line">	4．在方法声明中有一个隐藏的内置对象（数组）,arguments,封装所有的实际参数</span><br><span class="line">* 调用：</span><br><span class="line">	方法名称(实际参数列表)</span><br></pre></td></tr></table></figure>
</li>
<li><p>Array:数字对象</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 创建：</span><br><span class="line">	1. var arr = new Array(元素列表);</span><br><span class="line">	2. var arr = new Array(默认长度);</span><br><span class="line">	3. var arr = [元素列表]</span><br><span class="line">2. 方法：</span><br><span class="line">	* join():将数组中的元素拼接为字符串</span><br><span class="line">	* join(参数):将数组中的元素按照指定的分割符拼接为字符串</span><br><span class="line">		eg：join(&quot;--&quot;)</span><br><span class="line">	* push():在数组的尾部添加一个元素</span><br><span class="line">	* pop():删除并返回数组的最后一个元素</span><br><span class="line">	* sort(); 排序</span><br><span class="line">	* reverse(): 颠倒数组元素</span><br><span class="line">	* toString(): 数组转化为字符串并返回</span><br><span class="line">3. 属性：</span><br><span class="line">	arr.length</span><br><span class="line">4. 特点：</span><br><span class="line">	* JS 中，数组元素的类型可变</span><br><span class="line">		eg:var arr = [1,&quot;asd&quot;,true]</span><br><span class="line">	* </span><br><span class="line">5. 访问：</span><br><span class="line">	* 通过下标索引:</span><br><span class="line">		eg: arr[1]</span><br></pre></td></tr></table></figure>
</li>
<li><p>Data对象</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 创建：</span><br><span class="line">	var date = new Date();</span><br><span class="line"></span><br><span class="line">2. 方法：</span><br><span class="line">	toLocalString():返回当前date对象对应时间的本地格式字符串</span><br><span class="line">	getTime():获取毫秒值。1970/1/1---当前</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>Math对象</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 创建：</span><br><span class="line">	不用创建，直接使用</span><br><span class="line">		Math.方法名();</span><br><span class="line"></span><br><span class="line">2. 方法：</span><br><span class="line">	random() -- 0-1之间的随机数(不包含1)</span><br><span class="line">	ceil(x) --对数进行上舍入</span><br><span class="line">	floor(x) --对数进行下舍入</span><br><span class="line">	round(x) --四舍五入</span><br><span class="line">3. 属性：</span><br><span class="line">	Math.PI</span><br></pre></td></tr></table></figure>
</li>
<li><p>正则表达式规则</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">一、正则表达式(regular expression)描述了一种字符串匹配的模式（pattern），可以用来检查一个串是否含有某种子串、将匹配的子串替换或者从某个串中取出符合某个条件的子串等。</span><br><span class="line">1. 单个字符：[]</span><br><span class="line">	eg：[a] [ab] [a-zA-Z0-9]</span><br><span class="line">	* 特殊符号代表特殊含义的单个字符：</span><br><span class="line">		\d：单个数字</span><br><span class="line">		\w：匹配字母或数字或下划线或汉字 等价于 &#x27;[^A-Za-z0-9_]&#x27;。</span><br><span class="line">		\s: 匹配任意的空白符</span><br><span class="line">		\b: 匹配单词的开始或结束</span><br><span class="line">		^:  匹配字符串的开始</span><br><span class="line">		$:  匹配字符串的结束</span><br><span class="line">2. 量词符号：</span><br><span class="line">	?: 表示出现0次或者1次</span><br><span class="line">	*： 表示出现0次或多次</span><br><span class="line">	+： 表示出现1次或者多次</span><br><span class="line">	eg:</span><br><span class="line">		\w*  --出现一次或者多次</span><br><span class="line">		\w&#123;m,n&#125;  --出现m-n次</span><br><span class="line">3.开始结束符号</span><br><span class="line">	* ^ 开始 </span><br><span class="line">	* $ 结束</span><br></pre></td></tr></table></figure>
</li>
<li><p>RegExp：正则表达式对象</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 创建：</span><br><span class="line">	1. var reg = new RegExp(&quot;正则表达式&quot;); -- 注意：不常用，并且其中&#x27;\&#x27;要使用转义符&quot;\\&quot;</span><br><span class="line">	2. var reg = /正则表达式/; -- 不用转义符，直接写正则表达式</span><br><span class="line">	eg:</span><br><span class="line">		var reg = new RegExp(&quot;^\w&#123;1,2&#125;$&quot;)</span><br><span class="line">        var reg1 = /^w&#123;6,12&#125;$/</span><br><span class="line"></span><br><span class="line">2. 方法：</span><br><span class="line">	test():验证指定字符串是否符合正则定义的规范</span><br><span class="line">3. 属性：</span><br><span class="line">	Math.PI</span><br></pre></td></tr></table></figure>
</li>
<li><p>Global对象</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 特点：全局对象，这个对象中的方法不需要对象就可以之间访问 </span><br><span class="line">	格式： 方法名()</span><br><span class="line">	eg：</span><br><span class="line"></span><br><span class="line">2. 方法：</span><br><span class="line">	1. encodeURI() : URI编码 </span><br><span class="line">    此函数对特殊字符进行编码，除了： , / ? : @ &amp; = + $ #（请使用 encodeURIComponent() 对这些字符进行编码）。</span><br><span class="line">    eg:</span><br><span class="line">	2. decodeURI() : URI解码 </span><br><span class="line">	此函数对已编码的 URI 进行解码。</span><br><span class="line">	</span><br><span class="line">    //编码的字符更多</span><br><span class="line">	3. decodeURIComponent() ：URI解码</span><br><span class="line">	4. encodeURIComponent() : URI编码</span><br><span class="line">	</span><br><span class="line">	5. parseInt()</span><br><span class="line">			* 逐一判断每一个字符是否是数字，将前面的数字部分转换为number</span><br><span class="line">	6. isNaN();判断一个值是否是NaN</span><br><span class="line">			* NaN十分特殊。NaN参与的==比较全部问false</span><br><span class="line">	7. eval(): 将JavaScript 字符串 作为脚本代码执行执行</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
]]></content>
      <categories>
        <category>javaScript</category>
      </categories>
      <tags>
        <tag>javaScript学习</tag>
      </tags>
  </entry>
  <entry>
    <title>jquery_animation</title>
    <url>/2022/02/16/jquery-animation/</url>
    <content><![CDATA[<h1 id="jquery高级"><a href="#jquery高级" class="headerlink" title="jquery高级"></a>jquery高级</h1><h2 id="一、jQuery动画"><a href="#一、jQuery动画" class="headerlink" title="一、jQuery动画"></a>一、jQuery动画</h2><ol>
<li><p>三种方式显示和隐藏元素</p>
<ul>
<li><p>默认显示和隐藏方式</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">//参数</span><br><span class="line">//1.speed: 动画速度.三个预定义值（&quot;slow&quot;,&quot;normal&quot;,&quot;fast&quot;）,或者传入动画时长毫秒值</span><br><span class="line">//2.easing:</span><br><span class="line">//	* swing:动画执行时效果先慢，中间快，最后慢（默认）</span><br><span class="line">//	* linear:动画匀速</span><br><span class="line">//3.fn:动画完成时执行的函数，每个元素执行一次</span><br><span class="line">1.show([speed],[easing],[fn])</span><br><span class="line">2.hide([speed],[easing],[fn])</span><br><span class="line">3.toggle([speed],[easing],[fn])</span><br><span class="line">eg:</span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.div1</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="attribute">height</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">width</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="css">        <span class="attribute">background-color</span>: red;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>元素显示和隐藏动画<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;div1&quot;</span>&gt;</span></span><br><span class="line">        hh</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;b1&quot;</span>&gt;</span>默认动画显示<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;b2&quot;</span>&gt;</span>默认动画隐藏<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;b3&quot;</span>&gt;</span>默认动画显示和隐藏<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">&quot;#b1&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// $(&quot;.div1&quot;).show(&quot;slow&quot;,&quot;swing&quot;,function()&#123;</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//     alert(&quot;显示&quot;);</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">// &#125;);</span></span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;.div1&quot;</span>).show(<span class="string">&quot;slow&quot;</span>,<span class="string">&quot;swing&quot;</span>);</span></span><br><span class="line"><span class="javascript">        &#125;);</span></span><br><span class="line"><span class="javascript">        $(<span class="string">&quot;#b2&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// $(&quot;.div1&quot;).hide(&quot;slow&quot;,&quot;swing&quot;,function()&#123;</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//     alert(&quot;隐藏&quot;);</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">// &#125;);</span></span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;.div1&quot;</span>).hide(<span class="string">&quot;slow&quot;</span>,<span class="string">&quot;swing&quot;</span>);</span></span><br><span class="line"><span class="javascript">        &#125;);</span></span><br><span class="line"><span class="javascript">        $(<span class="string">&quot;#b3&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// $(&quot;.div1&quot;).toggle(&quot;slow&quot;,&quot;swing&quot;,function()&#123;</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//     alert(&quot;隐藏&quot;);</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">// &#125;);</span></span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;.div1&quot;</span>).toggle(<span class="string">&quot;slow&quot;</span>,<span class="string">&quot;swing&quot;</span>);</span></span><br><span class="line"><span class="javascript">        &#125;);</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>滑动显示和隐藏方式</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> slideDown([speed],[easing],[fn])</span><br><span class="line"><span class="number">2.</span> slideUp([speed],[easing],[fn])</span><br><span class="line"><span class="number">3.</span> slideToggle([speed],[easing],[fn])</span><br></pre></td></tr></table></figure>
</li>
<li><p>淡入淡出显示和隐藏方式</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span>fadeIn([speed],[easing],[fn])</span><br><span class="line"><span class="number">2.</span>fadeOut([speed],[easing],[fn])</span><br><span class="line"><span class="number">3.</span>fadeToggle([speed],[easing],[fn])</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h2 id="二、jQuery遍历"><a href="#二、jQuery遍历" class="headerlink" title="二、jQuery遍历"></a>二、jQuery遍历</h2><ol>
<li><p>js遍历方式</p>
<ul>
<li><p>for(初始化值；循环结束条件；步长)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;city&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>北京<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>上海<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>武汉<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>深圳<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>重庆<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>成都<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> ulcity = $(<span class="string">&quot;#city li&quot;</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> len = ulcity.length;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>;i&lt;len;i++)&#123;</span></span><br><span class="line"><span class="javascript">            alert(ulcity[i].innerHTML);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<ol>
<li><p>jq遍历方式</p>
<ul>
<li><p>jq对象.each(callback函数)</p>
</li>
<li><p><strong>通过callback函数的返回值可以控制循环，达到break和continue的效果</strong></p>
<ul>
<li>return false；相当于break</li>
<li>return true；相当于continue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;city&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>北京<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>上海<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>武汉<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>深圳<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>重庆<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>成都<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> ulcity = $(<span class="string">&quot;#city li&quot;</span>);</span></span><br><span class="line"><span class="javascript">        <span class="comment">//第一种方式</span></span></span><br><span class="line"><span class="javascript">        ulcity.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">//this代表每次遍历得到的js对象</span></span></span><br><span class="line"><span class="javascript">            alert(<span class="built_in">this</span>.innerHTML);</span></span><br><span class="line"><span class="javascript">        &#125;);</span></span><br><span class="line"><span class="javascript">        <span class="comment">//第二种方式</span></span></span><br><span class="line"><span class="javascript">        ulcity.each(<span class="function"><span class="keyword">function</span>(<span class="params">index,element</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">//index代表遍历索引</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//element代表每次遍历得到的js对象次</span></span></span><br><span class="line"><span class="javascript">            alert(<span class="string">&quot;第&quot;</span>+index+<span class="string">&quot;次 : &quot;</span>+element.innerHTML);</span></span><br><span class="line"><span class="javascript">        &#125;);</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<ul>
<li><p>(jQuery或者$).each(object,callback函数)————-jquery可以用\$符号代替</p>
<ul>
<li>使用方法同上</li>
</ul>
</li>
<li><p>for..of: （jquery3.0以上）</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">eg:</span><br><span class="line"><span class="keyword">for</span>(li <span class="keyword">of</span> citys)&#123;</span><br><span class="line">	alert($(li).html());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="三、jQuery事件绑定"><a href="#三、jQuery事件绑定" class="headerlink" title="三、jQuery事件绑定"></a>三、jQuery事件绑定</h2><ol>
<li><p>jquery标准的绑定事件方式</p>
<ul>
<li>jq对象.事件方法（回调函数）;</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mouseover(回调函数):鼠标移动到元素上</span><br><span class="line">mouseout(回调函数):鼠标从元素上移出</span><br><span class="line">click(回调函数):鼠标点击</span><br><span class="line">* 特殊的事件</span><br><span class="line">1. focus():直接调用focus()，不传入回调函数，则表示让元素获得焦点。</span><br><span class="line">2. 表单对象.submit(): //让表单提交</span><br></pre></td></tr></table></figure>
</li>
<li><p>on绑定事件/off解除绑定</p>
<ul>
<li>jq对象.on(“事件名称”，回调函数)；</li>
<li>jq对象.off(“事件名称”)；<ul>
<li>如果off()函数不传递任何参数，则会将调用方法的元素上的所有事件全部解绑</li>
</ul>
</li>
</ul>
</li>
<li><p>事件切换：toggle（jquery1.9以上版本将次功能删除，如果要使用则要导入jQuery Migrate(迁移) js文件）</p>
<ul>
<li>jq对象.toggle(fn1,fn2,…)；———-fni 代表第几个回调函数</li>
</ul>
</li>
</ol>
<h2 id="四、案例"><a href="#四、案例" class="headerlink" title="四、案例"></a>四、案例</h2><ol>
<li><p>广告图片显示</p>
<ul>
<li>页面弹出3秒后淡入图片</li>
<li>使用定时器<ul>
<li>setTimeout(函数，时间t)；// t毫秒后执行</li>
<li>setInterval(函数，时间t)；// 每t毫秒后循环执行</li>
</ul>
</li>
<li>定时器停止<ul>
<li>setInterval函数会返回一个startID</li>
<li>clearInterval(startID);和clearTimeout就可以停止</li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;.div1&quot;</span>).fadeToggle(<span class="number">3000</span>,<span class="string">&quot;swing&quot;</span>);</span></span><br><span class="line"><span class="javascript">        &#125;,<span class="number">3000</span>);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;.div1&quot;</span>).fadeToggle(<span class="number">3000</span>,<span class="string">&quot;swing&quot;</span>);</span></span><br><span class="line"><span class="javascript">        &#125;,<span class="number">8000</span>);</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>抽奖案例</p>
<ul>
<li>点击抽奖按钮，图片进行快速变动</li>
<li>点击停止，图片定格，并且以动画形式显示</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;div1&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./imgs/picture/001.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;img1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;b1&quot;</span>&gt;</span>抽奖<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;b2&quot;</span> <span class="attr">disabled</span>&gt;</span>停止<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./imgs/picture/001.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;img2&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> pre_imgssrc = <span class="string">&quot;./imgs/picture/&quot;</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> end_imgssrc = <span class="string">&quot;.jpg&quot;</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> startID;</span></span><br><span class="line"><span class="javascript">       $(<span class="string">&quot;#b1&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">           $(<span class="string">&quot;#img2&quot;</span>).slideUp(<span class="string">&quot;fast&quot;</span>,<span class="string">&quot;swing&quot;</span>);</span></span><br><span class="line"><span class="javascript">           $(<span class="string">&quot;#b1&quot;</span>).prop(<span class="string">&quot;disabled&quot;</span>,<span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">           $(<span class="string">&quot;#b2&quot;</span>).prop(<span class="string">&quot;disabled&quot;</span>,<span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript">        startID = <span class="built_in">setInterval</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> num = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random()*<span class="number">199</span>);</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> middle = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span>(num&gt;=<span class="number">100</span>)</span></span><br><span class="line"><span class="javascript">                    middle = <span class="string">&quot;&quot;</span>+num;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">else</span> <span class="keyword">if</span>(num&gt;=<span class="number">10</span>)</span></span><br><span class="line"><span class="javascript">                    middle = <span class="string">&quot;0&quot;</span>+num;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">else</span></span></span><br><span class="line"><span class="javascript">                    middle = <span class="string">&quot;00&quot;</span>+num;</span></span><br><span class="line"><span class="javascript">                $(<span class="string">&quot;#img1&quot;</span>).prop(<span class="string">&quot;src&quot;</span>,pre_imgssrc+middle+end_imgssrc);</span></span><br><span class="line"><span class="javascript">            &#125;,<span class="number">20</span>);</span></span><br><span class="line"><span class="javascript">       &#125;);</span></span><br><span class="line"><span class="javascript">       $(<span class="string">&quot;#b2&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">clearInterval</span>(startID);</span></span><br><span class="line"><span class="javascript">        $(<span class="string">&quot;#img2&quot;</span>).prop(<span class="string">&quot;src&quot;</span>,$(<span class="string">&quot;#img1&quot;</span>).prop(<span class="string">&quot;src&quot;</span>)).slideDown(<span class="string">&quot;slow&quot;</span>,<span class="string">&quot;swing&quot;</span>);</span></span><br><span class="line"><span class="javascript">        $(<span class="string">&quot;#b1&quot;</span>).prop(<span class="string">&quot;disabled&quot;</span>,<span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript">        $(<span class="string">&quot;#b2&quot;</span>).prop(<span class="string">&quot;disabled&quot;</span>,<span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">       &#125;);</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="五、插件：增强jQuery功能"><a href="#五、插件：增强jQuery功能" class="headerlink" title="五、插件：增强jQuery功能"></a>五、插件：增强jQuery功能</h2><ol>
<li><p>实现方式：</p>
<ul>
<li><p>$.fn.extend(object)</p>
<ul>
<li><p>增强jQuery获取的对象的功能 eg:$(“#id”)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    $.fn.extend(&#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">check</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            alert(<span class="string">&quot;123&quot;</span>);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">&quot;#b1&quot;</span>).check();</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<ul>
<li><p>$.extend(object)</p>
<ul>
<li><p>增强jQuery对象自身的功能</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    $.extend(&#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">max</span>:<span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span>(a&gt;b)</span></span><br><span class="line"><span class="javascript">                <span class="keyword">return</span> a;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">else</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">return</span> b;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        alert($.max(<span class="number">5</span>,<span class="number">66</span>));</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ol>
<li><p>案例：</p>
<ol>
<li><p>弹出数字方法：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    $.fn.extend(&#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">check</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            alert(<span class="string">&quot;123&quot;</span>);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">&quot;#b1&quot;</span>).check();</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>复选框选中与不选中</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    $.fn.extend(&#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">check</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.prop(<span class="string">&quot;checked&quot;</span>,<span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">        &#125;,</span></span><br><span class="line"><span class="javascript">        <span class="attr">uncheck</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.prop(<span class="string">&quot;checked&quot;</span>,<span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">&quot;#b1&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;input[type=&#x27;checkbox&#x27;]&quot;</span>).check();</span></span><br><span class="line"><span class="javascript">        &#125;);</span></span><br><span class="line"><span class="javascript">        $(<span class="string">&quot;#b2&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;input[type=&#x27;checkbox&#x27;]&quot;</span>).uncheck();</span></span><br><span class="line"><span class="javascript">        &#125;);</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;b1&quot;</span>&gt;</span>全选<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;b2&quot;</span>&gt;</span>全不选<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    a：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    b：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    c：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>返回两数中较大的数</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    $.extend(&#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">max</span>:<span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span>(a&gt;b)</span></span><br><span class="line"><span class="javascript">                <span class="keyword">return</span> a;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">else</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">return</span> b;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        alert($.max(<span class="number">5</span>,<span class="number">66</span>));</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>jquery</category>
      </categories>
      <tags>
        <tag>jquery</tag>
      </tags>
  </entry>
  <entry>
    <title>jquery</title>
    <url>/2022/01/27/jquery/</url>
    <content><![CDATA[<h3 id="1-jquery快速入门"><a href="#1-jquery快速入门" class="headerlink" title="1.jquery快速入门"></a>1.jquery快速入门</h3><ul>
<li>下载jquery</li>
<li>导入jquery的js文件<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;./resources/js/jquery-3.4.1.min.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure></li>
<li>使用<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据元素id获取元素JQuery对象</span></span><br><span class="line"><span class="keyword">var</span> div1 = $(<span class="string">&quot;#div1&quot;</span>);</span><br><span class="line"><span class="comment">//JS对象使用innerHTML获取标签体的内容，JQuery对象用html()方法</span></span><br><span class="line">alert(div1.html());</span><br></pre></td></tr></table></figure>
<h3 id="2-JQuery对象与JS对象的区别与转换"><a href="#2-JQuery对象与JS对象的区别与转换" class="headerlink" title="2.JQuery对象与JS对象的区别与转换"></a>2.JQuery对象与JS对象的区别与转换</h3></li>
<li>使用js和Jq获取的元素对象是有区别的（方法不通用）  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1.js和jq两种方式通过标签获取到的元素对象集合都可以当成数组使用，但是jq使用起来更为方便</span></span><br><span class="line"><span class="comment">//获取js元素</span></span><br><span class="line"><span class="keyword">var</span> divs = <span class="built_in">document</span>.getElementsByTagName(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">alert(divs.length);</span><br><span class="line"><span class="comment">//获取JQuery元素</span></span><br><span class="line"><span class="keyword">var</span> jqDivs = $(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">alert($divs.length);</span><br><span class="line"><span class="comment">//2. 遍历获取到的元素对象，将标签体的内容修改为“aaa”</span></span><br><span class="line"><span class="comment">// * js 操作</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>;i&lt;divs.length;i++)&#123;</span><br><span class="line">    divs[i].innerHTML = <span class="string">&quot;aaa&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// * jq操作</span></span><br><span class="line"><span class="comment">// html(&quot;aaa&quot;)会修改所有的元素标签体</span></span><br><span class="line">jqDivs.html(<span class="string">&quot;aaa&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>相互转换</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//js对象转换为jq对象</span></span><br><span class="line">$(js对象)</span><br><span class="line"><span class="comment">//jq对象转换为js对象</span></span><br><span class="line">jq对象[索引]  <span class="comment">// eg: $(&quot;#div1&quot;)[0]</span></span><br><span class="line">jq对象.get(索引)</span><br></pre></td></tr></table></figure>
<h3 id="3-选择器（筛选具有相同特征的元素）"><a href="#3-选择器（筛选具有相同特征的元素）" class="headerlink" title="3.选择器（筛选具有相同特征的元素）"></a>3.选择器（筛选具有相同特征的元素）</h3></li>
<li><p>获取父元素</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">//parent是找当前元素的第一个父节点，parents是找当前元素的所有父节点 </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&#x27;div1&#x27;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&#x27;div2&#x27;</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&#x27;div3&#x27;</span> <span class="attr">class</span>=<span class="string">&#x27;a&#x27;</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&#x27;div4&#x27;</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">$(&#x27;p&#x27;).parent()取到的是div2,div3,div4</span><br><span class="line">$(&#x27;p&#x27;).parent(&#x27;.a&#x27;)取到的是div3</span><br><span class="line">$(&#x27;p&#x27;).parent().parent()取到的是div1</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>基本语法学习：</p>
<ul>
<li>事件绑定<ol>
<li>绑定点击事件： <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//js中的写法</span></span><br><span class="line">js对象.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//使用jq对象的click(function)方法，传入一个匿名函数</span></span><br><span class="line">$(<span class="string">&quot;#b1&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    alert(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li>入口函数<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//js中的写法</span></span><br><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//jq中的写法(dom文档加载完后就执行)</span></span><br><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//两种方式有区别</span></span><br><span class="line"><span class="comment">//* window.onload只能定义一次，多次则会将前面的覆盖</span></span><br><span class="line"><span class="comment">//$(function()方式可以定义多次，绑定多个function</span></span><br></pre></td></tr></table></figure></li>
<li><p>样式控制</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//使用jq对象.css(&quot;&quot;,&quot;&quot;)方法，传入两个参数：样式名称，样式值</span></span><br><span class="line">$(<span class="string">&quot;#div1&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>分类</p>
<ul>
<li>基本选择器：</li>
<li>1、标签选择器(元素选择器)<ul>
<li>标签选择器：语法:$(“html标签名”)获得所有匹配标签名称的元素</li>
<li>id选择器：语法:$(“#id的属性值”)获得与指定id属性值匹配的元素</li>
<li>类选择器：语法︰$(“.class的属性值”)获得与指定的class属性值匹配的元秦</li>
<li>并集选择器：语法:$(“选择器1,选择器2”)</li>
</ul>
</li>
<li>2、层级选择器<ul>
<li>后代选择器（所有后代）：语法:$(“A B “)选择A元秦内部的所有B元素</li>
<li>子选择器（只选择下一级）：语法:$(“A&gt;B”)选择A元素内部的所有B子元素</li>
</ul>
</li>
<li>3、属性选择器<ul>
<li>属性名称选择器：语法:$(“A[属性名]”)包含指定属性的选择器</li>
<li>属性选择器：语法:$(“A[属性名=’值’]”)包含指定属性等于指定值的选择器<ul>
<li>A[属性名!=’值’]:不等于’值’</li>
<li>A[属性名^=’值’]:以’值’开始</li>
<li>A[属性名$=’值’]:以’值’结束</li>
<li>A[属性名*=’值’]:包函’值’</li>
</ul>
</li>
<li>复合属性选择器：语法:$(“A[属性名=’值’][]…”)包含多个属性条件的选择器</li>
</ul>
</li>
<li>4、过滤选择器<ul>
<li>首元素选择器：语法 —- :first获得选择的元素中的第一个元素</li>
<li>尾元素选择器：语法—- :last获得选择的元素中的最后一个元素</li>
<li>非元素选择器：语法—-   :not(selector)不包括指定内容的元素 eg: $(“div:not(.one)”)</li>
<li>偶数选择器：语法—-      :even偶数，从o 开始计数</li>
<li>奇数选择器：语法—-       :odd奇数，从o 开始计数</li>
<li>等于索引选择器：语法—-   :ea(index)指定索引元素</li>
<li>大于索引选择器：语法—-   :gt(index)大于指定索引元素</li>
<li>小于索引选择器：语法—-   :lt(index)小于指定索引元秦</li>
<li>标题选择器：语法—-           :header获得标题(h1~h6)元素，固定写法</li>
</ul>
</li>
<li>5、表单过滤选择器</li>
<li>可用元素选择器：语法—-           :enabled 获得可用元素</li>
<li>不可用元素选择器：语法—-       :disabled获得不可用元素</li>
<li>选中选择器：语法—-                   : checked 获得单选/复选框选中的元素</li>
<li>选中选择器：语法—-                   :selected 获得下拉框选中的元素</li>
</ul>
</li>
</ul>
</li>
<li><p>DOM操作 </p>
</li>
</ul>
<ol>
<li><p>内容操作</p>
<ol>
<li>html():获取/设置元秦的标签体内容〈a&gt;<font>内容</font>&lt;/a&gt; —&gt;〈font&gt;内容&lt;/font&gt;</li>
<li>text():获取/设置元秦的标签体纯文本内容〈a&gt;<font>内容</font>&lt;/a&gt;—&gt;内容</li>
<li>val(:获取/设置元素的value属性值</li>
</ol>
</li>
<li><p>属性操作</p>
</li>
</ol>
<ul>
<li><p>通用属性操作</p>
<ol>
<li>attr():获取/设置元素的属性</li>
<li>removeAttr():删除属性</li>
<li>prop():获取/设置元素的属性</li>
<li>emoveProp():删除属性</li>
</ol>
<ul>
<li>attr和prop区别?</li>
</ul>
<ol>
<li>如果操作的是元素的固有属性，则建议使用prop</li>
<li>如果操作的是元素自定义的属性，则建议使用attr</li>
</ol>
</li>
<li><p>对class属性操作</p>
</li>
</ul>
<ol>
<li>addclass():添加class属性值</li>
<li>removeclass():删除class属性值</li>
<li>toggleclass():切换class属性</li>
</ol>
<ul>
<li>toggleclass( “one” ) :<ul>
<li>判断如果元素对象上存在class=”one”，则将属性值one删除掉。如果元素对象上不存在class=”one”，则添加</li>
</ul>
</li>
</ul>
<p>3.CRUD操作</p>
<ul>
<li>append():父元素将子元素追加到末尾<ul>
<li>对象1.append(对象2)：将对象2添加到对象1元素的内部的末尾</li>
</ul>
</li>
<li>prepend():父元素将子元素追加到开头<ul>
<li>对象1.prepend(对象2)：对象2添加到对象1元素内部的开头</li>
</ul>
</li>
<li>appendTo():与append()相反<ul>
<li>对象1.append(对象2)：对象1添加到对象2元素末尾</li>
<li>注意：如果 对象1 是已存在的元素，它将从当前位置被移除。</li>
</ul>
</li>
<li>prependTo():与prepend()相反<ul>
<li>对象1.prepend(对象2)：对象1添加到对象2开头</li>
<li>注意：如果 对象1 是已存在的元素，它将从当前位置被移除。</li>
</ul>
</li>
<li>after():添加元素到元素后<ul>
<li>对象1.after(对象2)：将对象2添加到对象1后</li>
</ul>
</li>
<li>before():添加元素到元素前面<ul>
<li>对象1.before(对象2)：将对象2添加到对象1前面</li>
</ul>
</li>
<li>insertAfter():<ul>
<li>对象1.insertAfter(对象2)：将对象1添加到对象2后面</li>
<li>注意：如果 对象1 是已存在的元素，它将从它的当前位置被移除，并被插入在被选元素之后。</li>
</ul>
</li>
<li>insertBefore():<ul>
<li>对象1.insertBefore(对象2)：将对象1添加到对象2前面</li>
</ul>
</li>
<li>remove():<ul>
<li>对象.remove():将对象删除</li>
</ul>
</li>
<li>empty():<ul>
<li>将元素后代元素全部清空，但是保留当前对象和属性</li>
</ul>
</li>
</ul>
<h3 id="jq对象的克隆方法"><a href="#jq对象的克隆方法" class="headerlink" title="jq对象的克隆方法"></a>jq对象的克隆方法</h3><p>$(“”) .clone()，返回当前对象的克隆对象</p>
<p>使用append()方法时如果不想变动当前对象，则可以使用克隆对象</p>
]]></content>
      <categories>
        <category>jquery</category>
      </categories>
      <tags>
        <tag>jquery</tag>
      </tags>
  </entry>
  <entry>
    <title>mailSend</title>
    <url>/2022/03/12/mailSend/</url>
    <content><![CDATA[<h1 id="java发送邮件"><a href="#java发送邮件" class="headerlink" title="java发送邮件"></a>java发送邮件</h1><p>！！！qq邮箱需要打开协议（获取授权码）</p>
<p><img src="/2022/03/12/mailSend/1.png" alt></p>
<h2 id="1-纯文本邮件发送"><a href="#1-纯文本邮件发送" class="headerlink" title="1. 纯文本邮件发送"></a>1. 纯文本邮件发送</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendSimpleMail</span><span class="params">()</span></span>&#123;</span><br><span class="line">       Properties prop = <span class="keyword">new</span> Properties();</span><br><span class="line">       <span class="comment">//设置qq邮件服务器</span></span><br><span class="line">       prop.setProperty(<span class="string">&quot;mail.host&quot;</span>,<span class="string">&quot;smtp.qq.com&quot;</span>);</span><br><span class="line">       <span class="comment">//邮件发送协议</span></span><br><span class="line">       prop.setProperty(<span class="string">&quot;mail.transport.protocol&quot;</span>,<span class="string">&quot;smtp&quot;</span>);</span><br><span class="line">       <span class="comment">//需要验证用户名密码</span></span><br><span class="line">       prop.setProperty(<span class="string">&quot;mail.smtp.auth&quot;</span>,<span class="string">&quot;true&quot;</span>);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//关于qq邮箱，还要设置ssl加密，加上以下代码即可</span></span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           MailSSLSocketFactory sf = <span class="keyword">new</span> MailSSLSocketFactory();</span><br><span class="line">           sf.setTrustAllHosts(<span class="keyword">true</span>);</span><br><span class="line">           prop.put(<span class="string">&quot;mail.smtp.ssl.enable&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">           prop.put(<span class="string">&quot;mail.smtp.ssl.socketFactory&quot;</span>, <span class="string">&quot;sf&quot;</span>);</span><br><span class="line"></span><br><span class="line">           <span class="comment">//使用JavaMail发送邮件的5个步骤</span></span><br><span class="line"></span><br><span class="line">           <span class="comment">//1. 创建定义整个程序所需的环境信息的Session对象</span></span><br><span class="line"></span><br><span class="line">           <span class="comment">//qq邮箱才有：其他不用</span></span><br><span class="line">           Session session = Session.getDefaultInstance(prop, <span class="keyword">new</span> Authenticator() &#123;</span><br><span class="line">               <span class="meta">@Override</span></span><br><span class="line">               <span class="function"><span class="keyword">protected</span> PasswordAuthentication <span class="title">getPasswordAuthentication</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                   <span class="comment">//发件人邮箱用户名，授权码</span></span><br><span class="line">                   <span class="keyword">return</span> <span class="keyword">new</span> PasswordAuthentication(<span class="string">&quot;**********@qq.com&quot;</span>, <span class="string">&quot;授权码&quot;</span>);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;);</span><br><span class="line"></span><br><span class="line">           <span class="comment">//开启session的debug模式，查看发送mail的运行状态</span></span><br><span class="line">           session.setDebug(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">           <span class="comment">//2. 通过Session得到transport对象</span></span><br><span class="line">           Transport transport = session.getTransport();</span><br><span class="line"></span><br><span class="line">           <span class="comment">//3. 使用邮箱的用户名和授权码连接邮件服务器</span></span><br><span class="line">           transport.connect(<span class="string">&quot;smtp.qq.com&quot;</span>,<span class="string">&quot;**********@qq.com&quot;</span>,<span class="string">&quot;授权码&quot;</span>);</span><br><span class="line"></span><br><span class="line">           <span class="comment">//4. 创建邮件</span></span><br><span class="line"></span><br><span class="line">           <span class="comment">//4.1 创建邮件对象</span></span><br><span class="line">           MimeMessage message = <span class="keyword">new</span> MimeMessage(session);</span><br><span class="line">           <span class="comment">//4.2 指明发件人</span></span><br><span class="line">           message.setFrom(<span class="keyword">new</span> InternetAddress(<span class="string">&quot;**********@qq.com&quot;</span>));</span><br><span class="line">           <span class="comment">//4.3 指明收件人，</span></span><br><span class="line">           message.setRecipient(Message.RecipientType.TO,<span class="keyword">new</span> InternetAddress(<span class="string">&quot;**********@qq.com&quot;</span>));</span><br><span class="line">           <span class="comment">//4.4 邮件标题</span></span><br><span class="line">           message.setSubject(<span class="string">&quot;测试邮件&quot;</span>);</span><br><span class="line">           <span class="comment">//4.5 邮件文本内容</span></span><br><span class="line">           message.setContent(<span class="string">&quot;&lt;h1 style=&#x27;color:red&#x27;&gt;你好！&lt;/h1&gt;&quot;</span>,<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">           <span class="comment">//5. 发送邮件</span></span><br><span class="line">           transport.sendMessage(message,message.getAllRecipients());</span><br><span class="line">           transport.close();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-图片复杂信息发送"><a href="#2-图片复杂信息发送" class="headerlink" title="2. 图片复杂信息发送"></a>2. 图片复杂信息发送</h2><p><img src="/2022/03/12/mailSend/2.png" alt="image-20220312160153430"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mutiMailSend</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Properties prop = <span class="keyword">new</span> Properties();</span><br><span class="line">        <span class="comment">//设置qq邮件服务器</span></span><br><span class="line">        prop.setProperty(<span class="string">&quot;mail.host&quot;</span>,<span class="string">&quot;smtp.qq.com&quot;</span>);</span><br><span class="line">        <span class="comment">//邮件发送协议</span></span><br><span class="line">        prop.setProperty(<span class="string">&quot;mail.transport.protocol&quot;</span>,<span class="string">&quot;smtp&quot;</span>);</span><br><span class="line">        <span class="comment">//需要验证用户名密码</span></span><br><span class="line">        prop.setProperty(<span class="string">&quot;mail.smtp.auth&quot;</span>,<span class="string">&quot;true&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//关于qq邮箱，还要设置ssl加密，加上以下代码即可</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            MailSSLSocketFactory sf = <span class="keyword">new</span> MailSSLSocketFactory();</span><br><span class="line">            sf.setTrustAllHosts(<span class="keyword">true</span>);</span><br><span class="line">            prop.put(<span class="string">&quot;mail.smtp.ssl.enable&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">            prop.put(<span class="string">&quot;mail.smtp.ssl.socketFactory&quot;</span>, <span class="string">&quot;sf&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//使用JavaMail发送邮件的5个步骤</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//1. 创建定义整个程序所需的环境信息的Session对象</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//qq邮箱才有：其他不用</span></span><br><span class="line">            Session session = Session.getDefaultInstance(prop, <span class="keyword">new</span> Authenticator() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> PasswordAuthentication <span class="title">getPasswordAuthentication</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="comment">//发件人邮箱用户名，授权码</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> PasswordAuthentication(<span class="string">&quot;***@qq.com&quot;</span>, <span class="string">&quot;***&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//开启session的debug模式，查看发送mail的运行状态</span></span><br><span class="line">            session.setDebug(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//2. 通过Session得到transport对象</span></span><br><span class="line">            Transport transport = session.getTransport();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//3. 使用邮箱的用户名和授权码连接邮件服务器</span></span><br><span class="line">            transport.connect(<span class="string">&quot;smtp.qq.com&quot;</span>,<span class="string">&quot;***@qq.com&quot;</span>,<span class="string">&quot;***&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//4. 创建邮件</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//4.1 创建邮件对象</span></span><br><span class="line">            MimeMessage message = <span class="keyword">new</span> MimeMessage(session);</span><br><span class="line">            <span class="comment">//4.2 指明发件人</span></span><br><span class="line">            message.setFrom(<span class="keyword">new</span> InternetAddress(<span class="string">&quot;***@qq.com&quot;</span>));</span><br><span class="line">            <span class="comment">//4.3 指明收件人，</span></span><br><span class="line">            message.setRecipient(Message.RecipientType.TO,<span class="keyword">new</span> InternetAddress(<span class="string">&quot;***@qq.com&quot;</span>));</span><br><span class="line">            <span class="comment">//4.4 邮件标题</span></span><br><span class="line">            message.setSubject(<span class="string">&quot;邮件功能测试&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//4.5 邮件文本内容</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//！！！与简单邮件区别</span></span><br><span class="line">            <span class="comment">//=============================================</span></span><br><span class="line">            <span class="comment">//1. 准备图片数据</span></span><br><span class="line">            MimeBodyPart img = <span class="keyword">new</span> MimeBodyPart();</span><br><span class="line">            <span class="comment">//2. 图片需要经过数据处理 DataHandler</span></span><br><span class="line">             String path = MailSend.class.getClassLoader().getResource(<span class="string">&quot;1.jpg&quot;</span>).getPath();</span><br><span class="line">            DataHandler dh = <span class="keyword">new</span> DataHandler(<span class="keyword">new</span> FileDataSource(path));</span><br><span class="line">            img.setDataHandler(dh);</span><br><span class="line">            img.setContentID(<span class="string">&quot;bz.jpg&quot;</span>);</span><br><span class="line">            <span class="comment">//3. 准备正文数据</span></span><br><span class="line">            MimeBodyPart text = <span class="keyword">new</span> MimeBodyPart();</span><br><span class="line">            <span class="comment">//注意图片路径&lt;img src=&#x27;cid:bz.jpg&#x27;&gt;，前加cid:</span></span><br><span class="line">            text.setContent(<span class="string">&quot;&lt;h1 style=&#x27;color:red&#x27;&gt;你好！邮件包含图片&lt;/h1&gt;&lt;img src=&#x27;cid:bz.jpg&#x27;&gt;&quot;</span>,<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">            <span class="comment">//4. 描述数据关系</span></span><br><span class="line">            MimeMultipart mm = <span class="keyword">new</span> MimeMultipart();</span><br><span class="line">            mm.addBodyPart(text);</span><br><span class="line">            mm.addBodyPart(img);</span><br><span class="line">            mm.setSubType(<span class="string">&quot;related&quot;</span>);<span class="comment">//如果带附件则是mixed</span></span><br><span class="line">            message.setContent(mm);</span><br><span class="line">            message.saveChanges(); <span class="comment">//保存修改</span></span><br><span class="line">            <span class="comment">//=============================================</span></span><br><span class="line">            <span class="comment">//5. 发送邮件</span></span><br><span class="line">            transport.sendMessage(message,message.getAllRecipients());</span><br><span class="line">            transport.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-文件发送-设置内容和拼接有变化"><a href="#3-文件发送-设置内容和拼接有变化" class="headerlink" title="3. 文件发送(设置内容和拼接有变化)"></a>3. 文件发送(设置内容和拼接有变化)</h2><p><img src="/2022/03/12/mailSend/3.png" alt="image-20220312165313055"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Properties prop = <span class="keyword">new</span> Properties();</span><br><span class="line">        <span class="comment">//设置qq邮件服务器</span></span><br><span class="line">        prop.setProperty(<span class="string">&quot;mail.host&quot;</span>,<span class="string">&quot;smtp.qq.com&quot;</span>);</span><br><span class="line">        <span class="comment">//邮件发送协议</span></span><br><span class="line">        prop.setProperty(<span class="string">&quot;mail.transport.protocol&quot;</span>,<span class="string">&quot;smtp&quot;</span>);</span><br><span class="line">        <span class="comment">//需要验证用户名密码</span></span><br><span class="line">        prop.setProperty(<span class="string">&quot;mail.smtp.auth&quot;</span>,<span class="string">&quot;true&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//关于qq邮箱，还要设置ssl加密，加上以下代码即可</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            MailSSLSocketFactory sf = <span class="keyword">new</span> MailSSLSocketFactory();</span><br><span class="line">            sf.setTrustAllHosts(<span class="keyword">true</span>);</span><br><span class="line">            prop.put(<span class="string">&quot;mail.smtp.ssl.enable&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">            prop.put(<span class="string">&quot;mail.smtp.ssl.socketFactory&quot;</span>, <span class="string">&quot;sf&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//使用JavaMail发送邮件的5个步骤</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//1. 创建定义整个程序所需的环境信息的Session对象</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//qq邮箱才有：其他不用</span></span><br><span class="line">            Session session = Session.getDefaultInstance(prop, <span class="keyword">new</span> Authenticator() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> PasswordAuthentication <span class="title">getPasswordAuthentication</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="comment">//发件人邮箱用户名，授权码</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> PasswordAuthentication(<span class="string">&quot;***@qq.com&quot;</span>, <span class="string">&quot;***&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//开启session的debug模式，查看发送mail的运行状态</span></span><br><span class="line">            session.setDebug(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//2. 通过Session得到transport对象</span></span><br><span class="line">            Transport transport = session.getTransport();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//3. 使用邮箱的用户名和授权码连接邮件服务器</span></span><br><span class="line">            transport.connect(<span class="string">&quot;smtp.qq.com&quot;</span>,<span class="string">&quot;***@qq.com&quot;</span>,<span class="string">&quot;***&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//4. 创建邮件</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//4.1 创建邮件对象</span></span><br><span class="line">            MimeMessage message = <span class="keyword">new</span> MimeMessage(session);</span><br><span class="line">            <span class="comment">//4.2 指明发件人</span></span><br><span class="line">            message.setFrom(<span class="keyword">new</span> InternetAddress(<span class="string">&quot;***@qq.com&quot;</span>));</span><br><span class="line">            <span class="comment">//4.3 指明收件人，</span></span><br><span class="line">            message.setRecipient(Message.RecipientType.TO,<span class="keyword">new</span> InternetAddress(<span class="string">&quot;***@qq.com&quot;</span>));</span><br><span class="line">            <span class="comment">//4.4 邮件标题</span></span><br><span class="line">            message.setSubject(<span class="string">&quot;邮件功能测试&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//4.5 邮件文本内容</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//！！！与简单邮件区别</span></span><br><span class="line">            <span class="comment">//=============================================</span></span><br><span class="line">            <span class="comment">//1. 准备图片数据</span></span><br><span class="line">            MimeBodyPart img = <span class="keyword">new</span> MimeBodyPart();</span><br><span class="line">            <span class="comment">//2. 图片需要经过数据处理 DataHandler</span></span><br><span class="line">            String path = MailSend.class.getClassLoader().getResource(<span class="string">&quot;1.jpg&quot;</span>).getPath();</span><br><span class="line">            DataHandler dh = <span class="keyword">new</span> DataHandler(<span class="keyword">new</span> FileDataSource(path));</span><br><span class="line">            img.setDataHandler(dh);</span><br><span class="line">            img.setContentID(<span class="string">&quot;bz.jpg&quot;</span>);</span><br><span class="line">            <span class="comment">//3. 准备正文数据</span></span><br><span class="line">            MimeBodyPart text = <span class="keyword">new</span> MimeBodyPart();</span><br><span class="line">            text.setContent(<span class="string">&quot;&lt;h1 style=&#x27;color:red&#x27;&gt;你好！邮件包含图片&lt;/h1&gt;&lt;img src=&#x27;cid:bz.jpg&#x27;&gt;&quot;</span>,<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">//*****************************************</span></span><br><span class="line">            <span class="comment">//3. 传递附件file</span></span><br><span class="line">            <span class="comment">//*****************************************</span></span><br><span class="line">            MimeBodyPart file1 = <span class="keyword">new</span> MimeBodyPart();</span><br><span class="line">            String filePath = MailFileSend.class.getClassLoader().getResource(<span class="string">&quot;mailcode.txt&quot;</span>).getPath();</span><br><span class="line">            file1.setDataHandler(<span class="keyword">new</span> DataHandler(<span class="keyword">new</span> FileDataSource(filePath)));</span><br><span class="line">            file1.setFileName(<span class="string">&quot;wenjian.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//4. 描述数据关系</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//4.1 拼接文本和图片</span></span><br><span class="line">            MimeMultipart mm = <span class="keyword">new</span> MimeMultipart();</span><br><span class="line">            mm.addBodyPart(text);</span><br><span class="line">            mm.addBodyPart(img);</span><br><span class="line">            mm.setSubType(<span class="string">&quot;related&quot;</span>);<span class="comment">//如果是附件则是mixed</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//*******************************************************************</span></span><br><span class="line">            <span class="comment">//4.2 拼接文本图片和附件文件</span></span><br><span class="line">            <span class="comment">//4.2.1 将之前MimeMultipart拼接的文本图片重新设置成一个MimeBodyPart，与附件mixed拼接</span></span><br><span class="line">            MimeBodyPart contextText = <span class="keyword">new</span> MimeBodyPart();</span><br><span class="line">            contextText.setContent(mm);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//4.2.2 最终拼接</span></span><br><span class="line">            MimeMultipart all = <span class="keyword">new</span> MimeMultipart();</span><br><span class="line">            all.addBodyPart(file1);</span><br><span class="line">            all.addBodyPart(contextText);</span><br><span class="line">            all.setSubType(<span class="string">&quot;mixed&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//*******************************************************************</span></span><br><span class="line"></span><br><span class="line">            message.setContent(all);</span><br><span class="line">            message.saveChanges(); <span class="comment">//保存修改</span></span><br><span class="line">            <span class="comment">//=============================================</span></span><br><span class="line">            <span class="comment">//5. 发送邮件</span></span><br><span class="line">            transport.sendMessage(message,message.getAllRecipients());</span><br><span class="line">            transport.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>javaweb</category>
      </categories>
      <tags>
        <tag>mail</tag>
      </tags>
  </entry>
  <entry>
    <title></title>
    <url>/2022/04/09/nodejs/</url>
    <content><![CDATA[<p>title: nodejs学习<br>date: 2022-04-09 15:53:13<br>categories: nodejs<br>tags: nodejs</p>
<h1 id="nodejs学习"><a href="#nodejs学习" class="headerlink" title="nodejs学习"></a>nodejs学习</h1><h2 id="一、初识nodejs"><a href="#一、初识nodejs" class="headerlink" title="一、初识nodejs"></a>一、初识nodejs</h2><h3 id="1-官网下载安装"><a href="#1-官网下载安装" class="headerlink" title="1. 官网下载安装"></a>1. 官网下载安装</h3><p><a href="https://nodejs.org/en/">Node.js (nodejs.org)</a></p>
<h3 id="2-cmd查看安装版本"><a href="#2-cmd查看安装版本" class="headerlink" title="2. cmd查看安装版本"></a>2. cmd查看安装版本</h3><ol>
<li>node -v      查看版本</li>
</ol>
<h2 id="3-npm基础命令"><a href="#3-npm基础命令" class="headerlink" title="3. npm基础命令"></a>3. npm基础命令</h2><h4 id="1-初始化node-js项目"><a href="#1-初始化node-js项目" class="headerlink" title="1. 初始化node js项目"></a>1. 初始化node js项目</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">node init</span><br></pre></td></tr></table></figure>
<h4 id="2-安装模块（包）"><a href="#2-安装模块（包）" class="headerlink" title="2. 安装模块（包）"></a>2. 安装模块（包）</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//全局安装</span><br><span class="line">npm install  模块名称 -g</span><br><span class="line">//本地安装</span><br><span class="line">npm install 模块名</span><br><span class="line">//一次性安装多个</span><br><span class="line">npm install 模块1 模块2 模块n --save</span><br><span class="line">//安装运行时依赖</span><br><span class="line">npm install 模块名 --save</span><br></pre></td></tr></table></figure>
<h2 id="二、es6特性"><a href="#二、es6特性" class="headerlink" title="二、es6特性"></a>二、es6特性</h2><h3 id="1-解构"><a href="#1-解构" class="headerlink" title="1. 解构"></a>1. 解构</h3><h4 id="数组模型的解构（Array）"><a href="#数组模型的解构（Array）" class="headerlink" title="数组模型的解构（Array）"></a>数组模型的解构（Array）</h4><p><strong>基本</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> [a, b, c] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="comment">// a = 1</span></span><br><span class="line"><span class="comment">// b = 2</span></span><br><span class="line"><span class="comment">// c = 3</span></span><br></pre></td></tr></table></figure>
<p><strong>可嵌套</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> [a, [[b], c]] = [<span class="number">1</span>, [[<span class="number">2</span>], <span class="number">3</span>]]; </span><br><span class="line"><span class="comment">// a = 1 </span></span><br><span class="line"><span class="comment">// b = 2 </span></span><br><span class="line"><span class="comment">// c = 3</span></span><br></pre></td></tr></table></figure>
<p><strong>可忽略</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> [a, , b] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]; </span><br><span class="line"><span class="comment">// a = 1 </span></span><br><span class="line"><span class="comment">// b = 3</span></span><br></pre></td></tr></table></figure>
<p><strong>剩余运算符</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> [a, ...b] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="comment">//a = 1</span></span><br><span class="line"><span class="comment">//b = [2, 3]</span></span><br></pre></td></tr></table></figure>
<h4 id="对象模型的解构（Object）"><a href="#对象模型的解构（Object）" class="headerlink" title="对象模型的解构（Object）"></a>对象模型的解构（Object）</h4><p><strong>基本</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; foo, bar &#125; = &#123; <span class="attr">foo</span>: <span class="string">&#x27;aaa&#x27;</span>, <span class="attr">bar</span>: <span class="string">&#x27;bbb&#x27;</span> &#125;;</span><br><span class="line"><span class="comment">// foo = &#x27;aaa&#x27;</span></span><br><span class="line"><span class="comment">// bar = &#x27;bbb&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> &#123; <span class="attr">baz</span> : foo &#125; = &#123; <span class="attr">baz</span> : <span class="string">&#x27;ddd&#x27;</span> &#125;;</span><br><span class="line"><span class="comment">// foo = &#x27;ddd&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-模块化"><a href="#2-模块化" class="headerlink" title="2. 模块化"></a>2. 模块化</h3><p>在ES6中每一个模块即是一个文件，在文件中定义的变量，函数，对象在外部是无法获取的。如果你希望外部可以读取模块当中的内容，就必须使用export来对其进行暴露（输出）。先来看个例子，来对一个变量进行模块化。我们先来创建一个test.js文件，来对这一个变量进行输出：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="built_in">let</span> myName=<span class="string">&quot;laowang&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>然后可以创建一个index.js文件，以import的形式将这个变量进行引入:</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;myName&#125; <span class="keyword">from</span> <span class="string">&quot;./test.js&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(myName);<span class="comment">//laowang</span></span><br></pre></td></tr></table></figure>
<p><strong>如果要输出多个变量可以将这些变量包装成对象进行模块化输出</strong>：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> myName=<span class="string">&quot;laowang&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> myAge=<span class="number">90</span>;</span><br><span class="line"><span class="keyword">let</span> myfn=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;我是&quot;</span>+myName+<span class="string">&quot;！今年&quot;</span>+myAge+<span class="string">&quot;岁了&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">    myName,</span><br><span class="line">    myAge,</span><br><span class="line">    myfn</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/******************************接收的代码调整为**********************/</span></span><br><span class="line"><span class="keyword">import</span> &#123;myfn,myAge,myName&#125; <span class="keyword">from</span> <span class="string">&quot;./test.js&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(myfn());<span class="comment">//我是laowang！今年90岁了</span></span><br><span class="line"><span class="built_in">console</span>.log(myAge);<span class="comment">//90</span></span><br><span class="line"><span class="built_in">console</span>.log(myName);<span class="comment">//laowang</span></span><br></pre></td></tr></table></figure>
<p><strong>如果你不想暴露模块当中的变量名字</strong>，可以通过as来进行操作:</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> myName=<span class="string">&quot;laowang&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> myAge=<span class="number">90</span>;</span><br><span class="line"><span class="keyword">let</span> myfn=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;我是&quot;</span>+myName+<span class="string">&quot;！今年&quot;</span>+myAge+<span class="string">&quot;岁了&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">    myName <span class="keyword">as</span> name,</span><br><span class="line">    myAge <span class="keyword">as</span> age,</span><br><span class="line">    myfn <span class="keyword">as</span> fn</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/******************************接收的代码调整为**********************/</span></span><br><span class="line"><span class="keyword">import</span> &#123;fn,age,name&#125; <span class="keyword">from</span> <span class="string">&quot;./test.js&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(fn());<span class="comment">//我是laowang！今年90岁了</span></span><br><span class="line"><span class="built_in">console</span>.log(age);<span class="comment">//90</span></span><br><span class="line"><span class="built_in">console</span>.log(name);<span class="comment">//laowang</span></span><br></pre></td></tr></table></figure>
<p><strong>也可以直接导入整个模块</strong>，将上面的接收代码修改为：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> info <span class="keyword">from</span> <span class="string">&quot;./test.js&quot;</span>;<span class="comment">//通过*来批量接收，as 来指定接收的名字</span></span><br><span class="line"><span class="built_in">console</span>.log(info.fn());<span class="comment">//我是laowang！今年90岁了</span></span><br><span class="line"><span class="built_in">console</span>.log(info.age);<span class="comment">//90</span></span><br><span class="line"><span class="built_in">console</span>.log(info.name);<span class="comment">//laowang</span></span><br></pre></td></tr></table></figure>
<h4 id="默认导出（default-export）"><a href="#默认导出（default-export）" class="headerlink" title="* 默认导出（default export）"></a>* 默认导出（default export）</h4><p><strong>一个模块只能有一个默认导出</strong>，对于默认导出，导入的名称可以和导出的名称不一致。</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="comment"><span class="markdown">/<span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**导出**</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span>/</span></span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> function()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;默认导出一个方法&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"><span class="markdown">/<span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**引入**</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span>/</span></span></span><br><span class="line"><span class="keyword">import</span> myFn from <span class="string">&quot;./test.js&quot;</span>;<span class="comment">//注意这里默认导出不需要用&#123;&#125;。</span></span><br><span class="line">console.log(myFn());<span class="comment">//默认导出一个方法</span></span><br></pre></td></tr></table></figure>
<p><strong>可以将所有需要导出的变量放入一个对象中</strong>，然后通过default export进行导出</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="comment"><span class="markdown">/<span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**导出**</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span>/</span></span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    myFn()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;默认导出一个方法&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    myName:<span class="string">&quot;laowang&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"><span class="markdown">/<span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**引入**</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span>/</span></span></span><br><span class="line"><span class="keyword">import</span> myObj from <span class="string">&quot;./test.js&quot;</span>;</span><br><span class="line">console.log(myObj.myFn(),myObj.myName);<span class="comment">//默认导出一个方法 laowang</span></span><br></pre></td></tr></table></figure>
<p><strong>同样也支持混合导出</strong></p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="comment"><span class="markdown">/<span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**导出**</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span>/</span></span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> function()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;默认导出一个方法&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> myName=<span class="string">&quot;laowang&quot;</span>;</span><br><span class="line"><span class="comment"><span class="markdown">/<span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**引入**</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span>/</span></span></span><br><span class="line"><span class="keyword">import</span> myFn,&#123;myName&#125; from <span class="string">&quot;./test.js&quot;</span>;</span><br><span class="line">console.log(myFn(),myName);<span class="comment">//默认导出一个方法 laowang</span></span><br></pre></td></tr></table></figure>
<h3 id="3-promise-异步问题"><a href="#3-promise-异步问题" class="headerlink" title="3. promise 异步问题"></a>3. promise 异步问题</h3><h4 id="promise"><a href="#promise" class="headerlink" title="promise"></a>promise</h4><ol>
<li>是异步编程的一种解决方案（比传统的回调函数更加合理、强大），用同步操作将异步流程表达出来。避免层层嵌套回调。promise 对象提供统一接口，使得控制异步操作更加容易。</li>
<li>promise 是一个容器，里面保存着一个事件（在某个未来才会有结果）的结果。</li>
<li>从语法上讲 promise 是一个对象，这个对象有以下两个特点：<ul>
<li>对象状态不受外界影响，有三种状态：pending、fulfilled、rejected。只有异步操作结果可以改变这个状态，任何其他操作都无法改变这个操作。这也是 promise 名字的由来，’承诺’,表示其他手段无法改变。</li>
<li>状态一旦改变，就不会在变，任何时候都可以得到这个结果。状态只能由 pending =&gt; fulfilled、pending =&gt; rejected。 只要这两种情况发生了，就凝固了，会一直保持。这时就称 resolved (已定型)。 如果状态已经发生改变，我们在对promise 对象添加回调函数，也会立即得到这个结果。 这与事件（event）完全不同,事件的特点是，你错过了他，再去监听，是得不到结果的。</li>
<li>缺点：<ol>
<li>无法取消promise, promise一旦新建，就会立即执行，无法中途取消。</li>
<li>如果不设置回调函数， Promise 内部抛出的错误，无法反应到外部。</li>
<li>当处于 pending 状态的时候，无法得知目前进展到哪一个阶段（刚开始还是即将完成）</li>
</ol>
</li>
</ul>
</li>
<li>Peomise 对象是一个构造函数，用来生成 Promise实例。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">const promise = new Promise(function(resolve, reject)&#123;</span><br><span class="line">  if (res) &#123;</span><br><span class="line">    resolve(value) // 异步操作成功，翻转状态:pending =&gt; fulfilled，并且返回响应的值 Promise的实例状态变为 resolved,就会出发 then 方法。</span><br><span class="line">    console.log(&#x27;11111&#x27;) // resolve 、reject 不会终止 Promise 的参数函数的执行，这里的 11111 仍然会打印出来，并且会先于 resolve(res) 执行，因为立即 resolved 的 Promise 是在本轮事件循环的末尾执行，总是晚于本轮循环的同步。resolved 仍然是一个 promise，promise创建的是微任务，console.log(&#x27;11111&#x27;) 是在 script 的创建的 宏 任务列表中的。 Promise 构造函数的参数函数是立即执行的，但是 resolved 返回的新的 promise 是微任务。</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    reject() //  // 异步操作失败，pending =&gt; rejected,返回错误失败原因</span><br><span class="line">    console.log(&#x27;22222&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise.then(res =&gt; &#123;</span><br><span class="line">  // resolved 成功 执行的回调函数</span><br><span class="line">&#125;, error =&gt; &#123;</span><br><span class="line">  // rejected 失败 执行的回调函数</span><br><span class="line">&#125;)</span><br><span class="line">===   等价于，推荐使用下面的方式，更直观，还能捕获错误</span><br><span class="line">promise.then(res =&gt; &#123;</span><br><span class="line">  // resolved 成功 执行的回调函数</span><br><span class="line">&#125;).catch(error =&gt; &#123;</span><br><span class="line">  // rejected 失败 执行的回调函数，这里这个 catch 不仅会捕获 rejected 的失败原因，如果 .then 成功回调函数的代码执行有错误，也会进入到catch,捕获到错误。</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>实例二：链式调用实现异步</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;输出1&#x27;</span>)</span><br><span class="line">        resolve(<span class="string">&#x27;输出1&#x27;</span>)</span><br><span class="line">    &#125;,<span class="number">1000</span>)</span><br><span class="line">&#125;).then(<span class="function"><span class="params">req</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(req+<span class="string">&#x27;输出2&#x27;</span>)</span><br><span class="line">            resolve(resolve+<span class="string">&quot;输出2&quot;</span>)</span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="4-await-和-async"><a href="#4-await-和-async" class="headerlink" title="4. await 和 async"></a>4. await 和 async</h3><ul>
<li>awit后面接一个会return new promise 的函数并执行它</li>
<li>await只能放在async函数里面</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// awit后面接一个会return new promise 的函数并执行它</span></span><br><span class="line"><span class="comment">// await只能放在async函数里面</span></span><br><span class="line"><span class="keyword">let</span> fun1 =  <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> num = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            num += <span class="number">20</span>;</span><br><span class="line">            resolve(num)</span><br><span class="line">        &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> fun2 = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> num = <span class="keyword">await</span> fun1();</span><br><span class="line">    <span class="built_in">console</span>.log(num)</span><br><span class="line">&#125;</span><br><span class="line">fun2();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>mybatis</title>
    <url>/2022/03/14/mybatis/</url>
    <content><![CDATA[<h1 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a>MyBatis</h1><h2 id="一、mybatis的介绍"><a href="#一、mybatis的介绍" class="headerlink" title="一、mybatis的介绍"></a>一、mybatis的介绍</h2><p>​    MyBatis 本是apache的一个开源项目iBatis, 2010年这个项目由apache software foundation 迁移到了</p>
<p>google code，并且改名为MyBatis 。 2013 年 11 月迁移到Github。 MyBatis是一个优秀的持久层框</p>
<p>架，它对jdbc的操作数据库的过程进行封装，使开发者只需要关注 SQL 本身，而不需要花费精力去处</p>
<p>理例如注册驱动、创建connection、创建statement、手动设置参数、结果集检索等jdbc繁杂的过程代</p>
<p>码。</p>
<p>​    Mybatis通过xml或注解的方式将要执行的各种statement（statement、preparedStatement、</p>
<p>CallableStatement）配置起来，并通过java对象和statement中的sql进行映射生成最终执行的sql语</p>
<p>句，最后由mybatis框架执行sql并将结果映射成java对象并返回。</p>
<h4 id="jdbc编程"><a href="#jdbc编程" class="headerlink" title="jdbc编程"></a>jdbc编程</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Connection connection = <span class="keyword">null</span>;</span><br><span class="line">    PreparedStatement preparedStatement = <span class="keyword">null</span>;</span><br><span class="line">    ResultSet resultSet = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//加载数据库驱动</span></span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        <span class="comment">//通过驱动管理类获取数据库链接</span></span><br><span class="line">        connection =</span><br><span class="line">        DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis?</span></span><br><span class="line"><span class="string">        characterEncoding=utf-8&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;root&quot;</span>);</span><br><span class="line">        <span class="comment">//定义sql语句 ?表示占位符</span></span><br><span class="line">        String sql = <span class="string">&quot;select * from user where username = ?&quot;</span>;</span><br><span class="line">        <span class="comment">//获取预处理statement</span></span><br><span class="line">        preparedStatement = connection.prepareStatement(sql);</span><br><span class="line">        <span class="comment">//设置参数，第一个参数为sql语句中参数的序号（从 1 开始），第二个参数为设置的参</span></span><br><span class="line">        数值</span><br><span class="line">        preparedStatement.setString( <span class="number">1</span> , <span class="string">&quot;王五&quot;</span>);</span><br><span class="line">        <span class="comment">//向数据库发出sql执行查询，查询出结果集</span></span><br><span class="line">        resultSet = preparedStatement.executeQuery();</span><br><span class="line">        <span class="comment">//遍历查询结果集</span></span><br><span class="line">        <span class="keyword">while</span>(resultSet.next())&#123;</span><br><span class="line">        System.out.println(resultSet.getString(<span class="string">&quot;id&quot;</span>)+<span class="string">&quot;</span></span><br><span class="line"><span class="string">        &quot;</span>+resultSet.getString(<span class="string">&quot;username&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span>&#123;</span><br><span class="line">        <span class="comment">//释放资源</span></span><br><span class="line">        <span class="keyword">if</span>(resultSet!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                resultSet.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(preparedStatement!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                preparedStatement.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(connection!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                connection.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>jdbc操作数据库有什么问题</p>
<ol>
<li>数据库链接创建、释放频繁造成系统资源浪费从而影响系统性能，如果使用数据库链接池可解决此</li>
</ol>
<p>问题。</p>
<ol>
<li>Sql语句在代码中硬编码，造成代码不易维护，实际应用sql变化的可能较大，sql变动需要改变java</li>
</ol>
<p>代码。</p>
<ol>
<li>使用preparedStatement向占有位符号传参数存在硬编码，因为sql语句的where条件不一定，可</li>
</ol>
<p>能多也可能少，修改sql还要修改代码，系统不易维护。</p>
<ol>
<li>对结果集解析存在硬编码（查询列名），sql变化导致解析代码变化，系统不易维护，如果能将数</li>
</ol>
<p>据库记录封装成pojo对象解析比较方便。</p>
<h4 id="mybatis的架构"><a href="#mybatis的架构" class="headerlink" title="mybatis的架构"></a>mybatis的架构</h4><ol>
<li>mybatis配置</li>
</ol>
<p>SqlMapConfig.xml: 此文件作为mybatis的全局配置文件，配置了mybatis的运行环境等信</p>
<p>息，比如数据库连接信息。</p>
<p>mapper.xml：sql映射文件，文件中配置了操作数据库的sql语句。 需要在</p>
<p>SqlMapConfig.xml中加载。</p>
<ol>
<li><p>通过mybatis环境等配置信息构造SqlSessionFactory即会话工厂。</p>
</li>
<li><p>由会话工厂创建sqlSession即会话，操作数据库需要通过sqlSession进行。</p>
</li>
<li><p>mybatis底层自定义了Executor执行器接口操作数据库，Executor接口有两个实现，一个是基本执</p>
</li>
</ol>
<p>行器、一个是缓存执行器。</p>
<ol>
<li>MappedStatement也是mybatis一个底层封装对象，它包装了mybatis配置信息及sql映射信息</li>
</ol>
<p>等。 mapper.xml文件中一个sql对应一个MappedStatement对象 ，sql的id即是Mapped</p>
<p>statement的id</p>
<ol>
<li>MappedStatement对sql执行输入参数进行定义，包括HashMap、基本类型、pojo，Executor通</li>
</ol>
<p>过Mapped Statement在执行sql前将输入的java对象映射至sql中，输入参数映射就是jdbc编程中</p>
<p>对preparedStatement设置参数。</p>
<ol>
<li>Mapped Statement对sql执行输出结果进行定义，包括HashMap、基本类型、pojo，Executor通</li>
</ol>
<p>过Mapped</p>
<p>Statement在执行sql后将输出结果映射至java对象中，输出结果映射过程相当于jdbc编程中对结果</p>
<p>的解析处理过程。</p>
<ol>
<li>Mapped StateMent总结：拿到左边的输入映射进行sql参数配置，结合session会话完成对数据库</li>
</ol>
<p>的sql操作，并拿到最终结果并输出到右边的输出映射数据中。</p>
<h5 id="总结"><a href="#总结" class="headerlink" title="总结:"></a>总结:</h5><ol>
<li>Mybatis是一个轻量级的持久层框架，它将sql语句定制到xml配置文件中，并将sql执行的结果自</li>
</ol>
<p>动映射到指定的数据类型:map,list,pojo,基本类型</p>
<ol>
<li>Mybatis简单架构</li>
</ol>
<h2 id="二、mybatis入门程序"><a href="#二、mybatis入门程序" class="headerlink" title="二、mybatis入门程序"></a>二、mybatis入门程序</h2><h3 id="mybatis下载"><a href="#mybatis下载" class="headerlink" title="mybatis下载"></a>mybatis下载</h3><p>mybaits的代码由github.com管理，地址：<a href="https://github.com/mybatis/mybatis-3/releases">https://github.com/mybatis/mybatis-3/releases</a></p>
<p>mybatis-3.5.9.jar——mybatis的核心包</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="案例程序"><a href="#案例程序" class="headerlink" title="案例程序"></a>案例程序</h3><h4 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h4><p>实现以下功能:</p>
<ol>
<li><p>根据用户id查询一个用户信息</p>
</li>
<li><p>根据用户名称模糊查询用户信息列表</p>
</li>
<li><p>添加用户</p>
</li>
<li><p>更新用户</p>
</li>
<li><p>删除用户</p>
</li>
</ol>
<h4 id="开发步骤"><a href="#开发步骤" class="headerlink" title="开发步骤"></a>开发步骤</h4><p>首先编写mybatis-config.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">  <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/example/BlogMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="1-编写获取SqlSession工具类"><a href="#1-编写获取SqlSession工具类" class="headerlink" title="1. 编写获取SqlSession工具类"></a>1. 编写获取SqlSession工具类</h5><p><img src="/2022/03/14/mybatis/1.png" alt></p>
<p><img src="/2022/03/14/mybatis/2.png" alt></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        String resource = <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            InputStream is = Resources.getResourceAsStream(resource);</span><br><span class="line">            sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(is);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title">getSqlSession</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactory.openSession();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-编写pojo类"><a href="#2-编写pojo类" class="headerlink" title="2. 编写pojo类"></a>2. 编写pojo类</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">user1</span> </span>&#123;</span><br><span class="line">    Integer id;</span><br><span class="line">    String name;</span><br><span class="line">    Integer age;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="3-编写pojo-mapper接口"><a href="#3-编写pojo-mapper接口" class="headerlink" title="3. 编写pojo mapper接口"></a>3. 编写pojo mapper接口</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">user1Mapper</span> </span>&#123;</span><br><span class="line">    <span class="function">List&lt;user1&gt; <span class="title">getAllUser1</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="4-编写mapper-xml"><a href="#4-编写mapper-xml" class="headerlink" title="4. 编写mapper.xml"></a>4. 编写mapper.xml</h5><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--namespace绑定一个对应的mapper接口的相对路径--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;mapper.user1Mapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--select查询方法，id为mapper接口中对应方法的名字--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllUser1&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;pojo.user1&quot;</span>&gt;</span></span><br><span class="line">      select * from user1</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="5-mybatis-config-xml-绑定mapper-xml"><a href="#5-mybatis-config-xml-绑定mapper-xml" class="headerlink" title="5. mybatis-config.xml 绑定mapper.xml"></a>5. mybatis-config.xml 绑定mapper.xml</h5><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mapper/user1Mapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="6-测试程序"><a href="#6-测试程序" class="headerlink" title="6. 测试程序"></a>6. 测试程序</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mybatis_test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//获得sqlSession</span></span><br><span class="line">        SqlSession sqlSession = MybatisUtil.getSqlSession();</span><br><span class="line">        <span class="comment">//方式一：getMapper</span></span><br><span class="line">        user1Mapper uMapper = sqlSession.getMapper(user1Mapper.class);</span><br><span class="line">        List&lt;user1&gt; uList = uMapper.getAllUser1();</span><br><span class="line">        System.out.println(uList);</span><br><span class="line">        <span class="comment">//方式二：直接使用sqlSession(不推荐)</span></span><br><span class="line">        List&lt;user1&gt; ul = sqlSession.selectList(<span class="string">&quot;mapper.user1Mapper.getAllUser1&quot;</span>);</span><br><span class="line">        System.out.println(ul);</span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h5 id="可能遇到的问题"><a href="#可能遇到的问题" class="headerlink" title="可能遇到的问题"></a>可能遇到的问题</h5><p>你们可以能会遇到的问题:</p>
<ol>
<li><p>配置文件没有注册</p>
</li>
<li><p>绑定接口错误。</p>
</li>
<li><p>方法名不对</p>
</li>
<li><p>返回类型不对</p>
</li>
<li><p>Maven导出资源问题</p>
</li>
</ol>
<h2 id="三、CRUD"><a href="#三、CRUD" class="headerlink" title="三、CRUD"></a>三、CRUD</h2><h3 id="3-1-select"><a href="#3-1-select" class="headerlink" title="3.1 select"></a>3.1 select</h3><ul>
<li>id：是对应的方法的名称</li>
<li>resultType：是sql语句执行的返回值类的路径</li>
<li>parameterType：是方法参数类型</li>
<li>parameterMap：是方法的参数列表</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">user1Mapper</span> </span>&#123;</span><br><span class="line">    <span class="function">List&lt;user1&gt; <span class="title">getAllUser1</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">user1 <span class="title">getUser1ByID</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;mapper.user1Mapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllUser1&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;pojo.user1&quot;</span>&gt;</span></span><br><span class="line">      select * from user1</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUser1ByID&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;pojo.user1&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- id = #&#123;id&#125; 中#&#123;id&#125;与上面接口的形参名称int id相同--&gt;</span></span><br><span class="line">      select * from user1 where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-2-insert"><a href="#3-2-insert" class="headerlink" title="3.2 insert"></a>3.2 insert</h3><ul>
<li><h1 id="id-name-age-与pojo-user1类属性一致"><a href="#id-name-age-与pojo-user1类属性一致" class="headerlink" title="{id},#{name},#{age} 与pojo.user1类属性一致"></a>{id},#{name},#{age} 与pojo.user1类属性一致</h1></li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addUser1&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;pojo.user1&quot;</span>&gt;</span></span><br><span class="line">        insert into user1 (id,name,age) values(#&#123;id&#125;,#&#123;name&#125;,#&#123;age&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>注意，增删改需要提交事务</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//增删改需要提交事务</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">       user1 u1 = <span class="keyword">new</span> user1(<span class="number">97</span>, <span class="string">&quot;sdas&quot;</span>, <span class="number">200</span>);</span><br><span class="line">       SqlSession sqlSession = MybatisUtil.getSqlSession();</span><br><span class="line">       user1Mapper mapper = sqlSession.getMapper(user1Mapper.class);</span><br><span class="line">       <span class="keyword">int</span> res = mapper.addUser1(u1);</span><br><span class="line">       <span class="keyword">if</span>(res&gt;<span class="number">0</span>)&#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;插入成功&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//提交事务</span></span><br><span class="line">       sqlSession.commit();</span><br><span class="line">       sqlSession.close();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-3-update"><a href="#3-3-update" class="headerlink" title="3.3 update"></a>3.3 update</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUser1&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;pojo.user1&quot;</span>&gt;</span></span><br><span class="line">    update user1 set name=#&#123;name&#125;,age=#&#123;age&#125; where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-delect"><a href="#3-4-delect" class="headerlink" title="3.4 delect"></a>3.4 delect</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;delectUser1&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">    delete from user1 where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p>mybatis中的增删改查，就是编写接口与配置文件中的sql</p>
<h2 id="四、map传值，模糊查询"><a href="#四、map传值，模糊查询" class="headerlink" title="四、map传值，模糊查询"></a>四、map传值，模糊查询</h2><h3 id="4-1-传递map值"><a href="#4-1-传递map值" class="headerlink" title="4.1  传递map值"></a>4.1  传递map值</h3><ul>
<li>使用map进行参数传递，在更新单个数据时就不需要new一个新的对象，只需要传递需要修改的参数</li>
<li><strong>使用map可以避免新建对象产生的冗余信息</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mapUpdateUName</span><span class="params">(Map&lt;String,Object&gt; m)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;mapUpdateUName&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">     update user1 set name=#&#123;name&#125; where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mapUpdateN</span><span class="params">()</span></span>&#123;</span><br><span class="line">    SqlSession sqlSession = MybatisUtil.getSqlSession();</span><br><span class="line">    user1Mapper mapper = sqlSession.getMapper(user1Mapper.class);</span><br><span class="line">    HashMap&lt;String, Object&gt; m = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    m.put(<span class="string">&quot;id&quot;</span>,<span class="number">1</span>);</span><br><span class="line">    m.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;天海&quot;</span>);</span><br><span class="line">    <span class="keyword">int</span> res = mapper.mapUpdateUName(m);</span><br><span class="line">    <span class="keyword">if</span>(res&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;修改成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    sqlSession.commit();</span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-模糊查询"><a href="#4-2-模糊查询" class="headerlink" title="4.2 模糊查询"></a>4.2 模糊查询</h3><h4 id="1-java代码执行时传递通配符"><a href="#1-java代码执行时传递通配符" class="headerlink" title="1. java代码执行时传递通配符"></a>1. java代码执行时传递通配符</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">select * from user1 where id = #&#123;val&#125;</span><br><span class="line">String val = <span class="string">&quot;%val%&quot;</span> </span><br></pre></td></tr></table></figure>
<h4 id="2-在配置文件中拼接"><a href="#2-在配置文件中拼接" class="headerlink" title="2. 在配置文件中拼接"></a>2. 在配置文件中拼接</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">select * from user1 where id = &quot;%&quot;#&#123;id&#125;&quot;%&quot;</span><br></pre></td></tr></table></figure>
<h2 id="五、配置解析"><a href="#五、配置解析" class="headerlink" title="五、配置解析"></a>五、配置解析</h2><h3 id="5-1-核心配置文件"><a href="#5-1-核心配置文件" class="headerlink" title="5.1 核心配置文件"></a>5.1 核心配置文件</h3><ul>
<li><p>mybatis-config.xml</p>
<p><img src="/2022/03/14/mybatis/3.png" alt></p>
</li>
</ul>
<h4 id="1）环境配置（environments）"><a href="#1）环境配置（environments）" class="headerlink" title="1）环境配置（environments）"></a>1）环境配置（environments）</h4><p>MyBatis 可以配置成适应多种环境，</p>
<p><strong>不过要记住：尽管可以配置多个环境，但每个 SqlSessionFactory 实例只能选择一种环境。</strong></p>
<ul>
<li><strong>每个数据库对应一个 SqlSessionFactory 实例</strong></li>
</ul>
<p>为了指定创建哪种环境，只要将它作为可选的参数传递给 SqlSessionFactoryBuilder 即可。可以接受环境配置的两个方法签名是：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">SqlSessionFactory factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(reader, environment);</span><br><span class="line">SqlSessionFactory factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(reader, environment, properties);</span><br></pre></td></tr></table></figure>
<p>如果忽略了环境参数，那么将会加载默认环境，如下所示：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">SqlSessionFactory factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(reader);</span><br><span class="line">SqlSessionFactory factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(reader, properties);</span><br></pre></td></tr></table></figure>
<p>environments 元素定义了如何配置环境。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;...&quot;</span> <span class="attr">value</span>=<span class="string">&quot;...&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意一些关键点:</p>
<ul>
<li>默认使用的环境 ID（比如：default=”development”）。</li>
<li>每个 environment 元素定义的环境 ID（比如：id=”development”）。</li>
<li>事务管理器的配置（比如：type=”JDBC”）。</li>
<li>数据源的配置（比如：type=”POOLED”）。</li>
</ul>
<p>默认环境和环境 ID 顾名思义。 环境可以随意命名，但务必保证默认的环境 ID 要匹配其中一个环境 ID。</p>
<h5 id="数据源（dataSource）"><a href="#数据源（dataSource）" class="headerlink" title="数据源（dataSource）"></a>数据源（dataSource）</h5><p>dataSource 元素使用标准的 JDBC 数据源接口来配置 JDBC 连接对象的资源。</p>
<ul>
<li>大多数 MyBatis 应用程序会按示例中的例子来配置数据源。虽然数据源配置是可选的，但如果要启用延迟加载特性，就必须配置数据源。</li>
</ul>
<p>有三种内建的数据源类型（也就是 type=”[UNPOOLED|POOLED|JNDI]”）：</p>
<p><strong>一般只使用连接池的方式</strong></p>
<p><strong>POOLED</strong>– 这种数据源的实现利用“池”的概念将 JDBC 连接对象组织起来，避免了创建新的连接实例时所必需的初始化和认证时间。 这种处理方式很流行，能使并发 Web 应用快速响应请求。</p>
<p>除了上述提到 UNPOOLED 下的属性外，还有更多属性用来配置 POOLED 的数据源：</p>
<ul>
<li><code>poolMaximumActiveConnections</code> – 在任意时间可存在的活动（正在使用）连接数量，默认值：10</li>
<li><code>poolMaximumIdleConnections</code> – 任意时间可能存在的空闲连接数。</li>
<li><code>poolMaximumCheckoutTime</code> – 在被强制返回之前，池中连接被检出（checked out）时间，默认值：20000 毫秒（即 20 秒）</li>
<li><code>poolTimeToWait</code> – 这是一个底层设置，如果获取连接花费了相当长的时间，连接池会打印状态日志并重新尝试获取一个连接（避免在误配置的情况下一直失败且不打印日志），默认值：20000 毫秒（即 20 秒）。</li>
<li><code>poolMaximumLocalBadConnectionTolerance</code> – 这是一个关于坏连接容忍度的底层设置， 作用于每一个尝试从缓存池获取连接的线程。 如果这个线程获取到的是一个坏的连接，那么这个数据源允许这个线程尝试重新获取一个新的连接，但是这个重新尝试的次数不应该超过 <code>poolMaximumIdleConnections</code> 与 <code>poolMaximumLocalBadConnectionTolerance</code> 之和。 默认值：3（新增于 3.4.5）</li>
<li><code>poolPingQuery</code> – 发送到数据库的侦测查询，用来检验连接是否正常工作并准备接受请求。默认是“NO PING QUERY SET”，这会导致多数数据库驱动出错时返回恰当的错误消息。</li>
<li><code>poolPingEnabled</code> – 是否启用侦测查询。若开启，需要设置 <code>poolPingQuery</code> 属性为一个可执行的 SQL 语句（最好是一个速度非常快的 SQL 语句），默认值：false。</li>
<li><code>poolPingConnectionsNotUsedFor</code> – 配置 poolPingQuery 的频率。可以被设置为和数据库连接超时时间一样，来避免不必要的侦测，默认值：0（即所有连接每一时刻都被侦测 — 当然仅当 poolPingEnabled 为 true 时适用）。</li>
</ul>
<h5 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h5><p>mybatis默认的事务管理器就是JDBC，连接池：POOLED</p>
<h4 id="2-属性-properties（放在configuration开头）"><a href="#2-属性-properties（放在configuration开头）" class="headerlink" title="2) 属性 properties（放在configuration开头）"></a>2) 属性 properties（放在configuration开头）</h4><p>我们可以通过properties属性来实现引用配置文件</p>
<p> 这些属性可以在外部进行配置，并可以进行动态替换。你既可以在典型的 Java 属性文件中配置这些属性，也可以在 properties 元素的子元素中设置。</p>
<h5 id="1-编写一个properties"><a href="#1-编写一个properties" class="headerlink" title="1. 编写一个properties"></a>1. 编写一个properties</h5><p><strong>“注意”：这里jdbcurl不能命名为”url“，因为${url}在mybatis中有默认值</strong></p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">driverClassName</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">jdbcurl</span>=<span class="string">jdbc:mysql://localhost:3306/user?serverTimezone=UTC&amp;characterEncoding=utf8&amp;useUnicode=true&amp;useSSL=false</span></span><br><span class="line"><span class="attr">username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">111111</span></span><br></pre></td></tr></table></figure>
<h5 id="2-在核心配置文件中引入"><a href="#2-在核心配置文件中引入" class="headerlink" title="2. 在核心配置文件中引入"></a>2. 在核心配置文件中引入</h5><p><img src="/2022/03/14/mybatis/4.png" alt></p>
<ul>
<li>properties导入必须在configuration的最前面</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/example/config.properties&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;dev_user&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;F2Fa3!33TYyg&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>导入后，就可以根据properties中配置的值使用${key}获取对应的值</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>可以直接引入外部文件</li>
<li>可以在其中添加属性</li>
<li>如果两个文件有同一个字段，优先使用外部配置文件的</li>
</ul>
<h4 id="3）类型别名（typeAliases）（放在configuration中第三的位置（setting之后））"><a href="#3）类型别名（typeAliases）（放在configuration中第三的位置（setting之后））" class="headerlink" title="3）类型别名（typeAliases）（放在configuration中第三的位置（setting之后））"></a>3）类型别名（typeAliases）（放在configuration中第三的位置（setting之后））</h4><p>类型别名可为 Java 类型设置一个缩写名字。 它仅用于 XML 配置，意在降低冗余的全限定类名书写。例如：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Author&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Author&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Blog&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Blog&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Comment&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Comment&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Post&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Post&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Section&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Section&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Tag&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Tag&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>当这样配置时，<code>Blog</code> 可以用在任何使用 <code>domain.blog.Blog</code> 的地方。</p>
<p>也可以指定一个包名，MyBatis 会在包名下面搜索需要的 Java Bean，比如：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;domain.blog&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>每一个在包 <code>domain.blog</code> 中的 Java Bean，在没有注解的情况下，会使用 Bean 的首字母小写的非限定类名来作为它的别名。 比如 <code>domain.blog.Author</code> 的别名为 <code>author</code>；若有注解，则别名为其注解值。见下面的例子：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Alias(&quot;author&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Author</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-设置-setting"><a href="#4-设置-setting" class="headerlink" title="4) 设置 setting"></a>4) 设置 setting</h4><p>这是 MyBatis 中极为重要的调整设置，它们会改变 MyBatis 的运行时行为。 下表描述了设置中各项设置的含义、默认值等。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">设置名</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">有效值</th>
<th style="text-align:left">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">cacheEnabled</td>
<td style="text-align:left">全局性地开启或关闭所有映射器配置文件中已配置的任何缓存。</td>
<td style="text-align:left">true \</td>
<td style="text-align:left">false</td>
<td>true</td>
</tr>
<tr>
<td style="text-align:left">lazyLoadingEnabled</td>
<td style="text-align:left">延迟加载的全局开关。当开启时，所有关联对象都会延迟加载。 特定关联关系中可通过设置 <code>fetchType</code> 属性来覆盖该项的开关状态。</td>
<td style="text-align:left">true \</td>
<td style="text-align:left">false</td>
<td>false</td>
</tr>
<tr>
<td style="text-align:left">logImpl</td>
<td style="text-align:left">指定 MyBatis 所用日志的具体实现，未指定时将自动查找。</td>
<td style="text-align:left">SLF4J \</td>
<td style="text-align:left">LOG4J(deprecated since 3.5.9) \</td>
<td>LOG4J2 \</td>
<td>JDK_LOGGING \</td>
<td>COMMONS_LOGGING \</td>
<td>STDOUT_LOGGING \</td>
<td>NO_LOGGING</td>
<td>未设置</td>
</tr>
</tbody>
</table>
</div>
<h4 id="5-映射器（mappers）"><a href="#5-映射器（mappers）" class="headerlink" title="5) 映射器（mappers）"></a>5) 映射器（mappers）</h4><p>绑定资源</p>
<p>方式一、配置配置文件路径</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用相对于类路径的资源引用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/builder/AuthorMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/builder/BlogMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/builder/PostMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>方式二、扫描包</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 将包内的映射器接口实现全部注册为映射器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;org.mybatis.builder&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意：此方法有一些约束</p>
<ul>
<li>xml配置文件和接口必须同名</li>
<li>xml配置文件和接口必须在同一个包下</li>
</ul>
<p>方式三、</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用映射器接口实现类的完全限定类名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.builder.AuthorMapper&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.builder.BlogMapper&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.builder.PostMapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意：此方法有一些约束</p>
<ul>
<li>xml配置文件和接口必须同名</li>
<li>xml配置文件和接口必须在同一个包下</li>
</ul>
<h2 id="六、生命周期和作用域"><a href="#六、生命周期和作用域" class="headerlink" title="六、生命周期和作用域"></a>六、生命周期和作用域</h2><p>生命周期类别是至关重要的，因为错误的使用会导致非常严重的并发问题。</p>
<p><img src="/2022/03/14/mybatis/5.png" alt></p>
<h3 id="6-1-sqlSessionFactoryBuilder"><a href="#6-1-sqlSessionFactoryBuilder" class="headerlink" title="6.1 sqlSessionFactoryBuilder:"></a>6.1 sqlSessionFactoryBuilder:</h3><ul>
<li>一旦创建sqlSessionFactory就不需要sqlSessionFactoryBuilder了</li>
<li>局部变量</li>
</ul>
<h3 id="6-2-sqlSessionFactory"><a href="#6-2-sqlSessionFactory" class="headerlink" title="6.2 sqlSessionFactory"></a>6.2 sqlSessionFactory</h3><ul>
<li>SqlSessionFactory 一旦被创建就应该在应用的运行期间一直存在，因此 SqlSessionFactory 的最佳作用域是应用作用域。</li>
<li>最简单的就是使用单例模式或者静态单例模式。</li>
</ul>
<h3 id="6-3-sqlSession"><a href="#6-3-sqlSession" class="headerlink" title="6.3 sqlSession"></a>6.3 sqlSession</h3><ul>
<li>每个线程都应该有它自己的 SqlSession 实例。</li>
<li>SqlSession 的实例不是线程安全的，因此是不能被共享的，所以它的最佳的作用域是请求或方法作用域。</li>
<li>每次收到 HTTP 请求，就可以打开一个 SqlSession，返回一个响应后，就关闭它。 这个关闭操作很重要，为了确保每次都能执行关闭操作，你应该把这个关闭操作放到 finally 块中。</li>
</ul>
<h2 id="七、解决属性名和字段名不一致问题"><a href="#七、解决属性名和字段名不一致问题" class="headerlink" title="七、解决属性名和字段名不一致问题"></a>七、解决属性名和字段名不一致问题</h2><h3 id="7-1-新建数据库表"><a href="#7-1-新建数据库表" class="headerlink" title="7.1  新建数据库表"></a>7.1  新建数据库表</h3><p><img src="/2022/03/14/mybatis/6.png" alt></p>
<h3 id="7-2-创建实体类，属性名与数据库表中字段不一致"><a href="#7-2-创建实体类，属性名与数据库表中字段不一致" class="headerlink" title="7.2 创建实体类，属性名与数据库表中字段不一致"></a>7.2 创建实体类，属性名与数据库表中字段不一致</h3><p><img src="/2022/03/14/mybatis/7.png" alt></p>
<ul>
<li>注意<ul>
<li>这里实体类如果只有参构造方法，并且构造函数参数顺序与数据库表中字段名顺序一致，则也能正常查询出结果</li>
<li>如果只有空构造，则名称不对应的字段值显示为空</li>
<li>如果只有参构造方法，并且参数错位，则会报错</li>
</ul>
</li>
</ul>
<h3 id="7-3-使用resultMap解决"><a href="#7-3-使用resultMap解决" class="headerlink" title="7.3 使用resultMap解决"></a>7.3 使用resultMap解决</h3><p><code>resultMap</code> 元素是 MyBatis 中最重要最强大的元素。ResultMap 的设计思想是，对简单的语句做到零配置，对于复杂一点的语句，只需要描述语句之间的关系就行了。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--id为resultMap名称，type为映射的pojo对象--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;pojo.user&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--column为数据库中的列名，property为实体类中的属性set方法名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;uid&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;uName&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;uemail&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllUser&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userMap&quot;</span>&gt;</span></span><br><span class="line">  select * from user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="八、日志"><a href="#八、日志" class="headerlink" title="八、日志"></a>八、日志</h2><h3 id="8-1-日志工厂"><a href="#8-1-日志工厂" class="headerlink" title="8.1 日志工厂"></a>8.1 日志工厂</h3><ul>
<li>如果一个数据库操作，出现了异常，排错时，日志是最好的工具。</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>logImpl</th>
<th>指定 MyBatis 所用日志的具体实现，未指定时将自动查找。</th>
<th>SLF4J \</th>
<th>LOG4J(deprecated since 3.5.9) \</th>
<th>LOG4J2 \</th>
<th>JDK_LOGGING \</th>
<th>COMMONS_LOGGING \</th>
<th>STDOUT_LOGGING \</th>
<th>NO_LOGGING</th>
<th>未设置</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>重点掌握</p>
<ul>
<li><p>LOG4J</p>
</li>
<li><p>STDOUT_LOGGING </p>
</li>
</ul>
<p>使用哪一个在setting中进行配置</p>
<h3 id="8-2-STDOUT-LOGGING-标准日志输出"><a href="#8-2-STDOUT-LOGGING-标准日志输出" class="headerlink" title="8.2 STDOUT_LOGGING 标准日志输出"></a>8.2 STDOUT_LOGGING 标准日志输出</h3><p>在核心配置文件中配置settings（在第二个位置，properties后）</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;STDOUT_LOGGING&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/03/14/mybatis/8.png" alt></p>
<h3 id="8-3-LOG4J2"><a href="#8-3-LOG4J2" class="headerlink" title="8.3 LOG4J2"></a>8.3 LOG4J2</h3><h4 id="LOG4J2环境配置"><a href="#LOG4J2环境配置" class="headerlink" title="LOG4J2环境配置"></a>LOG4J2环境配置</h4><ol>
<li><p>先导包</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-core --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.17.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-api --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.17.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>Log4j2简介</strong></p>
<p>log4j2是log4j 1.x 的升级版，2015年5月，Apache宣布log4j1.x 停止更新。最新版为1.2.17。</p>
<p>log4j2参考了logback的一些优秀的设计，并且修复了一些问题，因此带来了一些重大的提升，主要有：</p>
<p>1、异常处理：在logback中，Appender中的异常不会被应用感知到，但是在log4j2中，提供了一些异常处理机制。</p>
<p>2、性能提升：log4j2相较于log4j 1和logback都具有很明显的性能提升。</p>
<p>3、自动重载配置：参考了logback的设计，提供自动刷新参数配置，可以动态的修改日志的级别而不需要重启应用。</p>
<p>4、无垃圾机制，log4j2在大部分情况下，都可以使用其设计的一套无垃圾机制，避免频繁的日志收集导致的jvm gc。</p>
<p><strong>以Java项目为例介绍log4j2配置步骤</strong></p>
<p>工程结构如下</p>
<p> <a href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdsAAAGmCAYAAAA0xi4rAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAADRYSURBVHhe7d35cxznnd/x/CdJ1TrZjVO1jq+1FzZHICkeAiVCIggOSRDgAdIwBFAWzUO2DoJrEwRBHRYJ0KJEyudySBmHIALwVgapZFPZSipH5Yekkt2tStb7nzyZp3ue7qef/vZ0z9GDGcz7h1dx+rn6mQGrP3ie6cH8k0OHDqnvHDgKANhBvvvcbrG8Xq+88opYDv81/trXvqZeODqQirAFgB2IsM0fYQsAPY6wzR9hCwA9rlVhi2SELQD0OMI2fyZs9//4L1J5YasbAwB2DhMEyE/dYas7AACA+hC2AADkjLAFACBnOmy/+vVvpiJsAQBoEGELAEDOCFsAAHJG2AIAkLOODNvjY+Pq7OTFiNPfe1UdeHFQbA8AQCfryLC98s5NNbfwScytuw/U2IVJsQ8AAJ2qq8LWODMxJfYDAKATNRy2V65eU7Nzc2p29lZtlTaXr1yN9E2TFrZZ6DGksQEAaLeGw7Z4YkRtbm6qlZWVmjY2NtRw8USkb5o8w7avMK0WymVVLi+qyUK/2KYRZtytra2Yx4s31ORw687Van2Fl9X0nQfq448/jnnw9mmxj+3Fi3fU/MWXg+O+w6+p+Qd31PTh/rrGrtVWe/DgbTXi/Mz0uXWdfX5t5O0H6sGd19SLCe2Tzp3l+Urs5yzVd7JaPz+7XSOa/b8F7BRNbSM/fPRIra6uiiFr6DZuvzQ7LWy1crmkrndo4JoLohtYQQAJoWXrG3s7cuGUwjbL2Eltk5j2b71dOb8TxN6c3DK7vfOc+gqn1VsPsp/b1c1hW+vnZ7drRD0/f2AnaypsT46MigFrO1ZZAbv90nRz2Lqh2jc8ra6X/BAuL05H+nSKWiFnQuitseTXym8TBluWsA37hWPXaisJAtU7X3SO/hycMu98el7mX6vOG6vxgOnqsK3x83Pb1qvZ/1vATtH0DVJ37y2o9fX1WMjqsnsLC2KfNNsRtkMzi+pxdWWqA3NhZloNWfV9haK6vljy60uLlUCNjpMUtl7f4Rve2PY59XiT7jmnimGfqcXwXNZ5dX8zV79P9Fxpz0OSFnJ6mzGy8hHaj7wdXpyzhq1mj11v2IZbxX6/tDl6gWq1t+u8eQirbGnL039+b6tpsyVdeXzypWhA6XPZ/Uz4m/G04JcM83pd9Pt4/dyVt9A/8txqzFest8JVS/r5iX1jY/uh6Y9b6Tem+/vjSz8HW9L/LWmewby88cM2emz39Yn+klV7/kA7NB222tLScixsl5eXxbZZtDtsJxfl7V+zEvWCtro6jbXJErbV/nZd0jkfz/iBa8LWVS75wRse3wjCNO15JEm7IIYhFX1eNvt9P/tiXc/YaW1t5gJv2noXbSdA3ADV4Rxpb1107TozD1MfO65e2CMhYT/nan0sTKvhZY+h2wTjOQEVnj++ArSfb1p7tz7ob702+jh4/vZzSXstnJ+DOXbnZupd0s8/aZ7B6+TM2wtQpyz5tYmfA2iHloTt/Pwdtba2FgStfjx3+7bYNousYTs6PqEGjxZFA4NHxLHdsA1XnZUgrK4sTZkOKr1yjLSphuXQTHW1WUfYxsbTK9VqW73dHJmXWdnq40obO3yjc8r+POw52TJdEJ0gc3kXwshFsY6wdS6MZgXissdw52QuxJEVjTB2NABNnRNOwvONjCWdyzzn6qorMlfrXKbMVnM8L7xfDoJErg8f222CttLzcZ+zHkP6+aW9FkK9FHaZfv4p8/TnJb1ONV67lPmbMiBvLQlbbWlpybtZSmtmVatlDVsdqrtGJ1XhrbuJ3LFjYWtCzVn9mVWiXmlKbWLj1LGyTVq1am4bs3KNhWsDz8Mut2W6IForB4l/UaxeNO2LXR1jp7W1eVvI1urE9I2W6TnZgRReYOMXcatOeL6R52Q9jtbL25ianq+pc1dV4nhOGHpllXmZMbxxzHxSwsOs/iTmtU78+aW8FvbKM1pfHauOn3/aPMXXKaUsbf6mDMhby8J2ZPR0cGfyyVOjYpus6glbHaj9v//HRO7Y2xO28jmTeCvXpLA1x20MWzfYkuh2YXhVL3Z1jJ01bE0QSRdlN3T0+Ho8LxSc55BUl3aBTr7A+8/fe05O/6CdNXczV3E8+5eB6mP7Bq7IfDKEbdJ8bOLPL+ewtX/+afMUX6eUMsIWnaJlYVvo361KpZIqPXniPZbaZNXWsK2x/RqsMp1j3SbrNrJ3I1Q18EwQRlapTjAbdYdthufhnsOodUG0L/puncu7sFUunJGLXR1jZw1b76IshIt/3uhcTZCaYLXbJ9X54eVcwK1AS73AV59XrecRCVNh3n5Z9XxSYFhzlOZjk56PxGvn/vyEvn6ZNTfnZxGpr+fnL5zLJj3PtLK0+ZsyIG8tC1vt7Ph5debcebGuHu0MW11mwtAVhKNwg5S+USkITO+i4o9rt7G5gZd4ThOmdYZtlueRJOmCaMprrTZs3kWu0vaQdWduPWPXujAbQb/qaiitzp/TndgFuVadO07sOOUCr4/9Xwiqr4EUSFZ7/3FlfCeggvM5gRG2r/ZPm685tl9rKYT0uAk/v+Sxo79YmOO0sBXnlDJP9zX26lPK0uYPtEtLw7ZV9M1NOkjT7H7+QEvC1lt9pn70p9KvGrj+jU3RcWqFrfQXpPwVrx/YdjtzzkbCNsvzkJgLkLslq0nBZ9rLF9A7aupk/GKXZexabTV90fXHjq4CbXbI6ePg4m9dwA1zvlp1wbmti3OWi747tg4N97kEbU1f+6M/Thjo1Xe0r7MqrDFfsd6Zf9gm+vMT+8bG9ucSjFt5Hm7Ymr62Wv+3TBvxdbLmXc/PIhiToMU26MiwrUe9YdsIE3Q6wMxnYfumzBZtGHZAI6TA6GbealT4BQboZYRtBtI2spG2RQuk6eawjW1xV1eRrB6BKMI2I+9zsM4flLC3fYFGdfvKVm/dmy1atmkBWdeHLQAAnY6wBQAgZ4QtAAA5I2wBAMgZYQsAQM4IWwAAckbYAgCQM8IWAICcEbYAAOSsp8L2+Ni4Ojt5MWJ0fELtP3RYbA8AQCv0VNgmfXXfrbsP1NiFSbEPAADNImwtZyamxH4AADSjY8P28pVrarh4QqxrVNYvpa9FjyGNDQBAko4N29m5ObWxsaE+/uShOnZiRGxTL8IWALAdOjdsZ2+plZUVtbq66v179949sV092hm2/hfOl9T1Yflr0/qmFvnieQDoER0ftsb6+rpaXl5Wc7dvi+2z6KSVLWELAL2ja8LWWFtbU0tLS+r4yClV2L1X7JuEsAUAbIeuC1vNbC2XSiV19tx5sb+knWHrbiP3FabVQrmstra2KiFbKZ+Jhm1foaiul/x6v000iP3xwnrt8UwxqAcAdK6uDVutVHqizo53ftiaoDXhaI5NoJqgLS9OB/2HZkqqXLqhhrx6v/3CVBi+Xj0rYwDoCl27jTw6dkYV+uW+SbYtbIUtYzsspXo7YPuGi17omjqvPuUGLABA5+iasH327FklZJfV7fk7Yvsstits7VVqtN4PWF1vbw/b7K1iHcp2nbcdTdgCQMfrmrDt5o/+ZAlbt94WbjuH4crKFgC6R+eG7dyc2tzcVA8fPlQnR0bFNvXarrAVt4mtMv9xcnB69W5Yp/QBAHSOjg3ba2/8SBVb9JejjIHBI2rwaLEpegxpbFckbM3KtHoDVOINUlag2mHqBqs/dnSlCwDoXB0btt3GBGZwx7GzzWsCNnivNfWjP9EgnVx068IbqEwbAEBnImwBAMgZYQsAQM4IWwAAckbYAgCQM8IWAICcEbYAAOSMsAUAIGeELQAAOSNsAQDIGWELAEDOCFsAAHJG2AIAkLOeCtvjY+Pq7OTFiNHxCbX/0GGxPQAArdBTYZv0fba37j5QYxcmxT4AADSLsLWcmZgS+wEA0IyODNsrV6+p2bk5NTt7q7ZKm8tXropjSNLCNgs9hjQ2AABJOjJsiydG1ObmplpZWalpY2NDDRdPiGNICFsAwHbo2G3kh48eqdXVVTFkDd1G6puEsAUAbIeODduTI6NiwNqOVVbAUt8khC0AYDt09A1Sd+8tqPX19VjI6rJ7Cwtin1ryDtu+4Rvqcbmstra2AgtT/Vbdoro+U/LKy5XHk4V+1VcoquulsE95cTo2LgCgu3V02GpLS8uxsF1eXhbbpskzbP0wLanrw364hmVlL3DNYztMTdCasr7CtFqotjdtAADdr+PDdn7+jlpbWwuCVj+eu31bbJsm/7D1V6vJ9dEglQIaALDzdHzYaktLS97NUlqjq1otz7DVJheTt4OlYO2bWgy2k+22AICdpSvCdmT0dHBn8slTo2KbLPIOW8NsB0femyVsAaBndUXYFvp3q1KppEpPnniPpTZZtCtsDfs9WDFs2UYGgJ7QFWGrnR0/r86cOy/WZZVn2EqrVDtMxbCN3SAVPQYA7AxdE7atMDB4RA0eLTZFjyGNrenANe/Z+lvIYbgmrWL56A8A7Hw9FbYAAGwHwhYAgJwRtgAA5IywBQAgZ4QtAAA5I2wBAMgZYQsAQM4IWwAAckbYAgCQM8IWAICcEbYAAOSMsAUAIGeEbYscHxtXZycvRoyOT6j9hw6L7QEAvYOwbZGkr++7dfeBGrswKfYBAPQGwrZF0r4r98zElNgPALDzEbYtkucX0wMAultPhe2Vq9fU7Nycmp29VVulzeUrV8UxkhC2AIAkPRW2xRMjanNzU62srNS0sbGhhosnxDGSdFvY9g3fUI/LJXV9uF+sBwC0Ts9tIz989Eitrq6KIWvoNlLfWljZAgCS9FzYnhwZFQPWdqyyApb61kLYAgCS9OQNUnfvLaj19fVYyOqyewsLYp80eYZtsOU7pf8tq62tLc/jmWK1LixbmAq3hd060ycy5nB/4vj2WACAxvVk2GpLS8uxsF1eXhbbZpF/2JZVuXRDDRX8AByaKXmB6JaVy4tqsnLcV5hWC5U+dmBG6mNhGx/ftDX9AQCN6dmwnZ+/o9bW1oKg1Y/nbt8W22bRjrCVVq3xMhOgxSA45Xr3cfJY9hgAgPr1bNhqS0tL3s1SWjOrWi3/sI0GX+ayqcVgW9hbCUcCNv641lgAgMb0dNiOjJ4O7kw+eWpUbJNVp4Wt2UY24RqrT3hca3wAQGN6OmwL/btVqVRSpSdPvMdSm6w6LmwrK1r7PVivXpeZerttxvEBAI3p6bDVzo6fV2fOnRfr6jEweEQNHi02RY8hjZ01DCMBagVrWBeudCNtM44PAGhMz4dtN8gahm7Z5GL4MR4/ZMM7lO22WccHADSGsAUAIGeELQAAOSNsAQDIGWELAEDOCFsAAHJG2AIAkDPCFgCAnBG2AADkjLAFACBnhC0AADkjbAEAyBlhCwBAzgjbDrfr5Hm169ylqLEpteuFQbE9AKDzELYdbtfV26pw61dxs79Qu85Mi30AAJ2FsO1wiWFbtevsa2I/AEDnIGw7XFrYZqHHkMYGALQHYdvh8gxbviAeANqDsO1wrGwBoPsRth2OsAWA7kfYdrg8w9bdRvaPy2prayvweKao+gpFdb1U9h7b/YdmSqpcXlSThf7EvnZ7AOhVhG2Ha1fY9hWm1UIlLBemwvdv7TD1HpduqKHKY6+vFcBpfU0ZAPQqwrbDtS1sh4tBkMr14eN6+9rlANCLCNsO166wDcqmFiNbwWUTqM5WsrvSrdXX1ANAryJsO1zbVrbVrWA7IGOr2UqY+gEbDd4sfQGglxG2Ha5tYRsEaRiOXpkdoF6oVo6ndL/w/dgsfQGglxG2Ha6tYWsHq1cXXa1qk4v+HcflxfDvMmftCwC9irDtdC8NqV2vnGiKHkMa293qNUEavt8av8tYB6uut8uy9gWAXkXY9jA3bAEA+SBse5gftnwWFgDyRtj2KOm9VwBAPghbAAByRtgCAJAzwhYAgJwRtgAA5IywBQAgZ4QtAAA5I2wBAMgZYQsAQM4IWwAAckbYdrjjY+Pq7OTFiNHxCbX/0GGxPQCg8xC2He7KOzfV3MInMbfuPlBjFybFPgCAzkLYdriksDXOTEyJ/QAAnYOw7XBpYZuFHkMaGwDQHoRti1y5ek3Nzs2p2dlbtVXaXL5yVRxDQtgCQPcjbFukeGJEbW5uqpWVlZo2NjbUcPGEOIaEsAWA7kfYttDDR4/U6uqqGLKGbiP1TULYAkD3I2xb6OTIqBiwtmOVFbDUNwlhCwDdj7Btsbv3FtT6+nosZHXZvYUFsU8tWcN28GhR7F9L3/AN9bi8qK7PlNTW1pYqVx5PFvpVX6GorpfKXpldHu0X1msLU1a9239x2ulbUteH3fH8ssxzssb0xmhyzgCQJ8I2B0tLy7GwXV5eFtumqSds37iwRz27k8wd2wRQJAyroWWXDVWCr1y6oYZ06CWGZdkLL7d/7Dixvx22tefUV5hWC9XzSfVaPXM2ZQCQF8I2B/Pzd9Ta2loQtPrx3O3bYts09YTteHGPunMpmTu2FDh9U4vxVaEVbn6faL1N7G+VJQdfNGwjcxL62JqdMwDkjbDNydLSknezlNboqlarJ2wHD+32AjeJO7YUYnpFaG+12h7P+FvVk4s1tnN18FVXlEFZLEzTwtapF8LU1uycASBvhG1ORkZPB3cmnzw1KrbJop6w1avXv//t3kTu2Elh64ZlErN69ALMrFy3KWybmbPUDgBaibDNSaF/tyqVSqr05In3WGqTRf43SEnBFi1LE9myFfrbYdlQ2ApltmbnLNUDQCsRtjk6O35enTl3XqzLamDwiL9FnGL38wcavEHKCTZzs5G1UrTDzA5OaZzUG6SqIWe2d4N607/WnBLHrB43OGdTBgB5IWx3EP2+rHtTlM1tnxQ4JryC9zjd8KuEl6kT693+znuk/nnD+oUpHcDVYMw6J3fMJucMAHkibHeQem+QAgC0B2G7g+jVq3RjlCH1AQDkj7AFACBnhC0AADkjbAEAyBlhCwBAzghbAAByRtgCAJAzwhYAgJwRtgAA5IywBQAgZ4QtRK8cO+H9q791SKK/IMHtAwCQEbaIOTt50QtU/Vj6Oj9Nf9OQ2w8AICNsEaGDVocpYQsArUPYImCCViNsAaB1CFt47KDVCFsAaB3CFuq5PXu98LSZG6CkoNXSwjbpS+BbwR07dlzQX0Zvf5H8opostOeL4vN83gC6F2ELtW/gRW9lK5GCVtuusO0rFNX1UrkSoPLYJmjLi9NB2eRi5bh0Qw21IXAJWwASwhZecEqBWst2he3QTKkSnKXEsfumFmNB3M4AJGwBSAhbtCVszYo02Nq1Vp5+fbj164XllO4f3f71x6yUuWOnBFytei+8I/P05/F4phj28+YSzj2sC8sWprLNBUBvImyRCzt0gq3fasDGj8OAs4/t91pNHx1qbqClBVzaNrJXX52L/dgEqt1Xh7P3C4FTZuZK2AKQELY97KeHv6keDn21JdyxI2Hrbe06q1SrTKq3Ayw4joRgtrB1V66SoL+zmvbL/YCPtpXKqs+1xlwA9C7CtofpkPy3J/9VxL858WX1u6NfDo6fvhI+rsUdOxJAOkydlaVd7wWiWF8NY+ux21c6NvS49hZvLVJbady0sqS5AOhthG0Pc8NWB+uFb39JvXvgj4Oy49/4kprb98deCNttXe7YkQBqMmxNEEqkbWXN2w6uI/R0ez2eWT1r0rhpZVI9ABC2PcyErQ5SHajHv/4l9cHBP1FbVoiuHP1X6tXv/HMvhGutct2xIwHkbRM7AZWyjSyVBXVOoLnHXngn9JWE5/LfKzarWyk408qkegAgbHuYCdtfv/xlNfy1P1KfHZHDVIfvj3f/CzX9nS+J9Zo7diSAWnCDlM0NtGbCzpwrCFj7lwBhrLSyes8PoDcQtj3MhO2z4pfVxUqQjn/rS6rkrF71qvenlVVvsbLqXRj4k0idzR3bDR0TsGb7196u9ev90PPqdL+Zxla2qVvO1XmYYHfvVLZ/EZCCM61MqgcAwraH2e/Z6tXrhwf/xHuP9sGhMFT19rEO4tXhaLi6pPGb4a0wnfdxkxBwADodYdvD3BukNB2qj176l8GxDmD7Pdwk0vhZ+Vu3YVi628xp/LDN/h4tALQbYdvDpLBtlDR+Pdzt36xBK91FDACdhrAFACBnhC0AADkjbAEAyBlhCwBAzghbAAByRtgCAJAzwhYAgJwRtgAA5IywBQAgZ4RtixwfG1dnJy9GjI5PqP2HDovtAQC9g7BtkSvv3FRzC5/E3Lr7QI1dmBT7AAB6A2HbIklha5yZmBL7AQB2PsK2RdLCNgs9hjQ2AKC79VTYXrl6Tc3OzanZ2Vu1VdpcvnJVHCMJYQsASNJTYVs8MaI2NzfVyspKTRsbG2q4eEIcI0neYds3PK0mW/jl6K0eDwCQrOe2kR8+eqRWV1fFkDV0G6lvLXmGrf/l6OGXqzer1eMBAGrrubA9OTIqBqztWGUFLPWthbAFACTpyRuk7t5bUOvr67GQ1WX3FhbEPmnyCls/GMtqa2vL83im6JcXiup6KSwvlxfVZCEMT7eftjDVnzgeACA/PRm22tLScixsl5eXxbZZtHNla4K2vDgdtBmaKaly6YYaqgSutHI1IRsGLitbAGiXng3b+fk7am1tLQha/Xju9m2xbRZtDdupxfhKtjCtFiJhGq23EbYA0F49G7ba0tKSd7OU1syqVmtn2OpVrL09bDPbwpOL1haztQKWxgMA5Kunw3Zk9HRwZ/LJU6Nim6zaHbZmy9ht6zIrXi90q6tdwhYA2qunw7bQv1uVSiVVevLEeyy1yaqdYetvI9cXlvFtZsIWANqlp8NWOzt+Xp05d16sq8fA4BE1eLTYFD2GNLYdlP5x9QYpa3VrB7D4nq4VsO54AIB89XzYdgvzHqx5/zX+0Z/oSlUHrqmT6t3xAAD5IWwBAMgZYQsAQM4IWwAAckbYAgCQM8IWAICcEbYAAOQsS9gePXbcD9sXjg4AAIA6ZA1bjbAFAKABhC0AADkjbAEAyBlhCwBAzghbAAByRth2gcFXD6qXLzlee0EdOvWC2B4A0FkI2y5w9MYBdfxn++M+2Kde/sFBsQ8AoHMQtl0gMWyrXn6dwAWATpY1bPmjFhm8eeMtdeeDd9X8+3dq0m1+PPOmOIYkLWyz0GNIYwMA8sfKtoXOTp5Tm5ubamVlpaaNjQ11euKMOIYkz7A9OHFTPSk/VTcneP8XAPJC2LbYp7/8hVpdXRVD1vj0l5+KfZOwsgWA7kbYttj41HkxYG1nJ8+KfZMQtgDQ3QjbHNz/6L5aX1+Phawuu//gvtinljzD1t1G9o/LamtrK/BkfkwdHBpTNz8re4/t/mPzT1W5/JF6feiFxL52ewDoRYRtTpaXl2Nhq8uktmnaFbYHh15XH1XC8qM3wvdv7TD1Hn92U41VHnt9rQBO62vKAKAXEbY5ef/D99Xa2loQtPrxuz97V2ybpm1hOzEWBKlcHz6ut69dDgC9hrDNkV7J6pultEZXtVq7wjYoe+OjyFZw2QSqs5XsrnRr9TX1ANCLCNscXZi+ENyZrG+cktpk0baVbXUr2A7I2Gq2EqZ+wEaDN0tfAOhVhG3Onjx5op48fSLWZdW2sA2CNAxHr8wOUC9UK8dv6H7h+7FZ+gJAryJsc/bqpVfV9y9NinVZtTVs7WD16qKrVe31j/07jssfvx6Ok7EvAPQiwrYLvHh6QL107oWm6DGksd2tXhOk4fut8buMdbDqerssa18A6EWEbY9zwxYA0HqEbY/zw5bPwgJAngjbHia99woAaD3CFgCAnBG2AADkjLAFACBnWcP26LHjhC0AAI1gZQsAQM4IWwAAckbYAgCQM8IWdTn86kE1/JP96oVhuR4AEEfYIq44qA5Mvqr2vzGj9l2f9+jHuuzl115U5zb3qtFf7fP+5rLYHwAQQdgiNHxIHXj9inr+3V+qvT/7S9GL9297Yaud/WKvOvrOAVa5AJCCsIXn4PFBtW/mPTFgbYcevBeErTHycF/itwoBAAhbaJUVbZag1aSw1fS2sjg2ACBz2PJHLXYwvXUsBaskFrYbe1Xxzn41UJTHBgCwskVxMPE92u9c/qn65tir6utHx9SfnXtNPfeTxUjYjn7+ijp0/443hjg2AMBD2Pa4A9+fjAftB79V3zh5Qf3p/hfVn52ZVt+euKK+cfyc+tcvDauBj+54QTv8+KJ6/sNfe+31GNLYeX4xvTt27HjodfVR2f8KQe9rBKvf2XtwaEzd/Cwsl7TqKwcPTryuXudL+QFUELY9Tn+kxw3bvh/+hfrTAy+p3XMfR+ve+5V64ecLauDj6Pu7egxp7LzC1gRmOWFsE7R2aOrv7i1/dlONOV+Sn9scc/xFA0D3IWx73L535iPBqX1zZMJb0brlSfQY0th5Bc7Y/NNKcD5NHPvgGx/FgjhpLoQtgHYgbHtcYtienoqVJ8katu4Wrrtda2/9emH5hu7vb/8GbbwxK2Xu2CnhllRfq19svuJcolvSH73xQqz8yfxYZFwAvYew7XGJ28j7X1T9sw8i5c/duBc5NrJsIwdbv9WAjR/7QWuCKdgKtgLO9AkDLXvY1ruN7M5P81fU/hhSP79Mnh+A3kbY9rikG6S+fvyc+sq+F70V7rcvXFZfPTKivlIJ4D3zn8baZ7lByt/adVaGVplU74WbVeYdm3B2wqxWuPnjyHVJ/cT5Vn8BCMM0Wm+rNR8AvYew7XVJH/2pBK5e4eot5W8Uz6pvfe+y2n0rutLVdN+kj/7YgeOFl7OytOvtVWO0vhrGTri5YeYeG3pcs71rlxtp/SRm9a1Xy6YstiWeMC6A3kTYoq4/auHSfaUxNTtwmg3bWuGXtG3rbR2nBF5SKErzSRJ9r9n+5aD2uQH0DsIWdf25Rpvuo/uKY1bYgeNvy0bDx96qFbdthbKgzgkz99gLy4S+tqRQlOabJr7NXF9/ADsXYQtP1i8iMHRb3Ucay4iEbQtukLLVCtt6gi6pbTA/a3VrB7D4y0Hk+YbBa+oB9C7CFqHKKjXtK/Z0nbd1XGNFa8QCsRpgZvs39j5nZDu20m++sZVt2pZzrXEide58nXY6cO2x3Xrznq77PAH0HsIWcTW+PL6dfwfZWz1mfd+0RmgCwHYjbNER3PdI3W3mNH7Ypr9HCwDbgbBFx3C3f7MGLdu1ADodYQsAQM4IWwAAckbYAgCQs6xhe/TYcT9sBw/tBgAAdah7ZSsNAgAAkhG2AADkjLAFACBnhC0AADkjbAEAyFnPhe3lV/5czQx9O+LHR/5cnTpcENsDANCsngvbB8Wvqy9G/jTm85GvqLeOfFvsAwBAMzo6bN9565o6f+aEWNeopLA13qmsdKV+AAA0KmvYbssftXjv3Tm1sbGhPn30UF04NyK2qVda2Gahx5DGBgBA0tEr23fv3FIrKytqdXXV+/fn9++J7eqRd9gePj2trpzuF+vapRPmAAAIdUXYGuvr62p5eVm9/95tsX0WeYbt4dM31NNySc1tY9B1whwAAFFdFbbG2tqaWlpaUhPjp9QrL+0V+yYhbAEA7daVYauZreUnT0rqtVfPi/0leYWtH3L+l5hrT2eLYnm8blHNzZa88nLl8ZWBfnV4YFo9qPYp6+C85LfTdV6/gaKaexqOGfRLmAMAYHt1ddhqT5486Yiw1dxVpQnNB5fCVeZ4JVjdcCx/NB2OUe0TBHL1OAxiP2jtPt6YT2+o8WBMVrYA0Em6dht5eXlJvTpxRuxXS1vD9nTRC8CkNiZs7TA+fGkxCFZTFglood4OdcIWADpPV4Xts2fPvBukPnj/jtg+i3aGbVBeCUiztetv+9phG21vr1KD/l47P2B1vT2WTa+GCVsA6DxdFbb3Fzv7oz9u0IVbwFaZ1abRsHXrbYQtAHSejg5b/UctNjc31aefPlQTF0bFNvVqa9jqLV83OL1t4OSwFbeJrTK7v6m3EbYA0Hk6Omxn3vmR+t54a/5ylJFr2Do3RLnB6AdhuNIVwzbrDVJWiEcC3JkDAGD7dXTY5uHsSwU1MfjdpugxpLG1Kx9VP7JTvVvYHHtlXiCGYZi0CjWBGfSZja524x/9iY7hzgEAsL16Lmy7kbdyrfE+LQCgsxG2HSa29Sx8rhYA0F0I2w7kfryHoAWA7kbYAgCQM8IWAICcEbYAAOQsa9gePXbcD1vdAQAA1Keula00AAAAqI2wBQAgZ4QtAAA5I2wBAMgZYVv1yrET3r9X3rkpGhg8EusDAEAWhG3F2cmLXqDqx3MLn4gGjxZj/QAAyKLnw1YHrQ5TwhYAkJeeDlsTtBphCwDIS5aw3ZF/1MIOWo2wBQDkpSdXts/t2euFp83cACUFrUbYAgAa1ZNhu2/gRW9lK5GCVksL277hG+pxuaSuD/eL9fXoKxTV9VI58lV7wVfuLU6LfbZTs8+9la8dAHSingxbHZxSoNayHWH7eCZ6TlNeLt1QQ4WdE0yELYCdjrDNqBPC1q+bVgvlslqYImwBoFsQthnVG7buVrC7/WtC06vT/aZ0/0U1WVmx1gpbbWimFBkvdq7qOF6dmZc3fthGj+3XhWV2gKfN32Y/90bOZ/d3xwaAnYCwFYyOT3htbLufPyCOZUQCpxpUJqDix37QmjA1xyYk08K2b2ox2Ep2x9a8MDb11YCzt551vRegTpl7/qT5uyLPvZHzEbYAdjgdtln0VNjq+j/71p+rr3zlq4ncMSOBo8PQWl169VaZVC+FXc2wrTGWvdVswi+yak0syzZ/UxbU2X0bOZ/12NQDwE4iBauk58JWB+of/dN/lsgdMxIeOpisVZxb7wWrWF9H2Fb7m1WjJNy6jQZZWlna/E2ZVNfQ+WqMDQA7gRSsEsLW4Y4ZCY+cw3ZyMdzSlcaySUGWVkbYAkBrScEqIWwd7piR8NBh5YaLV1YNU+uxWF8jbN27kaVz2RoKv5T5m7Kgzu7byPmEegDYSaRglRC2DnfMSHg4NxTFjxu7QSoYx1p1imVWWDYUfinzd0X6NnI+oR4AdhIpWCU9Gbbf+da31U9u3AgcGXw5U9h6x9WAMu+fukFlAtar0/1m4itb09cmr3adc9nzaCD8vOMa8zd1wS8LVt9GzifVA8BOIgWrZEeFrf47yPqLB5Loeh22+/c+r75YWwtMfm8iMWyb5a1Ga7z3CgDoXlKwSnZU2Gahw9YEq0Tqk5X7nqhZKSZt0wIAupsUrJKeC9u8uR/ZIWgBYOeSglVC2AIA0CApWCWELQAADZKCVULYAgDQIClYXfPz84QtAACNksJVQtgCANAgKVglhC0AAA2SglVC2AIA0CApWCWELQAADZKCVULYAgDQIClYJYQtAAANkoJVsnPCtn+P+u7R0dCB6vPaP6B2DZ1S3z08HO+z53m1a2BQ7Xr5mN/frQcAoAYpWCU7Jmx3HXpFPbewFtg1MqF2XZlTz91dDcoKl2/57ffuV4Xpt9Vz7z0N62488MLXHRcAgCRSsLp21B+12DX6/SA4vfC0gtS26/SUKtz8hVw3OimODQCARApXyY4J28LF67HwLMz/ZWRl67lX/bdSV7j7eaRu1/euimPvNHypOwC0hhSskp0TttfvB6FZuPVL9d0jI175ruHTkUAt3PqV+u7Lx/26ykrWrtNbz/aYOxVhCwCtIQWrZGeEbf8e9dwHvwtDc8zaDh48FgnUwrkfBHW7Ri5E6na9eCTst4MRtgDQGlKwSnZE2Lo3R9l3HsdWr6/4q1qv7tW3wrqfLSnpjuQgmGYWwy+EL91QQ4UwqPoKRXW9VBa/MD7oP6X/Dds8nilW68KyhSk5/PQX0petcOwrTKuFSr9wjPrGD/oQtgDQFClYJTsjbO2boz5cVd/dvTeoK0y/E9bdrdRZdxwX3vwwqPPuRq6W20xglcuLarISsCZYTaCmHpv+VkDr8NTh55aZc+hj1+RiOKb9uJHxCVsAaA0pWCU7Imztm6MKP3kYrbMC9bmfPorW3Xkc9rt0M1JnmDCzV512WPVNLcZC0i5L7p88pimzBfXeCjY8XyPjp50LAJCNDtKvfv2bqXZG2No3R5nP0lY9N/9bue7AoaDcq7Pey7VJwWS2cXWYecHqbiunBFvWMpdZsaaFdFpZlnMBANL1Tti6N0eNXwrr9h0MP+qj6869HtTtOnYmKNfM3csuMbi2KWz19rG3PVzdQtYaGT/LuQAA6XombGN/OUr/qUZTN3QqWvfKibBu4mpYVwlk/VelTJ3NDyZpS7a6TextGTvBFttGri8MTZktHDMMeq+8gfHTzgUAyKZ3wta+OUqH5vMHgzq9NRzWfa527d0X1r3xXlDnffa2Wu7yg6kchmdDN0jVF4amLKhzA7bJMK91LgBAdr2zjfzC4eDLB3YNRbeC9ZcMBHVHTkbrBotBnf4srl1nC4LJ/uiPtY3rtakGrFTfUBhWx9Mf39F13t3H1la1HegNjS/UAwDq11M3SOWJYAIAJCFsW4SwBQAkIWxbhLAFACQhbAEAyBlhCwBAzghbAAByliVsjx47TtgCANAoVrYAAOSMsAUAIGeELQAAOSNsAQDIWdeF7cDgEXXlnZse/VhqAwBAJ+m6sB08WlRzC5949GOpDQAAnaQjw1avWHWQmpXr/lN7PP2HhbA9PKx2jU563HEAAOgEHRm2eotYh6n+Vx+f29zrGXxzTyxsC2/dVf2//0ePOw4AAJ0gS9gm/lGLy1euqeHiiVh5swhbAMBO0tTKdnZuTm1sbKiPP3mojp2IfiF7M5oJ2++9dtnrp/+1xwQAYLs0F7azt9TKyopaXV31/r17716sTSOaCVu3r6uvUFTXS2W1tbUlKpcX1WQh/Wvy+oan1eQ2fp1era/0M8/x8Yx8A5ndt11fDchXEALoZS0JW2N9fV0tLy+rudu3Y23r0Y6wTQqiLDohOJoJWxshCAD5a2nYGmtra2ppaUkdHzmlCrv3xvqlIWzTEbYA0D1yCVvNbC2XSiV19tz5WN9aOiFsh2ZKqmyFUF9hWi2Uy+ov5+9UwinchjbjmHGl7Wg/0BbV9cqYpu77R6shN6X/DfstTIWh5/eLbnkH52sibO2+weOZxeAc5dINNVRj7vp5pc8t4fkGr2fy6xWOER3ffm0AoJvkGrZaqfREnR3vvrDVJhfLqrw4HXscBJQTHKZe88K6GlomOOz6oMwKNj/gq2FWDXc7YCL1zhxs9YdtOA/3uYhzzzQ36flWz5np9Yo+NzMmgQugG+W6jTw6dkYV+qN9smhH2NorJpsdUMFF31t9hisvNwz6phbjKzMrkKSgSC4zIVgMQliuj84h0q6BsE2eh1SfZW41xsz0ekXrAaCbtTRsnz17VgnZZXV7/k6sbT3aEbZZVraaXnHpEE4KDruNRJ/HbS+NkVhWCSZ7PLO1LbUN+tQdtmnBl3CeOuZml6W9Xrq93kkwZfYKGAC6UUvDtps++pM1bM1FP2lLVB/bW6CmjS0tfKQyE3iR943teqF/ME7OYdvI3OyytNfLZs7l/QxY7QLoUs2F7dyc2tzcVA8fPlQnR0Zj9Y3qlLANtzvD8PHKnTDx20XDxZYWPlKZN6YTSPZ5pP5Bu7rDtsY8pPoG5hYZM+X1kti/AEj1ANDJmgrba2/8SBVb+JejjFpfRLD7+QNenaYfu19E4PZ1ZQ1b9+LuB4S/sorVVce0A6ie8JHK3EDy68LVpNQ/GKfusA3nHjyX6kpeOk8jc4ucM+31sl5rqb8pA4Bu0VTYdiNzoTfvB7rMBd+7+9gOAyeE3O1ld9x4GEWDIktZ5H1LrzwM+VrhU+s56gC2+waP7Y/+1NgyN+qdm1tW6/Xy6iuBa+qkegDoJj0XtgAAtBthCwBAzghbAAByRtgCAJAzwhYAgJwRtgAA5CxL2B49dtwP20OvfQ4AAOqQNWw1whYAgAYQtgAA5IywBQAgZ4QtAAA569iwfe32mnrzw+x0e2kcAAC2W8eGrQ7QO4/W1Ft3/X/T6PbSOAAAbLeODlsdtId+sKZ+eEcOWBthCwDoVE2H7cSNz9Wxq9GyVjArWx20WQKXsAUAdKqsYZv4Ry0u315VGxsbanZhRRWvrcbqG2XCVssSuFffl8cBAGC7Nb2y/eHcqlpeXlErK/6/b38QrW+UHbZX31tTL/7gc3VxLiy7/XBNXaqE78kfV9pXglgaI83p+3/lfDn5X6nZN1v3C0OSgTfX1aWM5xl4c0M9bdO88jJw+/eV1/b36tLF2s9hu34eWe2EnwWA7dHCsPWtr6+r35RW1JXKitdtWw8TtlLQ3ri/po5d89sNXFlXB2/9tdp/9z+rA+/9jTp4vRwbS6Iv7G4A6FDQF/mPmpx7LfVesHshbAcufqFmV8qqvLKhTlttTPjm+fOoB2ELoFEtD1tjbW1N/erxijp+bdULS7dfGh22+gYpKWhf/mGlzetrat/P/6vq3/yD6v/9P0bs+d3fqhdmtsRxNXNxly7il34Tv+i3EmEbr6/1mnu/FOX486gHYQugUbmFrba6uur9u/jpqjqlt3udvrXosJ1/uKaufRAGrT72VrSVoN3z+H/HQjZi4w/q4M1/J45twvbp/S/EeptpG2xt/mY9rPMuvr9Xs9UVmAkUvzzso+lzueXm/OnnqFzg7/urbsP+RSHW312xC/OptVpMmn9YV5nP7Wib6HzW1UfVOm8ruDL3pLA1bbOuXjO9VrXmlvJaZBq/Gratft0B7Fy5h612/xc6bOu7yNjv2RrejVKVun0//2+xcNVlez7720jZ7vV/UAPXNmJja2bLWEsKXXMxNRdcNxjMxTRyQRbCw96yTrpgp57DWt1FxnP6B/XV9u757DGlC3+2+deaj98//EXCP3aDyJDmlyT+WjnHaXNLeS2yje/3b/XrDmBny3Ub+dePV9TJH0XbZyWF7YnKWAOX18Wt44E3NtXzn/yPWLneapbGN/QF0l552BdP6YJpky6eA29+EVzoo+2qF2lnzMbOYY0nbNHagem3lYNOkm3+9c3HDjxTZtQzP/G5WmWpc0s5V7bx83ndAexsLQ/bZ8+eqd+WVtTV+eYuMuMza+rV2c8j9Pu3B27/dSxQtaSw3b309+L4kmAVZlYnwgU10t66+MbqKn0jIR654Id9GjmHXeb+smAzq0v9nqgps3+ZqCXr/L22znzslWVYLz9Habwk3msljp1tbvq41mtRz/h5ve4AdqaWh+3b769U69Ivno3Y/+F/igWqpsN238f/PV63/g/iOEkiF9dGgjDYNg3Lky7YXl0LwtYNiCRmbt7FPyn86py/W1932FqrQbcurK+euwVhG5QLr0W9YdvK1x3AztZ02Oo/arG5ualuLa6oE29E6/Kw/72/iQdqxYF3/6MauPxM7Xn6fyLlu7/4v7Exki7Abl2tdm7boEy6YHuBKo/Z0DmsMntsu18ttQKu3vl79bH5RANFKrPVCi6vzg5D99zW2GlzM2U2+7WoZ3ypbZparzuAna3psP3+X3yujlc/89oOL1wvR8I09Ad14M5/8AP3s78Lyvf+5n+J43gfN3EvrGk3yNS4YSYYw7kI+23Cc7kX3IbOYV/0TXsrrOw52GEh9TdlQV3a/FPn4z+/8PlUj2uErfQcNB20ejXYstcq5bWoZ3xpzs287gB2tqbDtu1+8Ln3Odpo0Bp/UPsW/4vq/+L/BWUHbv21PE6FuZjb3DuTzUXV1JsLr1eXcPGMvFfn1UcD1tS7F/Ws53DLYv3d9pULv6mT6l215p9tPn77oH+Nj/7Y7POG5472afq1Snkt6hm/1a87gJ2r+8K24uDMlnhHsmvvr/+nF87SGAAAtEtXhq2m/2DF7mfhCtalg3bgkvz5WQAA2qlrw1bTf7BCf4529+/+zlvp6puh9Hu0B279e7E9AADboavDFgCAbkDYAgCQM8IWAICcZQ3bo8eO+2GrOwAAgPrUtbKVBgAAALURtgAA5Cxb2H5T/X+ZIhOJGfzZBQAAAABJRU5ErkJggg=="><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdsAAAGmCAYAAAA0xi4rAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAADRYSURBVHhe7d35cxznnd/x/CdJ1TrZjVO1jq+1FzZHICkeAiVCIggOSRDgAdIwBFAWzUO2DoJrEwRBHRYJ0KJEyudySBmHIALwVgapZFPZSipH5Yekkt2tStb7nzyZp3ue7qef/vZ0z9GDGcz7h1dx+rn6mQGrP3ie6cH8k0OHDqnvHDgKANhBvvvcbrG8Xq+88opYDv81/trXvqZeODqQirAFgB2IsM0fYQsAPY6wzR9hCwA9rlVhi2SELQD0OMI2fyZs9//4L1J5YasbAwB2DhMEyE/dYas7AACA+hC2AADkjLAFACBnOmy/+vVvpiJsAQBoEGELAEDOCFsAAHJG2AIAkLOODNvjY+Pq7OTFiNPfe1UdeHFQbA8AQCfryLC98s5NNbfwScytuw/U2IVJsQ8AAJ2qq8LWODMxJfYDAKATNRy2V65eU7Nzc2p29lZtlTaXr1yN9E2TFrZZ6DGksQEAaLeGw7Z4YkRtbm6qlZWVmjY2NtRw8USkb5o8w7avMK0WymVVLi+qyUK/2KYRZtytra2Yx4s31ORw687Van2Fl9X0nQfq448/jnnw9mmxj+3Fi3fU/MWXg+O+w6+p+Qd31PTh/rrGrtVWe/DgbTXi/Mz0uXWdfX5t5O0H6sGd19SLCe2Tzp3l+Urs5yzVd7JaPz+7XSOa/b8F7BRNbSM/fPRIra6uiiFr6DZuvzQ7LWy1crmkrndo4JoLohtYQQAJoWXrG3s7cuGUwjbL2Eltk5j2b71dOb8TxN6c3DK7vfOc+gqn1VsPsp/b1c1hW+vnZ7drRD0/f2AnaypsT46MigFrO1ZZAbv90nRz2Lqh2jc8ra6X/BAuL05H+nSKWiFnQuitseTXym8TBluWsA37hWPXaisJAtU7X3SO/hycMu98el7mX6vOG6vxgOnqsK3x83Pb1qvZ/1vATtH0DVJ37y2o9fX1WMjqsnsLC2KfNNsRtkMzi+pxdWWqA3NhZloNWfV9haK6vljy60uLlUCNjpMUtl7f4Rve2PY59XiT7jmnimGfqcXwXNZ5dX8zV79P9Fxpz0OSFnJ6mzGy8hHaj7wdXpyzhq1mj11v2IZbxX6/tDl6gWq1t+u8eQirbGnL039+b6tpsyVdeXzypWhA6XPZ/Uz4m/G04JcM83pd9Pt4/dyVt9A/8txqzFest8JVS/r5iX1jY/uh6Y9b6Tem+/vjSz8HW9L/LWmewby88cM2emz39Yn+klV7/kA7NB222tLScixsl5eXxbZZtDtsJxfl7V+zEvWCtro6jbXJErbV/nZd0jkfz/iBa8LWVS75wRse3wjCNO15JEm7IIYhFX1eNvt9P/tiXc/YaW1t5gJv2noXbSdA3ADV4Rxpb1107TozD1MfO65e2CMhYT/nan0sTKvhZY+h2wTjOQEVnj++ArSfb1p7tz7ob702+jh4/vZzSXstnJ+DOXbnZupd0s8/aZ7B6+TM2wtQpyz5tYmfA2iHloTt/Pwdtba2FgStfjx3+7bYNousYTs6PqEGjxZFA4NHxLHdsA1XnZUgrK4sTZkOKr1yjLSphuXQTHW1WUfYxsbTK9VqW73dHJmXWdnq40obO3yjc8r+POw52TJdEJ0gc3kXwshFsY6wdS6MZgXissdw52QuxJEVjTB2NABNnRNOwvONjCWdyzzn6qorMlfrXKbMVnM8L7xfDoJErg8f222CttLzcZ+zHkP6+aW9FkK9FHaZfv4p8/TnJb1ONV67lPmbMiBvLQlbbWlpybtZSmtmVatlDVsdqrtGJ1XhrbuJ3LFjYWtCzVn9mVWiXmlKbWLj1LGyTVq1am4bs3KNhWsDz8Mut2W6IForB4l/UaxeNO2LXR1jp7W1eVvI1urE9I2W6TnZgRReYOMXcatOeL6R52Q9jtbL25ianq+pc1dV4nhOGHpllXmZMbxxzHxSwsOs/iTmtU78+aW8FvbKM1pfHauOn3/aPMXXKaUsbf6mDMhby8J2ZPR0cGfyyVOjYpus6glbHaj9v//HRO7Y2xO28jmTeCvXpLA1x20MWzfYkuh2YXhVL3Z1jJ01bE0QSRdlN3T0+Ho8LxSc55BUl3aBTr7A+8/fe05O/6CdNXczV3E8+5eB6mP7Bq7IfDKEbdJ8bOLPL+ewtX/+afMUX6eUMsIWnaJlYVvo361KpZIqPXniPZbaZNXWsK2x/RqsMp1j3SbrNrJ3I1Q18EwQRlapTjAbdYdthufhnsOodUG0L/puncu7sFUunJGLXR1jZw1b76IshIt/3uhcTZCaYLXbJ9X54eVcwK1AS73AV59XrecRCVNh3n5Z9XxSYFhzlOZjk56PxGvn/vyEvn6ZNTfnZxGpr+fnL5zLJj3PtLK0+ZsyIG8tC1vt7Ph5debcebGuHu0MW11mwtAVhKNwg5S+USkITO+i4o9rt7G5gZd4ThOmdYZtlueRJOmCaMprrTZs3kWu0vaQdWduPWPXujAbQb/qaiitzp/TndgFuVadO07sOOUCr4/9Xwiqr4EUSFZ7/3FlfCeggvM5gRG2r/ZPm685tl9rKYT0uAk/v+Sxo79YmOO0sBXnlDJP9zX26lPK0uYPtEtLw7ZV9M1NOkjT7H7+QEvC1lt9pn70p9KvGrj+jU3RcWqFrfQXpPwVrx/YdjtzzkbCNsvzkJgLkLslq0nBZ9rLF9A7aupk/GKXZexabTV90fXHjq4CbXbI6ePg4m9dwA1zvlp1wbmti3OWi747tg4N97kEbU1f+6M/Thjo1Xe0r7MqrDFfsd6Zf9gm+vMT+8bG9ucSjFt5Hm7Ymr62Wv+3TBvxdbLmXc/PIhiToMU26MiwrUe9YdsIE3Q6wMxnYfumzBZtGHZAI6TA6GbealT4BQboZYRtBtI2spG2RQuk6eawjW1xV1eRrB6BKMI2I+9zsM4flLC3fYFGdfvKVm/dmy1atmkBWdeHLQAAnY6wBQAgZ4QtAAA5I2wBAMgZYQsAQM4IWwAAckbYAgCQM8IWAICcEbYAAOSsp8L2+Ni4Ojt5MWJ0fELtP3RYbA8AQCv0VNgmfXXfrbsP1NiFSbEPAADNImwtZyamxH4AADSjY8P28pVrarh4QqxrVNYvpa9FjyGNDQBAko4N29m5ObWxsaE+/uShOnZiRGxTL8IWALAdOjdsZ2+plZUVtbq66v179949sV092hm2/hfOl9T1Yflr0/qmFvnieQDoER0ftsb6+rpaXl5Wc7dvi+2z6KSVLWELAL2ja8LWWFtbU0tLS+r4yClV2L1X7JuEsAUAbIeuC1vNbC2XSiV19tx5sb+knWHrbiP3FabVQrmstra2KiFbKZ+Jhm1foaiul/x6v000iP3xwnrt8UwxqAcAdK6uDVutVHqizo53ftiaoDXhaI5NoJqgLS9OB/2HZkqqXLqhhrx6v/3CVBi+Xj0rYwDoCl27jTw6dkYV+uW+SbYtbIUtYzsspXo7YPuGi17omjqvPuUGLABA5+iasH327FklZJfV7fk7Yvsstits7VVqtN4PWF1vbw/b7K1iHcp2nbcdTdgCQMfrmrDt5o/+ZAlbt94WbjuH4crKFgC6R+eG7dyc2tzcVA8fPlQnR0bFNvXarrAVt4mtMv9xcnB69W5Yp/QBAHSOjg3ba2/8SBVb9JejjIHBI2rwaLEpegxpbFckbM3KtHoDVOINUlag2mHqBqs/dnSlCwDoXB0btt3GBGZwx7GzzWsCNnivNfWjP9EgnVx068IbqEwbAEBnImwBAMgZYQsAQM4IWwAAckbYAgCQM8IWAICcEbYAAOSMsAUAIGeELQAAOSNsAQDIGWELAEDOCFsAAHJG2AIAkLOeCtvjY+Pq7OTFiNHxCbX/0GGxPQAArdBTYZv0fba37j5QYxcmxT4AADSLsLWcmZgS+wEA0IyODNsrV6+p2bk5NTt7q7ZKm8tXropjSNLCNgs9hjQ2AABJOjJsiydG1ObmplpZWalpY2NDDRdPiGNICFsAwHbo2G3kh48eqdXVVTFkDd1G6puEsAUAbIeODduTI6NiwNqOVVbAUt8khC0AYDt09A1Sd+8tqPX19VjI6rJ7Cwtin1ryDtu+4Rvqcbmstra2AgtT/Vbdoro+U/LKy5XHk4V+1VcoquulsE95cTo2LgCgu3V02GpLS8uxsF1eXhbbpskzbP0wLanrw364hmVlL3DNYztMTdCasr7CtFqotjdtAADdr+PDdn7+jlpbWwuCVj+eu31bbJsm/7D1V6vJ9dEglQIaALDzdHzYaktLS97NUlqjq1otz7DVJheTt4OlYO2bWgy2k+22AICdpSvCdmT0dHBn8slTo2KbLPIOW8NsB0femyVsAaBndUXYFvp3q1KppEpPnniPpTZZtCtsDfs9WDFs2UYGgJ7QFWGrnR0/r86cOy/WZZVn2EqrVDtMxbCN3SAVPQYA7AxdE7atMDB4RA0eLTZFjyGNrenANe/Z+lvIYbgmrWL56A8A7Hw9FbYAAGwHwhYAgJwRtgAA5IywBQAgZ4QtAAA5I2wBAMgZYQsAQM4IWwAAckbYAgCQM8IWAICcEbYAAOSMsAUAIGeEbYscHxtXZycvRoyOT6j9hw6L7QEAvYOwbZGkr++7dfeBGrswKfYBAPQGwrZF0r4r98zElNgPALDzEbYtkucX0wMAultPhe2Vq9fU7Nycmp29VVulzeUrV8UxkhC2AIAkPRW2xRMjanNzU62srNS0sbGhhosnxDGSdFvY9g3fUI/LJXV9uF+sBwC0Ts9tIz989Eitrq6KIWvoNlLfWljZAgCS9FzYnhwZFQPWdqyyApb61kLYAgCS9OQNUnfvLaj19fVYyOqyewsLYp80eYZtsOU7pf8tq62tLc/jmWK1LixbmAq3hd060ycy5nB/4vj2WACAxvVk2GpLS8uxsF1eXhbbZpF/2JZVuXRDDRX8AByaKXmB6JaVy4tqsnLcV5hWC5U+dmBG6mNhGx/ftDX9AQCN6dmwnZ+/o9bW1oKg1Y/nbt8W22bRjrCVVq3xMhOgxSA45Xr3cfJY9hgAgPr1bNhqS0tL3s1SWjOrWi3/sI0GX+ayqcVgW9hbCUcCNv641lgAgMb0dNiOjJ4O7kw+eWpUbJNVp4Wt2UY24RqrT3hca3wAQGN6OmwL/btVqVRSpSdPvMdSm6w6LmwrK1r7PVivXpeZerttxvEBAI3p6bDVzo6fV2fOnRfr6jEweEQNHi02RY8hjZ01DCMBagVrWBeudCNtM44PAGhMz4dtN8gahm7Z5GL4MR4/ZMM7lO22WccHADSGsAUAIGeELQAAOSNsAQDIGWELAEDOCFsAAHJG2AIAkDPCFgCAnBG2AADkjLAFACBnhC0AADkjbAEAyBlhCwBAzgjbDrfr5Hm169ylqLEpteuFQbE9AKDzELYdbtfV26pw61dxs79Qu85Mi30AAJ2FsO1wiWFbtevsa2I/AEDnIGw7XFrYZqHHkMYGALQHYdvh8gxbviAeANqDsO1wrGwBoPsRth2OsAWA7kfYdrg8w9bdRvaPy2prayvweKao+gpFdb1U9h7b/YdmSqpcXlSThf7EvnZ7AOhVhG2Ha1fY9hWm1UIlLBemwvdv7TD1HpduqKHKY6+vFcBpfU0ZAPQqwrbDtS1sh4tBkMr14eN6+9rlANCLCNsO166wDcqmFiNbwWUTqM5WsrvSrdXX1ANAryJsO1zbVrbVrWA7IGOr2UqY+gEbDd4sfQGglxG2Ha5tYRsEaRiOXpkdoF6oVo6ndL/w/dgsfQGglxG2Ha6tYWsHq1cXXa1qk4v+HcflxfDvMmftCwC9irDtdC8NqV2vnGiKHkMa293qNUEavt8av8tYB6uut8uy9gWAXkXY9jA3bAEA+SBse5gftnwWFgDyRtj2KOm9VwBAPghbAAByRtgCAJAzwhYAgJwRtgAA5IywBQAgZ4QtAAA5I2wBAMgZYQsAQM4IWwAAckbYdrjjY+Pq7OTFiNHxCbX/0GGxPQCg8xC2He7KOzfV3MInMbfuPlBjFybFPgCAzkLYdriksDXOTEyJ/QAAnYOw7XBpYZuFHkMaGwDQHoRti1y5ek3Nzs2p2dlbtVXaXL5yVRxDQtgCQPcjbFukeGJEbW5uqpWVlZo2NjbUcPGEOIaEsAWA7kfYttDDR4/U6uqqGLKGbiP1TULYAkD3I2xb6OTIqBiwtmOVFbDUNwlhCwDdj7Btsbv3FtT6+nosZHXZvYUFsU8tWcN28GhR7F9L3/AN9bi8qK7PlNTW1pYqVx5PFvpVX6GorpfKXpldHu0X1msLU1a9239x2ulbUteH3fH8ssxzssb0xmhyzgCQJ8I2B0tLy7GwXV5eFtumqSds37iwRz27k8wd2wRQJAyroWWXDVWCr1y6oYZ06CWGZdkLL7d/7Dixvx22tefUV5hWC9XzSfVaPXM2ZQCQF8I2B/Pzd9Ta2loQtPrx3O3bYts09YTteHGPunMpmTu2FDh9U4vxVaEVbn6faL1N7G+VJQdfNGwjcxL62JqdMwDkjbDNydLSknezlNboqlarJ2wHD+32AjeJO7YUYnpFaG+12h7P+FvVk4s1tnN18FVXlEFZLEzTwtapF8LU1uycASBvhG1ORkZPB3cmnzw1KrbJop6w1avXv//t3kTu2Elh64ZlErN69ALMrFy3KWybmbPUDgBaibDNSaF/tyqVSqr05In3WGqTRf43SEnBFi1LE9myFfrbYdlQ2ApltmbnLNUDQCsRtjk6O35enTl3XqzLamDwiL9FnGL38wcavEHKCTZzs5G1UrTDzA5OaZzUG6SqIWe2d4N607/WnBLHrB43OGdTBgB5IWx3EP2+rHtTlM1tnxQ4JryC9zjd8KuEl6kT693+znuk/nnD+oUpHcDVYMw6J3fMJucMAHkibHeQem+QAgC0B2G7g+jVq3RjlCH1AQDkj7AFACBnhC0AADkjbAEAyBlhCwBAzghbAAByRtgCAJAzwhYAgJwRtgAA5IywBQAgZ4QtRK8cO+H9q791SKK/IMHtAwCQEbaIOTt50QtU/Vj6Oj9Nf9OQ2w8AICNsEaGDVocpYQsArUPYImCCViNsAaB1CFt47KDVCFsAaB3CFuq5PXu98LSZG6CkoNXSwjbpS+BbwR07dlzQX0Zvf5H8opostOeL4vN83gC6F2ELtW/gRW9lK5GCVtuusO0rFNX1UrkSoPLYJmjLi9NB2eRi5bh0Qw21IXAJWwASwhZecEqBWst2he3QTKkSnKXEsfumFmNB3M4AJGwBSAhbtCVszYo02Nq1Vp5+fbj164XllO4f3f71x6yUuWOnBFytei+8I/P05/F4phj28+YSzj2sC8sWprLNBUBvImyRCzt0gq3fasDGj8OAs4/t91pNHx1qbqClBVzaNrJXX52L/dgEqt1Xh7P3C4FTZuZK2AKQELY97KeHv6keDn21JdyxI2Hrbe06q1SrTKq3Ayw4joRgtrB1V66SoL+zmvbL/YCPtpXKqs+1xlwA9C7CtofpkPy3J/9VxL858WX1u6NfDo6fvhI+rsUdOxJAOkydlaVd7wWiWF8NY+ux21c6NvS49hZvLVJbady0sqS5AOhthG0Pc8NWB+uFb39JvXvgj4Oy49/4kprb98deCNttXe7YkQBqMmxNEEqkbWXN2w6uI/R0ez2eWT1r0rhpZVI9ABC2PcyErQ5SHajHv/4l9cHBP1FbVoiuHP1X6tXv/HMvhGutct2xIwHkbRM7AZWyjSyVBXVOoLnHXngn9JWE5/LfKzarWyk408qkegAgbHuYCdtfv/xlNfy1P1KfHZHDVIfvj3f/CzX9nS+J9Zo7diSAWnCDlM0NtGbCzpwrCFj7lwBhrLSyes8PoDcQtj3MhO2z4pfVxUqQjn/rS6rkrF71qvenlVVvsbLqXRj4k0idzR3bDR0TsGb7196u9ev90PPqdL+Zxla2qVvO1XmYYHfvVLZ/EZCCM61MqgcAwraH2e/Z6tXrhwf/xHuP9sGhMFT19rEO4tXhaLi6pPGb4a0wnfdxkxBwADodYdvD3BukNB2qj176l8GxDmD7Pdwk0vhZ+Vu3YVi628xp/LDN/h4tALQbYdvDpLBtlDR+Pdzt36xBK91FDACdhrAFACBnhC0AADkjbAEAyBlhCwBAzghbAAByRtgCAJAzwhYAgJwRtgAA5IywBQAgZ4RtixwfG1dnJy9GjI5PqP2HDovtAQC9g7BtkSvv3FRzC5/E3Lr7QI1dmBT7AAB6A2HbIklha5yZmBL7AQB2PsK2RdLCNgs9hjQ2AKC79VTYXrl6Tc3OzanZ2Vu1VdpcvnJVHCMJYQsASNJTYVs8MaI2NzfVyspKTRsbG2q4eEIcI0neYds3PK0mW/jl6K0eDwCQrOe2kR8+eqRWV1fFkDV0G6lvLXmGrf/l6OGXqzer1eMBAGrrubA9OTIqBqztWGUFLPWthbAFACTpyRuk7t5bUOvr67GQ1WX3FhbEPmnyCls/GMtqa2vL83im6JcXiup6KSwvlxfVZCEMT7eftjDVnzgeACA/PRm22tLScixsl5eXxbZZtHNla4K2vDgdtBmaKaly6YYaqgSutHI1IRsGLitbAGiXng3b+fk7am1tLQha/Xju9m2xbRZtDdupxfhKtjCtFiJhGq23EbYA0F49G7ba0tKSd7OU1syqVmtn2OpVrL09bDPbwpOL1haztQKWxgMA5Kunw3Zk9HRwZ/LJU6Nim6zaHbZmy9ht6zIrXi90q6tdwhYA2qunw7bQv1uVSiVVevLEeyy1yaqdYetvI9cXlvFtZsIWANqlp8NWOzt+Xp05d16sq8fA4BE1eLTYFD2GNLYdlP5x9QYpa3VrB7D4nq4VsO54AIB89XzYdgvzHqx5/zX+0Z/oSlUHrqmT6t3xAAD5IWwBAMgZYQsAQM4IWwAAckbYAgCQM8IWAICcEbYAAOQsS9gePXbcD9sXjg4AAIA6ZA1bjbAFAKABhC0AADkjbAEAyBlhCwBAzghbAAByRth2gcFXD6qXLzlee0EdOvWC2B4A0FkI2y5w9MYBdfxn++M+2Kde/sFBsQ8AoHMQtl0gMWyrXn6dwAWATpY1bPmjFhm8eeMtdeeDd9X8+3dq0m1+PPOmOIYkLWyz0GNIYwMA8sfKtoXOTp5Tm5ubamVlpaaNjQ11euKMOIYkz7A9OHFTPSk/VTcneP8XAPJC2LbYp7/8hVpdXRVD1vj0l5+KfZOwsgWA7kbYttj41HkxYG1nJ8+KfZMQtgDQ3QjbHNz/6L5aX1+Phawuu//gvtinljzD1t1G9o/LamtrK/BkfkwdHBpTNz8re4/t/mPzT1W5/JF6feiFxL52ewDoRYRtTpaXl2Nhq8uktmnaFbYHh15XH1XC8qM3wvdv7TD1Hn92U41VHnt9rQBO62vKAKAXEbY5ef/D99Xa2loQtPrxuz97V2ybpm1hOzEWBKlcHz6ut69dDgC9hrDNkV7J6pultEZXtVq7wjYoe+OjyFZw2QSqs5XsrnRr9TX1ANCLCNscXZi+ENyZrG+cktpk0baVbXUr2A7I2Gq2EqZ+wEaDN0tfAOhVhG3Onjx5op48fSLWZdW2sA2CNAxHr8wOUC9UK8dv6H7h+7FZ+gJAryJsc/bqpVfV9y9NinVZtTVs7WD16qKrVe31j/07jssfvx6Ok7EvAPQiwrYLvHh6QL107oWm6DGksd2tXhOk4fut8buMdbDqerssa18A6EWEbY9zwxYA0HqEbY/zw5bPwgJAngjbHia99woAaD3CFgCAnBG2AADkjLAFACBnWcP26LHjhC0AAI1gZQsAQM4IWwAAckbYAgCQM8IWdTn86kE1/JP96oVhuR4AEEfYIq44qA5Mvqr2vzGj9l2f9+jHuuzl115U5zb3qtFf7fP+5rLYHwAQQdgiNHxIHXj9inr+3V+qvT/7S9GL9297Yaud/WKvOvrOAVa5AJCCsIXn4PFBtW/mPTFgbYcevBeErTHycF/itwoBAAhbaJUVbZag1aSw1fS2sjg2ACBz2PJHLXYwvXUsBaskFrYbe1Xxzn41UJTHBgCwskVxMPE92u9c/qn65tir6utHx9SfnXtNPfeTxUjYjn7+ijp0/443hjg2AMBD2Pa4A9+fjAftB79V3zh5Qf3p/hfVn52ZVt+euKK+cfyc+tcvDauBj+54QTv8+KJ6/sNfe+31GNLYeX4xvTt27HjodfVR2f8KQe9rBKvf2XtwaEzd/Cwsl7TqKwcPTryuXudL+QFUELY9Tn+kxw3bvh/+hfrTAy+p3XMfR+ve+5V64ecLauDj6Pu7egxp7LzC1gRmOWFsE7R2aOrv7i1/dlONOV+Sn9scc/xFA0D3IWx73L535iPBqX1zZMJb0brlSfQY0th5Bc7Y/NNKcD5NHPvgGx/FgjhpLoQtgHYgbHtcYtienoqVJ8katu4Wrrtda2/9emH5hu7vb/8GbbwxK2Xu2CnhllRfq19svuJcolvSH73xQqz8yfxYZFwAvYew7XGJ28j7X1T9sw8i5c/duBc5NrJsIwdbv9WAjR/7QWuCKdgKtgLO9AkDLXvY1ruN7M5P81fU/hhSP79Mnh+A3kbY9rikG6S+fvyc+sq+F70V7rcvXFZfPTKivlIJ4D3zn8baZ7lByt/adVaGVplU74WbVeYdm3B2wqxWuPnjyHVJ/cT5Vn8BCMM0Wm+rNR8AvYew7XVJH/2pBK5e4eot5W8Uz6pvfe+y2n0rutLVdN+kj/7YgeOFl7OytOvtVWO0vhrGTri5YeYeG3pcs71rlxtp/SRm9a1Xy6YstiWeMC6A3kTYoq4/auHSfaUxNTtwmg3bWuGXtG3rbR2nBF5SKErzSRJ9r9n+5aD2uQH0DsIWdf25Rpvuo/uKY1bYgeNvy0bDx96qFbdthbKgzgkz99gLy4S+tqRQlOabJr7NXF9/ADsXYQtP1i8iMHRb3Ucay4iEbQtukLLVCtt6gi6pbTA/a3VrB7D4y0Hk+YbBa+oB9C7CFqHKKjXtK/Z0nbd1XGNFa8QCsRpgZvs39j5nZDu20m++sZVt2pZzrXEide58nXY6cO2x3Xrznq77PAH0HsIWcTW+PL6dfwfZWz1mfd+0RmgCwHYjbNER3PdI3W3mNH7Ypr9HCwDbgbBFx3C3f7MGLdu1ADodYQsAQM4IWwAAckbYAgCQs6xhe/TYcT9sBw/tBgAAdah7ZSsNAgAAkhG2AADkjLAFACBnhC0AADkjbAEAyFnPhe3lV/5czQx9O+LHR/5cnTpcENsDANCsngvbB8Wvqy9G/jTm85GvqLeOfFvsAwBAMzo6bN9565o6f+aEWNeopLA13qmsdKV+AAA0KmvYbssftXjv3Tm1sbGhPn30UF04NyK2qVda2Gahx5DGBgBA0tEr23fv3FIrKytqdXXV+/fn9++J7eqRd9gePj2trpzuF+vapRPmAAAIdUXYGuvr62p5eVm9/95tsX0WeYbt4dM31NNySc1tY9B1whwAAFFdFbbG2tqaWlpaUhPjp9QrL+0V+yYhbAEA7daVYauZreUnT0rqtVfPi/0leYWtH3L+l5hrT2eLYnm8blHNzZa88nLl8ZWBfnV4YFo9qPYp6+C85LfTdV6/gaKaexqOGfRLmAMAYHt1ddhqT5486Yiw1dxVpQnNB5fCVeZ4JVjdcCx/NB2OUe0TBHL1OAxiP2jtPt6YT2+o8WBMVrYA0Em6dht5eXlJvTpxRuxXS1vD9nTRC8CkNiZs7TA+fGkxCFZTFglood4OdcIWADpPV4Xts2fPvBukPnj/jtg+i3aGbVBeCUiztetv+9phG21vr1KD/l47P2B1vT2WTa+GCVsA6DxdFbb3Fzv7oz9u0IVbwFaZ1abRsHXrbYQtAHSejg5b/UctNjc31aefPlQTF0bFNvVqa9jqLV83OL1t4OSwFbeJrTK7v6m3EbYA0Hk6Omxn3vmR+t54a/5ylJFr2Do3RLnB6AdhuNIVwzbrDVJWiEcC3JkDAGD7dXTY5uHsSwU1MfjdpugxpLG1Kx9VP7JTvVvYHHtlXiCGYZi0CjWBGfSZja524x/9iY7hzgEAsL16Lmy7kbdyrfE+LQCgsxG2HSa29Sx8rhYA0F0I2w7kfryHoAWA7kbYAgCQM8IWAICcEbYAAOQsa9gePXbcD1vdAQAA1Keula00AAAAqI2wBQAgZ4QtAAA5I2wBAMgZYVv1yrET3r9X3rkpGhg8EusDAEAWhG3F2cmLXqDqx3MLn4gGjxZj/QAAyKLnw1YHrQ5TwhYAkJeeDlsTtBphCwDIS5aw3ZF/1MIOWo2wBQDkpSdXts/t2euFp83cACUFrUbYAgAa1ZNhu2/gRW9lK5GCVksL277hG+pxuaSuD/eL9fXoKxTV9VI58lV7wVfuLU6LfbZTs8+9la8dAHSingxbHZxSoNayHWH7eCZ6TlNeLt1QQ4WdE0yELYCdjrDNqBPC1q+bVgvlslqYImwBoFsQthnVG7buVrC7/WtC06vT/aZ0/0U1WVmx1gpbbWimFBkvdq7qOF6dmZc3fthGj+3XhWV2gKfN32Y/90bOZ/d3xwaAnYCwFYyOT3htbLufPyCOZUQCpxpUJqDix37QmjA1xyYk08K2b2ox2Ep2x9a8MDb11YCzt551vRegTpl7/qT5uyLPvZHzEbYAdjgdtln0VNjq+j/71p+rr3zlq4ncMSOBo8PQWl169VaZVC+FXc2wrTGWvdVswi+yak0syzZ/UxbU2X0bOZ/12NQDwE4iBauk58JWB+of/dN/lsgdMxIeOpisVZxb7wWrWF9H2Fb7m1WjJNy6jQZZWlna/E2ZVNfQ+WqMDQA7gRSsEsLW4Y4ZCY+cw3ZyMdzSlcaySUGWVkbYAkBrScEqIWwd7piR8NBh5YaLV1YNU+uxWF8jbN27kaVz2RoKv5T5m7Kgzu7byPmEegDYSaRglRC2DnfMSHg4NxTFjxu7QSoYx1p1imVWWDYUfinzd0X6NnI+oR4AdhIpWCU9Gbbf+da31U9u3AgcGXw5U9h6x9WAMu+fukFlAtar0/1m4itb09cmr3adc9nzaCD8vOMa8zd1wS8LVt9GzifVA8BOIgWrZEeFrf47yPqLB5Loeh22+/c+r75YWwtMfm8iMWyb5a1Ga7z3CgDoXlKwSnZU2Gahw9YEq0Tqk5X7nqhZKSZt0wIAupsUrJKeC9u8uR/ZIWgBYOeSglVC2AIA0CApWCWELQAADZKCVULYAgDQIClYXfPz84QtAACNksJVQtgCANAgKVglhC0AAA2SglVC2AIA0CApWCWELQAADZKCVULYAgDQIClYJYQtAAANkoJVsnPCtn+P+u7R0dCB6vPaP6B2DZ1S3z08HO+z53m1a2BQ7Xr5mN/frQcAoAYpWCU7Jmx3HXpFPbewFtg1MqF2XZlTz91dDcoKl2/57ffuV4Xpt9Vz7z0N62488MLXHRcAgCRSsLp21B+12DX6/SA4vfC0gtS26/SUKtz8hVw3OimODQCARApXyY4J28LF67HwLMz/ZWRl67lX/bdSV7j7eaRu1/euimPvNHypOwC0hhSskp0TttfvB6FZuPVL9d0jI175ruHTkUAt3PqV+u7Lx/26ykrWrtNbz/aYOxVhCwCtIQWrZGeEbf8e9dwHvwtDc8zaDh48FgnUwrkfBHW7Ri5E6na9eCTst4MRtgDQGlKwSnZE2Lo3R9l3HsdWr6/4q1qv7tW3wrqfLSnpjuQgmGYWwy+EL91QQ4UwqPoKRXW9VBa/MD7oP6X/Dds8nilW68KyhSk5/PQX0petcOwrTKuFSr9wjPrGD/oQtgDQFClYJTsjbO2boz5cVd/dvTeoK0y/E9bdrdRZdxwX3vwwqPPuRq6W20xglcuLarISsCZYTaCmHpv+VkDr8NTh55aZc+hj1+RiOKb9uJHxCVsAaA0pWCU7Imztm6MKP3kYrbMC9bmfPorW3Xkc9rt0M1JnmDCzV512WPVNLcZC0i5L7p88pimzBfXeCjY8XyPjp50LAJCNDtKvfv2bqXZG2No3R5nP0lY9N/9bue7AoaDcq7Pey7VJwWS2cXWYecHqbiunBFvWMpdZsaaFdFpZlnMBANL1Tti6N0eNXwrr9h0MP+qj6869HtTtOnYmKNfM3csuMbi2KWz19rG3PVzdQtYaGT/LuQAA6XombGN/OUr/qUZTN3QqWvfKibBu4mpYVwlk/VelTJ3NDyZpS7a6TextGTvBFttGri8MTZktHDMMeq+8gfHTzgUAyKZ3wta+OUqH5vMHgzq9NRzWfa527d0X1r3xXlDnffa2Wu7yg6kchmdDN0jVF4amLKhzA7bJMK91LgBAdr2zjfzC4eDLB3YNRbeC9ZcMBHVHTkbrBotBnf4srl1nC4LJ/uiPtY3rtakGrFTfUBhWx9Mf39F13t3H1la1HegNjS/UAwDq11M3SOWJYAIAJCFsW4SwBQAkIWxbhLAFACQhbAEAyBlhCwBAzghbAAByliVsjx47TtgCANAoVrYAAOSMsAUAIGeELQAAOSNsAQDIWdeF7cDgEXXlnZse/VhqAwBAJ+m6sB08WlRzC5949GOpDQAAnaQjw1avWHWQmpXr/lN7PP2HhbA9PKx2jU563HEAAOgEHRm2eotYh6n+Vx+f29zrGXxzTyxsC2/dVf2//0ePOw4AAJ0gS9gm/lGLy1euqeHiiVh5swhbAMBO0tTKdnZuTm1sbKiPP3mojp2IfiF7M5oJ2++9dtnrp/+1xwQAYLs0F7azt9TKyopaXV31/r17716sTSOaCVu3r6uvUFTXS2W1tbUlKpcX1WQh/Wvy+oan1eQ2fp1era/0M8/x8Yx8A5ndt11fDchXEALoZS0JW2N9fV0tLy+rudu3Y23r0Y6wTQqiLDohOJoJWxshCAD5a2nYGmtra2ppaUkdHzmlCrv3xvqlIWzTEbYA0D1yCVvNbC2XSiV19tz5WN9aOiFsh2ZKqmyFUF9hWi2Uy+ov5+9UwinchjbjmHGl7Wg/0BbV9cqYpu77R6shN6X/DfstTIWh5/eLbnkH52sibO2+weOZxeAc5dINNVRj7vp5pc8t4fkGr2fy6xWOER3ffm0AoJvkGrZaqfREnR3vvrDVJhfLqrw4HXscBJQTHKZe88K6GlomOOz6oMwKNj/gq2FWDXc7YCL1zhxs9YdtOA/3uYhzzzQ36flWz5np9Yo+NzMmgQugG+W6jTw6dkYV+qN9smhH2NorJpsdUMFF31t9hisvNwz6phbjKzMrkKSgSC4zIVgMQliuj84h0q6BsE2eh1SfZW41xsz0ekXrAaCbtTRsnz17VgnZZXV7/k6sbT3aEbZZVraaXnHpEE4KDruNRJ/HbS+NkVhWCSZ7PLO1LbUN+tQdtmnBl3CeOuZml6W9Xrq93kkwZfYKGAC6UUvDtps++pM1bM1FP2lLVB/bW6CmjS0tfKQyE3iR943teqF/ME7OYdvI3OyytNfLZs7l/QxY7QLoUs2F7dyc2tzcVA8fPlQnR0Zj9Y3qlLANtzvD8PHKnTDx20XDxZYWPlKZN6YTSPZ5pP5Bu7rDtsY8pPoG5hYZM+X1kti/AEj1ANDJmgrba2/8SBVb+JejjFpfRLD7+QNenaYfu19E4PZ1ZQ1b9+LuB4S/sorVVce0A6ie8JHK3EDy68LVpNQ/GKfusA3nHjyX6kpeOk8jc4ucM+31sl5rqb8pA4Bu0VTYdiNzoTfvB7rMBd+7+9gOAyeE3O1ld9x4GEWDIktZ5H1LrzwM+VrhU+s56gC2+waP7Y/+1NgyN+qdm1tW6/Xy6iuBa+qkegDoJj0XtgAAtBthCwBAzghbAAByRtgCAJAzwhYAgJwRtgAA5CxL2B49dtwP20OvfQ4AAOqQNWw1whYAgAYQtgAA5IywBQAgZ4QtAAA569iwfe32mnrzw+x0e2kcAAC2W8eGrQ7QO4/W1Ft3/X/T6PbSOAAAbLeODlsdtId+sKZ+eEcOWBthCwDoVE2H7cSNz9Wxq9GyVjArWx20WQKXsAUAdKqsYZv4Ry0u315VGxsbanZhRRWvrcbqG2XCVssSuFffl8cBAGC7Nb2y/eHcqlpeXlErK/6/b38QrW+UHbZX31tTL/7gc3VxLiy7/XBNXaqE78kfV9pXglgaI83p+3/lfDn5X6nZN1v3C0OSgTfX1aWM5xl4c0M9bdO88jJw+/eV1/b36tLF2s9hu34eWe2EnwWA7dHCsPWtr6+r35RW1JXKitdtWw8TtlLQ3ri/po5d89sNXFlXB2/9tdp/9z+rA+/9jTp4vRwbS6Iv7G4A6FDQF/mPmpx7LfVesHshbAcufqFmV8qqvLKhTlttTPjm+fOoB2ELoFEtD1tjbW1N/erxijp+bdULS7dfGh22+gYpKWhf/mGlzetrat/P/6vq3/yD6v/9P0bs+d3fqhdmtsRxNXNxly7il34Tv+i3EmEbr6/1mnu/FOX486gHYQugUbmFrba6uur9u/jpqjqlt3udvrXosJ1/uKaufRAGrT72VrSVoN3z+H/HQjZi4w/q4M1/J45twvbp/S/EeptpG2xt/mY9rPMuvr9Xs9UVmAkUvzzso+lzueXm/OnnqFzg7/urbsP+RSHW312xC/OptVpMmn9YV5nP7Wib6HzW1UfVOm8ruDL3pLA1bbOuXjO9VrXmlvJaZBq/Gratft0B7Fy5h612/xc6bOu7yNjv2RrejVKVun0//2+xcNVlez7720jZ7vV/UAPXNmJja2bLWEsKXXMxNRdcNxjMxTRyQRbCw96yTrpgp57DWt1FxnP6B/XV9u757DGlC3+2+deaj98//EXCP3aDyJDmlyT+WjnHaXNLeS2yje/3b/XrDmBny3Ub+dePV9TJH0XbZyWF7YnKWAOX18Wt44E3NtXzn/yPWLneapbGN/QF0l552BdP6YJpky6eA29+EVzoo+2qF2lnzMbOYY0nbNHagem3lYNOkm3+9c3HDjxTZtQzP/G5WmWpc0s5V7bx83ndAexsLQ/bZ8+eqd+WVtTV+eYuMuMza+rV2c8j9Pu3B27/dSxQtaSw3b309+L4kmAVZlYnwgU10t66+MbqKn0jIR654Id9GjmHXeb+smAzq0v9nqgps3+ZqCXr/L22znzslWVYLz9Habwk3msljp1tbvq41mtRz/h5ve4AdqaWh+3b769U69Ivno3Y/+F/igWqpsN238f/PV63/g/iOEkiF9dGgjDYNg3Lky7YXl0LwtYNiCRmbt7FPyn86py/W1932FqrQbcurK+euwVhG5QLr0W9YdvK1x3AztZ02Oo/arG5ualuLa6oE29E6/Kw/72/iQdqxYF3/6MauPxM7Xn6fyLlu7/4v7Exki7Abl2tdm7boEy6YHuBKo/Z0DmsMntsu18ttQKu3vl79bH5RANFKrPVCi6vzg5D99zW2GlzM2U2+7WoZ3ypbZparzuAna3psP3+X3yujlc/89oOL1wvR8I09Ad14M5/8AP3s78Lyvf+5n+J43gfN3EvrGk3yNS4YSYYw7kI+23Cc7kX3IbOYV/0TXsrrOw52GEh9TdlQV3a/FPn4z+/8PlUj2uErfQcNB20ejXYstcq5bWoZ3xpzs287gB2tqbDtu1+8Ln3Odpo0Bp/UPsW/4vq/+L/BWUHbv21PE6FuZjb3DuTzUXV1JsLr1eXcPGMvFfn1UcD1tS7F/Ws53DLYv3d9pULv6mT6l215p9tPn77oH+Nj/7Y7POG5472afq1Snkt6hm/1a87gJ2r+8K24uDMlnhHsmvvr/+nF87SGAAAtEtXhq2m/2DF7mfhCtalg3bgkvz5WQAA2qlrw1bTf7BCf4529+/+zlvp6puh9Hu0B279e7E9AADboavDFgCAbkDYAgCQM8IWAICcZQ3bo8eO+2GrOwAAgPrUtbKVBgAAALURtgAA5Cxb2H5T/X+ZIhOJGfzZBQAAAABJRU5ErkJggg==" alt="img"></a>   </p>
<p>1.添加log4j2相关jar包（maven）</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--添加log4j2相关jar包--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;log4j-api&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.7&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;log4j-core&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.7&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>2.log4j2.xml配置和简单说明</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;configuration status=&quot;error&quot;&gt;</span><br><span class="line">    &lt;!--先定义所有的appender --&gt;</span><br><span class="line">    &lt;appenders&gt;</span><br><span class="line">        &lt;!--这个输出控制台的配置 --&gt;</span><br><span class="line">        &lt;Console name=&quot;Console&quot; target=&quot;SYSTEM_OUT&quot;&gt;</span><br><span class="line">            &lt;!--             控制台只输出level及以上级别的信息（onMatch），其他的直接拒绝（onMismatch） --&gt;</span><br><span class="line">            &lt;ThresholdFilter level=&quot;trace&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt;</span><br><span class="line">            &lt;!--             这个都知道是输出日志的格式 --&gt;</span><br><span class="line">            &lt;PatternLayout pattern=&quot;%d&#123;HH:mm:ss.SSS&#125; %-5level %class&#123;36&#125; %L %M - %msg%xEx%n&quot;/&gt;</span><br><span class="line">        &lt;/Console&gt;</span><br><span class="line"> </span><br><span class="line">        &lt;!--文件会打印出所有信息，这个log每次运行程序会自动清空，由append属性决定，这个也挺有用的，适合临时测试用 --&gt;</span><br><span class="line">        &lt;!--append为TRUE表示消息增加到指定文件中，false表示消息覆盖指定的文件内容，默认值是true --&gt;</span><br><span class="line">        &lt;File name=&quot;log&quot; fileName=&quot;D:/logs/log4j2.log&quot; append=&quot;false&quot;&gt;</span><br><span class="line">            &lt;PatternLayout pattern=&quot;%d&#123;HH:mm:ss.SSS&#125; %-5level %class&#123;36&#125; %L %M - %msg%xEx%n&quot;/&gt;</span><br><span class="line">        &lt;/File&gt;</span><br><span class="line"> </span><br><span class="line">        &lt;!--添加过滤器ThresholdFilter,可以有选择的输出某个级别以上的类别  onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;意思是匹配就接受,否则直接拒绝  --&gt;</span><br><span class="line">        &lt;File name=&quot;ERROR&quot; fileName=&quot;D:/logs/error.log&quot;&gt;</span><br><span class="line">            &lt;ThresholdFilter level=&quot;error&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot;/&gt;</span><br><span class="line">            &lt;PatternLayout pattern=&quot;%d&#123;yyyy.MM.dd &#x27;at&#x27; HH:mm:ss z&#125; %-5level %class&#123;36&#125; %L %M - %msg%xEx%n&quot;/&gt;</span><br><span class="line">        &lt;/File&gt;</span><br><span class="line"> </span><br><span class="line">        &lt;!--这个会打印出所有的信息，每次大小超过size，则这size大小的日志会自动存入按年份-月份建立的文件夹下面并进行压缩，作为存档 --&gt;</span><br><span class="line">        &lt;RollingFile name=&quot;RollingFile&quot; fileName=&quot;D:/logs/web.log&quot;</span><br><span class="line">                     filePattern=&quot;logs/$$&#123;date:yyyy-MM&#125;/web-%d&#123;MM-dd-yyyy&#125;-%i.log.gz&quot;&gt;</span><br><span class="line">            &lt;PatternLayout pattern=&quot;%d&#123;yyyy-MM-dd &#x27;at&#x27; HH:mm:ss z&#125; %-5level %class&#123;36&#125; %L %M - %msg%xEx%n&quot;/&gt;</span><br><span class="line">            &lt;SizeBasedTriggeringPolicy size=&quot;2MB&quot;/&gt;</span><br><span class="line">        &lt;/RollingFile&gt;</span><br><span class="line">    &lt;/appenders&gt;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    &lt;!--然后定义logger，只有定义了logger并引入的appender，appender才会生效 --&gt;</span><br><span class="line">    &lt;loggers&gt;</span><br><span class="line">        &lt;root level=&quot;trace&quot;&gt;</span><br><span class="line">            &lt;appender-ref ref=&quot;RollingFile&quot;/&gt;</span><br><span class="line">            &lt;appender-ref ref=&quot;Console&quot;/&gt;</span><br><span class="line">            &lt;appender-ref ref=&quot;ERROR&quot; /&gt;</span><br><span class="line">            &lt;appender-ref ref=&quot;log&quot;/&gt;</span><br><span class="line">        &lt;/root&gt;</span><br><span class="line">    &lt;/loggers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>
<p>3.测试类</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.Logger;</span><br><span class="line"> </span><br><span class="line">public class log4j2Test &#123;</span><br><span class="line"> </span><br><span class="line">    private static Logger logger= LogManager.getLogger(LogManager.ROOT_LOGGER_NAME);</span><br><span class="line"> </span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        for(int i=0;i&lt;3;i++)&#123;</span><br><span class="line">            // 记录trace级别的信息</span><br><span class="line">            logger.trace(&quot;log4j2日志输出：This is trace message.&quot;);</span><br><span class="line">            // 记录debug级别的信息</span><br><span class="line">            logger.debug(&quot;log4j2日志输出：This is debug message.&quot;);</span><br><span class="line">            // 记录info级别的信息</span><br><span class="line">            logger.info(&quot;log4j2日志输出：This is info message.&quot;);</span><br><span class="line">            // 记录error级别的信息</span><br><span class="line">            logger.error(&quot;log4j2日志输出：This is error message.&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>log4j2配置说明</strong></p>
<p>log4j 2.x版本不再支持像1.x中的.properties后缀的文件配置方式，2.x版本常用.xml后缀的文件进行配置，除此之外还包含.json和.jsn配置文件</p>
<p>log4j2虽然采用xml风格进行配置，依然包含三个组件,分别是 Logger(记录器)、Appender(输出目的地)、Layout(日志布局)。</p>
<p>XML配置文件解析</p>
<p>1、根节点Configuration有两个属性:status和monitorinterval,有两个子节点:Appenders和Loggers(表明可以定义多个Appender和Logger).</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">status用来指定log4j本身的打印日志的级别.</span><br><span class="line">monitorinterval为log4j 2.x新特点自动重载配置。指定自动重新配置的监测间隔时间，单位是s,最小是5s。</span><br></pre></td></tr></table></figure>
<p>2、Appenders节点，常见的有三种子节点:Console、File、RollingFile</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Console节点用来定义输出到控制台的Appender.</span><br><span class="line">File节点用来定义输出到指定位置的文件的Appender.</span><br><span class="line">RollingFile节点用来定义超过指定大小自动删除旧的创建新的的Appender.</span><br></pre></td></tr></table></figure>
<p>通过在子节点中加入<PatternLayout pattern="自定义信息格式">进行日志布局</PatternLayout></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">%c 输出所属类的全名，可写为 %c&#123;Num&#125; ,Num类名输出的范围 如：&quot;com.sun.aaa.classB&quot;,%C&#123;2&#125;将使日志输出输出范围为：aaa.classB</span><br><span class="line">%d 输出日志时间其格式为 可指定格式 如 %d&#123;HH:mm:ss&#125;等</span><br><span class="line">%l 输出日志事件发生位置，包括类目名、发生线程，在代码中的行数</span><br><span class="line">%n 换行符</span><br><span class="line">%m 输出代码指定信息，如info(“message”),输出message</span><br><span class="line">%p 输出日志的优先级，即 FATAL ,ERROR 等</span><br><span class="line">%r 输出从启动到显示该条日志信息所耗费的时间（毫秒数）</span><br><span class="line">%t 输出产生该日志事件的线程名</span><br></pre></td></tr></table></figure>
<p>3、Loggers节点，常见的有两种:Root和Logger.</p>
<p>Root节点用来指定项目的根日志，如果没有单独指定Logger，那么就会默认使用该Root日志输出</p>
<p>Logger节点用来单独指定日志的形式，比如要为指定包下的class指定不同的日志级别等。</p>
<p><strong>logback log4j log4j2 性能实测</strong></p>
<p>可见在同步日志模式下, Logback的性能是最糟糕的</p>
<p>而log4j2的性能无论在同步日志模式还是异步日志模式下都是最佳的</p>
<h4 id="mybatis引入log4j2"><a href="#mybatis引入log4j2" class="headerlink" title="mybatis引入log4j2"></a>mybatis引入log4j2</h4><p>mybatis核心配置文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--标准日志--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;setting name=&quot;logImpl&quot; value=&quot;STDOUT_LOGGING&quot;/&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--log4j2--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;LOG4J2&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>log4j2.xml 在loggers中增加配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 将业务dao接口所在的包填写进去,并用在控制台和文件中输出 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;mapper&quot;</span> <span class="attr">level</span>=<span class="string">&quot;TRACE&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">additivity</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;Console&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;MyFile&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用:"></a>使用:</h4><p><img src="/2022/03/14/mybatis/9.png" alt></p>
<h2 id="九、注解"><a href="#九、注解" class="headerlink" title="九、注解"></a>九、注解</h2><h3 id="9-1-使用步骤"><a href="#9-1-使用步骤" class="headerlink" title="9.1 使用步骤"></a>9.1 使用步骤</h3><ol>
<li><p>注解用在接口方法上</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">userMapper</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select * from user&quot;)</span></span><br><span class="line">    <span class="function">List&lt;user&gt; <span class="title">findAllUser</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置核心配置文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;mapper.userMapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>本质：反射机制实现</p>
<p>底层：动态代理</p>
<h2 id="十、Lombok（简化编程的插件）"><a href="#十、Lombok（简化编程的插件）" class="headerlink" title="十、Lombok（简化编程的插件）"></a>十、Lombok（简化编程的插件）</h2><p>在pojo类中使用注解，省略编写get，set方法，和toString 方法，EqualsAndHashCode方法，构造方法等</p>
<ol>
<li><p>在idea中安装Lombok插件</p>
<p><img src="/2022/03/14/mybatis/10.png" alt></p>
</li>
<li><p>导入Lombok jar包</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>Lombok注解</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Getter</span> and <span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@FieldNameConstants</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span>, <span class="meta">@RequiredArgsConstructor</span> and <span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@Log</span>, <span class="meta">@Log4j</span>, <span class="meta">@Log4j2</span>, <span class="meta">@Slf4j</span>, <span class="meta">@XSlf4j</span>, <span class="meta">@CommonsLog</span>, <span class="meta">@JBossLog</span>, <span class="meta">@Flogger</span>, <span class="meta">@CustomLog</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@SuperBuilder</span></span><br><span class="line"><span class="meta">@Singular</span></span><br><span class="line"><span class="meta">@Delegate</span></span><br><span class="line"><span class="meta">@Value</span></span><br><span class="line"><span class="meta">@Accessors</span></span><br><span class="line"><span class="meta">@Wither</span></span><br><span class="line"><span class="meta">@With</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="meta">@val</span></span><br><span class="line"><span class="meta">@var</span></span><br></pre></td></tr></table></figure>
<p>其中最重要的是@Data注解</p>
<ul>
<li>给pojo类加上@Data注解<ul>
<li>自动生成：无参构造方法、get、set、tostring、hashcode、equals方法</li>
</ul>
</li>
<li>@AllArgsConstructor,@NoArgsConstructor（生成构造方法）</li>
</ul>
<h2 id="十一、多表联合查询"><a href="#十一、多表联合查询" class="headerlink" title="十一、多表联合查询"></a>十一、多表联合查询</h2><h3 id="11-1-多对一（使用association进行映射）"><a href="#11-1-多对一（使用association进行映射）" class="headerlink" title="11.1 多对一（使用association进行映射）"></a>11.1 多对一（使用association进行映射）</h3><h4 id="1-需求：查询学生时，将对应的老师信息查询出来"><a href="#1-需求：查询学生时，将对应的老师信息查询出来" class="headerlink" title="1. 需求：查询学生时，将对应的老师信息查询出来"></a>1. 需求：查询学生时，将对应的老师信息查询出来</h4><p><img src="/2022/03/14/mybatis/11.png" alt="image-20220318092219905"></p>
<p>上图数据库中，学生表中通过tid这个外键关联了老师信息，因此在编写学生pojo类时可以将学生属性的tid使用一个teacherpojo类型替换</p>
<p><img src="/2022/03/14/mybatis/12.png" alt="image-20220318093445938"></p>
<h4 id="方法一：按照查询嵌套处理"><a href="#方法一：按照查询嵌套处理" class="headerlink" title="方法一：按照查询嵌套处理"></a>方法一：按照查询嵌套处理</h4><p>在创建好对应的pojo类后，我们创建studentMapper查询所有学生时会遇到属性和列不匹配的问题</p>
<p>因此我们需要使用一个额外的查询，通过老师id将老师信息查询出来，之后使用resultMap来映射结果集</p>
<p>（即在一次查询中，嵌套使用另一次查询）（通过association中的select绑定第二次查询）</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllStudentAndTeacher&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;studentAndTeacher&quot;</span>&gt;</span></span><br><span class="line">    select * from student</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;studentAndTeacher&quot;</span> <span class="attr">type</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;tid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tid&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--复杂属性我们需要单独处理</span></span><br><span class="line"><span class="comment">        如果是对象：使用association</span></span><br><span class="line"><span class="comment">        如果是集合：使用collection</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;t&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tid&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;teacher&quot;</span> <span class="attr">select</span>=<span class="string">&quot;getTeacher&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getTeacher&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;teacher&quot;</span>&gt;</span></span><br><span class="line">    select * from teacher where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="方法二：通过结果映射处理"><a href="#方法二：通过结果映射处理" class="headerlink" title="方法二：通过结果映射处理"></a>方法二：通过结果映射处理</h4><p>通过sql的方式，进行多表联合查询，最后映射查询结果（对象通过association关联）</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--按照结果嵌套处理--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllStudent&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;student1&quot;</span>&gt;</span></span><br><span class="line">    select s.id sid,s.name sname,t.name tname,tid from  student s,teacher t where t.id = s.tid</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;student1&quot;</span> <span class="attr">type</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;sname&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;t&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;teacher&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;tid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;tname&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="11-2-一对多（使用-collection进行映射）"><a href="#11-2-一对多（使用-collection进行映射）" class="headerlink" title="11.2 一对多（使用 collection进行映射）"></a>11.2 一对多（使用 collection进行映射）</h3><h4 id="需求：在查询老师时查询出老师所有的学生"><a href="#需求：在查询老师时查询出老师所有的学生" class="headerlink" title="需求：在查询老师时查询出老师所有的学生"></a>需求：在查询老师时查询出老师所有的学生</h4><p>在teacher类中添加一个集合来存储老师所有的学生</p>
<h4 id="方法一：按照查询嵌套处理-1"><a href="#方法一：按照查询嵌套处理-1" class="headerlink" title="方法一：按照查询嵌套处理"></a>方法一：按照查询嵌套处理</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findTById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;teacher1&quot;</span>&gt;</span></span><br><span class="line">    select * from teacher where id = #&#123;tid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;teacher1&quot;</span> <span class="attr">type</span>=<span class="string">&quot;teacher&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;slist&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;ArrayList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;student&quot;</span> <span class="attr">select</span>=<span class="string">&quot;getStudent&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getStudent&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">    select * from student where tid = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="方法二：通过结果集映射处理"><a href="#方法二：通过结果集映射处理" class="headerlink" title="方法二：通过结果集映射处理"></a>方法二：通过结果集映射处理</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--通过结果映射处理--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findTById1&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;teacher2&quot;</span>&gt;</span></span><br><span class="line">    select t.id tid,t.name tname,s.id sid,s.name sname from  teacher t,student s where t.id = s.tid</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;teacher2&quot;</span> <span class="attr">type</span>=<span class="string">&quot;teacher&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tid&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tname&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;slist&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;sname&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="总结：-1"><a href="#总结：-1" class="headerlink" title="总结："></a>总结：</h3><ol>
<li>关联：association 【多对一】</li>
<li>集合：collection 【一对多】</li>
<li>JavaType &amp; ofType<ul>
<li>JavaType ：指定实体类中的属性类型</li>
<li>ofType：指定映射到集合中的pojo类型（泛型的类型）</li>
</ul>
</li>
</ol>
<h2 id="十二、动态sql"><a href="#十二、动态sql" class="headerlink" title="十二、动态sql"></a>十二、动态sql</h2><h3 id="12-1-什么是动态sql："><a href="#12-1-什么是动态sql：" class="headerlink" title="12.1 什么是动态sql："></a>12.1 什么是动态sql：</h3><ul>
<li><strong>动态sql就是根据不同的条件生成不同的sql语句</strong></li>
</ul>
<h3 id="12-2-创建数据库"><a href="#12-2-创建数据库" class="headerlink" title="12.2 创建数据库"></a>12.2 创建数据库</h3><p><img src="/2022/03/14/mybatis/14.png" alt="image-20220318151325977"></p>
<ul>
<li><p>配置mybatis核心配置文件Setting中的mapUnderscoreToCamelCase</p>
</li>
<li><p>```xml<br><settings></settings></p>
<pre><code>&lt;!--标准日志--&gt;
&lt;!--&lt;setting name=&quot;logImpl&quot; value=&quot;STDOUT_LOGGING&quot;/&gt;--&gt;
&lt;!--log4j2--&gt;
&lt;setting name=&quot;logImpl&quot; value=&quot;LOG4J2&quot;/&gt;
&lt;!--配置经典数据库命名格式，到驼峰命名的转换--&gt;
&lt;setting name=&quot;mapUnderscoreToCamelCase&quot; value=&quot;true&quot;/&gt;
</code></pre><p>&lt;/settings&gt;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">![image-20220318151256485](mybatis/13.png)</span><br><span class="line"></span><br><span class="line">### 12.3 标签</span><br><span class="line"></span><br><span class="line">### if标签,where标签</span><br><span class="line"></span><br><span class="line">* 需求：根据map传入的约束条件，动态的查询信息</span><br><span class="line"></span><br><span class="line">*where* 元素只会在子元素返回任何内容的情况下才插入 “WHERE” 子句。而且，若子句的开头为 “AND” 或 “OR”，*where* 元素也会将它们去除。</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;select id=&quot;findAllByInput&quot; resultType=&quot;Blog&quot; parameterType=&quot;map&quot;&gt;</span><br><span class="line">    select * from blog</span><br><span class="line">    &lt;where&gt;</span><br><span class="line">        &lt;if test=&quot;title!=&#x27;&#x27; and title!=null&quot;&gt;</span><br><span class="line">            title = #&#123;title&#125;</span><br><span class="line">        &lt;/if&gt;</span><br><span class="line">        &lt;if test=&quot;author!=&#x27;&#x27; and author!=null&quot;&gt;</span><br><span class="line">            and author = #&#123;author&#125;</span><br><span class="line">        &lt;/if&gt;</span><br><span class="line">    &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="choose标签"><a href="#choose标签" class="headerlink" title="choose标签"></a>choose标签</h3><p>有时候，我们不想使用所有的条件，而只是想从多个条件中选择一个使用。针对这种情况，MyBatis 提供了 choose 元素，它有点像 Java 中的 switch 语句。</p>
<p>还是上面的例子，但是策略变为：传入了 “title” 就按 “title” 查找，传入了 “author” 就按 “author” 查找的情形。若两者都没有传入，就返回标记为 featured 的 BLOG（这可能是管理员认为，与其返回大量的无意义随机 Blog，还不如返回一些由管理员挑选的 Blog）。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findActiveBlogLike&quot;</span></span></span><br><span class="line"><span class="tag">     <span class="attr">resultType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM BLOG WHERE state = ‘ACTIVE’</span><br><span class="line">  <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;title != null&quot;</span>&gt;</span></span><br><span class="line">      AND title like #&#123;title&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;author != null and author.name != null&quot;</span>&gt;</span></span><br><span class="line">      AND author_name like #&#123;author.name&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">      AND featured = 1</span><br><span class="line">    <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="set标签"><a href="#set标签" class="headerlink" title="set标签"></a>set标签</h3><p>用于动态更新语句的类似解决方案叫做 <em>set</em>。<em>set</em> 元素可以用于动态包含需要更新的列，忽略其它不更新的列。比如：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateAuthorIfNecessary&quot;</span>&gt;</span></span><br><span class="line">  update Author</span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null&quot;</span>&gt;</span>username=#&#123;username&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;password != null&quot;</span>&gt;</span>password=#&#123;password&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email != null&quot;</span>&gt;</span>email=#&#123;email&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bio != null&quot;</span>&gt;</span>bio=#&#123;bio&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">  where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个例子中，<em>set</em> 元素会动态地在行首插入 SET 关键字，并会删掉额外的逗号（这些逗号是在使用条件语句给列赋值时引入的）。</p>
<h3 id="trim标签，定制标签"><a href="#trim标签，定制标签" class="headerlink" title="trim标签，定制标签"></a>trim标签，定制标签</h3><p>如果 <em>where</em> 元素与你期望的不太一样，你也可以通过自定义 trim 元素来定制 <em>where</em> 元素的功能。比如，和 <em>where</em> 元素等价的自定义 trim 元素为：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;WHERE&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;AND |OR &quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><em>prefixOverrides</em> 属性会忽略通过管道符分隔的文本序列（注意此例中的空格是必要的）。上述例子会移除所有 <em>prefixOverrides</em> 属性中指定的内容，并且插入 <em>prefix</em> 属性中指定的内容。</p>
<p>用于动态更新语句的类似解决方案叫做 <em>set</em>。<em>set</em> 元素可以用于动态包含需要更新的列，忽略其它不更新的列。比如：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateAuthorIfNecessary&quot;</span>&gt;</span></span><br><span class="line">  update Author</span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null&quot;</span>&gt;</span>username=#&#123;username&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;password != null&quot;</span>&gt;</span>password=#&#123;password&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email != null&quot;</span>&gt;</span>email=#&#123;email&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bio != null&quot;</span>&gt;</span>bio=#&#123;bio&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">  where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个例子中，<em>set</em> 元素会动态地在行首插入 SET 关键字，并会删掉额外的逗号（这些逗号是在使用条件语句给列赋值时引入的）。</p>
<p>来看看与 <em>set</em> 元素等价的自定义 <em>trim</em> 元素吧：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;SET&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意，我们覆盖了后缀值设置，并且自定义了前缀值。</p>
<h3 id="foreach-标签"><a href="#foreach-标签" class="headerlink" title="foreach 标签"></a>foreach 标签</h3><p>动态 SQL 的另一个常见使用场景是对集合进行遍历（尤其是在构建 IN 条件语句的时候）。比如：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectPostIn&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;domain.blog.Post&quot;</span>&gt;</span></span><br><span class="line">  SELECT *</span><br><span class="line">  FROM POST P</span><br><span class="line">  WHERE ID in</span><br><span class="line">   <span class="comment">&lt;!--这里collection=&quot;list&quot;中，“list”为我们传入需要遍历的变量名--&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">        #&#123;item&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><em>foreach</em> 元素的功能非常强大，它允许你指定一个集合，声明可以在元素体内使用的集合项（item）和索引（index）变量。它也允许你指定开头与结尾的字符串以及集合项迭代之间的分隔符。这个元素也不会错误地添加多余的分隔符，看它多智能！</p>
<p><strong>提示</strong> 你可以将任何可迭代对象（如 List、Set 等）、Map 对象或者数组对象作为集合参数传递给 <em>foreach</em>。当使用可迭代对象或者数组时，index 是当前迭代的序号，item 的值是本次迭代获取到的元素。当使用 Map 对象（或者 Map.Entry 对象的集合）时，index 是键，item 是值。</p>
<h3 id="sql标签：进行sql段的复用"><a href="#sql标签：进行sql段的复用" class="headerlink" title="sql标签：进行sql段的复用"></a>sql标签：进行sql段的复用</h3><ul>
<li>将可能复用的sql语句部分 放入 sql标签，之后可以在需要的位置使用 include标签引入</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;titleAndAuthor&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;title!=&#x27;&#x27; and title!=null&quot;</span>&gt;</span></span><br><span class="line">        title = #&#123;title&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;author!=&#x27;&#x27; and author!=null&quot;</span>&gt;</span></span><br><span class="line">        and author = #&#123;author&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllByInput&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Blog&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">    select * from blog</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;titleAndAuthor&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="十三、mybatis缓存"><a href="#十三、mybatis缓存" class="headerlink" title="十三、mybatis缓存"></a>十三、mybatis缓存</h2><h3 id="13-1-一级缓存-默认开启，无法手动关闭"><a href="#13-1-一级缓存-默认开启，无法手动关闭" class="headerlink" title="13.1 一级缓存(默认开启，无法手动关闭)"></a>13.1 一级缓存(默认开启，无法手动关闭)</h3><ul>
<li><p>一级缓存也叫本地缓存：（在SqlSession中）</p>
<ul>
<li><p>与数据库同一次会话期间查询到的数据会放在本地缓存中。</p>
</li>
<li><p>以后如果需要获取相同的数据，直接从缓存中拿，没必须再去查询数据库;</p>
</li>
</ul>
</li>
</ul>
<p>测试：</p>
<ol>
<li>开启日志</li>
<li>测试在同一个SqlSession中查询同一个数据两次，并分布赋值给u1、u2</li>
<li>判断u1和u2地址是否相同</li>
<li>查看日志输出</li>
</ol>
<p><img src="/2022/03/14/mybatis/15.png" alt="image-20220318193238876"></p>
<p>通过日志信息，我们可以清楚的看到，SqlSession默认会对查询结果进行缓存，在查询相同信息时直接返回结果，不会重新执行sql。</p>
<h4 id="缓存失效的情况："><a href="#缓存失效的情况：" class="headerlink" title="缓存失效的情况："></a>缓存失效的情况：</h4><ol>
<li><p>查询不同的东西</p>
</li>
<li><p>增删改操作，可能会改变原来的数据，所以必定会刷新缓存!</p>
</li>
<li><p>查询不同的Mapper.xml</p>
</li>
<li><p>手动清理缓存!</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">SqlSession.clearCache()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="13-2-二级缓存"><a href="#13-2-二级缓存" class="headerlink" title="13.2 二级缓存"></a>13.2 二级缓存</h3><ul>
<li>开启二级缓存后，同一个mapper配置文件下的操作都会被缓存</li>
</ul>
<p>MyBatis 内置了一个强大的事务性查询缓存机制，它可以非常方便地配置和定制。 </p>
<p>默认情况下，只启用了本地的会话缓存（一级缓存），它仅仅对一个会话中的数据进行缓存。 要启用全局的二级缓存，只需Mapper文件中添加一行：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>基本上就是这样。这个简单语句的效果如下:</p>
<ul>
<li>映射语句文件中的所有 select 语句的结果将会被缓存。</li>
<li>映射语句文件中的所有 insert、update 和 delete 语句会刷新缓存。</li>
<li>缓存会使用最近最少使用算法（LRU, Least Recently Used）算法来清除不需要的缓存。</li>
<li>缓存不会定时进行刷新（也就是说，没有刷新间隔）。</li>
<li>缓存会保存列表或对象（无论查询方法返回哪种）的 1024 个引用。</li>
<li>缓存会被视为读/写缓存，这意味着获取到的对象并不是共享的，可以安全地被调用者修改，而不干扰其他调用者或线程所做的潜在修改。</li>
</ul>
<p><strong>提示</strong> 缓存只作用于 cache 标签所在的映射文件中的语句。如果你混合使用 Java API 和 XML 映射文件，在共用接口中的语句将不会被默认缓存。你需要使用 @CacheNamespaceRef 注解指定缓存作用域。</p>
<p>这些属性可以通过 cache 元素的属性来修改。比如：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span></span></span><br><span class="line"><span class="tag">  <span class="attr">eviction</span>=<span class="string">&quot;FIFO&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">flushInterval</span>=<span class="string">&quot;60000&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">size</span>=<span class="string">&quot;512&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">readOnly</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个更高级的配置创建了一个 FIFO 缓存，每隔 60 秒刷新，最多可以存储结果对象或列表的 512 个引用，而且返回的对象被认为是只读的，因此对它们进行修改可能会在不同线程中的调用者产生冲突。</p>
<p>可用的清除策略有：</p>
<ul>
<li><code>LRU</code> – 最近最少使用：移除最长时间不被使用的对象。</li>
<li><code>FIFO</code> – 先进先出：按对象进入缓存的顺序来移除它们。</li>
<li><code>SOFT</code> – 软引用：基于垃圾回收器状态和软引用规则移除对象。</li>
<li><code>WEAK</code> – 弱引用：更积极地基于垃圾收集器状态和弱引用规则移除对象。</li>
</ul>
<p>默认的清除策略是 LRU。</p>
<p>flushInterval（刷新间隔）属性可以被设置为任意的正整数，设置的值应该是一个以毫秒为单位的合理时间量。 默认情况是不设置，也就是没有刷新间隔，缓存仅仅会在调用语句时刷新。</p>
<p>size（引用数目）属性可以被设置为任意正整数，要注意欲缓存对象的大小和运行环境中可用的内存资源。默认值是 1024。</p>
<p>readOnly（只读）属性可以被设置为 true 或 false。只读的缓存会给所有调用者返回缓存对象的相同实例。 因此这些对象不能被修改。这就提供了可观的性能提升。而可读写的缓存会（通过序列化）返回缓存对象的拷贝。 速度上会慢一些，但是更安全，因此默认值是 false。</p>
<p><strong>提示</strong> 二级缓存是事务性的。这意味着，当 SqlSession 完成并提交时，或是完成并回滚，但没有执行 flushCache=true 的 insert/delete/update 语句时，缓存会获得更新。</p>
<h3 id="13-3-缓存查询顺序"><a href="#13-3-缓存查询顺序" class="headerlink" title="13.3 缓存查询顺序"></a>13.3 缓存查询顺序</h3><ol>
<li>先看二级缓存</li>
<li>在看一级缓存</li>
<li>再连接数据库查询</li>
</ol>
]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title>maven</title>
    <url>/2022/02/26/maven/</url>
    <content><![CDATA[<h1 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h1><p><img src="/2022/02/26/maven/33.png" alt></p>
<h2 id="一、idea默认整合了Maven"><a href="#一、idea默认整合了Maven" class="headerlink" title="一、idea默认整合了Maven"></a>一、idea默认整合了Maven</h2><p><img src="/2022/02/26/maven/1.png" alt></p>
<h2 id="二、下载（如果想使用指定版本的）"><a href="#二、下载（如果想使用指定版本的）" class="headerlink" title="二、下载（如果想使用指定版本的）"></a>二、下载（如果想使用指定版本的）</h2><ol>
<li>maven.apache.org,点击download</li>
</ol>
<p>​        <img src="/2022/02/26/maven/2.png" alt></p>
<ol>
<li><p>在idea中配置</p>
<p><img src="/2022/02/26/maven/3.png" alt></p>
</li>
<li><p>conf目录下：settings.xml 全局配置文件</p>
</li>
<li><p>.m2文件夹</p>
<ul>
<li><p>在安装配置好maven之后，你会发现在用户目录下不存在.m2文件夹</p>
<ul>
<li><p>我们仅仅是对maven进行了安装以及环境变量的配置，需要注意的是，我们并没有让maven执行真正的任务。说到这里，你应该明白了，只要我们执行任何一个maven任务，.m2文件夹就会在用户目录自动的被创建。</p>
</li>
<li><p>下面我们在cmd命令下执行<strong>mvn -help:system</strong></p>
<p>执行完该任务后，你就会发现maven在你当前登录的用户文件夹下自动创建了.m2文件夹。</p>
</li>
<li><p>默认情况下.m2文件夹下放置了maven本地仓库<strong>.m2/repository</strong>。所有的maven构件都被存储到该仓库中，以便重用。</p>
</li>
</ul>
</li>
<li><p>此时.m2文件夹没有settings.xml ，可以官网下载maven再复制到</p>
</li>
</ul>
</li>
</ol>
<h2 id="三、远程仓库配置"><a href="#三、远程仓库配置" class="headerlink" title="三、远程仓库配置"></a>三、远程仓库配置</h2><h3 id="1-默认的远程仓库使用的是Apache提供的中央仓库"><a href="#1-默认的远程仓库使用的是Apache提供的中央仓库" class="headerlink" title="1. 默认的远程仓库使用的是Apache提供的中央仓库"></a>1. 默认的远程仓库使用的是Apache提供的中央仓库</h3><p>mvnrepository.com</p>
<h3 id="2-在-m2文件夹settings-xml-中配置"><a href="#2-在-m2文件夹settings-xml-中配置" class="headerlink" title="2. 在.m2文件夹settings.xml 中配置"></a>2. 在.m2文件夹settings.xml 中配置</h3><h3 id="3-镜像仓库配置（使国内访问更快）"><a href="#3-镜像仓库配置（使国内访问更快）" class="headerlink" title="3.镜像仓库配置（使国内访问更快）"></a>3.镜像仓库配置（使国内访问更快）</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--指定镜像id（可自定义）--&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-aliyun<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--匹配中央仓库（阿里云仓库名称，不可自定义）--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--指定镜像名称（可自定义）--&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus aliyun<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--指定镜像地址（镜像地址）--&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--添加jar包依赖--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="四、本地仓库设置"><a href="#四、本地仓库设置" class="headerlink" title="四、本地仓库设置"></a>四、本地仓库设置</h2><h3 id="1-在-m2文件夹settings-xml-中配置"><a href="#1-在-m2文件夹settings-xml-中配置" class="headerlink" title="1. 在.m2文件夹settings.xml 中配置"></a>1. 在.m2文件夹settings.xml 中配置</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>/path/to/local/repo<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="五、仓库优先级"><a href="#五、仓库优先级" class="headerlink" title="五、仓库优先级"></a>五、仓库优先级</h2><ol>
<li>先从本地仓库查找，如果没有找到</li>
<li>如果没有配置镜像仓库则到默认中央仓库查找</li>
<li>如果配置了镜像，则从镜像仓库查找。还没找到会到默认中央仓库查找。</li>
</ol>
<h2 id="六、指定编译运行的jdk"><a href="#六、指定编译运行的jdk" class="headerlink" title="六、指定编译运行的jdk"></a>六、指定编译运行的jdk</h2><h3 id="在settings-xml中配置"><a href="#在settings-xml中配置" class="headerlink" title="在settings.xml中配置"></a>在settings.xml中配置</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span>&gt;</span>jdk-1.8<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">jdk</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">maven.compiler.compilerVersion</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.compilerVersion</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="七、maven项目类型"><a href="#七、maven项目类型" class="headerlink" title="七、maven项目类型"></a>七、maven项目类型</h2><h3 id="1-pom工程"><a href="#1-pom工程" class="headerlink" title="1. pom工程"></a>1. pom工程</h3><ul>
<li>逻辑工程，用在父级工程或聚合工程中。用来做jar包的版本控制</li>
</ul>
<h3 id="2-jar工程"><a href="#2-jar工程" class="headerlink" title="2. jar工程"></a>2. jar工程</h3><ul>
<li>将会打包成jar包，作为jar包使用。即为常见的本地工程—-》java project</li>
</ul>
<h3 id="3-war工程"><a href="#3-war工程" class="headerlink" title="3. war工程"></a>3. war工程</h3><ul>
<li>将会打包成war，发布在服务器上的工程</li>
</ul>
<h2 id="八、创建maven项目"><a href="#八、创建maven项目" class="headerlink" title="八、创建maven项目"></a>八、创建maven项目</h2><ol>
<li>新建maven项目</li>
</ol>
<p>​    <img src="/2022/02/26/maven/5.png" alt></p>
<ol>
<li><p>填写相关信息</p>
<p><img src="/2022/02/26/maven/6.png" alt></p>
<p><img src="/2022/02/26/maven/7.png" alt></p>
</li>
</ol>
<h2 id="九、项目结构"><a href="#九、项目结构" class="headerlink" title="九、项目结构"></a>九、项目结构</h2><p><img src="/2022/02/26/maven/8.png" alt></p>
<p>在pom.xml文件根元素project下的dependencies标签中，配置依赖信息，内可以包含多个dependence元素，以声明多个依赖。每个依赖dependence标签都应该包含以下元素: groupld, artifactld, version:依赖的基本坐标，对于任何一个依赖来说，基本坐标是最重要的，Maven根据坐标才能找到需要的依赖。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hestialx<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>MavenTest01<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="十、maven项目的依赖，继承，聚合"><a href="#十、maven项目的依赖，继承，聚合" class="headerlink" title="十、maven项目的依赖，继承，聚合"></a>十、maven项目的依赖，继承，聚合</h2><h3 id="1-依赖关系和其传递性"><a href="#1-依赖关系和其传递性" class="headerlink" title="1. 依赖关系和其传递性"></a>1. 依赖关系和其传递性</h3><ul>
<li><p>创建maven项目A，在pom.xml中引入mybatis jar包</p>
</li>
<li><p>首先将maven项目A打包为jar</p>
<ul>
<li><p>点击右侧maven</p>
</li>
<li><p>选择项目</p>
</li>
<li><p>点击install生成项目jar包</p>
<p><img src="/2022/02/26/maven/9.png" alt></p>
</li>
</ul>
</li>
<li><p>打包好后，在项目Bpom.xml中引入项目A jar包</p>
</li>
<li><p>此时项目B不仅引入了项目A jar包，还引入了mybatis jar包</p>
</li>
</ul>
<h3 id="2-依赖的版本冲突问题"><a href="#2-依赖的版本冲突问题" class="headerlink" title="2. 依赖的版本冲突问题"></a>2. 依赖的版本冲突问题</h3><ol>
<li><p>最短路径优先原则</p>
<ul>
<li><p>如果导入依赖存在版本冲突问题优先选择依赖路径最短的版本</p>
<p><img src="/2022/02/26/maven/10.png" alt>    </p>
</li>
</ul>
</li>
<li><p>最先声明原则</p>
<ul>
<li>如果依赖路径是一样长的，同样出现了版本冲突，则看在pom.xml中的声明顺序引入最先声明的</li>
</ul>
</li>
<li><p>排除依赖</p>
<ul>
<li><p>可以pom.xml文件中在引入时配置排除的jar包</p>
<ul>
<li><p>eg:在引入jar包依赖时排除mybatis</p>
<p><img src="/2022/02/26/maven/11.png" alt></p>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="3-依赖的范围"><a href="#3-依赖的范围" class="headerlink" title="3. 依赖的范围"></a>3. 依赖的范围</h3><p>在pom.xml中配置scope</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span><span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/02/26/maven/13.png" alt></p>
<h3 id="4-继承"><a href="#4-继承" class="headerlink" title="4.继承"></a>4.继承</h3><p>创建pom项目</p>
<p><img src="/2022/02/26/maven/14.png" alt></p>
<p>本质是pom.xml文件的继承</p>
<h3 id="5-聚合"><a href="#5-聚合" class="headerlink" title="5. 聚合"></a>5. 聚合</h3><h2 id="十一、maven插件"><a href="#十一、maven插件" class="headerlink" title="十一、maven插件"></a>十一、maven插件</h2><h3 id="1-编译器jdk版本插件"><a href="#1-编译器jdk版本插件" class="headerlink" title="1. 编译器jdk版本插件"></a>1. 编译器jdk版本插件</h3><p><img src="/2022/02/26/maven/17.png" alt></p>
<h3 id="2-资源拷贝插件"><a href="#2-资源拷贝插件" class="headerlink" title="2. 资源拷贝插件"></a>2. 资源拷贝插件</h3><ul>
<li>一般情况，maven 项目打包（install）会将resources目录下的资源文件打包到classes文件下，src下的资源文件不会打包</li>
</ul>
<p><img src="/2022/02/26/maven/18.png" alt></p>
<ul>
<li>现在想把非resources下面的文件也打包到classes下面:需要配置:</li>
</ul>
<p><img src="/2022/02/26/maven/19.png" alt></p>
<h3 id="3-tomcat插件"><a href="#3-tomcat插件" class="headerlink" title="3. tomcat插件"></a>3. tomcat插件</h3><h4 id="创建maven的web项目"><a href="#创建maven的web项目" class="headerlink" title="* 创建maven的web项目"></a>* 创建maven的web项目</h4><p><img src="/2022/02/26/maven/20.png" alt></p>
<p><img src="/2022/02/26/maven/21.png" alt></p>
<p><img src="/2022/02/26/maven/22.png" alt></p>
<p><img src="/2022/02/26/maven/23.png" alt></p>
<p>在项目pom.xml文件中添加tomcat插件配置</p>
<p><img src="/2022/02/26/maven/24.png" alt></p>
<p>点击右侧maven菜单运行tomcat</p>
<p><img src="/2022/02/26/maven/25.png" alt></p>
<h4 id="插件配置模板设置"><a href="#插件配置模板设置" class="headerlink" title="* 插件配置模板设置　　"></a>* 插件配置模板设置　　</h4><ul>
<li><p>打开idea　点击setting</p>
</li>
<li><p>搜索Live Template</p>
</li>
<li><p>创建个人Template组</p>
<p><img src="/2022/02/26/maven/26.png" alt></p>
</li>
<li><p>在Template组下定义动态模板</p>
<p><img src="/2022/02/26/maven/27.png" alt></p>
</li>
</ul>
<h2 id="十二、maven命令控制"><a href="#十二、maven命令控制" class="headerlink" title="十二、maven命令控制"></a>十二、maven命令控制</h2><ol>
<li>mvn clean<ul>
<li>将编译的target目录删除</li>
</ul>
</li>
<li>mvn compile（编译）<ul>
<li>将src  main 目录下的文件进行编译，放置在target目录下</li>
</ul>
</li>
<li>mvn test（测试）<ul>
<li>编译src  main 目录和test 的文件，并放置在target目录下</li>
</ul>
</li>
<li>mvn package（打包）<ul>
<li>编译src  main 目录和test 的文件，并放置在target目录下，并打包成war包</li>
</ul>
</li>
<li>mvn install（安装）<ul>
<li>编译src  main 目录和test 的文件，并放置在target目录下，并打包成war包，并放置在本地仓库</li>
</ul>
</li>
<li>mvn deploy（发布）</li>
</ol>
<p><img src="/2022/02/26/maven/33.png" alt></p>
]]></content>
      <categories>
        <category>maven</category>
      </categories>
      <tags>
        <tag>maven</tag>
      </tags>
  </entry>
  <entry>
    <title>redis</title>
    <url>/2022/02/21/redis/</url>
    <content><![CDATA[<h1 id="redis学习"><a href="#redis学习" class="headerlink" title="redis学习"></a>redis学习</h1><h2 id="一、概念"><a href="#一、概念" class="headerlink" title="一、概念"></a>一、概念</h2><p>Redis（Remote Dictionary Server )，即远程字典服务，是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据，并提供多种语言的API。</p>
<p>Redis是非关系型数据库</p>
<ul>
<li>关系型数据库和非关系型数据库的区别</li>
</ul>
<p><img src="/2022/02/21/redis/1.png" alt></p>
<h2 id="二、下载"><a href="#二、下载" class="headerlink" title="二、下载"></a>二、下载</h2><ol>
<li>官网：<a href="https://redis.io">https://redis.io</a></li>
<li>中文网：<a href="https://www.redis.net.cn">https://www.redis.net.cn</a></li>
<li>下载windows版本，解压可以直接使用<ul>
<li>redis.windows.conf:配置文件</li>
<li>redis-cli.exe:redis的客户端</li>
<li>redis-server.exe:redis服务器端</li>
</ul>
</li>
</ol>
<h2 id="三、命令操作"><a href="#三、命令操作" class="headerlink" title="三、命令操作"></a>三、命令操作</h2><h3 id="1-打开服务"><a href="#1-打开服务" class="headerlink" title="1. 打开服务"></a>1. 打开服务</h3><p>打开一个 <strong>cmd</strong> 窗口 使用 cd 命令切换目录到 <strong>C:\redis</strong> 运行：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">redis-server.exe redis.windows.conf</span><br></pre></td></tr></table></figure>
<h3 id="2-打开客户端"><a href="#2-打开客户端" class="headerlink" title="2. 打开客户端"></a>2. 打开客户端</h3><p>这时候另启一个 cmd 窗口，原来的不要关闭，不然就无法访问服务端了。</p>
<p>切换到 redis 目录下运行:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">redis-cli.exe -h 127.0.0.1 -p 6379</span><br></pre></td></tr></table></figure>
<p>设置键值对:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set myKey abc</span><br></pre></td></tr></table></figure>
<p>取出键值对:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">get myKey</span><br></pre></td></tr></table></figure>
<h3 id="redis的数据结构"><a href="#redis的数据结构" class="headerlink" title="redis的数据结构"></a>redis的数据结构</h3><ul>
<li>redis存储的是：键值对格式的数据，其中key都是字符串</li>
</ul>
<p>Redis中的 value支持五种数据类型：</p>
<ol>
<li><p>string（字符串），</p>
<ul>
<li><p>存储</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set myKey abc</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">get myKey</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">del myKey</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>hash（哈希），：map格式</p>
<ul>
<li><p>存储</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hset key field value</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//获取单个值</span><br><span class="line">hget key field value</span><br><span class="line">//获取全部</span><br><span class="line">hgetall key</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//删除指定值</span><br><span class="line">hdel key field</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>list（列表），：LinkedList</p>
<ul>
<li><p>存储</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//在左侧添加元素</span><br><span class="line">lpush key value</span><br><span class="line">//在右侧添加元素</span><br><span class="line">rpush key value</span><br><span class="line">//</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//范围获取</span><br><span class="line">lrange key start end:</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">lpop key:删除列表最左边的元素，并将元素返回</span><br><span class="line">rpop key:删除列表最右边的元素，并将元素返回</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>set（集合）：不允许重复</p>
<ul>
<li><p>存储</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sadd key value</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//获取几何中所有元素</span><br><span class="line">smembers key</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//删除set集合中的某个元素</span><br><span class="line">srem key value</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>zset(sorted set：无重复的有序集合)</p>
<ul>
<li><p>存储</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">zadd key score value;</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">zrange key start end withscores</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">zrem key value</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h3 id="通用命令"><a href="#通用命令" class="headerlink" title="通用命令"></a>通用命令</h3><ol>
<li>keys *：查询所有的键</li>
<li>type key：获取键对应的value的类型</li>
<li>del key：删除指定的key value</li>
</ol>
<h2 id="四、持久化"><a href="#四、持久化" class="headerlink" title="四、持久化"></a>四、持久化</h2><ol>
<li><p>redis是一个内存数据库，当redis服务器重启，数据会丢失</p>
</li>
<li><p>redis持久化机制：</p>
<ul>
<li><p>RDB：默认方式，不需要进行配置，默认就使用这种机制</p>
<ul>
<li><p>在一定间隔的时间中，检测key的变化情况，然后持久化数据</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#   In the example below the behaviour will be to save:</span><br><span class="line">#   after 900 sec (15 min) if at least 1 key changed</span><br><span class="line">#   after 300 sec (5 min) if at least 10 keys changed</span><br><span class="line">#   after 60 sec if at least 10000 keys changed</span><br><span class="line">#</span><br><span class="line">#   Note: you can disable saving completely by commenting out all &quot;save&quot; lines.</span><br><span class="line">#</span><br><span class="line">#   It is also possible to remove all the previously configured save</span><br><span class="line">#   points by adding a save directive with a single empty string argument</span><br><span class="line">#   like in the following example:</span><br><span class="line">#</span><br><span class="line">#   save &quot;&quot;</span><br><span class="line"></span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启redis服务器，并指定配置文件名称</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">redis-server.exe redis.windows.conf</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>AOF：日志记录的方式，可以记录每一条命令的操作。可以每一次操作后进行持久化数据</p>
<ul>
<li><p>编辑redis.windows.conf配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">appendonly on ---&gt; appendonly yes (开启aof)</span><br><span class="line"># appendfsync always 每一次操作都持久化</span><br><span class="line">appendfsync always everysec : 每秒持久化一次</span><br><span class="line"># appendfsync no 不进行持久化</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="五、Java客户端-Jedis"><a href="#五、Java客户端-Jedis" class="headerlink" title="五、Java客户端 Jedis"></a>五、Java客户端 Jedis</h2><ul>
<li><p>导入jar包</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">commons-pool2-2.11.1.jar</span><br><span class="line">jedis-2.9.0.jar</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">/空参构造，默认值是localhost和<span class="number">6379</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jedistest</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Jedis j = <span class="keyword">new</span> Jedis(<span class="string">&quot;localhost&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        j.set(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">        j.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>jedis操作redis各种数据</p>
<ol>
<li><p>string</p>
<ul>
<li><p>get</p>
</li>
<li><p>set</p>
</li>
<li><p>setex</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jedistest2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//空参构造，默认值是localhost和6379</span></span><br><span class="line">        Jedis j = <span class="keyword">new</span> Jedis(<span class="string">&quot;localhost&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        j.set(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;li&quot;</span>);</span><br><span class="line">        String username = j.get(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        System.out.println(username);</span><br><span class="line">        <span class="comment">//可以使用setex（）方法存储指定过期时间的key value</span></span><br><span class="line">    	<span class="comment">//10秒后过期</span></span><br><span class="line">        j.setex(<span class="string">&quot;limitcode&quot;</span>,<span class="number">10</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        j.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>hash：map</p>
<ul>
<li><p>hset()</p>
</li>
<li><p>hget()</p>
</li>
<li><p>hgetAll()</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//hash类型操作</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jedistest3</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//空参构造，默认值是localhost和6379</span></span><br><span class="line">        Jedis j = <span class="keyword">new</span> Jedis(<span class="string">&quot;localhost&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        j.hset(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;lx&quot;</span>);</span><br><span class="line">        j.hset(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;age&quot;</span>,<span class="string">&quot;10&quot;</span>);</span><br><span class="line">        j.hset(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;phone&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        String uname = j.hget(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(uname);</span><br><span class="line">        <span class="comment">//获取所有值</span></span><br><span class="line">        Map&lt;String, String&gt; user = j.hgetAll(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        Set&lt;String&gt; keySet = user.keySet();</span><br><span class="line">        <span class="keyword">for</span> (String s : keySet) &#123;</span><br><span class="line">            System.out.println(s+<span class="string">&quot;:&quot;</span>+user.get(s));</span><br><span class="line">        &#125;</span><br><span class="line">        j.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>list：linkedlist</p>
<ul>
<li><p>lpush/rpush</p>
</li>
<li><p>lpop/rpop</p>
</li>
<li><p>lrange</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//list类型操作</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jedistest4</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//空参构造，默认值是localhost和6379</span></span><br><span class="line">        Jedis j = <span class="keyword">new</span> Jedis(<span class="string">&quot;localhost&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        j.del(<span class="string">&quot;number&quot;</span>);</span><br><span class="line">        <span class="comment">//存储</span></span><br><span class="line">        j.lpush(<span class="string">&quot;number&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>);</span><br><span class="line">        j.rpush(<span class="string">&quot;number&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="string">&quot;3&quot;</span>,<span class="string">&quot;9&quot;</span>);</span><br><span class="line">        <span class="comment">//结果[9, 3, 1, 1, 3, 9]</span></span><br><span class="line">        <span class="comment">//获取所有</span></span><br><span class="line">        List&lt;String&gt; number = j.lrange(<span class="string">&quot;number&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        System.out.println(number);</span><br><span class="line">        <span class="comment">//弹出</span></span><br><span class="line">        j.rpop(<span class="string">&quot;number&quot;</span>);</span><br><span class="line">        List&lt;String&gt; number1 = j.lrange(<span class="string">&quot;number&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        System.out.println(number1);</span><br><span class="line">        j.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
</li>
</ul>
<ol>
<li><p>set：</p>
<ul>
<li><p>sadd</p>
</li>
<li><p>smembers</p>
</li>
<li><p>srem</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//set类型操作</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jedistest5</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//空参构造，默认值是localhost和6379</span></span><br><span class="line">        Jedis j = <span class="keyword">new</span> Jedis(<span class="string">&quot;localhost&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        j.sadd(<span class="string">&quot;com&quot;</span>,<span class="string">&quot;php&quot;</span>,<span class="string">&quot;c++&quot;</span>,<span class="string">&quot;java&quot;</span>);</span><br><span class="line">        Set&lt;String&gt; java = j.smembers(<span class="string">&quot;java&quot;</span>);</span><br><span class="line">        System.out.println(java);</span><br><span class="line">        j.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<ol>
<li><p>sortedset：</p>
<ul>
<li><p>zadd</p>
</li>
<li><p>zrange</p>
</li>
<li><p>zrem</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//set类型操作</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jedistest6</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//空参构造，默认值是localhost和6379</span></span><br><span class="line">        Jedis j = <span class="keyword">new</span> Jedis(<span class="string">&quot;localhost&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        j.zadd(<span class="string">&quot;hero&quot;</span>,<span class="number">50</span>,<span class="string">&quot;yase&quot;</span>);</span><br><span class="line">        j.zadd(<span class="string">&quot;hero&quot;</span>,<span class="number">10</span>,<span class="string">&quot;heshang&quot;</span>);</span><br><span class="line">        j.zadd(<span class="string">&quot;hero&quot;</span>,<span class="number">70</span>,<span class="string">&quot;sunwukong&quot;</span>);</span><br><span class="line">        Set&lt;String&gt; hero = j.zrange(<span class="string">&quot;hero&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        System.out.println(hero);</span><br><span class="line">        j.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<ul>
<li><p>jedis连接池</p>
<ol>
<li><p>使用</p>
<ol>
<li><p>创建连接池JedisPool对象</p>
</li>
<li><p>调用方法：getResource（）方法获取jedis链接</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//jedis连接池</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jedistest7</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//创建一个配置对象</span></span><br><span class="line">        JedisPoolConfig config = <span class="keyword">new</span> JedisPoolConfig();</span><br><span class="line">        <span class="comment">//最大连接数</span></span><br><span class="line">        config.setMaxTotal(<span class="number">50</span>);</span><br><span class="line">        <span class="comment">//最大空闲连接</span></span><br><span class="line">        config.setMaxIdle(<span class="number">10</span>);</span><br><span class="line">        JedisPool jedisPool = <span class="keyword">new</span> JedisPool(config,<span class="string">&quot;localhost&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        Jedis jedis = jedisPool.getResource();</span><br><span class="line">        String username = jedis.get(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        System.out.println(username);</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>JedisPoolConfig参数意义</p>
<p><img src="/2022/02/21/redis/2.png" alt></p>
</li>
</ol>
</li>
</ol>
</li>
</ul>
<h2 id="六、案例"><a href="#六、案例" class="headerlink" title="六、案例"></a>六、案例</h2><p><img src="/2022/02/21/redis/3.png" alt></p>
]]></content>
      <categories>
        <category>redis</category>
      </categories>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title>pytorch入门</title>
    <url>/2022/05/24/pytorch01/</url>
    <content><![CDATA[<h1 id="一、加载数据"><a href="#一、加载数据" class="headerlink" title="一、加载数据"></a>一、加载数据</h1><h2 id="1-Dataset和Dataloader"><a href="#1-Dataset和Dataloader" class="headerlink" title="1. Dataset和Dataloader"></a>1. Dataset和Dataloader</h2><h3 id="Dataset"><a href="#Dataset" class="headerlink" title="Dataset"></a>Dataset</h3><ol>
<li><p>提供一种方式去获取数据及其label</p>
</li>
<li><p>告诉我们总共有多少个数据</p>
</li>
</ol>
<h3 id="Dataloader"><a href="#Dataloader" class="headerlink" title="Dataloader"></a>Dataloader</h3><p>将数据进行不同形式的打包</p>
<p>提供后面网络所需要的数据形式</p>
<h2 id="2-蜜蜂蚂蚁数据集构建"><a href="#2-蜜蜂蚂蚁数据集构建" class="headerlink" title="2. 蜜蜂蚂蚁数据集构建"></a>2. 蜜蜂蚂蚁数据集构建</h2><h4 id="数据集下载"><a href="#数据集下载" class="headerlink" title="数据集下载"></a>数据集下载</h4><p><a href="https://download.pytorch.org/tutorial/hymenoptera_data.zip">https://download.pytorch.org/tutorial/hymenoptera_data.zip</a></p>
<p><img src="/2022/05/24/pytorch01/1.png" alt="image-20220524172221875"></p>
<h4 id="Dataset类介绍"><a href="#Dataset类介绍" class="headerlink" title="Dataset类介绍"></a>Dataset类介绍</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Dataset(*args, **kwds)</span><br><span class="line"> |  </span><br><span class="line"> |  An abstract class representing a :class:`Dataset`.</span><br><span class="line"> |  </span><br><span class="line"> |  All datasets that represent a map from keys to data samples should subclass</span><br><span class="line"> |  it. All subclasses should overwrite :meth:`__getitem__`, supporting fetching a</span><br><span class="line"> |  data sample for a given key. Subclasses could also optionally overwrite</span><br><span class="line"> |  :meth:`__len__`, which is expected to return the size of the dataset by many</span><br><span class="line"> |  :class:`~torch.utils.data.Sampler` implementations and the default options</span><br><span class="line"> |  of :class:`~torch.utils.data.DataLoader`.</span><br><span class="line"> |  </span><br><span class="line"> |  .. note::</span><br><span class="line"> |    :class:`~torch.utils.data.DataLoader` by default constructs a index</span><br><span class="line"> |    sampler that yields integral indices.  To make it work with a map-style</span><br><span class="line"> |    dataset with non-integral indices/keys, a custom sampler must be provided.</span><br></pre></td></tr></table></figure>
<h4 id="创建蜜蜂蚂蚁数据集的dataset类"><a href="#创建蜜蜂蚂蚁数据集的dataset类" class="headerlink" title="创建蜜蜂蚂蚁数据集的dataset类"></a>创建蜜蜂蚂蚁数据集的dataset类</h4><ul>
<li>创建MyData类，继承Dataset</li>
<li>在构造方法中传入root_dir（数据集根目录），label_dir（数据目录—-在这个数据集中代表标签）</li>
<li>使用os.path.join方法拼接路径，根据os.listdir方法获取图片路径集合</li>
<li>重写<strong>getitem</strong>方法，传入参数idx，根据idx得到对应的图片名称，使用cv2获取图片对象，返回图片对象和label</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> Dataset</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyData</span>(<span class="params">Dataset</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,root_dir,label_dir</span>):</span></span><br><span class="line">        <span class="comment"># train_ants_dir_path = &quot;data/hymenoptera_data/train/ants&quot;;</span></span><br><span class="line">        self.root_dir = root_dir</span><br><span class="line">        self.label_dir = label_dir</span><br><span class="line">        self.data_dir_path = os.path.join(self.root_dir,self.label_dir)</span><br><span class="line">        self.img_path = os.listdir(self.data_dir_path)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span>(<span class="params">self, idx</span>):</span></span><br><span class="line">        img_name = self.img_path[idx]</span><br><span class="line">        img_item_path = os.path.join(self.data_dir_path,img_name)</span><br><span class="line">        img = cv2.imread(img_item_path)</span><br><span class="line">        label = self.label_dir</span><br><span class="line">        <span class="comment"># cv2.imshow(&quot;image&quot;,img)</span></span><br><span class="line">        <span class="comment"># cv2.waitKey(0)</span></span><br><span class="line">        <span class="comment"># cv2.destroyAllWindows()</span></span><br><span class="line">        <span class="keyword">return</span> img,label</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.img_path)</span><br><span class="line"></span><br><span class="line">train_data = MyData(<span class="string">&quot;../data/hymenoptera_data/train&quot;</span>,<span class="string">&quot;ants&quot;</span>)</span><br><span class="line">train_data1 = MyData(<span class="string">&quot;../data/hymenoptera_data/train&quot;</span>,<span class="string">&quot;bees&quot;</span>)</span><br><span class="line">img,label = train_data[<span class="number">1</span>]</span><br><span class="line">img1,label1 = train_data1[<span class="number">1</span>]</span><br><span class="line">datatest = train_data+train_data1</span><br><span class="line">img2,label2 = datatest[<span class="number">130</span>]</span><br><span class="line"><span class="built_in">print</span>(label)</span><br><span class="line"><span class="built_in">print</span>(label1)</span><br><span class="line">cv2.imshow(<span class="string">&quot;image&quot;</span>,img)</span><br><span class="line">cv2.imshow(<span class="string">&quot;image1&quot;</span>,img1)</span><br><span class="line">cv2.imshow(<span class="string">&quot;img&quot;</span>,img2)</span><br><span class="line">cv2.waitKey(<span class="number">0</span>)</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong></p>
<p>创建的同种类型的dataset对象可以使用+好进行合并</p>
<p>eg:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">train_data = MyData(<span class="string">&quot;../data/hymenoptera_data/train&quot;</span>,<span class="string">&quot;ants&quot;</span>)</span><br><span class="line">train_data1 = MyData(<span class="string">&quot;../data/hymenoptera_data/train&quot;</span>,<span class="string">&quot;bees&quot;</span>)</span><br><span class="line">datatest = train_data+train_data1</span><br><span class="line">img2,label2 = datatest[<span class="number">130</span>]</span><br></pre></td></tr></table></figure>
<h2 id="3-Tensorboard"><a href="#3-Tensorboard" class="headerlink" title="3. Tensorboard"></a>3. Tensorboard</h2><h3 id="安装："><a href="#安装：" class="headerlink" title="安装："></a>安装：</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip install tensorboard</span><br></pre></td></tr></table></figure>
<h3 id="add-scalar绘图："><a href="#add-scalar绘图：" class="headerlink" title="add_scalar绘图："></a>add_scalar绘图：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter</span><br><span class="line"></span><br><span class="line"><span class="comment">#第一个参数指定文件夹名称（尽量把文件夹名称设置到项目根目录下，方便之后运行）</span></span><br><span class="line"><span class="comment">#默认为runs</span></span><br><span class="line">writer = SummaryWriter(<span class="string">&quot;../log&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="comment">#第一个参数是名称，第二第三个参数是y，x</span></span><br><span class="line">    writer.add_scalar(<span class="string">&quot;y=x&quot;</span>,i,i)</span><br><span class="line">writer.close()</span><br></pre></td></tr></table></figure>
<p>运行后在项目根目录下生成了log文件夹</p>
<p><img src="/2022/05/24/pytorch01/2.png" alt="image-20220524180553785"></p>
<p>打开terminal窗口，启动tensorboard</p>
<ul>
<li>—logdir=【生成的文件夹相对路径】 —port=【指定运行端口】默认端口为6006</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tensorboard --logdir=log --port=6006</span><br></pre></td></tr></table></figure>
<h3 id="add-image插入图像"><a href="#add-image插入图像" class="headerlink" title="add_image插入图像"></a>add_image插入图像</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;&quot;&quot;Add image data to summary.</span><br><span class="line"></span><br><span class="line">Note that this requires the ``pillow`` package.</span><br><span class="line"></span><br><span class="line">Args:</span><br><span class="line">    tag (string): Data identifier</span><br><span class="line">    img_tensor (torch.Tensor, numpy.array, or string/blobname): Image data</span><br><span class="line">    global_step (int): Global step value to record</span><br><span class="line">    walltime (float): Optional override default walltime (time.time())</span><br><span class="line">      seconds after epoch of event</span><br><span class="line">Shape:</span><br><span class="line">    img_tensor: Default is :math:`(3, H, W)`. You can use ``torchvision.utils.make_grid()`` to</span><br><span class="line">    convert a batch of tensor into 3xHxW format or call ``add_images`` and let us do the job.</span><br><span class="line">    Tensor with :math:`(1, H, W)`, :math:`(H, W)`, :math:`(H, W, 3)` is also suitable as long as</span><br><span class="line">    corresponding ``dataformats`` argument is passed, e.g. ``CHW``, ``HWC``, ``HW``.</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong>只支持torch.Tensor, numpy.array, or string/blobname类型的图像</p>
<p>默认图像格式：</p>
<p>Default is :math:`(3, H, W)</p>
<p>如果不是CHW格式需要使用dataformats字段指定</p>
<p>eg:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">writer.add_image(<span class="string">&#x27;my_image_HWC&#x27;</span>, img_HWC, <span class="number">0</span>, dataformats=<span class="string">&#x27;HWC&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">img = cv2.imread(<span class="string">&quot;../data/hymenoptera_data/train/ants/0013035.jpg&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(img.shape)</span><br><span class="line"><span class="comment">#第一个参数指定文件夹名称</span></span><br><span class="line">writer = SummaryWriter(<span class="string">&quot;../log&quot;</span>)</span><br><span class="line"><span class="comment">#第一个参数指定文件夹名称，第二个参数名称为图片对象，第三个为global_step</span></span><br><span class="line"><span class="comment"># dataformats设置图片格式（默认为CHW）,cv2读取的为（HWC）</span></span><br><span class="line">writer.add_image(<span class="string">&quot;first_img&quot;</span>,img,<span class="number">0</span>,dataformats=<span class="string">&#x27;HWC&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="comment"># 第一个参数是名称，第二第三个参数是y，x</span></span><br><span class="line">    writer.add_scalar(<span class="string">&quot;y=x&quot;</span>,i,i)</span><br><span class="line">writer.close()</span><br></pre></td></tr></table></figure>
<h2 id="4-CV2-imread颜色问题"><a href="#4-CV2-imread颜色问题" class="headerlink" title="4. CV2.imread颜色问题"></a>4. CV2.imread颜色问题</h2><p>CV2.imread读取完图片后，是以BGR的顺序存储图片颜色通道的，因此显示时颜色会出现问题</p>
<p>解决方法：</p>
<p>直接将颜色进行翻转</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">img[:,:,::-<span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<h2 id="5-torchversion中的transforms"><a href="#5-torchversion中的transforms" class="headerlink" title="5. torchversion中的transforms"></a>5. torchversion中的transforms</h2><p>transforms就是一个工具箱，其中有很多工具（类），可以进行图像处理</p>
<p>eg：将numpy图片转换为tensor</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> transforms</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"></span><br><span class="line">img_path = <span class="string">&quot;../data/hymenoptera_data/train/ants/0013035.jpg&quot;</span></span><br><span class="line">img = cv2.imread(img_path)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(img))</span><br><span class="line">tensor_trans = transforms.ToTensor()</span><br><span class="line">tensor_img = tensor_trans(img)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(tensor_img))</span><br></pre></td></tr></table></figure>
<h3 id="为什么需要tensor数据类型？"><a href="#为什么需要tensor数据类型？" class="headerlink" title="为什么需要tensor数据类型？"></a>为什么需要tensor数据类型？</h3><p>tensor数据类型中包装了神经网络训练需要的参数，例如梯度信息等</p>
<h3 id="常用的transforms工具"><a href="#常用的transforms工具" class="headerlink" title="常用的transforms工具"></a>常用的transforms工具</h3><ol>
<li><p>transforms.ToTensor(img) —-将图像转换为tensor数据类型</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tensor_trans = transforms.ToTensor()</span><br><span class="line">tensor_img = tensor_trans(img)</span><br></pre></td></tr></table></figure>
</li>
<li><p>transforms.Normalize(均值，方差) —-将图片根据给定的mean和std进行标准化</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Args:</span><br><span class="line">        mean (sequence): <span class="type">Sequence</span> of means <span class="keyword">for</span> each channel.</span><br><span class="line">        std (sequence): <span class="type">Sequence</span> of standard deviations <span class="keyword">for</span> each channel.</span><br><span class="line">        inplace(<span class="built_in">bool</span>,optional): Bool to make this operation <span class="keyword">in</span>-place.</span><br><span class="line">tensor_norm = transforms.Normalize([<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>],[<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>])</span><br><span class="line">img_norm = tensor_norm(tensor_img)</span><br></pre></td></tr></table></figure>
</li>
<li><p>Resize —-将图片放缩到指定大小</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Resize</span></span><br><span class="line">trans_resize = transforms.Resize((<span class="number">512</span>,<span class="number">512</span>))</span><br><span class="line">img_resize = trans_resize(img)</span><br><span class="line">img_resize = tensor_trans(img_resize)</span><br></pre></td></tr></table></figure>
</li>
<li><p>Compose 这个类的主要作用是串联多个图片变换的操作</p>
<p>eg：串联ToTensor和resize</p>
<ul>
<li>trans_resize1,tensor_trans都是transforms中的工具类的实例</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Compose</span></span><br><span class="line">trans_resize1 = transforms.Resize((<span class="number">256</span>,<span class="number">256</span>))</span><br><span class="line">trans_conpose = transforms.Compose([trans_resize1,tensor_trans])</span><br><span class="line">img_compose = trans_conpose(img)</span><br></pre></td></tr></table></figure>
</li>
<li><p>RandomCrop   —-随机裁剪指定大小的图片</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#RandomCrop</span></span><br><span class="line">trans_random = transforms.RandomCrop(<span class="number">100</span>)</span><br><span class="line">trans_conpose1 = transforms.Compose([trans_random,tensor_trans])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    img_crop = trans_conpose1(img)</span><br><span class="line">    writer = SummaryWriter(<span class="string">&quot;../log&quot;</span>)</span><br><span class="line">    writer.add_image(<span class="string">&quot;crop1&quot;</span>,img_crop,i)</span><br><span class="line">writer.close()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="6-torchvision下载使用数据集"><a href="#6-torchvision下载使用数据集" class="headerlink" title="6. torchvision下载使用数据集"></a>6. torchvision下载使用数据集</h2><p>在下载数据集时可以指定transform组件，对数据集进行初始化</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="comment">#定义Compose组装transforms组件</span></span><br><span class="line">dataset_transform = torchvision.transforms.Compose([</span><br><span class="line">    torchvision.transforms.ToTensor()</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">train_set = torchvision.datasets.CIFAR10(root=<span class="string">&quot;./data&quot;</span>,</span><br><span class="line">                                         train=<span class="literal">True</span>,</span><br><span class="line">                                         download=<span class="literal">True</span>,</span><br><span class="line">                                         transform=dataset_transform)</span><br><span class="line">test_set = torchvision.datasets.CIFAR10(root=<span class="string">&quot;./data&quot;</span>,</span><br><span class="line">                                        train=<span class="literal">False</span>,</span><br><span class="line">                                        download=<span class="literal">True</span>,</span><br><span class="line">                                        transform=dataset_transform)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(test_set[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(test_set.classes)</span><br><span class="line">img,target = test_set[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(img)</span><br><span class="line"><span class="built_in">print</span>(test_set.classes[target])</span><br></pre></td></tr></table></figure>
<h2 id="7-dataloader（定义如何获取数据）"><a href="#7-dataloader（定义如何获取数据）" class="headerlink" title="7. dataloader（定义如何获取数据）"></a>7. dataloader（定义如何获取数据）</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Data loader. Combines a dataset and a sampler, and provides an iterable over</span><br><span class="line">the given dataset.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Args:</span><br><span class="line">    dataset (Dataset): dataset from which to load the data.</span><br><span class="line">    batch_size (int, optional): how many samples per batch to load</span><br><span class="line">        (default: ``1``).</span><br><span class="line">    shuffle (bool, optional): set to ``True`` to have the data reshuffled</span><br><span class="line">        at every epoch (default: ``False``).</span><br><span class="line">    sampler (Sampler or Iterable, optional): defines the strategy to draw</span><br><span class="line">        samples from the dataset. Can be any ``Iterable`` with ``__len__``</span><br><span class="line">        implemented. If specified, :attr:`shuffle` must not be specified.</span><br><span class="line">    batch_sampler (Sampler or Iterable, optional): like :attr:`sampler`, but</span><br><span class="line">        returns a batch of indices at a time. Mutually exclusive with</span><br><span class="line">        :attr:`batch_size`, :attr:`shuffle`, :attr:`sampler`,</span><br><span class="line">        and :attr:`drop_last`.</span><br><span class="line">    num_workers (int, optional): how many subprocesses to use for data</span><br><span class="line">        loading. ``0`` means that the data will be loaded in the main process.</span><br><span class="line">        (default: ``0``)</span><br><span class="line">    collate_fn (callable, optional): merges a list of samples to form a</span><br><span class="line">        mini-batch of Tensor(s).  Used when using batched loading from a</span><br><span class="line">        map-style dataset.</span><br><span class="line">    pin_memory (bool, optional): If ``True``, the data loader will copy Tensors</span><br><span class="line">        into CUDA pinned memory before returning them.  If your data elements</span><br><span class="line">        are a custom type, or your :attr:`collate_fn` returns a batch that is a custom type,</span><br><span class="line">        see the example below.</span><br><span class="line">    drop_last (bool, optional): set to ``True`` to drop the last incomplete batch,</span><br><span class="line">        if the dataset size is not divisible by the batch size. If ``False`` and</span><br><span class="line">        the size of dataset is not divisible by the batch size, then the last batch</span><br><span class="line">        will be smaller. (default: ``False``)</span><br><span class="line">    timeout (numeric, optional): if positive, the timeout value for collecting a batch</span><br><span class="line">        from workers. Should always be non-negative. (default: ``0``)</span><br><span class="line">    worker_init_fn (callable, optional): If not ``None``, this will be called on each</span><br><span class="line">        worker subprocess with the worker id (an int in ``[0, num_workers - 1]``) as</span><br><span class="line">        input, after seeding and before data loading. (default: ``None``)</span><br><span class="line">    generator (torch.Generator, optional): If not ``None``, this RNG will be used</span><br><span class="line">        by RandomSampler to generate random indexes and multiprocessing to generate</span><br><span class="line">        `base_seed` for workers. (default: ``None``)</span><br><span class="line">    prefetch_factor (int, optional, keyword-only arg): Number of samples loaded</span><br><span class="line">        in advance by each worker. ``2`` means there will be a total of</span><br><span class="line">        2 * num_workers samples prefetched across all workers. (default: ``2``)</span><br><span class="line">    persistent_workers (bool, optional): If ``True``, the data loader will not shutdown</span><br><span class="line">        the worker processes after a dataset has been consumed once. This allows to</span><br><span class="line">        maintain the workers `Dataset` instances alive. (default: ``False``)</span><br></pre></td></tr></table></figure>
<p>eg:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#设置数据集test_set，每次取4条数据，打乱顺序，使用主线程运行，不舍弃剩余的数据</span></span><br><span class="line">test_load =  DataLoader(dataset=test_set,batch_size=<span class="number">4</span>,shuffle=<span class="literal">True</span>,num_workers=<span class="number">0</span>,drop_last=<span class="literal">False</span>)</span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> test_load:</span><br><span class="line">    imgs,targets = data</span><br><span class="line">    <span class="built_in">print</span>(imgs.shape)</span><br><span class="line">    <span class="built_in">print</span>(targets)</span><br></pre></td></tr></table></figure>
<h2 id="8-神经网络搭建"><a href="#8-神经网络搭建" class="headerlink" title="8. 神经网络搭建"></a>8. 神经网络搭建</h2><ul>
<li>torch.nn  —-Neural network</li>
</ul>
<h3 id="1）torch-nn-Module"><a href="#1）torch-nn-Module" class="headerlink" title="1）torch.nn.Module"></a>1）torch.nn.Module</h3><p><strong>所有自定义的神经网络结构都要继承torch.nn.Module这个类</strong></p>
<p>主要编写两个函数：</p>
<ul>
<li><strong>init</strong>（）函数中首先调用父类的init（）函数，然后定义网络结构组件</li>
<li>定义前向传播的过程</li>
</ul>
<p>eg：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Model</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.conv1 = nn.Conv2d(<span class="number">1</span>, <span class="number">20</span>, <span class="number">5</span>)</span><br><span class="line">        self.conv2 = nn.Conv2d(<span class="number">20</span>, <span class="number">20</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        x = F.relu(self.conv1(x))</span><br><span class="line">        <span class="keyword">return</span> F.relu(self.conv2(x))</span><br></pre></td></tr></table></figure>
<h1 id="二、cifar-10分类"><a href="#二、cifar-10分类" class="headerlink" title="二、cifar-10分类"></a>二、cifar-10分类</h1><h2 id="1-网络构建"><a href="#1-网络构建" class="headerlink" title="1. 网络构建"></a>1. 网络构建</h2><p><img src="/2022/05/24/pytorch01/3.png" alt="image-20220526203413906"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用Sequential</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">M</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.model1 = nn.Sequential(</span><br><span class="line">            nn.Conv2d(<span class="number">3</span>,<span class="number">32</span>,<span class="number">5</span>,padding=<span class="number">2</span>),</span><br><span class="line">            nn.MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            nn.Conv2d(<span class="number">32</span>, <span class="number">32</span>, <span class="number">5</span>, padding=<span class="number">2</span>),</span><br><span class="line">            nn.MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            nn.Conv2d(<span class="number">32</span>, <span class="number">64</span>, <span class="number">5</span>, padding=<span class="number">2</span>),</span><br><span class="line">            nn.MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            nn.Flatten(),</span><br><span class="line">            nn.Linear(<span class="number">1024</span>,<span class="number">64</span>),</span><br><span class="line">            nn.Linear(<span class="number">64</span>,<span class="number">10</span>)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        x = self.model1(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用传统方式</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyConv</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.conv1 = nn.Conv2d(in_channels=<span class="number">3</span>,out_channels=<span class="number">32</span>,kernel_size=<span class="number">5</span>,padding=<span class="number">2</span>,stride=<span class="number">1</span>)</span><br><span class="line">        self.pool1 = nn.MaxPool2d(<span class="number">2</span>)</span><br><span class="line">        self.conv2 = nn.Conv2d(in_channels=<span class="number">32</span>, out_channels=<span class="number">32</span>, kernel_size=<span class="number">5</span>, padding=<span class="number">2</span>, stride=<span class="number">1</span>)</span><br><span class="line">        self.pool2 = nn.MaxPool2d(<span class="number">2</span>)</span><br><span class="line">        self.conv3 = nn.Conv2d(in_channels=<span class="number">32</span>,out_channels=<span class="number">64</span>,kernel_size=<span class="number">5</span>,padding=<span class="number">2</span>)</span><br><span class="line">        self.pool3 = nn.MaxPool2d(<span class="number">2</span>)</span><br><span class="line">        self.flatten = nn.Flatten()</span><br><span class="line">        self.linear1 = nn.Linear(<span class="number">1024</span>,<span class="number">64</span>)</span><br><span class="line">        self.linear2 = nn.Linear(<span class="number">64</span>,<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self,x</span>):</span></span><br><span class="line">        x = self.conv1(x)</span><br><span class="line">        x = self.pool1(x)</span><br><span class="line">        x = self.conv2(x)</span><br><span class="line">        x = self.pool2(x)</span><br><span class="line">        x = self.conv3(x)</span><br><span class="line">        x = self.pool3(x)</span><br><span class="line">        x = self.flatten(x)</span><br><span class="line">        x = self.linear1(x)</span><br><span class="line">        x = self.linear2(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">myconv =  M()</span><br><span class="line"><span class="built_in">print</span>(myconv)</span><br><span class="line"><span class="built_in">input</span> = torch.ones((<span class="number">64</span>,<span class="number">3</span>,<span class="number">32</span>,<span class="number">32</span>))</span><br><span class="line">output = myconv(<span class="built_in">input</span>)</span><br><span class="line"><span class="built_in">print</span>(output.shape)</span><br><span class="line">writer = SummaryWriter(<span class="string">&quot;../log&quot;</span>)</span><br><span class="line">writer.add_graph(myconv,<span class="built_in">input</span>)</span><br><span class="line">writer.close()</span><br></pre></td></tr></table></figure>
<h2 id="2-损失函数和反向传播"><a href="#2-损失函数和反向传播" class="headerlink" title="2. 损失函数和反向传播"></a>2. 损失函数和反向传播</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用Sequential</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">M</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.model1 = nn.Sequential(</span><br><span class="line">            nn.Conv2d(<span class="number">3</span>,<span class="number">32</span>,<span class="number">5</span>,padding=<span class="number">2</span>),</span><br><span class="line">            nn.MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            nn.Conv2d(<span class="number">32</span>, <span class="number">32</span>, <span class="number">5</span>, padding=<span class="number">2</span>),</span><br><span class="line">            nn.MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            nn.Conv2d(<span class="number">32</span>, <span class="number">64</span>, <span class="number">5</span>, padding=<span class="number">2</span>),</span><br><span class="line">            nn.MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            nn.Flatten(),</span><br><span class="line">            nn.Linear(<span class="number">1024</span>,<span class="number">64</span>),</span><br><span class="line">            nn.Linear(<span class="number">64</span>,<span class="number">10</span>)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        x = self.model1(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dataset_transform = torchvision.transforms.Compose([</span><br><span class="line">    torchvision.transforms.ToTensor()</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">train_set = torchvision.datasets.CIFAR10(root=<span class="string">&quot;../data&quot;</span>,</span><br><span class="line">                                         train=<span class="literal">True</span>,</span><br><span class="line">                                         download=<span class="literal">True</span>,</span><br><span class="line">                                         transform=dataset_transform)</span><br><span class="line"><span class="comment">#设置数据集train_set，每次取4条数据，打乱顺序，使用主线程运行，不舍弃剩余的数据</span></span><br><span class="line">train_load =  DataLoader(dataset=train_set,batch_size=<span class="number">64</span>,shuffle=<span class="literal">True</span>,num_workers=<span class="number">0</span>,drop_last=<span class="literal">False</span>)</span><br><span class="line"><span class="comment">#损失函数CrossEntropyLoss</span></span><br><span class="line">loss = nn.CrossEntropyLoss()</span><br><span class="line">cifarnet = M()</span><br><span class="line"><span class="comment">#优化器SGD</span></span><br><span class="line">optim = torch.optim.SGD(cifarnet.parameters(),lr=<span class="number">0.01</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    running_loss = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> train_load:</span><br><span class="line">        imgs,tags = data</span><br><span class="line">        outputs = cifarnet(imgs)</span><br><span class="line">        <span class="comment">#计算损失</span></span><br><span class="line">        lossvalue = loss(outputs,tags)</span><br><span class="line">        <span class="comment">#每次将optim梯度重置为0</span></span><br><span class="line">        optim.zero_grad()</span><br><span class="line">        <span class="comment">#反向传播</span></span><br><span class="line">        lossvalue.backward()</span><br><span class="line">        <span class="comment">#参数优化</span></span><br><span class="line">        optim.step()</span><br><span class="line">        running_loss = running_loss+lossvalue</span><br><span class="line">    <span class="built_in">print</span>(running_loss)</span><br></pre></td></tr></table></figure>
<h1 id="三-VGG迁移学习cifar-10"><a href="#三-VGG迁移学习cifar-10" class="headerlink" title="三. VGG迁移学习cifar-10"></a>三. VGG迁移学习cifar-10</h1><h2 id="1-获取vgg16对象"><a href="#1-获取vgg16对象" class="headerlink" title="1. 获取vgg16对象"></a>1. 获取vgg16对象</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="comment">#不使用预训练参数</span></span><br><span class="line">vgg16_false = torchvision.models.vgg16(pretrained=<span class="literal">False</span>)</span><br><span class="line"><span class="comment">#使用预训练参数</span></span><br><span class="line">vgg16_true = torchvision.models.vgg16(pretrained=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/2022/05/24/pytorch01/4.png" alt="image-20220527110226236"></p>
<h2 id="2-修改vgg16网络结构"><a href="#2-修改vgg16网络结构" class="headerlink" title="2. 修改vgg16网络结构"></a>2. 修改vgg16网络结构</h2><ul>
<li>在最后添加一层全连接层</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">vgg16_false = torchvision.models.vgg16(pretrained=<span class="literal">False</span>)</span><br><span class="line">vgg16_true = torchvision.models.vgg16(pretrained=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"><span class="comment">#在最后添加一层全连接层</span></span><br><span class="line">vgg16_false.classifier.add_module(<span class="string">&quot;add_linear&quot;</span>,nn.Linear(<span class="number">1000</span>,<span class="number">10</span>))</span><br></pre></td></tr></table></figure>
<p><img src="/2022/05/24/pytorch01/5.png" alt="image-20220527110458303"></p>
<ul>
<li>修改最后一层全连接层为4069 - 10</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">vgg16_false = torchvision.models.vgg16(pretrained=<span class="literal">False</span>)</span><br><span class="line">vgg16_true = torchvision.models.vgg16(pretrained=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"><span class="comment">#在最后添加一层全连接层</span></span><br><span class="line"><span class="comment"># vgg16_false.classifier.add_module(&quot;add_linear&quot;,nn.Linear(1000,10))</span></span><br><span class="line"><span class="comment">#修改最后一层全连接层为4069 - 10</span></span><br><span class="line">vgg16_false.classifier[<span class="number">6</span>] = nn.Linear(<span class="number">4069</span>,<span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/2022/05/24/pytorch01/6.png" alt="image-20220527110647330"></p>
<h1 id="四、模型的保存和加载"><a href="#四、模型的保存和加载" class="headerlink" title="四、模型的保存和加载"></a>四、模型的保存和加载</h1><h2 id="方法一：保存网络结构和参数"><a href="#方法一：保存网络结构和参数" class="headerlink" title="方法一：保存网络结构和参数"></a>方法一：保存网络结构和参数</h2><h3 id="保存"><a href="#保存" class="headerlink" title="保存"></a>保存</h3><ul>
<li>torch.save(网络模型,”保存文件名”)</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"></span><br><span class="line">vgg16 = torchvision.models.vgg16(pretrained=<span class="literal">True</span>)</span><br><span class="line"><span class="comment">#方式一</span></span><br><span class="line">torch.save(vgg16,<span class="string">&quot;vgg16_method1.pth&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="加载"><a href="#加载" class="headerlink" title="加载"></a>加载</h3><ul>
<li>torch.load(“文件名称”)</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">model = torch.load(<span class="string">&quot;vgg16_method1.pth&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(model)</span><br></pre></td></tr></table></figure>
<h2 id="方法二：仅保存网络参数（推荐）"><a href="#方法二：仅保存网络参数（推荐）" class="headerlink" title="方法二：仅保存网络参数（推荐）"></a>方法二：仅保存网络参数（推荐）</h2><h3 id="保存-1"><a href="#保存-1" class="headerlink" title="保存"></a>保存</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#方式二：仅保存参数</span></span><br><span class="line">torch.save(vgg16.state_dict(),<span class="string">&quot;vgg16_method2.pth&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="加载-1"><a href="#加载-1" class="headerlink" title="加载"></a>加载</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#方式二</span></span><br><span class="line">vggfalse = torchvision.models.vgg16(pretrained=<span class="literal">False</span>)</span><br><span class="line">vggfalse.load_state_dict(torch.load(<span class="string">&quot;vgg16_method2.pth&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(vggfalse)</span><br></pre></td></tr></table></figure>
<h1 id="五、完整的训练过程"><a href="#五、完整的训练过程" class="headerlink" title="五、完整的训练过程"></a>五、完整的训练过程</h1><h2 id="1-获取数据集"><a href="#1-获取数据集" class="headerlink" title="1. 获取数据集"></a>1. 获取数据集</h2><h2 id="2-构建神经网络"><a href="#2-构建神经网络" class="headerlink" title="2. 构建神经网络"></a>2. 构建神经网络</h2><h2 id="3-定义训练参数，loss方法，优化器"><a href="#3-定义训练参数，loss方法，优化器" class="headerlink" title="3. 定义训练参数，loss方法，优化器"></a>3. 定义训练参数，loss方法，优化器</h2><h2 id="4-测试"><a href="#4-测试" class="headerlink" title="4. 测试"></a>4. 测试</h2><p><strong>计算正确率: </strong></p>
<ol>
<li><p>torch类型argmax(int参数)</p>
<p>参数为1：返回每一行的最大值的下标列表</p>
<p>参数为0：返回每一列的最大值的下标列表</p>
</li>
<li><p>torch类型==torch类型：会返回一个True和False的tensor</p>
<p>(torch1==torch2).sum()，获取相同值的的数量</p>
</li>
</ol>
<h2 id="cifar10模板"><a href="#cifar10模板" class="headerlink" title="cifar10模板"></a>cifar10模板</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#准备数据集</span></span><br><span class="line">dataset_transform = torchvision.transforms.Compose([</span><br><span class="line">    torchvision.transforms.ToTensor()</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">train_set = torchvision.datasets.CIFAR10(root=<span class="string">&quot;../data&quot;</span>,</span><br><span class="line">                                         train=<span class="literal">True</span>,</span><br><span class="line">                                         download=<span class="literal">True</span>,</span><br><span class="line">                                         transform=dataset_transform)</span><br><span class="line">test_set = torchvision.datasets.CIFAR10(root=<span class="string">&quot;../data&quot;</span>,</span><br><span class="line">                                        train=<span class="literal">False</span>,</span><br><span class="line">                                        download=<span class="literal">True</span>,</span><br><span class="line">                                        transform=dataset_transform)</span><br><span class="line"><span class="comment">#设置数据集test_set，每次取4条数据，打乱顺序，使用主线程运行，不舍弃剩余的数据</span></span><br><span class="line">train_load =  DataLoader(dataset=train_set,batch_size=<span class="number">64</span>,shuffle=<span class="literal">True</span>,num_workers=<span class="number">0</span>,drop_last=<span class="literal">False</span>)</span><br><span class="line">test_load =  DataLoader(dataset=test_set,batch_size=<span class="number">64</span>,shuffle=<span class="literal">True</span>,num_workers=<span class="number">0</span>,drop_last=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">train_len = <span class="built_in">len</span>(train_set)</span><br><span class="line">test_len = <span class="built_in">len</span>(test_set)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#构建网络</span></span><br><span class="line"><span class="comment">#使用Sequential</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">M</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.model1 = nn.Sequential(</span><br><span class="line">            nn.Conv2d(<span class="number">3</span>,<span class="number">32</span>,<span class="number">5</span>,padding=<span class="number">2</span>),</span><br><span class="line">            nn.MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            nn.Conv2d(<span class="number">32</span>, <span class="number">32</span>, <span class="number">5</span>, padding=<span class="number">2</span>),</span><br><span class="line">            nn.MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            nn.Conv2d(<span class="number">32</span>, <span class="number">64</span>, <span class="number">5</span>, padding=<span class="number">2</span>),</span><br><span class="line">            nn.MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            nn.Flatten(),</span><br><span class="line">            nn.Linear(<span class="number">1024</span>,<span class="number">64</span>),</span><br><span class="line">            nn.Linear(<span class="number">64</span>,<span class="number">10</span>)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        x = self.model1(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="comment">#训练</span></span><br><span class="line"><span class="comment">#损失函数CrossEntropyLoss</span></span><br><span class="line">loss = nn.CrossEntropyLoss()</span><br><span class="line">cifarnet = M()</span><br><span class="line"><span class="comment">#优化器SGD</span></span><br><span class="line">optim = torch.optim.SGD(cifarnet.parameters(),lr=<span class="number">0.01</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#SummaryWriter 记录损失变化</span></span><br><span class="line">writer = SummaryWriter(<span class="string">&quot;../log&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#训练次数定义</span></span><br><span class="line">total_train_step = <span class="number">0</span></span><br><span class="line"><span class="comment">#测试次数定义</span></span><br><span class="line">total_test_step = <span class="number">0</span></span><br><span class="line"><span class="comment">#训练轮次</span></span><br><span class="line">epoch = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(epoch):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;------------第&#123;&#125;论训练开始------------&quot;</span>.<span class="built_in">format</span>(i))</span><br><span class="line">    <span class="comment">#训练开始</span></span><br><span class="line">    cifarnet.train()</span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> train_load:</span><br><span class="line">        imgs,tags = data</span><br><span class="line">        outputs = cifarnet(imgs)</span><br><span class="line">        <span class="comment">#计算损失</span></span><br><span class="line">        lossvalue = loss(outputs,tags)</span><br><span class="line">        <span class="comment">#每次将optim梯度重置为0</span></span><br><span class="line">        optim.zero_grad()</span><br><span class="line">        <span class="comment">#反向传播</span></span><br><span class="line">        lossvalue.backward()</span><br><span class="line">        <span class="comment">#参数优化</span></span><br><span class="line">        optim.step()</span><br><span class="line">        writer.add_scalar(<span class="string">&quot;train&quot;</span>,lossvalue,total_train_step)</span><br><span class="line">        <span class="keyword">if</span>(total_train_step%<span class="number">100</span> == <span class="number">0</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;训练次数：&#123;&#125;，loss:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(total_train_step,lossvalue.item()))</span><br><span class="line">        total_train_step = total_train_step+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#测试开始</span></span><br><span class="line">    cifarnet.<span class="built_in">eval</span>()</span><br><span class="line">    <span class="comment"># 每训练一个轮次进行测试，不进行梯度计算</span></span><br><span class="line">    total_test_loss = <span class="number">0</span></span><br><span class="line">    <span class="comment"># 统计预测正确的数量</span></span><br><span class="line">    test_true_num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        <span class="keyword">for</span> data <span class="keyword">in</span> test_load:</span><br><span class="line">            imgs,tags = data</span><br><span class="line">            outputs = cifarnet(imgs)</span><br><span class="line">            <span class="comment">#计算预测正确的标签数</span></span><br><span class="line">            test_true_num = test_true_num + (outputs.argmax(<span class="number">1</span>)==tags).<span class="built_in">sum</span>()</span><br><span class="line">            lossvalue = loss(outputs,tags)</span><br><span class="line">            total_test_loss = total_test_loss+lossvalue</span><br><span class="line">    writer.add_scalar(<span class="string">&quot;test&quot;</span>,total_test_loss,total_test_step)</span><br><span class="line">    total_test_step = total_test_step+<span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;整体测试集loss:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(total_test_loss))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;整体测试集正确率:&#123;&#125;%&quot;</span>.<span class="built_in">format</span>(test_true_num/test_len)*<span class="number">100</span>)</span><br><span class="line">    torch.save(cifarnet,<span class="string">&quot;cifar10_&#123;&#125;.pth&quot;</span>.<span class="built_in">format</span>(i))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;模型以保存&quot;</span>)</span><br><span class="line">writer.close()</span><br></pre></td></tr></table></figure>
<h1 id="六、GPU训练"><a href="#六、GPU训练" class="headerlink" title="六、GPU训练"></a>六、GPU训练</h1><h2 id="方法一："><a href="#方法一：" class="headerlink" title="方法一："></a>方法一：</h2><p><img src="/2022/05/24/pytorch01/7.png" alt="image-20220527121953043"></p>
<p>网络模型，数据，损失函数调用.cuda（）方法</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#损失函数CrossEntropyLoss</span></span><br><span class="line">loss = nn.CrossEntropyLoss()</span><br><span class="line">loss = loss.cuda()</span><br><span class="line"><span class="comment">#网络模型</span></span><br><span class="line">cifarnet = M()</span><br><span class="line">cifarnet = cifarnet.cuda()</span><br><span class="line"><span class="comment">#数据</span></span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> train_load:</span><br><span class="line">    imgs,tags = data</span><br><span class="line">    imgs = imgs.cuda()</span><br><span class="line">    tags = tags.cuda()</span><br></pre></td></tr></table></figure>
<h2 id="方法二："><a href="#方法二：" class="headerlink" title="方法二："></a>方法二：</h2><p><img src="/2022/05/24/pytorch01/8.png" alt="image-20220527123013582"></p>
<p>定义训练的设备</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#显卡运行</span></span><br><span class="line">device = torch.device(<span class="string">&quot;cuda:0&quot;</span>)</span><br><span class="line"><span class="comment">#cpu运行</span></span><br><span class="line">device = torch.device(<span class="string">&quot;cpu&quot;</span>)</span><br><span class="line"></span><br><span class="line">将训练中的网络模型，数据，损失函数调用todevice(device)方法使用指定设备训练</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">model = model.to(device)</span><br><span class="line">loss_fn = loss_fn.to(device)</span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> train_dataloader:</span><br><span class="line">    imgs, targets = data</span><br><span class="line">    imgs = imgs.to(device)</span><br><span class="line">    targets = targets.to(device)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>pytorch</category>
      </categories>
      <tags>
        <tag>pytorch</tag>
      </tags>
  </entry>
  <entry>
    <title>servlet-1</title>
    <url>/2021/12/02/servlet-1/</url>
    <content><![CDATA[<h3 id="一、servlet基础"><a href="#一、servlet基础" class="headerlink" title="一、servlet基础"></a>一、servlet基础</h3><p>servlet : server applet</p>
<ul>
<li><p>概念∶运行在服务器端的小程序</p>
</li>
<li><p>Servlet就是一个接口，定义了Java类被浏览器访问到(tomcat识别)的规则。*将来我们自定义一个类，实现servlet接口，复写方法。</p>
</li>
</ul>
<h5 id="1-快速入门∶"><a href="#1-快速入门∶" class="headerlink" title="1. 快速入门∶"></a>1. 快速入门∶</h5><p>1．创建avaEE项目</p>
<p>2．定义一个类，实现servlet接口</p>
<p>3．实现接口中的抽象方法</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class servlet_demo1 implements Servlet &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void init(ServletConfig servletConfig) throws ServletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public ServletConfig getServletConfig() &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void service(ServletRequest servletRequest, ServletResponse servletResponse) throws ServletException, IOException &#123;</span><br><span class="line">        System.out.println(&quot;dddd&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String getServletInfo() &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void destroy() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4．配置servlet</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">web.xml</span><br><span class="line">&lt;!--配置servlet--&gt;</span><br><span class="line">    &lt;servlet&gt;</span><br><span class="line">        &lt;servlet-name&gt;demo1&lt;/servlet-name&gt;</span><br><span class="line">        &lt;servlet-class&gt;first_test.servlet_demo1&lt;/servlet-class&gt;</span><br><span class="line">    &lt;/servlet&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;servlet-mapping&gt;</span><br><span class="line">        &lt;servlet-name&gt;demo1&lt;/servlet-name&gt;</span><br><span class="line">        &lt;url-pattern&gt;/first&lt;/url-pattern&gt;</span><br><span class="line">    &lt;/servlet-mapping&gt;</span><br></pre></td></tr></table></figure>
<p>执行原理︰</p>
<ol>
<li><p>当服务器接受到客户端浏览器的请求后，会解析请求URL路径，获取访问的servlet的资源路径</p>
</li>
<li><p>查找web.xml文件，是否有对应的<url-pattern>标签体内容。</url-pattern></p>
</li>
<li><p>如果有，则在找到对应的<servlet-class>全类名</servlet-class></p>
</li>
<li><p>tomcat会将字节码文件加载进内存，并且创建其对象</p>
</li>
<li><p>调用其方法</p>
</li>
</ol>
<ul>
<li><p>servlet中的生命周期︰</p>
<p>1．被创建:执行init方法，只执行一次</p>
<ul>
<li><p>可以通过web.xml配置调用时间 </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>标签值为负数或不写，则是第一次被访问时创建。</span><br><span class="line">    				0或正数是服务器启动时创建</span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>demo1<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>first_test.servlet_demo1<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>5<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Servlet是单例的，所以当多个用户同时访问时可能出安全问题。</p>
<p>解决方法：</p>
<ul>
<li>尽量不在Servlet类中定义成员变量。</li>
<li>定义了也不要在其中修改值。</li>
</ul>
</li>
</ul>
<p>2．提供服务:执行service方法，执行多次</p>
<ul>
<li>每次访问，执行一次</li>
</ul>
<p>3．被销毁:执行destroy方法，执行一次</p>
<ul>
<li>servlet被销毁时执行。服务器关闭，servlet销毁。</li>
<li>只有服务器正常关闭，才会执行destroy。</li>
<li>通常用于释放资源。</li>
</ul>
</li>
</ul>
<h5 id="2-servlet3-0"><a href="#2-servlet3-0" class="headerlink" title="2. servlet3.0"></a>2. servlet3.0</h5><ul>
<li><p>好处</p>
<ul>
<li><p>支持注解配置。可以不需要在web.xml中配置servlet了</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">*步骤︰</span><br><span class="line"></span><br><span class="line">1．创建JavaEE项目，选择servlet的版本3.0以上，可以不创建web.xml</span><br><span class="line">2．定义一个类，实现servlet接口</span><br><span class="line">3．复写方法</span><br><span class="line">4.在类上使用@WebServlet注解，进行配置</span><br><span class="line"></span><br><span class="line">@WebServlet(urlPatterns = &#123;&quot;/login&quot;&#125;)</span><br><span class="line">或者</span><br><span class="line">@WebServlet(&#123;&quot;/login&quot;&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h5 id="3-idea与tomcat相关配置"><a href="#3-idea与tomcat相关配置" class="headerlink" title="3. idea与tomcat相关配置"></a>3. idea与tomcat相关配置</h5><ul>
<li>idea运行会为每一个项目单独建立配置文件：路径在每次启动显示（如下）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Using CATALINA_BASE:   &quot;C:\Users\lixu\.IntelliJIdea2018.3\system\tomcat\Tomcat_9_0_55_java_web_2&quot;</span><br></pre></td></tr></table></figure>
<p>通过idea使用 edit configurations 配置</p>
<ul>
<li>tomcat部署的项目和idea中的不一样</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">！！！tomcat部署的项目在out文件目录下</span><br></pre></td></tr></table></figure>
<ul>
<li>WEB-INF目录下文件不能被浏览器直接访问</li>
</ul>
]]></content>
      <categories>
        <category>servlet</category>
      </categories>
      <tags>
        <tag>servlet入门</tag>
      </tags>
  </entry>
  <entry>
    <title>servlet-2</title>
    <url>/2021/12/03/servlet-2/</url>
    <content><![CDATA[<h3 id="一、servlet继承体系结构"><a href="#一、servlet继承体系结构" class="headerlink" title="一、servlet继承体系结构"></a>一、servlet继承体系结构</h3><h5 id="1-servlet接口继承结构"><a href="#1-servlet接口继承结构" class="headerlink" title="1. servlet接口继承结构"></a>1. servlet接口继承结构</h5><p>接口：servlet（一般不用）</p>
<p>⬆  </p>
<p>抽象类：GenericServlet（一般不用）</p>
<p>⬆</p>
<p>抽象类：HttpServlet（推荐使用）</p>
<ul>
<li>GenericServlet<ul>
<li>（做了除了service方法外的空实现，如果继承GenericServlet则只用重写service方法）</li>
</ul>
</li>
<li>HttpServlet（http请求方式有post和get两种，HttpServlet对其进行了区别）<ul>
<li>重写了service方法，判断是http请求方式是post还是get，并调用doGet()和doPost()处理</li>
<li>不用再重写service方法判断http请求方式</li>
<li>直接重写doGet()和doPost()</li>
</ul>
</li>
</ul>
<h5 id="2-servlet相关配置"><a href="#2-servlet相关配置" class="headerlink" title="2. servlet相关配置"></a>2. servlet相关配置</h5><ol>
<li><p>urlpartten: servlet访问路径</p>
<ol>
<li>一个servlet可以定义多个访问路径︰ @webServlet({“/d4” , “ /dd4” , “ /ddd4”})</li>
<li>路径定义规则:<ol>
<li>/xxx</li>
<li>/ xxx/xxx:多层路径，目录结构</li>
<li>*.do</li>
</ol>
</li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>servlet</category>
      </categories>
      <tags>
        <tag>servlet学习</tag>
      </tags>
  </entry>
  <entry>
    <title>瑞吉外卖项目01</title>
    <url>/2022/05/10/reggieproject01/</url>
    <content><![CDATA[<h1 id="一、登录"><a href="#一、登录" class="headerlink" title="一、登录"></a>一、登录</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">需求</span><br><span class="line">* 1、将页面提交的密码password进行md5加密处理</span><br><span class="line">* 2、根据页面提交的用户名username查询数据库</span><br><span class="line">* 3、如果没有查询到则返回登录失败结果</span><br><span class="line">* 4、密码比对，如果不一致则返回登录失败结果</span><br><span class="line">* 5、查看员工状态，如果为已禁用状态，则返回员工已禁用结果</span><br><span class="line">* 6、登录成功，将员工id存入Session并返回登录成功结果</span><br></pre></td></tr></table></figure>
<h2 id="1-基础登录逻辑"><a href="#1-基础登录逻辑" class="headerlink" title="1. 基础登录逻辑"></a>1. 基础登录逻辑</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="comment">//接收前端json数据需要加注解@RequestBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R&lt;Employee&gt; <span class="title">Login</span><span class="params">(HttpServletRequest request,<span class="meta">@RequestBody</span> Employee employee)</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1、将页面提交的密码password进行md5加密处理</span></span><br><span class="line"><span class="comment">     * 2、根据页面提交的用户名username查询数据库</span></span><br><span class="line"><span class="comment">     * 3、如果没有查询到则返回登录失败结果</span></span><br><span class="line"><span class="comment">     * 4、密码比对，如果不一致则返回登录失败结果</span></span><br><span class="line"><span class="comment">     * 5、查看员工状态，如果为已禁用状态，则返回员工已禁用结果</span></span><br><span class="line"><span class="comment">     * 6、登录成功，将员工id存入Session并返回登录成功结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//1、将页面提交的密码password进行md5加密处理</span></span><br><span class="line">    String password = employee.getPassword();</span><br><span class="line">    password = DigestUtils.md5DigestAsHex(password.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">    <span class="comment">//2、根据页面提交的用户名username查询数据库</span></span><br><span class="line">    LambdaQueryWrapper&lt;Employee&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(Employee::getUsername,employee.getUsername());</span><br><span class="line">    Employee empUser = employeeService.getOne(queryWrapper);</span><br><span class="line">    <span class="comment">//3、如果没有查询到则返回登录失败结果</span></span><br><span class="line">    <span class="keyword">if</span>(empUser==<span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;登陆失败！用户不存在！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//4、密码比对，如果不一致则返回登录失败结果</span></span><br><span class="line">    <span class="keyword">if</span>(!empUser.getPassword().equals(password))&#123;</span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;登录失败！密码错误！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//5、查看员工状态，如果为已禁用状态，则返回员工已禁用结果</span></span><br><span class="line">    <span class="comment">// 0 表示禁用，1表示可用</span></span><br><span class="line">    <span class="keyword">if</span>(empUser.getStatus()==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;登录失败！账号禁用！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6、登录成功，将员工id存入Session并返回登录成功结果</span></span><br><span class="line">    request.getSession().setAttribute(<span class="string">&quot;employee&quot;</span>,empUser.getId());</span><br><span class="line">    <span class="keyword">return</span> R.success(empUser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-添加过滤器检验是否登录"><a href="#2-添加过滤器检验是否登录" class="headerlink" title="2. 添加过滤器检验是否登录"></a>2. 添加过滤器检验是否登录</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebFilter(filterName = &quot;loginCheckFilter&quot;,urlPatterns = &quot;/*&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginCheckFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="comment">//路径匹配器 ，支持通配符</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> AntPathMatcher PATH_MATCHER = <span class="keyword">new</span> AntPathMatcher();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        <span class="comment">//定义不需要拦截的uri数组</span></span><br><span class="line">        String[] excludeUri = <span class="keyword">new</span> String[]&#123;</span><br><span class="line">                <span class="string">&quot;/employee/login/**&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/employee/logout&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/backend/**&quot;</span></span><br><span class="line">        &#125;;</span><br><span class="line">        HttpServletRequest request = (HttpServletRequest) servletRequest;</span><br><span class="line">        HttpServletResponse response = (HttpServletResponse) servletResponse;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. 获取拦截请求</span></span><br><span class="line">        String requestURI = request.getRequestURI();</span><br><span class="line">        <span class="comment">// 2. 判断是否需要拦截</span></span><br><span class="line">        <span class="keyword">boolean</span> check = check(excludeUri, requestURI);</span><br><span class="line">        <span class="comment">// 3. 不需要处理则直接放行</span></span><br><span class="line">        <span class="keyword">if</span>(check)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;无需处理请求:&#123;&#125;&quot;</span>,request.getRequestURI());</span><br><span class="line">            filterChain.doFilter(request,response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4. 如果需要处理，则判断用户是否登录</span></span><br><span class="line">        <span class="comment">// 登录了直接放行</span></span><br><span class="line">        <span class="keyword">if</span>(request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>)!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;用户已登录-请求:&#123;&#125;&quot;</span>,request.getRequestURI());</span><br><span class="line">            filterChain.doFilter(request,response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果未登录</span></span><br><span class="line">        log.info(<span class="string">&quot;未登录-拦截请求:&#123;&#125;&quot;</span>,request.getRequestURI());</span><br><span class="line">        response.getWriter().write(JSON.toJSONString(R.error(<span class="string">&quot;NOTLOGIN&quot;</span>)));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 进行路径过滤匹配</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> urls</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> requestURI</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">check</span><span class="params">(String[] urls, String requestURI)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (String url : urls) &#123;</span><br><span class="line">            <span class="keyword">boolean</span> match = PATH_MATCHER.match(url, requestURI);</span><br><span class="line">            <span class="keyword">if</span>(match)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="二、添加员工"><a href="#二、添加员工" class="headerlink" title="二、添加员工"></a>二、添加员工</h1><p>添加员工时除了用户填写的信息，还要设置时间，默认初始密码等信息</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 新增员工</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> employee</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R&lt;String&gt; <span class="title">save</span><span class="params">(HttpServletRequest request,<span class="meta">@RequestBody</span> Employee employee)</span></span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;新增员工：&#123;&#125;&quot;</span>,employee.toString());</span><br><span class="line">    <span class="comment">//设置初始密码123456，并进行MD5加密</span></span><br><span class="line">    employee.setPassword(DigestUtils.md5DigestAsHex(<span class="string">&quot;123456&quot;</span>.getBytes(StandardCharsets.UTF_8)));</span><br><span class="line">    employee.setCreateTime(<span class="keyword">new</span> Date());</span><br><span class="line">    employee.setUpdateTime(<span class="keyword">new</span> Date());</span><br><span class="line">    <span class="comment">//设置创建，修改用户id</span></span><br><span class="line">    Long userid = (Long) request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>);</span><br><span class="line">    employee.setCreateUser(userid);</span><br><span class="line">    employee.setUpdateUser(userid);</span><br><span class="line">    employeeService.save(employee);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;新增成功！&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>新增员工时如果用户名重复则会抛出异常</p>
<p>这里我们选择使用全局异常对它进行处理</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice(annotations = &#123;RestController.class, Controller.class&#125;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ExceptionHandler(SQLIntegrityConstraintViolationException.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R&lt;String&gt; <span class="title">exceptionHandler</span><span class="params">(SQLIntegrityConstraintViolationException exception)</span> </span>&#123;</span><br><span class="line">        log.error(exception.getMessage());</span><br><span class="line">        <span class="keyword">if</span>(exception.getMessage().contains(<span class="string">&quot;Duplicate entry&quot;</span>))&#123;</span><br><span class="line">            String repeat = exception.getMessage().split(<span class="string">&quot; &quot;</span>)[<span class="number">2</span>];</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;用户名&quot;</span>+repeat+<span class="string">&quot;已存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;操作失败！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="三、员工分页查询"><a href="#三、员工分页查询" class="headerlink" title="三、员工分页查询"></a>三、员工分页查询</h1><h2 id="1-添加mybatis-plus分页配置"><a href="#1-添加mybatis-plus分页配置" class="headerlink" title="1. 添加mybatis-plus分页配置"></a>1. 添加mybatis-plus分页配置</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;cn.hestialx.reggie_project.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisPlusConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MybatisPlusInterceptor <span class="title">mybatisPlusInterceptor</span><span class="params">()</span></span>&#123;</span><br><span class="line">        MybatisPlusInterceptor Interceptor = <span class="keyword">new</span> MybatisPlusInterceptor();</span><br><span class="line">        <span class="comment">//配置分页插件</span></span><br><span class="line">        Interceptor.addInnerInterceptor(<span class="keyword">new</span> PaginationInnerInterceptor(DbType.MYSQL));</span><br><span class="line">        <span class="keyword">return</span> Interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-编写分页controller"><a href="#2-编写分页controller" class="headerlink" title="2. 编写分页controller"></a>2. 编写分页controller</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R&lt;Page&gt; <span class="title">pageFindUser</span><span class="params">(EmployeeQuery employeeQuery)</span></span>&#123;</span><br><span class="line">    Page&lt;Employee&gt; employeePage = <span class="keyword">new</span> Page&lt;&gt;();</span><br><span class="line">    employeePage.setCurrent(employeeQuery.getPage());</span><br><span class="line">    employeePage.setSize(employeeQuery.getPageSize());</span><br><span class="line">    <span class="keyword">if</span>(employeeQuery.getName()!=<span class="keyword">null</span>)&#123;</span><br><span class="line">        LambdaQueryWrapper&lt;Employee&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">        queryWrapper.like(Employee::getName,employeeQuery.getName());</span><br><span class="line">        employeeService.page(employeePage, queryWrapper);</span><br><span class="line">        <span class="keyword">return</span> R.success(employeePage);</span><br><span class="line">    &#125;</span><br><span class="line">    employeeService.page(employeePage);</span><br><span class="line">    <span class="keyword">return</span> R.success(employeePage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="四、启用或者禁用员工账号"><a href="#四、启用或者禁用员工账号" class="headerlink" title="四、启用或者禁用员工账号"></a>四、启用或者禁用员工账号</h1><h2 id="分析："><a href="#分析：" class="headerlink" title="分析："></a>分析：</h2><p>启用或者禁用用户实际上是修改用户，因此可以编写一个修改用户的通用controller来实现该功能</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R&lt;String&gt; <span class="title">update</span><span class="params">(HttpServletRequest request,<span class="meta">@RequestBody</span> Employee employee)</span></span>&#123;</span><br><span class="line">    log.info(employee.toString());</span><br><span class="line">    employee.setUpdateTime(<span class="keyword">new</span> Date());</span><br><span class="line">    employee.setUpdateUser((Long)request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>));</span><br><span class="line">    employeeService.updateById(employee);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;员工信息修改成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="问题：这样编写修改失败"><a href="#问题：这样编写修改失败" class="headerlink" title="问题：这样编写修改失败"></a>问题：这样编写修改失败</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator">=</span><span class="operator">=</span><span class="operator">&gt;</span>  Preparing: UPDATE employee <span class="keyword">SET</span> status<span class="operator">=</span>?, update_time<span class="operator">=</span>?, update_user<span class="operator">=</span>? <span class="keyword">WHERE</span> id<span class="operator">=</span>?</span><br><span class="line"><span class="operator">=</span><span class="operator">=</span><span class="operator">&gt;</span> Parameters: <span class="number">0</span>(<span class="type">Integer</span>), <span class="number">2022</span><span class="number">-05</span><span class="number">-11</span> <span class="number">21</span>:<span class="number">00</span>:<span class="number">10.916</span>(<span class="type">Timestamp</span>), <span class="number">1</span>(Long), <span class="number">1524009808844914700</span>(Long)</span><br><span class="line"><span class="operator">&lt;=</span><span class="operator">=</span>    Updates: <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>仔细观察发现，id与数据库中不一致</p>
<p>原因：</p>
<ul>
<li>这js数据精度的问题，雪花算法生成的19位的long数组太大，超过了js的数据范围</li>
</ul>
<p>解决办法：</p>
<ul>
<li>我们可以在服务端给页面响应json数据时进行处理，将long型数据统一转为String字符串</li>
</ul>
<h2 id="添加json数据映射器"><a href="#添加json数据映射器" class="headerlink" title="添加json数据映射器"></a>添加json数据映射器</h2><p>1）提供对象转换器JacksonObjectMapper，基于Jackson进行Java对象到json数据的转换</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对象映射器:基于jackson将Java对象转为json，或者将json转为Java对象</span></span><br><span class="line"><span class="comment"> * 将JSON解析为Java对象的过程称为 [从JSON反序列化Java对象]</span></span><br><span class="line"><span class="comment"> * 从Java对象生成JSON的过程称为 [序列化Java对象到JSON]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JacksonObjectMapper</span> <span class="keyword">extends</span> <span class="title">ObjectMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_DATE_FORMAT = <span class="string">&quot;yyyy-MM-dd&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_DATE_TIME_FORMAT = <span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_TIME_FORMAT = <span class="string">&quot;HH:mm:ss&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JacksonObjectMapper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="comment">//收到未知属性时不报异常</span></span><br><span class="line">        <span class="keyword">this</span>.configure(FAIL_ON_UNKNOWN_PROPERTIES, <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//反序列化时，属性不存在的兼容处理</span></span><br><span class="line">        <span class="keyword">this</span>.getDeserializationConfig().withoutFeatures(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        SimpleModule simpleModule = <span class="keyword">new</span> SimpleModule()</span><br><span class="line">                .addDeserializer(LocalDateTime.class, <span class="keyword">new</span> LocalDateTimeDeserializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT)))</span><br><span class="line">                .addDeserializer(LocalDate.class, <span class="keyword">new</span> LocalDateDeserializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT)))</span><br><span class="line">                .addDeserializer(LocalTime.class, <span class="keyword">new</span> LocalTimeDeserializer(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT)))</span><br><span class="line"></span><br><span class="line">                .addSerializer(BigInteger.class, ToStringSerializer.instance)</span><br><span class="line">                .addSerializer(Long.class, ToStringSerializer.instance)</span><br><span class="line">                .addSerializer(LocalDateTime.class, <span class="keyword">new</span> LocalDateTimeSerializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT)))</span><br><span class="line">                .addSerializer(LocalDate.class, <span class="keyword">new</span> LocalDateSerializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT)))</span><br><span class="line">                .addSerializer(LocalTime.class, <span class="keyword">new</span> LocalTimeSerializer(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//注册功能模块 例如，可以添加自定义序列化器和反序列化器</span></span><br><span class="line">        <span class="keyword">this</span>.registerModule(simpleModule);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2)在WebMvcConfig配置类中扩展Spring mvc的消息转换器，在此消息转换器中使用提供的对象转换器进行Java对象到json数据的转换</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 扩展mvc消息转换器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> converters</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">extendMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//创建消息转换器对象</span></span><br><span class="line">    MappingJackson2HttpMessageConverter messageConverter = <span class="keyword">new</span> MappingJackson2HttpMessageConverter();</span><br><span class="line">    <span class="comment">//设置对象转换器，使用jackson将Java对象转化为json</span></span><br><span class="line">    messageConverter.setObjectMapper(<span class="keyword">new</span> JacksonObjectMapper());</span><br><span class="line">    <span class="comment">//将转换器对象追加到转换器集合中，设置最高优先级0</span></span><br><span class="line">    converters.add(<span class="number">0</span>,messageConverter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="五、编辑员工"><a href="#五、编辑员工" class="headerlink" title="五、编辑员工"></a>五、编辑员工</h1><p>梳理操作过程和对应的程序的执行流程:</p>
<p>1、点击编辑按钮时，页面跳转到add.html，并在url中携带参数[员工id]</p>
<p>2、在add.html页面获取url中的参数[员工id]</p>
<p>3、发送ajax请求，请求服务端，同时提交员工id参数</p>
<p>4、服务端接收请求，根据员工id查询员工信息，将员工信息以json形式响应给页面</p>
<p>5、页面接收服务端响应的json数据，通过VUE的数据绑定进行员工信息回显</p>
<p>6、点击保存按钮，发送ajax请求，将页面中的员工信息以json方式提交给服务端</p>
<p>7、服务端接收员工信息，并进行处理，完成后给页面响应</p>
<p>8、页面接收到服务端响应信息后进行相应处理</p>
<h1 id="六、公共字段的自动填充"><a href="#六、公共字段的自动填充" class="headerlink" title="六、公共字段的自动填充"></a>六、公共字段的自动填充</h1><h2 id="问题分析："><a href="#问题分析：" class="headerlink" title="问题分析："></a>问题分析：</h2><p>​    前面我们已经完成了后台系统的员工管理功能开发，在新增员工时需要设置创建时间、创建人、修改时间、修改人等字段，在编辑员工时需要设置修改时间和修改人等字段。</p>
<p>这些字段属于公共字段，也就是很多表中都有这些字段，如下:</p>
<p>create_time    </p>
<p>update_time</p>
<p>create_user</p>
<p>update_user</p>
<p><strong>能不能对于这些公共字段在某个地方统一处理，来简化开发呢?</strong></p>
<p>答案就是使用Mybatis Plus提供的公共字段自动填充功能。</p>
<h2 id="初步代码实现："><a href="#初步代码实现：" class="headerlink" title="初步代码实现："></a>初步代码实现：</h2><p><strong>Mybatis Plus公共字段自动填充，也就是在插入或者更新的时候为指定字段赋予指定的值，使用它的好处就是可以统一对这些字段进行处理，避免了重复代码。</strong></p>
<p>实现步骤:</p>
<p>1、在实体类的属性上加入@TableField注解，指定自动填充的策略</p>
<p><img src="/2022/05/10/reggieproject01/1.png" alt="image-20220512164049748"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@TableField(fill = FieldFill.DEFAULT)</span> <span class="comment">//默认不处理</span></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT)</span> <span class="comment">//插入时填充</span></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.UPDATE)</span> <span class="comment">//更新时填充</span></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span> <span class="comment">//插入和更新字段时填充</span></span><br></pre></td></tr></table></figure>
<p>2、按照框架要求编写元数据对象处理器，在此类中统一为公共字段赋值，此类需要实现MetaObjectHandler接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义元数据对象处理器</span></span><br><span class="line"><span class="comment"> * 公共字段自动填充</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lixu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-05-12-16:46</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title">MetaObjectHandler</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertFill</span><span class="params">(MetaObject metaObject)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        log.info(&quot;公共字段自动填充【insert】&quot;);</span></span><br><span class="line"><span class="comment">//        log.info(metaObject.toString());</span></span><br><span class="line">        metaObject.setValue(<span class="string">&quot;createTime&quot;</span>,<span class="keyword">new</span> Date());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateTime&quot;</span>,<span class="keyword">new</span> Date());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;createUser&quot;</span>,<span class="number">1L</span>);</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateUser&quot;</span>,<span class="number">1L</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateFill</span><span class="params">(MetaObject metaObject)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        log.info(&quot;公共字段自动填充【insert】&quot;);</span></span><br><span class="line"><span class="comment">//        log.info(metaObject.toString());</span></span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateTime&quot;</span>,<span class="keyword">new</span> Date());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateUser&quot;</span>,<span class="number">1L</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="改进："><a href="#改进：" class="headerlink" title="改进："></a>改进：</h2><p>在上述代码中，我们没有获取当前登录用户id，而是写死了用户id</p>
<p>要对代码进行改进，首先要获取当前登录的用户id。</p>
<h3 id="知识补充："><a href="#知识补充：" class="headerlink" title="知识补充："></a>知识补充：</h3><p>在学习ThreadLocal之前，我们需要先确认一个事情，就是客户端发送的每次http请求，对应的在服务端都会分配一个新的线程来处理，在处理过程中涉及到的方法都属于相同的一个线程:</p>
<p>1、 LoginCheckFilter的doFilter方法</p>
<p>2、EmployeeController的update方法</p>
<p>3、MyMetaObjectHandler的updateFill方法</p>
<p>可以在上面的三个方法中分别加入下面代码（获取当前线程id) :</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">long</span> id = Thread.currentThread().getId() ;</span><br><span class="line">log.info(<span class="string">&quot;线程id:&#123;&#125;&quot;</span>,id) ;</span><br></pre></td></tr></table></figure>
<p>执行编辑员工功能进行验证，通过观察控制台输出可以发现，一次请求对应的线程id是相同的:</p>
<p><img src="/2022/05/10/reggieproject01/2.png" alt="image-20220512172842301"></p>
<h4 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h4><p>什么是ThreadLocal?</p>
<p>ThreadLocal并不是一个Thread，而是Thread的局部变量。当使用ThreadLocal维护变量时，ThreadLocal为每个使用该变量的线程提供独立的变量副本，所以每一个线程都可以独立地改变自己的副本，而不会影响其它线程所对应的副本。ThreadLocal为每个线程提供单独一份存储空间，具有线程隔离的效果，只有在线程内才能获取到对应的值，线程外则不能访问。</p>
<p>ThreadLocal常用方法:<br>线程本地常用方法：</p>
<ul>
<li>public void set(T value)   设置当前线程的线程局部变量的值</li>
</ul>
<ul>
<li>public T get()                     返回当前线程所对应的线程局部变量的值</li>
</ul>
<p>我们可以在LoginCheckFilter的doFilter方法中获取当前登录用户id，并调用ThreadLocal的set方法来设置当前线程的线程局部变量的值（用户id)，然后在MyMetaObjectHandler的updateFill方法中调用ThreadLocal的get方法来获得当前线程所对应的线程局部变量的值(用户id）。</p>
<h3 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤:"></a>实现步骤:</h3><p>1、编写BaseContext工具类，基于ThreadLocal封装的工具类</p>
<p>2、在LoginCheckFilter的doFilter方法中调用BaseContext来设置当前登录用户的id</p>
<p>3、在MyMetaobjectHandler的方法中调用BaseContext获取登录用户的id</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 基于ThreadLocal封装的工具类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lixu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-05-12-17:46</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseContext</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;Long&gt; threadLocal = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setCurrentId</span><span class="params">(Long id)</span></span>&#123;</span><br><span class="line">        threadLocal.set(id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title">getCurrentId</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> threadLocal.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="七、新增分类"><a href="#七、新增分类" class="headerlink" title="七、新增分类"></a>七、新增分类</h1><p>1、页面(backend/page/category/list.html)发送ajax请求，将新增分类窗口输入的数据以json形式提交到服务端</p>
<p>2、服务端Controller接收页面提交的数据并调用Service将数据进行保存</p>
<p>3、Service调用Mapper操作数据库，保存数据</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R&lt;String&gt; <span class="title">save</span><span class="params">(<span class="meta">@RequestBody</span> Category category)</span></span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;category:&#123;&#125;&quot;</span>,category);</span><br><span class="line">    <span class="keyword">boolean</span> result = categoryService.save(category);</span><br><span class="line">    <span class="keyword">if</span>(result)&#123;</span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;新增分类成功&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;新增分类失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="八、菜品分类分页查询"><a href="#八、菜品分类分页查询" class="headerlink" title="八、菜品分类分页查询"></a>八、菜品分类分页查询</h1><p>1、页面发送ajax请求，将分页查询参数(page.pageSize)提交到服务端</p>
<p>2、服务端Controller接收页面提交的数据并调用Service查询数据</p>
<p>3、Service调用Mapper操作数据库，查询分页数据</p>
<p>4、controller将查询到的分页数据响应给页面</p>
<p>5、页面接收到分页数据并通过ElementUl的Table组件展示到页面上</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R&lt;Page&gt; <span class="title">page</span><span class="params">(<span class="keyword">int</span> page, <span class="keyword">int</span> pageSize)</span></span>&#123;</span><br><span class="line">    Page&lt;Category&gt; pageCategory = <span class="keyword">new</span> Page&lt;&gt;();</span><br><span class="line">    LambdaQueryWrapper&lt;Category&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper.orderByAsc(Category::getSort);</span><br><span class="line">    categoryService.page(pageCategory, queryWrapper);</span><br><span class="line">    <span class="keyword">if</span>(pageCategory.getRecords().isEmpty())&#123;</span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;没有数据&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> R.success(pageCategory);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="九、菜品分类删除"><a href="#九、菜品分类删除" class="headerlink" title="九、菜品分类删除"></a>九、菜品分类删除</h1><h2 id="基础需求："><a href="#基础需求：" class="headerlink" title="基础需求："></a>基础需求：</h2><p>在分类管理列表页面，可以对某个分类进行删除操作。需要注意的是当分类关联了菜品或者套餐时，此分类不允许删除。</p>
<p>梳理一下整个程序的执行过程:</p>
<p>1、页面发送ajax请求，将参数(id)提交到服务端</p>
<p>2、服务端Controller接收页面提交的数据并调用Service删除数据</p>
<p>3、Service调用Mapper操作数据库</p>
<p><strong>注意</strong>：这里可以添加is_delete字段，使用@TableLogic注解标注is_delete字段，这样在使用mybatis-plus提供的删除中就不会删除记录而是修改is_delete字段字段值</p>
<ul>
<li>在CategoryServiceImpl中添加自定义的remove方法，删除之前判断是否关联菜品或者套餐</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> DishService dishService;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SetmealService setmealService;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据id删除，删除之前判断是否关联菜品或者套餐</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//判断当前分类是否关联了菜品</span></span><br><span class="line">    LambdaQueryWrapper&lt;Dish&gt; dishQueryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">    dishQueryWrapper.eq(Dish::getCategoryId,id);</span><br><span class="line">    <span class="keyword">long</span> count = dishService.count(dishQueryWrapper);</span><br><span class="line">    <span class="keyword">if</span>(count&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> CustomException(<span class="string">&quot;当前分类关联了菜品，不能删除&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//判断当前分类是否关联了套餐</span></span><br><span class="line">    LambdaQueryWrapper&lt;Setmeal&gt; setmealQueryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">    setmealQueryWrapper.eq(Setmeal::getCategoryId,id);</span><br><span class="line">    <span class="keyword">long</span> count1 = setmealService.count(setmealQueryWrapper);</span><br><span class="line">    <span class="keyword">if</span>(count1&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> CustomException(<span class="string">&quot;当前分类关联了套餐，不能删除&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//都没有关联</span></span><br><span class="line">    <span class="keyword">super</span>.removeById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编写controller</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R&lt;String&gt; <span class="title">delete</span><span class="params">(Long ids)</span></span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;删除分类&quot;</span>);</span><br><span class="line">    categoryService.remove(ids);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;删除成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="十、文件上传下载"><a href="#十、文件上传下载" class="headerlink" title="十、文件上传下载"></a>十、文件上传下载</h1><h2 id="1-文件上传"><a href="#1-文件上传" class="headerlink" title="1. 文件上传"></a>1. 文件上传</h2><h3 id="前端介绍："><a href="#前端介绍：" class="headerlink" title="前端介绍："></a>前端介绍：</h3><p>文件上传时，对页面的form表单有如下要求:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">method=<span class="string">&quot;post&quot;</span>                     采用post方式提交数据</span><br><span class="line"></span><br><span class="line">enctype=<span class="string">&quot;multipart/form-data&quot;</span>     采用multipart格式上传文件</span><br><span class="line"></span><br><span class="line">type=<span class="string">&quot;file&quot;</span>                       使用input的file控件上传</span><br></pre></td></tr></table></figure>
<p>这里我们采用Element ui封装的组件</p>
<h3 id="后端介绍："><a href="#后端介绍：" class="headerlink" title="后端介绍："></a>后端介绍：</h3><p>服务端要接收客户端页面上传的文件，通常都会使用Apache的两个组件:</p>
<p>commons-fileupload</p>
<p>commons-io</p>
<p>Spring框架在spring-web包中对文件上传进行了封装，大大简化了服务端代码，我们只需要在Controller的方法中声明一个MultipartFile类型的参数即可接收上传的文件</p>
<p>配置路径上传</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">reggie:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">D:\\img\</span></span><br></pre></td></tr></table></figure>
<p>上传图片实现</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;reggie.path&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String basePath;</span><br><span class="line"><span class="meta">@PostMapping(&quot;/upload&quot;)</span> <span class="comment">//MultipartFile名字要与前端form表单name一致</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R&lt;String&gt; <span class="title">upload</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file)</span></span>&#123;</span><br><span class="line">    <span class="comment">//获取原始文件名</span></span><br><span class="line">    String originalFilename = file.getOriginalFilename();</span><br><span class="line">    String random = UUID.randomUUID().toString();</span><br><span class="line">    String filename = random+originalFilename;</span><br><span class="line">    File dir = <span class="keyword">new</span> File(basePath);</span><br><span class="line">    <span class="keyword">if</span>(!dir.exists())&#123;</span><br><span class="line">        <span class="comment">//目录不存在则创建</span></span><br><span class="line">        log.info(<span class="string">&quot;创建文件夹&quot;</span>);</span><br><span class="line">        dir.mkdir();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        file.transferTo(<span class="keyword">new</span> File(basePath+filename));</span><br><span class="line">        <span class="comment">//创建目录对象</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> R.success(filename);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-文件下载"><a href="#2-文件下载" class="headerlink" title="2. 文件下载"></a>2. 文件下载</h2><p>文件下载，也称为download，是指将文件从服务器传输到本地计算机的过程。</p>
<p>通过浏览器进行文件下载，通常有两种表现形式:</p>
<ul>
<li>以附件形式下载，弹出保存对话框，将文件保存到指定磁盘目录</li>
<li>直接在浏览器中打开</li>
</ul>
<p>通过浏览器进行文件下载，本质上就是服务端将文件以流的形式写回浏览器的过程。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/download&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">download</span><span class="params">(String name, HttpServletResponse response)</span></span>&#123;</span><br><span class="line">    FileInputStream fileInputStream = <span class="keyword">null</span>;</span><br><span class="line">    ServletOutputStream outputStream = <span class="keyword">null</span>;</span><br><span class="line">    response.setContentType(<span class="string">&quot;image/jpeg&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        fileInputStream = <span class="keyword">new</span> FileInputStream(basePath+name);</span><br><span class="line">        outputStream = response.getOutputStream();</span><br><span class="line">        <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">while</span> ((len = fileInputStream.read(bytes))&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            outputStream.write(bytes,<span class="number">0</span>,len);</span><br><span class="line">            outputStream.flush();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            fileInputStream.close();</span><br><span class="line">            outputStream.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="十一、新增菜品"><a href="#十一、新增菜品" class="headerlink" title="十一、新增菜品"></a>十一、新增菜品</h1><p>梳理一下新增菜品时前端页面和服务端的交互过程:</p>
<p>1、页面(backend/page/food/add.html)发送ajax请求，请求服务端获取菜品分类数据并展示到下拉框中</p>
<p>2、页面发送请求进行图片上传，请求服务端将图片保存到服务器</p>
<p>3、页面发送请求进行图片下载，将上传的图片进行回显</p>
<p>4、点击保存按钮，发送ajax请求，将菜品相关数据以json形式提交到服务端</p>
<p>开发新增菜品功能，其实就是在服务端编写代码去处理前端页面发送的这4次请求即可。</p>
<h2 id="编写获取分类list的方法"><a href="#编写获取分类list的方法" class="headerlink" title="编写获取分类list的方法"></a>编写获取分类list的方法</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;List&lt;Category&gt;&gt; list(Category category)&#123;</span><br><span class="line">    LambdaQueryWrapper&lt;Category&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(category.getType()!=<span class="keyword">null</span>,Category::getType,category.getType())</span><br><span class="line">            .orderByAsc(Category::getSort)</span><br><span class="line">            .orderByDesc(Category::getCreateTime);</span><br><span class="line">    List&lt;Category&gt; list = categoryService.list(queryWrapper);</span><br><span class="line">    <span class="keyword">return</span> R.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="编写新增菜品方法"><a href="#编写新增菜品方法" class="headerlink" title="编写新增菜品方法"></a>编写新增菜品方法</h2><p>因为新增菜品传输的参数比较复杂，无法使用一个实体类接收，因此我们新建一个DTO类来接收参数</p>
<p>DishDTO</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DishDTO</span> <span class="keyword">extends</span> <span class="title">Dish</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;DishFlavor&gt; flavors = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> String categoryName;</span><br><span class="line">    <span class="keyword">private</span> Integer copies;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因为要操作多表，因此我们在Service层进行封装</p>
<p><strong>注意：</strong>@Transactional需要在springboot启动类上添加注解@EnableTransactionManagement</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加菜品和菜品风味</span></span><br><span class="line"><span class="comment"> * 因为要操作多表，因此需要开启事务</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dishDTO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveWithFlavor</span><span class="params">(DishDTO dishDTO)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//保存菜品基本信息到菜品dish</span></span><br><span class="line">    <span class="keyword">this</span>.save(dishDTO);</span><br><span class="line">    Long id = dishDTO.getId();</span><br><span class="line">    List&lt;DishFlavor&gt; flavors = dishDTO.getFlavors();</span><br><span class="line">    flavors = flavors.stream().map((item)-&gt;&#123;</span><br><span class="line">        item.setDishId(id);</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="comment">//保存菜品口味到dish_flavor</span></span><br><span class="line">    dishFlavorService.saveBatch(flavors);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="十二、菜品分页"><a href="#十二、菜品分页" class="headerlink" title="十二、菜品分页"></a>十二、菜品分页</h1><p>梳理一下菜品分页查询时前端页面和服务端的交互过程:</p>
<p>1、页面(backend/page/food/list.html)发送ajax请求，将分页查询参数(page、pageSize、name)提交到服务端，获取分页数据</p>
<p>2、页面发送请求，请求服务端进行图片下载，用于页面图片展示</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R&lt;Page&gt; <span class="title">page</span><span class="params">(<span class="keyword">int</span> page,<span class="keyword">int</span> pageSize,String name)</span></span>&#123;</span><br><span class="line">    Page&lt;Dish&gt; dishPage = <span class="keyword">new</span> Page&lt;&gt;();</span><br><span class="line">    dishPage.setCurrent(page);</span><br><span class="line">    dishPage.setSize(pageSize);</span><br><span class="line">    LambdaQueryWrapper&lt;Dish&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper.like(name!=<span class="keyword">null</span>,Dish::getName,name)</span><br><span class="line">            .orderByDesc(Dish::getUpdateTime);</span><br><span class="line">    dishService.page(dishPage,queryWrapper);</span><br><span class="line">    <span class="keyword">return</span> R.success(dishPage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述代码完成了简单的分页查询，但是菜品分类回显的是菜品的id，而不是前端需要的菜品分类名称</p>
<p>为了解决这一问题，可以在DishDTO中添加categoryName字段，把Page<Dish>中的数据拷贝到Page<DishDTO></DishDTO></Dish></p>
<p>并且同时给DishDTO中的categoryName字段设置对应的值</p>
<h2 id="对象拷贝："><a href="#对象拷贝：" class="headerlink" title="对象拷贝："></a>对象拷贝：</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//BeanUtils.copyProperties(源对象，拷贝对象，忽略的属性)</span></span><br><span class="line">BeanUtils.copyProperties(dishPage,dishDTOPage,<span class="string">&quot;records&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>改进：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R&lt;Page&gt; <span class="title">page</span><span class="params">(<span class="keyword">int</span> page,<span class="keyword">int</span> pageSize,String name)</span></span>&#123;</span><br><span class="line">    <span class="comment">//创建分页对象</span></span><br><span class="line">    Page&lt;Dish&gt; dishPage = <span class="keyword">new</span> Page&lt;&gt;();</span><br><span class="line">    <span class="comment">//创建DishDTO分页对象（拷贝dishPage数据，迎合前端数据要求，自定义菜品分类数据）</span></span><br><span class="line">    Page&lt;DishDTO&gt; dishDTOPage = <span class="keyword">new</span> Page&lt;&gt;();</span><br><span class="line">    <span class="comment">//设置分页条件</span></span><br><span class="line">    dishPage.setCurrent(page);</span><br><span class="line">    dishPage.setSize(pageSize);</span><br><span class="line">    LambdaQueryWrapper&lt;Dish&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper.like(name!=<span class="keyword">null</span>,Dish::getName,name)</span><br><span class="line">            .orderByDesc(Dish::getUpdateTime);</span><br><span class="line">    dishService.page(dishPage,queryWrapper);</span><br><span class="line">    <span class="comment">//对象拷贝</span></span><br><span class="line">    BeanUtils.copyProperties(dishPage,dishDTOPage,<span class="string">&quot;records&quot;</span>);</span><br><span class="line">    List&lt;Dish&gt; dishs = dishPage.getRecords();</span><br><span class="line">    <span class="comment">//设置分类id--分类名称的映射</span></span><br><span class="line">    List&lt;DishDTO&gt; dishDTOS = dishs.stream().map((item)-&gt;&#123;</span><br><span class="line">        DishDTO dishDTO = <span class="keyword">new</span> DishDTO();</span><br><span class="line">        <span class="comment">//获取分类id</span></span><br><span class="line">        Long categoryId = item.getCategoryId();</span><br><span class="line">        Category now = categoryService.getById(categoryId);</span><br><span class="line">        String nowcategory = now.getName();</span><br><span class="line">        dishDTO.setCategoryName(nowcategory);</span><br><span class="line">        BeanUtils.copyProperties(item,dishDTO);</span><br><span class="line">        <span class="keyword">return</span> dishDTO;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    dishDTOPage.setRecords(dishDTOS);</span><br><span class="line">    <span class="keyword">return</span> R.success(dishDTOPage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="十三、修改菜品"><a href="#十三、修改菜品" class="headerlink" title="十三、修改菜品"></a>十三、修改菜品</h1><p>梳理一下修改菜品时前端页面( add.html）和服务端的交互过程:</p>
<p>1、页面发送ajax请求，请求服务端获取分类数据，用于菜品分类下拉框中数据展示</p>
<p>2、页面发送ajax请求，请求服务端，根据id查询当前菜品信息，用于菜品信息回显</p>
<p>3、页面发送请求，请求服务端进行图片下载，用于页图片回显</p>
<p>4、点击保存按钮，页面发送ajax请求，将修改后的菜品相关数据以json形式提交到服务端</p>
<h2 id="查询菜品以及菜品口味回显"><a href="#查询菜品以及菜品口味回显" class="headerlink" title="查询菜品以及菜品口味回显"></a>查询菜品以及菜品口味回显</h2><ul>
<li>在service中添加getByIdWithFlavor方法，查询菜品和菜品口味，封装DishDTO返回</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> DishDTO <span class="title">getByIdWithFlavor</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">    DishDTO dishDTO = <span class="keyword">new</span> DishDTO();</span><br><span class="line">    <span class="comment">//查询基础信息</span></span><br><span class="line">    Dish dish = <span class="keyword">this</span>.getById(id);</span><br><span class="line">    <span class="comment">//查询口味</span></span><br><span class="line">    LambdaQueryWrapper&lt;DishFlavor&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(DishFlavor::getDishId,dish.getId());</span><br><span class="line">    List&lt;DishFlavor&gt; flavors = dishFlavorService.list(queryWrapper);</span><br><span class="line">    <span class="comment">//设置dishDTO属性</span></span><br><span class="line">    BeanUtils.copyProperties(dish,dishDTO);</span><br><span class="line">    dishDTO.setFlavors(flavors);</span><br><span class="line">    <span class="keyword">return</span> dishDTO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>controller层</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R&lt;DishDTO&gt; <span class="title">getById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span></span>&#123;</span><br><span class="line">    DishDTO dishDTO = dishService.getByIdWithFlavor(id);</span><br><span class="line">    <span class="keyword">return</span> R.success(dishDTO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="修改菜品和菜品口味"><a href="#修改菜品和菜品口味" class="headerlink" title="修改菜品和菜品口味"></a>修改菜品和菜品口味</h2><ul>
<li>这里口味修改要一项一项对比，可以先删除后添加</li>
<li>由于是多个sql操作，应该开启事务</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateWithFlavor</span><span class="params">(DishDTO dishDTO)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//更新dish基本信息</span></span><br><span class="line">    <span class="keyword">this</span>.updateById(dishDTO);</span><br><span class="line">    <span class="comment">//更新口味操作很复杂，可以先删除，再添加</span></span><br><span class="line">    <span class="comment">//删除</span></span><br><span class="line">    LambdaQueryWrapper&lt;DishFlavor&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(DishFlavor::getDishId,dishDTO.getId());</span><br><span class="line">    dishFlavorService.remove(queryWrapper);</span><br><span class="line">    <span class="comment">//新增</span></span><br><span class="line">    List&lt;DishFlavor&gt; flavors = dishDTO.getFlavors();</span><br><span class="line">    flavors = flavors.stream().map((item)-&gt;&#123;</span><br><span class="line">        item.setDishId(dishDTO.getId());</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    dishFlavorService.saveBatch(flavors);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>controller层</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R&lt;String&gt; <span class="title">update</span><span class="params">(<span class="meta">@RequestBody</span> DishDTO dishDTO)</span></span>&#123;</span><br><span class="line">    dishService.updateWithFlavor(dishDTO);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;修改菜品成功！&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="十四、套餐管理"><a href="#十四、套餐管理" class="headerlink" title="十四、套餐管理"></a>十四、套餐管理</h1><h2 id="1-新增"><a href="#1-新增" class="headerlink" title="1. 新增"></a>1. 新增</h2><p>梳理一下新增套餐时前端页面和服务端的交互过程:</p>
<p>1、页面(backend/page/combo/add.html)发送ajax请求，请求服务端获取套餐分类数据并展示到下拉框中</p>
<p>2、页面发送ajax请求，请求服务端获取菜品分类数据并展示到添加菜品窗口中</p>
<p>3、页面发送ajax请求，请求服务端，根据菜品分类查询对应的菜品数据并展示到添加菜品窗口中</p>
<p>4、页面发送请求进行图片上传，请求服务端将图片保存到服务器</p>
<p>5、页面发送请求进行图片下载，将上传的图片进行回显</p>
<p>6、点击保存按钮，发送ajax请求，将套餐相关数据以json形式提交到服务端</p>
<p>开发新增套餐功能，其实就是在服务端编写代码去处理前端页面发送的这6次请求即可。</p>
<h3 id="编写代码"><a href="#编写代码" class="headerlink" title="编写代码"></a>编写代码</h3><p>接收套餐相关数据，将信息添加到setmeal和setmeal_dish表中</p>
<ul>
<li>在SetmealService接口中定义方法saveWithSDish，并在SetmealServiceImpl中实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 新增套餐同时保存套餐菜品信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> setmealDTO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveWithSDish</span><span class="params">(SetmealDTO setmealDTO)</span></span>&#123;</span><br><span class="line">    <span class="comment">//保存套餐基本信息</span></span><br><span class="line">    <span class="keyword">this</span>.save(setmealDTO);</span><br><span class="line"></span><br><span class="line">    List&lt;SetmealDish&gt; setmealDishes = setmealDTO.getSetmealDishes();</span><br><span class="line">    setmealDishes = setmealDishes.stream().map(item-&gt;&#123;</span><br><span class="line">        item.setSetmealId(setmealDTO.getId());</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="comment">//保存套餐菜品信息</span></span><br><span class="line">    setmealDishService.saveBatch(setmealDishes);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-分页查询"><a href="#2-分页查询" class="headerlink" title="2. 分页查询"></a>2. 分页查询</h2><p>梳理一下套餐分页查询时前端页面和服务端的交互过程:</p>
<p>1、页面(backend/page/combo/list.html)发送ajax请求，将分页查询参数(page、pageSize、name)提交到服务端，获取分页数据</p>
<p>2、页面发送请求，请求服务端进行图片下载，用于页面图片展示</p>
<p>开发套餐信息分页查询功能，其实就是在服务端编写代码去处理前端页面发送的这2次请求即可。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R&lt;Page&gt; <span class="title">page</span><span class="params">(PageDTO pageDTO)</span></span>&#123;</span><br><span class="line">    Page&lt;Setmeal&gt; setmealPage = <span class="keyword">new</span> Page&lt;&gt;(pageDTO.getPage(), pageDTO.getPageSize());</span><br><span class="line">    Page&lt;SetmealDTO&gt; setmealDTOPage = <span class="keyword">new</span> Page&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    LambdaQueryWrapper&lt;Setmeal&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper.like(pageDTO.getName()!=<span class="keyword">null</span>,Setmeal::getName,pageDTO.getName())</span><br><span class="line">            .orderByDesc(Setmeal::getUpdateTime);</span><br><span class="line">    setmealService.page(setmealPage,queryWrapper);</span><br><span class="line">    BeanUtils.copyProperties(setmealPage,setmealDTOPage,<span class="string">&quot;records&quot;</span>);</span><br><span class="line">    List&lt;Setmeal&gt; records = setmealPage.getRecords();</span><br><span class="line">    List&lt;SetmealDTO&gt; collect = records.stream().map(item -&gt; &#123;</span><br><span class="line">        SetmealDTO setmealDTO = <span class="keyword">new</span> SetmealDTO();</span><br><span class="line">        BeanUtils.copyProperties(item, setmealDTO);</span><br><span class="line">        Category byId = categoryService.getById(item.getCategoryId());</span><br><span class="line">        <span class="keyword">if</span>(byId!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            setmealDTO.setCategoryName(byId.getName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> setmealDTO;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    setmealDTOPage.setRecords(collect);</span><br><span class="line">    <span class="keyword">return</span> R.success(setmealDTOPage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-删除"><a href="#3-删除" class="headerlink" title="3. 删除"></a>3. 删除</h2><p>需求：</p>
<ol>
<li><p>普通删除：前端点击删除按钮，传对应的id参数到后端，完成删除</p>
</li>
<li><p>批量删除：勾选套餐记录前的多选框，点击批量删除，传所有对应的id参数，完成删除</p>
</li>
</ol>
<p><strong>注意：</strong> </p>
<ol>
<li><p>删除套餐表数据的同时还要删除套餐对应的套餐菜品表的记录</p>
</li>
<li><p>删除套餐前要判断套餐是否在售卖</p>
</li>
</ol>
<p>在SetmealService类中新增方法deleteSetmealDishById来编写删除逻辑</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteSetmealDishById</span><span class="params">(Long[] ids)</span> </span>&#123;</span><br><span class="line">    LambdaQueryWrapper&lt;Setmeal&gt; queryWrapper1 = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper1.in(Setmeal::getId,ids)</span><br><span class="line">            .eq(Setmeal::getStatus,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">long</span> count = <span class="keyword">this</span>.count(queryWrapper1);</span><br><span class="line">    <span class="keyword">if</span>(count&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> CustomException(<span class="string">&quot;套餐正在售卖中，不能删除！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    LambdaQueryWrapper&lt;Setmeal&gt; queryWrapper2 = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper2.in(Setmeal::getId,ids);</span><br><span class="line">    List&lt;Setmeal&gt; list = <span class="keyword">this</span>.list(queryWrapper2);</span><br><span class="line">    LambdaQueryWrapper&lt;SetmealDish&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper.in(SetmealDish::getSetmealId,ids);</span><br><span class="line">    setmealDishService.remove(queryWrapper);</span><br><span class="line">    <span class="keyword">this</span>.removeByIds(Arrays.asList(ids));</span><br><span class="line">    <span class="keyword">for</span> (Setmeal setmeal : list) &#123;</span><br><span class="line">        <span class="keyword">new</span> File(basePath+setmeal.getImage()).delete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="十五、短信发送验证码"><a href="#十五、短信发送验证码" class="headerlink" title="十五、短信发送验证码"></a>十五、短信发送验证码</h1><p>腾讯云短信平台</p>
<h1 id="十六、手机用户端登录"><a href="#十六、手机用户端登录" class="headerlink" title="十六、手机用户端登录"></a>十六、手机用户端登录</h1><h2 id="1-生成验证码"><a href="#1-生成验证码" class="headerlink" title="1. 生成验证码"></a>1. 生成验证码</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.hestialx.reggie_project.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 随机生成验证码工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValidateCodeUtils</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 随机生成验证码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> length 长度为4位或者6位</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title">generateValidateCode</span><span class="params">(<span class="keyword">int</span> length)</span></span>&#123;</span><br><span class="line">        Integer code =<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(length == <span class="number">4</span>)&#123;</span><br><span class="line">            code = <span class="keyword">new</span> Random().nextInt(<span class="number">9999</span>);<span class="comment">//生成随机数，最大为9999</span></span><br><span class="line">            <span class="keyword">if</span>(code &lt; <span class="number">1000</span>)&#123;</span><br><span class="line">                code = code + <span class="number">1000</span>;<span class="comment">//保证随机数为4位数字</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(length == <span class="number">6</span>)&#123;</span><br><span class="line">            code = <span class="keyword">new</span> Random().nextInt(<span class="number">999999</span>);<span class="comment">//生成随机数，最大为999999</span></span><br><span class="line">            <span class="keyword">if</span>(code &lt; <span class="number">100000</span>)&#123;</span><br><span class="line">                code = code + <span class="number">100000</span>;<span class="comment">//保证随机数为6位数字</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;只能生成4位或6位数字验证码&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 随机生成指定长度字符串验证码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> length 长度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">generateValidateCode4String</span><span class="params">(<span class="keyword">int</span> length)</span></span>&#123;</span><br><span class="line">        Random rdm = <span class="keyword">new</span> Random();</span><br><span class="line">        String hash1 = Integer.toHexString(rdm.nextInt());</span><br><span class="line">        String capstr = hash1.substring(<span class="number">0</span>, length);</span><br><span class="line">        <span class="keyword">return</span> capstr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-登录"><a href="#2-登录" class="headerlink" title="2. 登录"></a>2. 登录</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/sendMsg&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R&lt;String&gt; <span class="title">sendMsg</span><span class="params">(<span class="meta">@RequestBody</span> User user, HttpSession session)</span></span>&#123;</span><br><span class="line">    String phone = user.getPhone();</span><br><span class="line">    <span class="keyword">if</span>(StringUtils.isNotEmpty(phone))&#123;</span><br><span class="line">        <span class="comment">//生成对应位数的验证码</span></span><br><span class="line">        String code = ValidateCodeUtils.generateValidateCode(<span class="number">4</span>).toString();</span><br><span class="line">        log.info(code);</span><br><span class="line">        <span class="comment">//将验证码保存到session</span></span><br><span class="line">        session.setAttribute(phone,code);</span><br><span class="line">        <span class="comment">//调用腾讯云api发送短信</span></span><br><span class="line">        <span class="keyword">return</span> R.success(code);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;验证码生成失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R&lt;String&gt; <span class="title">login</span><span class="params">(<span class="meta">@RequestBody</span> Map&lt;String,String&gt; map,HttpSession session)</span></span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setPhone(map.get(<span class="string">&quot;phone&quot;</span>));</span><br><span class="line">    String code = map.get(<span class="string">&quot;code&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取正确的验证码</span></span><br><span class="line">    String realcode = (String) session.getAttribute(user.getPhone());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(realcode!=<span class="keyword">null</span>&amp;&amp;realcode.equals(code))&#123;</span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(user.getPhone()!=<span class="keyword">null</span>,User::getPhone,user.getPhone());</span><br><span class="line">        User one = userService.getOne(queryWrapper);</span><br><span class="line">        <span class="keyword">if</span>(one==<span class="keyword">null</span>)&#123;</span><br><span class="line">            userService.save(user);</span><br><span class="line">            session.setAttribute(<span class="string">&quot;user&quot;</span>,user.getId());</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            session.setAttribute(<span class="string">&quot;user&quot;</span>,one.getId());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;验证码错误&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>瑞吉外卖项目</category>
      </categories>
      <tags>
        <tag>瑞吉外卖项目</tag>
      </tags>
  </entry>
  <entry>
    <title>servletcontext</title>
    <url>/2021/12/09/servletcontext/</url>
    <content><![CDATA[<h3 id="一、ServletContext对象"><a href="#一、ServletContext对象" class="headerlink" title="一、ServletContext对象"></a>一、ServletContext对象</h3><h5 id="1-概念"><a href="#1-概念" class="headerlink" title="1. 概念"></a>1. 概念</h5><p>代表整个web应用，可以和程序的容器(服务器)来通信</p>
<h5 id="2-获取ServletContext对象"><a href="#2-获取ServletContext对象" class="headerlink" title="2. 获取ServletContext对象"></a>2. 获取ServletContext对象</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//通过request对象获取</span></span><br><span class="line"><span class="number">1.</span> request.getServletContext();</span><br><span class="line"><span class="comment">//通过HttpServletContext获取</span></span><br><span class="line"><span class="number">2.</span> <span class="keyword">this</span>.getServletContext();</span><br><span class="line">getServletContext();</span><br></pre></td></tr></table></figure>
<h5 id="3-功能"><a href="#3-功能" class="headerlink" title="3. 功能"></a>3. 功能</h5><ul>
<li><p>获取MIME类型(格式： 大类型/小类型  eg: image/jpeg text/html)</p>
<ul>
<li>MIME多用途互联网邮件扩展类型</li>
<li>定义详情参考百度</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ServletContext的方法获取MIME类型</span></span><br><span class="line"><span class="function">String <span class="title">getMimeType</span><span class="params">(String file)</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>共享数据（ServletContext是一个域对象）</p>
<ul>
<li><p>作用范围是整个web应用</p>
<p><img src="/2021/12/09/servletcontext/1.png" alt></p>
</li>
<li><p>setAttribute(String name,Object value)</p>
</li>
<li><p>Object getAttribute(String name)</p>
</li>
<li><p>removeAttribute(String name)</p>
</li>
</ul>
</li>
<li><p>获取文件的真实路径</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ServletContext的方法</span></span><br><span class="line">getRealPath(String name)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="二、文件下载案例"><a href="#二、文件下载案例" class="headerlink" title="二、文件下载案例"></a>二、文件下载案例</h3><h5 id="案例需求："><a href="#案例需求：" class="headerlink" title="案例需求："></a>案例需求：</h5><ol>
<li>页面显示超链接</li>
<li>点击超链接后弹出下载提示框</li>
<li>完成图片下载</li>
</ol>
<h5 id="分析："><a href="#分析：" class="headerlink" title="分析："></a>分析：</h5><ol>
<li><p>超链接指向的资源如果能够被浏览器解析，则在浏览器中展示，如果不能解析，则弹出下载提示框。不满足需求</p>
</li>
<li><p>需求：任何资源都必须弹出下载提示框</p>
</li>
<li><p>使用响应头设置资源的打开方式:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">content-disposition:attachment;filename=xxx</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="步骤："><a href="#步骤：" class="headerlink" title="步骤："></a>步骤：</h5><ol>
<li>定义页面，编辑超链接href属性，指向servlet，传递资源名称filename</li>
<li>定义servlet<ul>
<li>获取文件名称</li>
<li>使用字节输入流加载文件进内存</li>
<li>指定response的响应头:content-disposition:attachment;filename=xxx</li>
<li>将数据写出到response输出流</li>
</ul>
</li>
</ol>
]]></content>
      <categories>
        <category>servlet</category>
      </categories>
      <tags>
        <tag>servletContext</tag>
      </tags>
  </entry>
  <entry>
    <title>jsp</title>
    <url>/2021/12/13/jsp/</url>
    <content><![CDATA[<h3 id="一、jsp简介"><a href="#一、jsp简介" class="headerlink" title="一、jsp简介"></a>一、jsp简介</h3><p><strong>JSP</strong>（全称<strong>J</strong>ava<strong>S</strong>erver <strong>P</strong>ages），java服务器页面</p>
<ul>
<li>特殊的页面，即可以定义html又可以定义java代码</li>
<li>用于简化书写</li>
</ul>
<h5 id="1-服务器访问jsp原理"><a href="#1-服务器访问jsp原理" class="headerlink" title="1. 服务器访问jsp原理"></a>1. 服务器访问jsp原理</h5><p><img src="/2021/12/13/jsp/1.png" alt></p>
<ul>
<li>jsp本质上是一个servlet</li>
</ul>
<h5 id="2-jsp脚本：jsp定义Java代码的方式"><a href="#2-jsp脚本：jsp定义Java代码的方式" class="headerlink" title="2. jsp脚本：jsp定义Java代码的方式"></a>2. jsp脚本：jsp定义Java代码的方式</h5><ol>
<li>&lt;%  代码 %&gt;     //在转化的servlet中的service方法中，定义流程</li>
<li>&lt;%! 代码 %&gt;    //在转化的servlet中的成员变量位置，定义成员变量</li>
<li>&lt;%=代码 %&gt;     //输出语句</li>
</ol>
<h5 id="3-jsp内置对象"><a href="#3-jsp内置对象" class="headerlink" title="3. jsp内置对象"></a>3. jsp内置对象</h5><ul>
<li>在jsp页面中不需要获取和创建，可以直接使用的对象</li>
<li>jsp一共有9个内置对象。</li>
</ul>
<ol>
<li>request</li>
<li>response</li>
<li>out：字符输出流对象，可以将数据输出到页面上。<ul>
<li>response.getWriter()与out区别    (服务器优先读取response.getWriter()缓冲区)<ul>
<li>response.getWriter()不管定义在哪，都会在out前输出</li>
</ul>
</li>
</ul>
</li>
</ol>
]]></content>
      <categories>
        <category>servlet</category>
      </categories>
      <tags>
        <tag>jsp</tag>
      </tags>
  </entry>
  <entry>
    <title>springMVC中Restful风格</title>
    <url>/2022/03/29/springMVC02/</url>
    <content><![CDATA[<h3 id="RestFul-风格"><a href="#RestFul-风格" class="headerlink" title="RestFul 风格"></a>RestFul 风格</h3><p><strong>概念</strong></p>
<p>Restful就是一个资源定位及资源操作的风格。不是标准也不是协议，只是一种风格。基于这个风格设计的软件可以更简洁，更有层次，更易于实现缓存等机制。</p>
<p><strong>功能</strong></p>
<p>资源：互联网所有的事物都可以被抽象为资源</p>
<p>资源操作：使用POST、DELETE、PUT、GET，使用不同方法对资源进行操作。</p>
<p>分别对应 添加、 删除、修改、查询。</p>
<p><strong>传统方式操作资源</strong>  ：通过不同的参数来实现不同的效果！方法单一，post 和 get</p>
<p>​    <a href="http://127.0.0.1/item/queryItem.action?id=1">http://127.0.0.1/item/queryItem.action?id=1</a> 查询,GET</p>
<p>​    <a href="http://127.0.0.1/item/saveItem.action">http://127.0.0.1/item/saveItem.action</a> 新增,POST</p>
<p>​    <a href="http://127.0.0.1/item/updateItem.action">http://127.0.0.1/item/updateItem.action</a> 更新,POST</p>
<p>​    <a href="http://127.0.0.1/item/deleteItem.action?id=1">http://127.0.0.1/item/deleteItem.action?id=1</a> 删除,GET或POST</p>
<p><strong>使用RESTful操作资源</strong> ：可以通过不同的请求方式来实现不同的效果！如下：请求地址一样，但是功能可以不同！</p>
<p>​    <a href="http://127.0.0.1/item/1">http://127.0.0.1/item/1</a> 查询,GET</p>
<p>​    <a href="http://127.0.0.1/item">http://127.0.0.1/item</a> 新增,POST</p>
<p>​    <a href="http://127.0.0.1/item">http://127.0.0.1/item</a> 更新,PUT</p>
<p>​    <a href="http://127.0.0.1/item/1">http://127.0.0.1/item/1</a> 删除,DELETE</p>
<p><strong>学习测试</strong></p>
<ol>
<li><p>在新建一个类 RestFulController</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestFulController</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在Spring MVC中可以使用  @PathVariable 注解，让方法参数的值对应绑定到一个URI模板变量上。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestFulController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//映射访问路径</span></span><br><span class="line">   <span class="meta">@RequestMapping(&quot;/commit/&#123;p1&#125;/&#123;p2&#125;&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">(<span class="meta">@PathVariable</span> <span class="keyword">int</span> p1, <span class="meta">@PathVariable</span> <span class="keyword">int</span> p2, Model model)</span></span>&#123;</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">int</span> result = p1+p2;</span><br><span class="line">       <span class="comment">//Spring MVC会自动实例化一个Model对象用于向视图中传值</span></span><br><span class="line">       model.addAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;结果：&quot;</span>+result);</span><br><span class="line">       <span class="comment">//返回视图位置</span></span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;test&quot;</span>;</span><br><span class="line">       </span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>我们来测试请求查看下</p>
<p><img src="/2022/03/29/springMVC02/1.png" alt></p>
</li>
<li><p>思考：使用路径变量的好处？</p>
</li>
<li><ul>
<li><p>使路径变得更加简洁；</p>
</li>
<li><p>获得参数更加方便，框架会自动进行类型转换。</p>
</li>
<li><p>通过路径变量的类型可以约束访问参数，如果类型不一样，则访问不到对应的请求方法，如这里访问是的路径是/commit/1/a，则路径与方法不匹配，而不会是参数转换失败。</p>
</li>
</ul>
</li>
</ol>
<pre><code> ![图片](SpringMVC02/2.png)
</code></pre><ol>
<li><p>我们来修改下对应的参数类型，再次测试</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//映射访问路径</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/commit/&#123;p1&#125;/&#123;p2&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">(<span class="meta">@PathVariable</span> <span class="keyword">int</span> p1, <span class="meta">@PathVariable</span> String p2, Model model)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">   String result = p1+p2;</span><br><span class="line">   <span class="comment">//Spring MVC会自动实例化一个Model对象用于向视图中传值</span></span><br><span class="line">   model.addAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;结果：&quot;</span>+result);</span><br><span class="line">   <span class="comment">//返回视图位置</span></span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;test&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/03/29/springMVC02/3.png" alt="图片"></p>
</li>
</ol>
<p><strong>使用method属性指定请求类型</strong></p>
<p>用于约束请求的类型，可以收窄请求范围。指定请求谓词的类型如GET, POST, HEAD, OPTIONS, PUT, PATCH, DELETE, TRACE等</p>
<p>我们来测试一下：</p>
<ul>
<li><p>增加一个方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//映射访问路径,必须是POST请求</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/hello&quot;,method = &#123;RequestMethod.POST&#125;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">index2</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line">   model.addAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;hello!&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;test&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>我们使用浏览器地址栏进行访问默认是Get请求，会报错405：</p>
<p><img src="/2022/03/29/springMVC02/4.png" alt="图片"></p>
</li>
<li><p>如果将POST修改为GET则正常了；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//映射访问路径,必须是Get请求</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/hello&quot;,method = &#123;RequestMethod.GET&#125;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">index2</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line">   model.addAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;hello!&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;test&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/03/29/springMVC02/5.png" alt="图片"></p>
</li>
</ul>
<p><strong>小结：</strong></p>
<p>Spring MVC 的 @RequestMapping 注解能够处理 HTTP 请求的方法, 比如 GET, PUT, POST, DELETE 以及 PATCH。</p>
<p><strong>所有的地址栏请求默认都会是 HTTP GET 类型的。</strong></p>
<p>方法级别的注解变体有如下几个：组合注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span></span><br><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="meta">@DeleteMapping</span></span><br><span class="line"><span class="meta">@PatchMapping</span></span><br></pre></td></tr></table></figure>
<p>@GetMapping 是一个组合注解，平时使用的会比较多！</p>
<p>它所扮演的是 @RequestMapping(method =RequestMethod.GET) 的一个快捷方式。</p>
]]></content>
      <categories>
        <category>SpringMVC</category>
      </categories>
      <tags>
        <tag>SpringMVC</tag>
        <tag>restful风格</tag>
      </tags>
  </entry>
  <entry>
    <title>springboot项目打包发布</title>
    <url>/2022/05/07/springbootmaintain/</url>
    <content><![CDATA[<h1 id="一、windows项目打包运行"><a href="#一、windows项目打包运行" class="headerlink" title="一、windows项目打包运行"></a>一、windows项目打包运行</h1><h2 id="1-打包"><a href="#1-打包" class="headerlink" title="1. 打包"></a>1. 打包</h2><ul>
<li>点击idea右侧maven</li>
</ul>
<p>​    <img src="/2022/05/07/springbootmaintain/1.png" alt="image-20220507164901466"></p>
<ul>
<li>点击Lifecycle，点击package进行打包生产target文件夹<ul>
<li><strong>注意：</strong>打包时会默认将测试类中的代码全部运行一次，点击skip tests 按钮跳过测试</li>
</ul>
</li>
</ul>
<p>​    <img src="/2022/05/07/springbootmaintain/2.png" alt="image-20220507165244839"></p>
<ul>
<li><p>查看target目录，已经生成jar包</p>
<p><img src="/2022/05/07/springbootmaintain/3.png" alt="image-20220507165447536"></p>
</li>
</ul>
<h2 id="2-运行"><a href="#2-运行" class="headerlink" title="2. 运行"></a>2. 运行</h2><ol>
<li><p>在jar包路径打开cmd</p>
</li>
<li><p>java -jar [jar包名]</p>
</li>
</ol>
<h2 id="3-windows端口查询"><a href="#3-windows端口查询" class="headerlink" title="3. windows端口查询"></a>3. windows端口查询</h2><ul>
<li><h1 id="查询端口"><a href="#查询端口" class="headerlink" title="查询端口"></a>查询端口</h1><ul>
<li>netstat -ano</li>
</ul>
</li>
<li><h1 id="查询指定端口"><a href="#查询指定端口" class="headerlink" title="查询指定端口"></a>查询指定端口</h1><ul>
<li>netstat -ano |findstr“端口号”</li>
</ul>
</li>
<li><h1 id="根据进程PID查询进程名称"><a href="#根据进程PID查询进程名称" class="headerlink" title="根据进程PID查询进程名称"></a>根据进程PID查询进程名称</h1><ul>
<li>tasklist |findstr “进程PID号”</li>
</ul>
</li>
<li><h1 id="根据PID杀死任务"><a href="#根据PID杀死任务" class="headerlink" title="根据PID杀死任务"></a>根据PID杀死任务</h1><ul>
<li>taskkill /F/PID“进程PID号”</li>
</ul>
</li>
<li><h1 id="根据进程名称杀死任务"><a href="#根据进程名称杀死任务" class="headerlink" title="根据进程名称杀死任务"></a>根据进程名称杀死任务</h1><ul>
<li>taskkill -f -t -im”进程名称”</li>
</ul>
</li>
</ul>
<h1 id="二、linux启动springboot项目"><a href="#二、linux启动springboot项目" class="headerlink" title="二、linux启动springboot项目"></a>二、linux启动springboot项目</h1><h2 id="2-1-基本启动"><a href="#2-1-基本启动" class="headerlink" title="2.1 基本启动"></a>2.1 基本启动</h2><ol>
<li><p>上传打包好的jar包</p>
</li>
<li><p>运行jar  —-java -jar [jar名称]</p>
</li>
<li><p>使用ip addr查看linux ip地址</p>
</li>
<li>访问</li>
</ol>
<h2 id="2-2-后台启动"><a href="#2-2-后台启动" class="headerlink" title="2.2 后台启动"></a>2.2 后台启动</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//指定log保存的文件 server.log</span><br><span class="line">nohup java -jar [jar包名称] &gt; server.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
<h2 id="2-3-关闭"><a href="#2-3-关闭" class="headerlink" title="2.3 关闭"></a>2.3 关闭</h2><ul>
<li>查询jar程序进程pid</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ps -ef|grep &quot;java -jar&quot;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/05/07/springbootmaintain/4.png" alt="image-20220507173211400"></p>
<ul>
<li>杀死进程</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kill -9 [pid]</span><br></pre></td></tr></table></figure>
<h1 id="三、设置临时属性"><a href="#三、设置临时属性" class="headerlink" title="三、设置临时属性"></a>三、设置临时属性</h1><p>运行时重定义配置属性</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java -jar [jar名称] --server.port=8080 --spring.datasource.druid.password=123</span><br></pre></td></tr></table></figure>
<h1 id="四、log日志"><a href="#四、log日志" class="headerlink" title="四、log日志"></a>四、log日志</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Async</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = LoggerFactory.getLogger(AsyncService.class);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">asynctarget</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">            log.debug(<span class="string">&quot;debug&quot;</span>);</span><br><span class="line">            log.info(<span class="string">&quot;info&quot;</span>);</span><br><span class="line">            log.warn(<span class="string">&quot;warn&quot;</span>);</span><br><span class="line">            log.error(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>日志级别</p>
<p>debug&lt;info&lt;warn&lt;error</p>
</li>
</ul>
<p>会根据当前设置的日志级别输出大于等于当前日志级别的日志信息</p>
<h2 id="设置日志级别"><a href="#设置日志级别" class="headerlink" title="设置日志级别"></a>设置日志级别</h2><p>//在配置文件中配置</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line"><span class="comment">#    设置分组</span></span><br><span class="line">  <span class="attr">group:</span></span><br><span class="line">  <span class="comment"># 分组名称：ebank</span></span><br><span class="line">    <span class="attr">ebank:</span> <span class="string">cn.hestialx.controller,cn.hestialx.service</span></span><br><span class="line">    <span class="attr">iservice:</span> <span class="string">com.aliaba</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="comment">#    整体日志级别</span></span><br><span class="line">    <span class="attr">root:</span> <span class="string">debug</span></span><br><span class="line">    <span class="comment">#    设置包的日志级别</span></span><br><span class="line"><span class="comment">#    cn.hestialx.controller: info</span></span><br><span class="line">    <span class="attr">ebank:</span> <span class="string">error</span></span><br></pre></td></tr></table></figure>
<h2 id="简化日志代码"><a href="#简化日志代码" class="headerlink" title="简化日志代码"></a>简化日志代码</h2><h3 id="1-导入lombok"><a href="#1-导入lombok" class="headerlink" title="1. 导入lombok"></a>1. 导入lombok</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-在需要输出日志的类上加上-Slf4j注解"><a href="#2-在需要输出日志的类上加上-Slf4j注解" class="headerlink" title="2. 在需要输出日志的类上加上@Slf4j注解"></a>2. 在需要输出日志的类上加上@Slf4j注解</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Async</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">asynctarget</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">            log.debug(<span class="string">&quot;debug&quot;</span>);</span><br><span class="line">            log.info(<span class="string">&quot;info&quot;</span>);</span><br><span class="line">            log.warn(<span class="string">&quot;warn&quot;</span>);</span><br><span class="line">            log.error(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="将日志记录到文件中"><a href="#将日志记录到文件中" class="headerlink" title="将日志记录到文件中"></a>将日志记录到文件中</h2><p>配置：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">name:</span> [<span class="string">文件名</span>]</span><br><span class="line">  <span class="attr">logback:</span></span><br><span class="line">    <span class="attr">rollingpolicy:</span></span><br><span class="line">    <span class="comment"># 设置单个日志文件大小---超过则会新建另一个日志文件</span></span><br><span class="line">      <span class="attr">max-file-size:</span> <span class="string">10MB</span></span><br><span class="line">      <span class="comment">#设置日志文件格式</span></span><br><span class="line">      <span class="attr">file-name-pattern:</span> <span class="string">server.%d&#123;yyyy-MM-dd&#125;.%i.log</span></span><br></pre></td></tr></table></figure>
<h1 id="五、热部署"><a href="#五、热部署" class="headerlink" title="五、热部署"></a>五、热部署</h1><h2 id="手动热部署"><a href="#手动热部署" class="headerlink" title="手动热部署"></a>手动热部署</h2><p>添加依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>修改项目后 点击build</p>
<p><img src="/2022/05/07/springbootmaintain/5.png" alt="image-20220507214420229"></p>
<h2 id="开启自动热部署"><a href="#开启自动热部署" class="headerlink" title="开启自动热部署"></a>开启自动热部署</h2><ul>
<li>idea在setting中设置</li>
</ul>
<p><img src="/2022/05/07/springbootmaintain/6.png" alt="image-20220507215434761"></p>
<ul>
<li>ctrl + shift + alt + /</li>
</ul>
<p><img src="/2022/05/07/springbootmaintain/7.png" alt="image-20220507215733807"></p>
<p><img src="/2022/05/07/springbootmaintain/8.png" alt="image-20220507215604988"></p>
<h1 id="六、关闭热部署"><a href="#六、关闭热部署" class="headerlink" title="六、关闭热部署"></a>六、关闭热部署</h1><p>添加到更高级配置：系统属性</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">devtools:</span></span><br><span class="line">  <span class="attr">restart:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringbootEmailApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//系统层面添加配置</span></span><br><span class="line">        System.setProperty(<span class="string">&quot;spring.devtools.restart.enabled&quot;</span>,<span class="string">&quot;false&quot;</span>);</span><br><span class="line">        SpringApplication.run(SpringbootEmailApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>springboot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>springboot项目发布</tag>
      </tags>
  </entry>
  <entry>
    <title>springboot异步邮件</title>
    <url>/2022/05/05/springbootemail/</url>
    <content><![CDATA[<h1 id="一、异步任务"><a href="#一、异步任务" class="headerlink" title="一、异步任务"></a>一、异步任务</h1><p>在springboot中开启异步任务是很简单的，只需要在springboot启动类上标注@EnableAsync注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">//开启异步任务</span></span><br><span class="line"><span class="meta">@EnableAsync</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringbootEmailApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringbootEmailApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果想要让服务任务异步执行，只需要在异步服务类或者是异步方法上添加@Async注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Async</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncService</span> </span>&#123;</span><br><span class="line">	<span class="comment">//@Async</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">asynctarget</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样asynctarget（）方法就能异步执行了</p>
<p>使用spring boot  的 俩个注解时：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableAsync</span></span><br><span class="line"><span class="meta">@Async</span></span><br></pre></td></tr></table></figure>
<p>当一个线程多次重复调用时出现异常：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">org.springframework.aop.interceptor.AsyncExecutionAspectSupport.getDefaultExecutor(AsyncExecutionAspectSupport.java:236) : Could not find unique TaskExecutor bean</span><br><span class="line">org.springframework.beans.factory.NoUniqueBeanDefinitionException: No qualifying bean of type &#x27;org.springframework.core.task.TaskExecutor&#x27; available: expected single matching bean but found 2: applicationTaskExecutor,taskScheduler</span><br><span class="line">	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveNamedBean(DefaultListableBeanFactory.java:1148)</span><br><span class="line">	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveBean(DefaultListableBeanFactory.java:413)</span><br><span class="line">	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBean(DefaultListableBeanFactory.java:346)</span><br><span class="line">	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBean(DefaultListableBeanFactory.java:339)</span><br><span class="line">	at org.springframework.aop.interceptor.AsyncExecutionAspectSupport.getDefaultExecutor(AsyncExecutionAspectSupport.java:233)</span><br><span class="line">	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.getDefaultExecutor(AsyncExecutionInterceptor.java:157)</span><br><span class="line">	at org.springframework.aop.interceptor.AsyncExecutionAspectSupport.lambda$configure$2(AsyncExecutionAspectSupport.java:119)</span><br><span class="line">	at org.springframework.util.function.SingletonSupplier.get(SingletonSupplier.java:100)</span><br><span class="line">	at org.springframework.aop.interceptor.AsyncExecutionAspectSupport.determineAsyncExecutor(AsyncExecutionAspectSupport.java:172)</span><br><span class="line">	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.invoke(AsyncExecutionInterceptor.java:107)</span><br><span class="line">	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)</span><br><span class="line">	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:689)</span><br><span class="line">	at com.tuijie.goods.biz.jointstore.store.products.mountain.MountainServiceImpl$$EnhancerBySpringCGLIB$$893511f8.store(&lt;generated&gt;)</span><br></pre></td></tr></table></figure>
<p> 根据异常提示信息: 期望一个单列Bean 但是 找到了俩个相匹配的  bean.。所以报错.</p>
<p>但是使用这个 Bean 是直接使用的 spirng 的，根本没有在项目中定义，所以想要知道原因，需要去 生成Bean 的地方看看。</p>
<p>找到代码的地址 org.springframework.boot.autoconfigure.task.TaskExecutionAutoConfiguration#applicationTaskExecutor</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Lazy</span></span><br><span class="line"><span class="meta">@Bean(name = &#123; APPLICATION_TASK_EXECUTOR_BEAN_NAME,</span></span><br><span class="line"><span class="meta">		AsyncAnnotationBeanPostProcessor.DEFAULT_TASK_EXECUTOR_BEAN_NAME &#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(Executor.class)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ThreadPoolTaskExecutor <span class="title">applicationTaskExecutor</span><span class="params">(TaskExecutorBuilder builder)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> builder.build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>原来 bean 创建的时候有俩个 name ，这俩个 name 刚好对应: applicationTaskExecutor, taskExecutor, 也对应俩个 BeanDefinition.  Spring 在选用时候 不知道用哪个，报错。</p>
<p>点进去 @Async 里面说明</p>
<p>其 value 可以指定  Bean Definition 。加上</p>
<p> @Async(value = “applicationTaskExecutor”)<br>运行项目。解决</p>
<h1 id="二、邮件发送"><a href="#二、邮件发送" class="headerlink" title="二、邮件发送"></a>二、邮件发送</h1><h2 id="2-1-导入依赖"><a href="#2-1-导入依赖" class="headerlink" title="2.1 导入依赖"></a>2.1 导入依赖</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-2-查看配置"><a href="#2-2-查看配置" class="headerlink" title="2.2 查看配置"></a>2.2 查看配置</h2><p>查看自动配置类：MailSenderAutoConfiguration</p>
<p><img src="/2022/05/05/springbootemail/1.png" alt="image-20200801104504309"></p>
<p>这个类中存在bean，JavaMailSenderImpl</p>
<p>然后我们去看下配置文件</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.mail&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MailProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Charset DEFAULT_CHARSET = StandardCharsets.UTF_8;</span><br><span class="line">	<span class="keyword">private</span> String host;</span><br><span class="line">	<span class="keyword">private</span> Integer port;</span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line">	<span class="keyword">private</span> String protocol = <span class="string">&quot;smtp&quot;</span>;</span><br><span class="line">	<span class="keyword">private</span> Charset defaultEncoding = DEFAULT_CHARSET;</span><br><span class="line">	<span class="keyword">private</span> Map&lt;String, String&gt; properties = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">	<span class="keyword">private</span> String jndiName;</span><br><span class="line">	<span class="comment">//set、get方法省略。。。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置文件</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">spring.mail.username</span>=<span class="string">xxxxxx@qq.com</span></span><br><span class="line"><span class="meta">spring.mail.password</span>=<span class="string">你的qq授权码</span></span><br><span class="line"><span class="meta">spring.mail.host</span>=<span class="string">smtp.qq.com</span></span><br><span class="line"><span class="comment"># qq需要配置ssl</span></span><br><span class="line"><span class="meta">spring.mail.properties.mail.smtp.ssl.enable</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>
<p>获取授权码：在QQ邮箱中的设置-&gt;账户-&gt;开启pop3和smtp服务</p>
<p><img src="/2022/05/05/springbootemail/2.png" alt="image-20200801105503766"></p>
<p>编写测试类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    SimpleMailMessage mailMessage = <span class="keyword">new</span> SimpleMailMessage();</span><br><span class="line">    mailMessage.setSubject(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">    mailMessage.setText(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">    mailMessage.setTo(<span class="string">&quot;******@qq.com&quot;</span>);</span><br><span class="line">    mailMessage.setFrom(<span class="string">&quot;******@qq.com&quot;</span>);</span><br><span class="line">    mailSender.send(mailMessage);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">contextLoads2</span><span class="params">()</span> <span class="keyword">throws</span> MessagingException </span>&#123;</span><br><span class="line">    <span class="comment">//复杂邮件</span></span><br><span class="line">    MimeMessage mimeMessage = mailSender.createMimeMessage();</span><br><span class="line">    <span class="comment">//组装</span></span><br><span class="line">    MimeMessageHelper mimeMessageHelper = <span class="keyword">new</span> MimeMessageHelper(mimeMessage, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    mimeMessageHelper.setSubject(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br><span class="line">    mimeMessageHelper.setText(<span class="string">&quot;&lt;h1&gt;hello&lt;/h1&gt;&quot;</span>,<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//附件</span></span><br><span class="line">    mimeMessageHelper.addAttachment(<span class="string">&quot;1.jpg&quot;</span>,<span class="keyword">new</span> File(<span class="string">&quot;F:\\SpringBoot\\springboot-email\\src\\main\\resources\\static\\imgs\\lc2.png&quot;</span>));</span><br><span class="line"></span><br><span class="line">    mimeMessageHelper.setTo(<span class="string">&quot;******@qq.com&quot;</span>);</span><br><span class="line">    mimeMessageHelper.setFrom(<span class="string">&quot;******@qq.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">    mailSender.send(mimeMessage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="三、定时任务"><a href="#三、定时任务" class="headerlink" title="三、定时任务"></a>三、定时任务</h1><p>项目开发中经常需要执行一些定时任务，比如需要在每天凌晨的时候，分析一次前一天的日志信息，Spring为我们提供了异步执行任务调度的方式，提供了两个接口。</p>
<ul>
<li>TaskExecutor接口（任务执行者）</li>
<li>TaskScheduler接口（任务调度者）</li>
</ul>
<p>两个注解：</p>
<ul>
<li>@EnableScheduling——开启定时功能的注解</li>
<li>@Scheduled——什么时候执行</li>
</ul>
<h2 id="3-1-Scheduled使用cron表达式："><a href="#3-1-Scheduled使用cron表达式：" class="headerlink" title="3.1 @Scheduled使用cron表达式："></a>3.1 @Scheduled使用cron表达式：</h2><div class="table-container">
<table>
<thead>
<tr>
<th>字段</th>
<th>允许值</th>
<th>允许特殊字符</th>
</tr>
</thead>
<tbody>
<tr>
<td>秒</td>
<td>0-59</td>
<td>, - * /</td>
</tr>
<tr>
<td>分</td>
<td>0-59</td>
<td>, - * /</td>
</tr>
<tr>
<td>小时</td>
<td>0-23</td>
<td>, - * /</td>
</tr>
<tr>
<td>日期</td>
<td>1-31</td>
<td>, - * / ? L W C</td>
</tr>
<tr>
<td>月份</td>
<td>1-12</td>
<td>, - * /</td>
</tr>
<tr>
<td>星期</td>
<td>0,7是SUN</td>
<td>, - * / ? L W C</td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>特殊字符</th>
<th>代表含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>,</td>
<td>枚举</td>
</tr>
<tr>
<td>-</td>
<td>区间</td>
</tr>
<tr>
<td>*</td>
<td>任意</td>
</tr>
<tr>
<td>/</td>
<td>步长</td>
</tr>
<tr>
<td>?</td>
<td>日/星期冲突匹配</td>
</tr>
<tr>
<td>L</td>
<td>最后</td>
</tr>
<tr>
<td>W</td>
<td>工作日</td>
</tr>
<tr>
<td>C</td>
<td>和calendar练习后计算过的值</td>
</tr>
<tr>
<td>#</td>
<td>星期，4#2 第二个星期三</td>
</tr>
</tbody>
</table>
</div>
<p><strong>常用表达式</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">（1）0/2 * * * * ?   表示每2秒 执行任务</span><br><span class="line">（1）0 0/2 * * * ?   表示每2分钟 执行任务</span><br><span class="line">（1）0 0 2 1 * ?   表示在每月的1日的凌晨2点调整任务</span><br><span class="line">（2）0 15 10 ? * MON-FRI   表示周一到周五每天上午10:15执行作业</span><br><span class="line">（4）0 0 10,14,16 * * ?   每天上午10点，下午2点，4点</span><br><span class="line">（5）0 0/30 9-17 * * ?   朝九晚五工作时间内每半小时</span><br><span class="line">（6）0 0 12 ? * WED   表示每个星期三中午12点</span><br><span class="line">（7）0 0 12 * * ?   每天中午12点触发</span><br><span class="line">（8）0 15 10 ? * *   每天上午10:15触发</span><br><span class="line">（9）0 15 10 * * ?     每天上午10:15触发</span><br><span class="line">（10）0 15 10 * * ?   每天上午10:15触发</span><br><span class="line">（12）0 * 14 * * ?     在每天下午2点到下午2:59期间的每1分钟触发</span><br><span class="line">（13）0 0/5 14 * * ?   在每天下午2点到下午2:55期间的每5分钟触发</span><br><span class="line">（14）0 0/5 14,18 * * ?     在每天下午2点到2:55期间和下午6点到6:55期间的每5分钟触发</span><br><span class="line">（15）0 0-5 14 * * ?   在每天下午2点到下午2:05期间的每1分钟触发</span><br><span class="line">（16）0 10,44 14 ? 3 WED   每年三月的星期三的下午2:10和2:44触发</span><br><span class="line">（17）0 15 10 ? * MON-FRI   周一至周五的上午10:15触发</span><br><span class="line">（18）0 15 10 15 * ?   每月15日上午10:15触发</span><br><span class="line">（19）0 15 10 L * ?   每月最后一日的上午10:15触发</span><br><span class="line">（20）0 15 10 ? * 6L   每月的最后一个星期六上午10:15触发</span><br><span class="line">（21）0 15 10 ? * 6L 2002-2005   2002年至2005年的每月的最后一个星期六上午10:15触发</span><br><span class="line">（22）0 15 10 ? * 6#3   每月的第三个星期六上午10:15触发</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduledService</span> </span>&#123;</span><br><span class="line">    <span class="comment">//cron表达式</span></span><br><span class="line">    <span class="comment">//秒 分 时 日 月 星期（0-7，其中0和7都表示星期天，？表示所有）</span></span><br><span class="line">    <span class="comment">//  0/2 * * * * ? (两秒执行一次)</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0/2 * * * 5 5#1&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;特定时间执行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-2-Scheduled-其他参数"><a href="#3-2-Scheduled-其他参数" class="headerlink" title="3.2 @Scheduled 其他参数"></a>3.2 @Scheduled 其他参数</h2><p>Long fixedDelay：定时任务每隔多久执行一次，单位是毫秒，上一次任务结束后开始计算下次执行的时间。</p>
<p>Long fixedRate：与fixedDelay一样表示定时任务的执行时间间隔，不同的是fixedRate的不会受到上一次任务结束时间的影响</p>
]]></content>
      <categories>
        <category>springboot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>异步</tag>
        <tag>邮件</tag>
      </tags>
  </entry>
  <entry>
    <title>springboot整合redis</title>
    <url>/2022/05/06/springbootredis/</url>
    <content><![CDATA[<h1 id="SpringBoot整合Redis"><a href="#SpringBoot整合Redis" class="headerlink" title="SpringBoot整合Redis"></a>SpringBoot整合Redis</h1><h2 id="一、导入Redis依赖"><a href="#一、导入Redis依赖" class="headerlink" title="一、导入Redis依赖"></a>一、导入Redis依赖</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="二、编写配置"><a href="#二、编写配置" class="headerlink" title="二、编写配置"></a>二、编写配置</h2><ul>
<li><strong>注意springboot连接redis默认使用的是lettuce，而不是jedis</strong></li>
</ul>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br></pre></td></tr></table></figure>
<h2 id="三、测试"><a href="#三、测试" class="headerlink" title="三、测试"></a>三、测试</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1. redisTemplate 操作不同数据类型</span></span><br><span class="line">    <span class="comment">//opsForList  操作list</span></span><br><span class="line">    <span class="comment">//opsForValue 操作String</span></span><br><span class="line">    <span class="comment">//... set、hash、zset、geo</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//除了基本操作，常用的方法可以直接通过redisTemplate操作</span></span><br><span class="line">    <span class="comment">//例如：事务，和基本的增删改查（CRUD）</span></span><br><span class="line"></span><br><span class="line">    redisTemplate.opsForValue().set(<span class="string">&quot;mm&quot;</span>,<span class="string">&quot;hestial&quot;</span>);</span><br><span class="line">    System.out.println(redisTemplate.opsForValue().get(<span class="string">&quot;mm&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="四、自定义RedisTemplate-配置"><a href="#四、自定义RedisTemplate-配置" class="headerlink" title="四、自定义RedisTemplate 配置"></a>四、自定义RedisTemplate 配置</h2><ul>
<li>由于官方默认的RedisTemplate对存入的键值进行序列化会出现乱码</li>
<li>我们可以自定义RedisTemplate 并将其配置到ioc容器中（<strong>在源码中：如果ioc容器中已经存在名为redisTemplate的对象，则不会再次注入默认的redisTemplate</strong>）</li>
</ul>
<h3 id="4-1-redisconfig类"><a href="#4-1-redisconfig类" class="headerlink" title="4.1 redisconfig类"></a>4.1 redisconfig类</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean(name = &quot;redisTemplate&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String,Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span></span>&#123;</span><br><span class="line">        RedisTemplate&lt;String,Object&gt; template = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="comment">//序列化 json解析任意对象</span></span><br><span class="line">        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = <span class="keyword">new</span> Jackson2JsonRedisSerializer&lt;&gt;(Object.class);</span><br><span class="line">        <span class="comment">//使用ObjectMapper转义</span></span><br><span class="line">        ObjectMapper om = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.activateDefaultTyping(LaissezFaireSubTypeValidator.instance ,</span><br><span class="line">                ObjectMapper.DefaultTyping.NON_FINAL,</span><br><span class="line">                JsonTypeInfo.As.WRAPPER_ARRAY);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line">        <span class="comment">//String的序列化</span></span><br><span class="line">        StringRedisSerializer stringRedisSerializer = <span class="keyword">new</span> StringRedisSerializer();</span><br><span class="line">        <span class="comment">//key采用String的序列化方式</span></span><br><span class="line">        template.setKeySerializer(stringRedisSerializer);</span><br><span class="line">        <span class="comment">//hash的key也采用String 的序列化方式</span></span><br><span class="line">        template.setHashKeySerializer(stringRedisSerializer);</span><br><span class="line">        <span class="comment">//value采用jackson的序列化方式</span></span><br><span class="line">        template.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="comment">//hash的value也采用jackson的序列化方式</span></span><br><span class="line">        template.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        template.afterPropertiesSet();</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="五、编写RedisUtils"><a href="#五、编写RedisUtils" class="headerlink" title="五、编写RedisUtils"></a>五、编写RedisUtils</h2><ul>
<li>可以将redis的基础操作封装起来，作为工具类，简化开发</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.hestialx.utils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.CollectionUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lixu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-05-06-18:25</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisUtils</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String,Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定缓存失效时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">expire</span><span class="params">(String key, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                redisTemplate.expire(key, time, TimeUnit.SECONDS);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据 key 获取过期时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键(不能为 Null)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 时间(秒) 返回0代表永久有效</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getExpire</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.getExpire(key, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断 key 是否存在</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键(不能为 Null)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 存在 false 不存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hashKey</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.hasKey(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 可以传一个值 或多个</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">del</span><span class="params">(String... key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (key != <span class="keyword">null</span> &amp;&amp; key.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            redisTemplate.delete(key[<span class="number">0</span>]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            redisTemplate.delete((Collection&lt;String&gt;) CollectionUtils.arrayToList(key));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//==================================String====================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通缓存获取</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> key == <span class="keyword">null</span> ? <span class="keyword">null</span> : redisTemplate.opsForValue().get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通缓存放入</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 成功 false 失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">set</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForValue().set(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通缓存放入并设置时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  时间(秒) time &gt; 0 若 time &lt;= 0 将设置无限期</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 成功 false 失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">set</span><span class="params">(String key, Object value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                redisTemplate.opsForValue().set(key, value, time, TimeUnit.SECONDS);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                set(key, value);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 递增</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> delta 要增加几(大于0)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">incr</span><span class="params">(String key, <span class="keyword">long</span> delta)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (delta &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;递增因子必须大于0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().increment(key, delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 递减</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> delta 要减少几(小于0)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">decr</span><span class="params">(String key, <span class="keyword">long</span> delta)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (delta &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;递减因子必须大于0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().decrement(key, delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ===============================list=================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取list缓存的内容</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> start 开始</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> end   结束 0 到 -1代表所有值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Object&gt; <span class="title">lGet</span><span class="params">(String key, <span class="keyword">long</span> start, <span class="keyword">long</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().range(key, start, end);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取list缓存的长度</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">lGetListSize</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().size(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过索引 获取list中的值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index 索引 index&gt;=0时， 0 表头，1 第二个元素，依次类推；index&lt;0时，-1，表尾，-2倒数第二个元素，依次类推</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">lGetIndex</span><span class="params">(String key, <span class="keyword">long</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().index(key, index);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  时间(秒)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, Object value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, List&lt;Object&gt; value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPushAll(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, List&lt;Object&gt; value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPushAll(key, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据索引修改list中的某条数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index 索引</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lUpdateIndex</span><span class="params">(String key, <span class="keyword">long</span> index, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().set(key, index, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 移除N个值为value</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> count 移除多少个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 移除的个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">lRemove</span><span class="params">(String key, <span class="keyword">long</span> count, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Long remove = redisTemplate.opsForList().remove(key, count, value);</span><br><span class="line">            <span class="keyword">return</span> remove;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ============================set=============================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据key获取Set中的所有值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;Object&gt; <span class="title">sGet</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().members(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据value从一个set中查询,是否存在</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 存在 false不存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sHasKey</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().isMember(key, value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将数据放入set缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key    键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values 值 可以是多个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 成功个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sSet</span><span class="params">(String key, Object... values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().add(key, values);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将set数据放入缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key    键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time   时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values 值 可以是多个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 成功个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sSetAndTime</span><span class="params">(String key, <span class="keyword">long</span> time, Object... values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Long count = redisTemplate.opsForSet().add(key, values);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> count;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取set缓存的长度</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sGetSetSize</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().size(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 移除值为value的</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key    键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values 值 可以是多个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 移除的个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">setRemove</span><span class="params">(String key, Object... values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Long count = redisTemplate.opsForSet().remove(key, values);</span><br><span class="line">            <span class="keyword">return</span> count;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ================================Map=================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashGet</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项 不能为null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">hget</span><span class="params">(String key, String item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().get(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取hashKey对应的所有键值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 对应的多个键值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;Object, Object&gt; <span class="title">hmget</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().entries(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashSet</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map 对应多个键值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hmset</span><span class="params">(String key, Map&lt;String, Object&gt; map)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashSet 并设置时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map  对应多个键值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hmset</span><span class="params">(String key, Map&lt;String, Object&gt; map, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向一张hash表中放入数据,如果不存在将创建</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item  项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hset</span><span class="params">(String key, String item, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().put(key, item, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向一张hash表中放入数据,如果不存在将创建</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item  项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  时间(秒) 注意:如果已存在的hash表有时间,这里将会替换原有的时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hset</span><span class="params">(String key, String item, Object value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().put(key, item, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除hash表中的值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项 可以使多个 不能为null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hdel</span><span class="params">(String key, Object... item)</span> </span>&#123;</span><br><span class="line">        redisTemplate.opsForHash().delete(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断hash表中是否有该项的值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 存在 false不存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hHasKey</span><span class="params">(String key, String item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().hasKey(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * hash递增 如果不存在,就会创建一个 并把新增后的值返回</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> by   要增加几(大于0)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">hincr</span><span class="params">(String key, String item, <span class="keyword">double</span> by)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().increment(key, item, by);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * hash递减</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> by   要减少记(小于0)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">hdecr</span><span class="params">(String key, String item, <span class="keyword">double</span> by)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().increment(key, item, -by);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ===============================HyperLogLog=================================</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">pfadd</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHyperLogLog().add(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">pfcount</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHyperLogLog().size(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pfremove</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        redisTemplate.opsForHyperLogLog().delete(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pfmerge</span><span class="params">(String key1, String key2)</span> </span>&#123;</span><br><span class="line">        redisTemplate.opsForHyperLogLog().union(key1, key2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="六、再次测试"><a href="#六、再次测试" class="headerlink" title="六、再次测试"></a>六、再次测试</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">RedisUtils redisUtils;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">contextLoads1</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User(<span class="string">&quot;lx&quot;</span>, <span class="string">&quot;lx666&quot;</span>);</span><br><span class="line">    <span class="comment">//        redisTemplate.opsForValue().set(&quot;mm&quot;,user);</span></span><br><span class="line">    <span class="comment">//        System.out.println(redisTemplate.opsForValue().get(&quot;mm&quot;));</span></span><br><span class="line">    redisUtils.set(<span class="string">&quot;mm&quot;</span>,user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>springboot</category>
      </categories>
      <tags>
        <tag>redis</tag>
        <tag>springboot</tag>
      </tags>
  </entry>
  <entry>
    <title>spring</title>
    <url>/2022/03/19/spring/</url>
    <content><![CDATA[<h1 id="Spring框架学习"><a href="#Spring框架学习" class="headerlink" title="Spring框架学习"></a>Spring框架学习</h1><h2 id="一、简介"><a href="#一、简介" class="headerlink" title="一、简介"></a>一、简介</h2><p>Spring框架是由于软件开发的复杂性而创建的。Spring使用的是基本的JavaBean来完成以前只可能由EJB完成的事情。</p>
<h3 id="1-1-优点"><a href="#1-1-优点" class="headerlink" title="1.1 优点"></a>1.1 优点</h3><ul>
<li>Spring是一个开源的免费框架（容器）</li>
<li>Spring是一个轻量级的、非入侵式的框架</li>
<li>控制反转（IOC），面向切面编程（AOP）</li>
<li>支持事务的处理，对框架整合的支持</li>
</ul>
<p>总结</p>
<p>Spring是一个轻量级的控制反转（IOC）和（AOP）的框架</p>
<h3 id="1-2-spring模块组成"><a href="#1-2-spring模块组成" class="headerlink" title="1.2 spring模块组成"></a>1.2 spring模块组成</h3><p><img src="/2022/03/19/spring/1.png" alt="1"></p>
<h3 id="1-3-扩展"><a href="#1-3-扩展" class="headerlink" title="1.3 扩展"></a>1.3 扩展</h3><p><img src="/2022/03/19/spring/2.png" alt="1"></p>
<ul>
<li>Spring Boot<ul>
<li>一个快速开发的脚手架</li>
<li>基于SpringBoot可以快速开发一个微服务</li>
<li>约定大于配置</li>
</ul>
</li>
<li>Spring Cloud<ul>
<li>SpringCloud是基于SpringBoot实现的。</li>
</ul>
</li>
</ul>
<h3 id="1-4-导入包"><a href="#1-4-导入包" class="headerlink" title="1.4 导入包"></a>1.4 导入包</h3><ul>
<li>初学Spring需要导入Spring core 等一系列的包，可以通过导入spring-webmvc代替</li>
<li>因为spring-webmvc本身依赖很多spring的包，所以maven会自动进行导入</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-webmvc --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="二、初步尝试Spring-（通过配置文件动态的获取对象实例）"><a href="#二、初步尝试Spring-（通过配置文件动态的获取对象实例）" class="headerlink" title="二、初步尝试Spring （通过配置文件动态的获取对象实例）"></a>二、初步尝试Spring （通过配置文件动态的获取对象实例）</h2><h3 id="1-编写一个service类添加一个属性usrdao"><a href="#1-编写一个service类添加一个属性usrdao" class="headerlink" title="1. 编写一个service类添加一个属性usrdao"></a>1. 编写一个service类添加一个属性usrdao</h3><p>userDao接口 以及 它的实现</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">userDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetUser</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">mysqlUserDaoImpl</span> <span class="keyword">implements</span> <span class="title">userDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;使用Mysql&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">oracleUserDaoImpl</span> <span class="keyword">implements</span> <span class="title">userDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;使用Oracle&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>userService类（注意：要编写userDao ud;的get和set方法）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">userService</span> </span>&#123;</span><br><span class="line">    userDao ud;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">userGet</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ud.GetUser();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> userDao <span class="title">getUd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ud;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUd</span><span class="params">(userDao ud)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.ud = ud;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编写配置文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;mathUtils&quot;</span> <span class="attr">class</span>=<span class="string">&quot;utils.mathUtils&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- additional collaborators and configuration for this bean go here --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;base&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;mysqlUserDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mapper.Impl.mysqlUserDaoImpl&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;oracleUserDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mapper.Impl.oracleUserDaoImpl&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;service.userService&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- additional collaborators and configuration for this bean go here --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;ud&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;oracleUserDao&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>编写测试类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test1</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">StringTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ApplicationContext classPathXmlApplicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">        userService us = (userService) classPathXmlApplicationContext.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        us.userGet();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="三、IOC创建对象的方式"><a href="#三、IOC创建对象的方式" class="headerlink" title="三、IOC创建对象的方式"></a>三、IOC创建对象的方式</h2><h3 id="1-采用无参构造创建对象（默认实现，通过对象的set方法注入）"><a href="#1-采用无参构造创建对象（默认实现，通过对象的set方法注入）" class="headerlink" title="1. 采用无参构造创建对象（默认实现，通过对象的set方法注入）"></a>1. 采用无参构造创建对象（默认实现，通过对象的set方法注入）</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;mathUtils&quot;</span> <span class="attr">class</span>=<span class="string">&quot;utils.mathUtils&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- additional collaborators and configuration for this bean go here --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;base&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;mysqlUserDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mapper.Impl.mysqlUserDaoImpl&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;oracleUserDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mapper.Impl.oracleUserDaoImpl&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;service.userService&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- additional collaborators and configuration for this bean go here --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;ud&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;oracleUserDao&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-采用有参构造创建对象"><a href="#2-采用有参构造创建对象" class="headerlink" title="2. 采用有参构造创建对象"></a>2. 采用有参构造创建对象</h3><ol>
<li><p>通常参数索引赋值</p>
<p>构造函数参数索引</p>
<p>您可以使用<code>index</code>属性来显式指定构造函数参数的索引，如以下示例所示：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;exampleBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.ExampleBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span> <span class="attr">value</span>=<span class="string">&quot;7500000&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;42&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>除了解决多个简单值的歧义性之外，指定索引还可以解决歧义，其中构造函数具有两个相同类型的参数。</p>
<p><strong>索引从 0 开始。</strong></p>
</li>
<li><p>通过参数名称赋值</p>
<p>您还可以使用构造函数参数名称来消除歧义，如以下示例所示：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;exampleBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;examples.ExampleBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;years&quot;</span> <span class="attr">value</span>=<span class="string">&quot;7500000&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;ultimateAnswer&quot;</span> <span class="attr">value</span>=<span class="string">&quot;42&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>请记住，要立即使用该功能，必须在启用调试标志的情况下编译代码，以便 Spring 可以从构造函数中查找参数名称。如果您不能或不想使用 debug 标志编译代码，则可以使用<a href="https://download.oracle.com/javase/6/docs/api/java/beans/ConstructorProperties.html">@ConstructorProperties</a> JDK注解 显式命名构造函数参数。然后，该示例类必须如下所示：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> examples;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Fields omitted</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ConstructorProperties(&#123;&quot;years&quot;, &quot;ultimateAnswer&quot;&#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ExampleBean</span><span class="params">(<span class="keyword">int</span> years, String ultimateAnswer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.years = years;</span><br><span class="line">        <span class="keyword">this</span>.ultimateAnswer = ultimateAnswer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过参数类型实现（可能产生歧义）</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;thingOne&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.ThingOne&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;thingTwo&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;thingThree&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;thingTwo&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.ThingTwo&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;thingThree&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.ThingThree&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="注意！"><a href="#注意！" class="headerlink" title="注意！"></a>注意！</h4><p>在使用getbean时，spring会将所有已经注册的对象都实例化。</p>
<h2 id="四、Spring配置"><a href="#四、Spring配置" class="headerlink" title="四、Spring配置"></a>四、Spring配置</h2><h3 id="4-1-别名（在配置文件中配置，原始名字也能使用）"><a href="#4-1-别名（在配置文件中配置，原始名字也能使用）" class="headerlink" title="4.1 别名（在配置文件中配置，原始名字也能使用）"></a>4.1 别名（在配置文件中配置，原始名字也能使用）</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;aAdd&quot;</span> <span class="attr">class</span>=<span class="string">&quot;utils.mathAdd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;add&quot;</span> <span class="attr">value</span>=<span class="string">&quot;35&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">alias</span> <span class="attr">name</span>=<span class="string">&quot;aAdd&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;addTest&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">5</span>;</span><br><span class="line">    ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">    mathAdd aAdd = (mathAdd) ac.getBean(<span class="string">&quot;addTest&quot;</span>);</span><br><span class="line">    <span class="keyword">int</span> add = aAdd.readd(a);</span><br><span class="line">    System.out.println(add);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-bean"><a href="#4-2-bean" class="headerlink" title="4.2 bean"></a>4.2 bean</h3><ul>
<li><p>id：bean的唯一标识符，相当于对象名</p>
</li>
<li><p>class：bean 对象对应的全限定名：包名+类型名</p>
</li>
<li><p>name：也是别名，并且name<strong>可以取多个别名</strong></p>
<ul>
<li>```xml<!--分隔符可以有多种‘,’/‘ ’/‘;’-->
<bean id="aAdd" class="utils.mathAdd" name="add1,add2,add3"><pre><code>&lt;constructor-arg name=&quot;add&quot; value=&quot;35&quot;/&gt;
</code></pre>&lt;/bean&gt;<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">### 4.3 import</span><br><span class="line"></span><br><span class="line">#### import一般用于团队开发使用，可以将多个配置文件导入合并为一个配置</span><br><span class="line"></span><br><span class="line">如果项目开发中，多个人负责不同类的开发，分别注册到不同的bean配置文件中，可以利用import将所有的bean整合到一起</span><br><span class="line"></span><br><span class="line">* beans1.xml</span><br><span class="line">* beans2.xml</span><br><span class="line">* applicationContext.xml</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans</span><br><span class="line">        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;import resource=&quot;beans1.xml&quot;/&gt;</span><br><span class="line">&lt;import resource=&quot;beans2.xml&quot;/&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
</bean></li>
</ul>
</li>
</ul>
<h2 id="五、依赖注入"><a href="#五、依赖注入" class="headerlink" title="五、依赖注入"></a>五、依赖注入</h2><h3 id="IOC与DI"><a href="#IOC与DI" class="headerlink" title="IOC与DI"></a>IOC与DI</h3><ol>
<li>IOC — Inverse of Control，控制反转，将对象的创建权反转给Spring </li>
<li>DI — Dependency Injection，依赖注入，在Spring框架负责创建Bean对象时，动态的将依赖对象注 入到Bean组件中 </li>
</ol>
<p>一句话总结: ioc是让spring创建对象的，而DI是spring在对象创建完毕之后，为对象的成员变量提供初 始化</p>
<h3 id="5-1-构造器注入"><a href="#5-1-构造器注入" class="headerlink" title="5.1 构造器注入"></a>5.1 构造器注入</h3><p>见第三章</p>
<h3 id="5-2-set注入【重点】"><a href="#5-2-set注入【重点】" class="headerlink" title="5.2 set注入【重点】"></a>5.2 set注入【重点】</h3><h4 id="5-2-1复杂类型的构建"><a href="#5-2-1复杂类型的构建" class="headerlink" title="5.2.1复杂类型的构建"></a>5.2.1复杂类型的构建</h4><p>address类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span> </span>&#123;</span><br><span class="line">    String province;</span><br><span class="line">    String city;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>student类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line">    <span class="keyword">private</span> String wife;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; hoppy;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,String&gt; card;</span><br><span class="line">    <span class="keyword">private</span> Properties info;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>beans配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;student1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;pojo.Student&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--第一种：普通值注入，value--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;lx&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--第二种：bean注入，ref--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;address&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;address1&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--第三种：数组注入--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;books&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>红楼梦<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>水浒传<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>三国演义<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>西游记<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--第四种：list注入--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hoppy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>跑步<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>写代码<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>吃零食<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>看动漫<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--第五种：map注入--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;qq&quot;</span> <span class="attr">value</span>=<span class="string">&quot;vip999&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;wx&quot;</span> <span class="attr">value</span>=<span class="string">&quot;vip9&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;baiduyun&quot;</span> <span class="attr">value</span>=<span class="string">&quot;vip999&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;xunlei&quot;</span> <span class="attr">value</span>=<span class="string">&quot;vip99&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--第六种：null注入--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;wife&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">null</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--第七种：properties注入--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;username&quot;</span>&gt;</span>123<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;password&quot;</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;address1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;pojo.Address&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;city&quot;</span> <span class="attr">value</span>=<span class="string">&quot;武汉&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;province&quot;</span> <span class="attr">value</span>=<span class="string">&quot;湖北&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="5-3-扩展注入方式"><a href="#5-3-扩展注入方式" class="headerlink" title="5.3 扩展注入方式"></a>5.3 扩展注入方式</h3><h4 id="1-p命名空间"><a href="#1-p命名空间" class="headerlink" title="1. p命名空间"></a>1. p命名空间</h4><p>原始配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myDataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;close&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- results in a setDriverClassName(String) call --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mydb&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;masterkaoli&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>p-namespace 允许您使用<code>bean</code>元素的属性(而不是嵌套的<code>&lt;property/&gt;</code>元素)来描述协作 Bean 的属性值，或同时使用这两者。</p>
<p><strong>以下示例使用p-namespace进行更简洁的 XML 配置：</strong></p>
<ul>
<li><strong>注意</strong>： 在使用p-namespace时需要在beans前导入 ：xmlns:p=”<a href="http://www.springframework.org/schema/p">http://www.springframework.org/schema/p</a>“</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myDataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">destroy-method</span>=<span class="string">&quot;close&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">p:driverClassName</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">p:url</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mydb&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">p:username</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">p:password</span>=<span class="string">&quot;masterkaoli&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-c命名空间"><a href="#2-c命名空间" class="headerlink" title="2. c命名空间"></a>2. c命名空间</h4><p>与<a href="https://www.docs4dev.com/docs/zh/spring-framework/5.1.3.RELEASE/reference/core.html#beans-p-namespace">具有 p-命名空间的 XML 快捷方式</a>相似，在 Spring 3.1 中引入的 c-namespace 允许使用内联属性来配置构造函数参数，而不是嵌套的<code>constructor-arg</code>元素。</p>
<ul>
<li>注意在引入c命名空间时需要导入：xmlns:c=”<a href="http://www.springframework.org/schema/c">http://www.springframework.org/schema/c</a>“</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:c</span>=<span class="string">&quot;http://www.springframework.org/schema/c&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;thingOne&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.ThingTwo&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;thingTwo&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.ThingThree&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- traditional declaration --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;thingOne&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.ThingOne&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;thingTwo&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;thingThree&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;[emailprotected]&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- c-namespace declaration --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;thingOne&quot;</span> <span class="attr">class</span>=<span class="string">&quot;x.y.ThingOne&quot;</span> <span class="attr">c:thingTwo-ref</span>=<span class="string">&quot;thingTwo&quot;</span> <span class="attr">c:thingThree-ref</span>=<span class="string">&quot;thingThree&quot;</span> <span class="attr">c:email</span>=<span class="string">&quot;[emailprotected]&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Bean的作用域"><a href="#Bean的作用域" class="headerlink" title="Bean的作用域"></a>Bean的作用域</h2><div class="table-container">
<table>
<thead>
<tr>
<th>Scope</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.docs4dev.com/docs/zh/spring-framework/5.1.3.RELEASE/reference/core.html#beans-factory-scopes-singleton">singleton</a></td>
<td>(默认)将每个 Spring IoC 容器的单个 bean 定义范围限定为单个对象实例。</td>
</tr>
<tr>
<td><a href="https://www.docs4dev.com/docs/zh/spring-framework/5.1.3.RELEASE/reference/core.html#beans-factory-scopes-prototype">prototype</a></td>
<td>将单个 bean 定义的作用域限定为任意数量的对象实例。</td>
</tr>
<tr>
<td><a href="https://www.docs4dev.com/docs/zh/spring-framework/5.1.3.RELEASE/reference/core.html#beans-factory-scopes-request">request</a></td>
<td>将单个 bean 定义的范围限定为单个 HTTP 请求的生命周期。也就是说，每个 HTTP 请求都有一个在单个 bean 定义后面创建的 bean 实例。仅在可感知网络的 Spring <code>ApplicationContext</code>中有效。</td>
</tr>
<tr>
<td><a href="https://www.docs4dev.com/docs/zh/spring-framework/5.1.3.RELEASE/reference/core.html#beans-factory-scopes-session">session</a></td>
<td>将单个 bean 定义的范围限定为 HTTP <code>Session</code>的生命周期。仅在可感知网络的 Spring <code>ApplicationContext</code>上下文中有效。</td>
</tr>
<tr>
<td><a href="https://www.docs4dev.com/docs/zh/spring-framework/5.1.3.RELEASE/reference/core.html#beans-factory-scopes-application">application</a></td>
<td>将单个 bean 定义的范围限定为<code>ServletContext</code>的生命周期。仅在可感知网络的 Spring <code>ApplicationContext</code>上下文中有效。</td>
</tr>
<tr>
<td><a href="https://www.docs4dev.com/docs/zh/spring-framework/5.1.3.RELEASE/reference/web.html#websocket-stomp-websocket-scope">websocket</a></td>
<td>将单个 bean 定义的范围限定为<code>WebSocket</code>的生命周期。仅在可感知网络的 Spring <code>ApplicationContext</code>上下文中有效。</td>
</tr>
</tbody>
</table>
</div>
<ol>
<li>单例模式（默认）</li>
<li>原型模式prototype：每次get时产生一个新对象</li>
</ol>
<h2 id="六、Bean的自动装配"><a href="#六、Bean的自动装配" class="headerlink" title="六、Bean的自动装配"></a>六、Bean的自动装配</h2><ul>
<li>自动装配是Spring满足bean依赖的一种方式！</li>
<li>Spring会在上下文中自动寻找，并自动的给bean装配属性！</li>
</ul>
<p>在Spring中有三种装配方式</p>
<ol>
<li>在xml中显示的配置</li>
<li>在java中显示的配置</li>
<li>隐式的自动装配bean</li>
</ol>
<h3 id="6-1-测试"><a href="#6-1-测试" class="headerlink" title="6.1 测试"></a>6.1 测试</h3><ol>
<li><p>环境搭建</p>
<ul>
<li>一个人有一个狗</li>
</ul>
</li>
<li><p>使用xml显示的配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">xmlns:c</span>=<span class="string">&quot;http://www.springframework.org/schema/c&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dog1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;pojo.Dog&quot;</span> <span class="attr">p:dname</span>=<span class="string">&quot;大狗&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;pojo.User&quot;</span> <span class="attr">c:name</span>=<span class="string">&quot;lx&quot;</span> <span class="attr">c:psw</span>=<span class="string">&quot;123&quot;</span> <span class="attr">c:d-ref</span>=<span class="string">&quot;dog1&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;pojo.User&quot;</span> <span class="attr">p:d-ref</span>=<span class="string">&quot;dog1&quot;</span> <span class="attr">p:name</span>=<span class="string">&quot;lx1&quot;</span> <span class="attr">p:psw</span>=<span class="string">&quot;456&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="6-2-使用bean的autowire属性实现自动装配-了解"><a href="#6-2-使用bean的autowire属性实现自动装配-了解" class="headerlink" title="6.2 使用bean的autowire属性实现自动装配(了解)"></a>6.2 使用bean的autowire属性实现自动装配(了解)</h3><h4 id="1-使用byName自动装配"><a href="#1-使用byName自动装配" class="headerlink" title="1. 使用byName自动装配"></a>1. 使用byName自动装配</h4><h4 id="2-使用byType自动装配"><a href="#2-使用byType自动装配" class="headerlink" title="2. 使用byType自动装配"></a>2. 使用byType自动装配</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:c</span>=<span class="string">&quot;http://www.springframework.org/schema/c&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;d&quot;</span> <span class="attr">class</span>=<span class="string">&quot;pojo.Dog&quot;</span> <span class="attr">p:dname</span>=<span class="string">&quot;大狗&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;bean id=&quot;name&quot; class=&quot;java.lang.String&quot; c:original=&quot;lx&quot;/&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;bean id=&quot;psw&quot; class=&quot;java.lang.String&quot; c:original=&quot;666&quot;/&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;pojo.User&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byName&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;pojo.User&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byType&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">autoBeanTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;beans1.xml&quot;</span>);</span><br><span class="line">    User user1 = ac.getBean(<span class="string">&quot;user1&quot;</span>, User.class);</span><br><span class="line">    User user2 = ac.getBean(<span class="string">&quot;user2&quot;</span>, User.class);</span><br><span class="line">    System.out.println(user1);</span><br><span class="line">    System.out.println(user2);</span><br><span class="line">    String string = <span class="keyword">new</span> String(<span class="string">&quot;sadsa&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">User&#123;name=&#x27;null&#x27;, psw=&#x27;null&#x27;, d=Dog&#123;Dname=&#x27;大狗&#x27;&#125;&#125;</span><br><span class="line">User&#123;name=&#x27;null&#x27;, psw=&#x27;null&#x27;, d=Dog&#123;Dname=&#x27;大狗&#x27;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：使用autowire进行自动注入，没有自动注入String类型的值、</p>
<h4 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h4><ul>
<li><p>byName的时候，需要保证所有bean的id唯一，并且这个bean需要和自动注入的属性的set方法的值一致!. </p>
</li>
<li><p>byType的时候，需要保证所有bean的class唯一，并且这个bean需要和自动注入的属性的类型一致!</p>
</li>
</ul>
<h3 id="6-3-使用注解进行自动装配"><a href="#6-3-使用注解进行自动装配" class="headerlink" title="6.3 使用注解进行自动装配"></a>6.3 使用注解进行自动装配</h3><p>jdk1.5开始支持注解，Spring2.5开始支持注解</p>
<ul>
<li><p>添加：属性</p>
<ul>
<li>xmlns:context=”<a href="http://www.springframework.org/schema/context">http://www.springframework.org/schema/context</a>“</li>
</ul>
</li>
<li><p>xsi:schemaLocation=中添加：</p>
<ul>
<li><a href="http://www.springframework.org/schema/context">http://www.springframework.org/schema/context</a><br><a href="http://www.springframework.org/schema/context/spring-context.xsd">http://www.springframework.org/schema/context/spring-context.xsd</a></li>
</ul>
</li>
<li>配置：\<context:annotation-config>注解支持</context:annotation-config></li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:c</span>=<span class="string">&quot;http://www.springframework.org/schema/c&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置注解支持--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;pojo.User&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;d&quot;</span> <span class="attr">class</span>=<span class="string">&quot;pojo.Dog&quot;</span> <span class="attr">p:dname</span>=<span class="string">&quot;大狗&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;lx&quot;)</span></span><br><span class="line">    String name;</span><br><span class="line">    <span class="meta">@Value(&quot;213&quot;)</span></span><br><span class="line">    String psw;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    Dog d;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>普通值注入可以通过 @Value(“lx”)</p>
</li>
<li><p>引用值注入：</p>
<p><strong>@Autowired与@Resource都可以用来装配bean. 都可以写在字段上,或写在setter方法上。</strong></p>
<ul>
<li><p>@Autowired</p>
<ul>
<li>默认按类型装配（这个注解是属业spring的），默认情况下必须要求依赖对象必须存在，如果要允许null值，可以设置它的required属性为false，如：@Autowired(required=false)</li>
</ul>
</li>
<li><p>@Autowired可以和@Qualifier(value=”bean的id名称”)联合使用</p>
<ul>
<li><p>如果我们想使用bean id 装配可以结合@Qualifier注解进行使用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired()</span></span><br><span class="line"><span class="meta">@Qualifier(value=&quot;baseDao&quot;)</span></span><br><span class="line"><span class="keyword">private</span> BaseDao baseDao;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>@Resource</p>
<ul>
<li>（这个注解属于J2EE的），默认按照名称进行装配，名称可以通过name属性进行指定，如果没有指定name属性，当注解写在字段上时，默认取字段名进行安装名称查找，如果注解写在setter方法上默认取属性名进行装配。当找不到与名称匹配的bean时才按照类型进行装配。但是需要注意的是，如果name属性一旦指定，就只会按照bean名称(id)进行装配。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="七、使用注解开发"><a href="#七、使用注解开发" class="headerlink" title="七、使用注解开发"></a>七、使用注解开发</h2><ol>
<li>导入包：</li>
</ol>
<p>​    <img src="/2022/03/19/spring/3.png" alt="image-20220322161155548"></p>
<ol>
<li><p>导入注解约束（context），增加对注解的支持</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置支持注解--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;context:annotation-config/&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置自动扫描包，使包下的注解生效--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;cn.hestialx.pojo&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>如果配置了\<context:component-scan>标签元素，那么\<context:annotation-config>标签就可以不用在xml中配置了，因为前者包含了后者。</context:annotation-config></context:component-scan></li>
</ul>
</li>
</ol>
<h3 id="7-1、bean-Component"><a href="#7-1、bean-Component" class="headerlink" title="7.1、bean-@Component"></a>7.1、bean-@Component</h3><h4 id="使用-Component注解代替bean的编写"><a href="#使用-Component注解代替bean的编写" class="headerlink" title="使用@Component注解代替bean的编写"></a>使用@Component注解代替bean的编写</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span> <span class="comment">//Component没有传入value值时，默认value为类名称首字母小写</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>@Component相当于<bean id="user" class="pojo.User">的作用</bean></p>
<h3 id="7-2、属性如何注入-Value"><a href="#7-2、属性如何注入-Value" class="headerlink" title="7.2、属性如何注入  - @Value"></a>7.2、属性如何注入  - @Value</h3><ul>
<li><p>普通值注入可以通过 @Value(“lx”)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span> <span class="comment">//Component没有传入value值时，默认value为类名称首字母小写</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;lx&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>引用值注入</p>
</li>
</ul>
<h3 id="7-3、衍生注解"><a href="#7-3、衍生注解" class="headerlink" title="7.3、衍生注解"></a>7.3、衍生注解</h3><ul>
<li>@Component有几个功能相同的衍生注解(主要是用来区分web开发中的MVC不同层的)<ul>
<li>dao层对应:[@Repository]</li>
<li>service层对应:[@Service]’</li>
<li>controller层对应:[@Controller]</li>
</ul>
</li>
</ul>
<h3 id="7-4、自动装配"><a href="#7-4、自动装配" class="headerlink" title="7.4、自动装配"></a>7.4、自动装配</h3><h3 id="7-5、作用域-Scope"><a href="#7-5、作用域-Scope" class="headerlink" title="7.5、作用域-@Scope"></a>7.5、作用域-@Scope</h3><p>Bean的作用域</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Scope</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.docs4dev.com/docs/zh/spring-framework/5.1.3.RELEASE/reference/core.html#beans-factory-scopes-singleton">singleton</a></td>
<td>(默认)将每个 Spring IoC 容器的单个 bean 定义范围限定为单个对象实例。</td>
</tr>
<tr>
<td><a href="https://www.docs4dev.com/docs/zh/spring-framework/5.1.3.RELEASE/reference/core.html#beans-factory-scopes-prototype">prototype</a></td>
<td>将单个 bean 定义的作用域限定为任意数量的对象实例。</td>
</tr>
<tr>
<td><a href="https://www.docs4dev.com/docs/zh/spring-framework/5.1.3.RELEASE/reference/core.html#beans-factory-scopes-request">request</a></td>
<td>将单个 bean 定义的范围限定为单个 HTTP 请求的生命周期。也就是说，每个 HTTP 请求都有一个在单个 bean 定义后面创建的 bean 实例。仅在可感知网络的 Spring <code>ApplicationContext</code>中有效。</td>
</tr>
<tr>
<td><a href="https://www.docs4dev.com/docs/zh/spring-framework/5.1.3.RELEASE/reference/core.html#beans-factory-scopes-session">session</a></td>
<td>将单个 bean 定义的范围限定为 HTTP <code>Session</code>的生命周期。仅在可感知网络的 Spring <code>ApplicationContext</code>上下文中有效。</td>
</tr>
<tr>
<td><a href="https://www.docs4dev.com/docs/zh/spring-framework/5.1.3.RELEASE/reference/core.html#beans-factory-scopes-application">application</a></td>
<td>将单个 bean 定义的范围限定为<code>ServletContext</code>的生命周期。仅在可感知网络的 Spring <code>ApplicationContext</code>上下文中有效。</td>
</tr>
<tr>
<td><a href="https://www.docs4dev.com/docs/zh/spring-framework/5.1.3.RELEASE/reference/web.html#websocket-stomp-websocket-scope">websocket</a></td>
<td>将单个 bean 定义的范围限定为<code>WebSocket</code>的生命周期。仅在可感知网络的 Spring <code>ApplicationContext</code>上下文中有效。</td>
</tr>
</tbody>
</table>
</div>
<ol>
<li>单例模式（默认）</li>
<li>原型模式prototype：每次get时产生一个新对象</li>
</ol>
<p>使用注解@Scope(“”)</p>
<ul>
<li>配置bean的作用域</li>
</ul>
<h2 id="JavaConfig实现配置Spring"><a href="#JavaConfig实现配置Spring" class="headerlink" title="JavaConfig实现配置Spring"></a>JavaConfig实现配置Spring</h2><p>完全不使用Spring的xml配置，全权交给Java来做！</p>
<p>JavaConfig时Spring的一个子项目，在Spring4后，成为核心功能</p>
<h3 id="使用纯java注解实现Spring配置"><a href="#使用纯java注解实现Spring配置" class="headerlink" title="* 使用纯java注解实现Spring配置"></a>* 使用纯java注解实现Spring配置</h3><h4 id="1-使用-ComponentScan-“cn-hestialx-pojo”-配置包扫描（相当于注解方式）"><a href="#1-使用-ComponentScan-“cn-hestialx-pojo”-配置包扫描（相当于注解方式）" class="headerlink" title="1. 使用@ComponentScan(“cn.hestialx.pojo”)配置包扫描（相当于注解方式）"></a>1. 使用@ComponentScan(“cn.hestialx.pojo”)配置包扫描（相当于注解方式）</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(&quot;cn.hestialx.pojo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">hestialxConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用步骤：</p>
<ul>
<li><p>创建一个类hestialxConfig</p>
</li>
<li><p>添加包扫描注解@ComponentScan(“cn.hestialx.pojo”)</p>
<ul>
<li><p>相当于</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置支持注解--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;context:annotation-config/&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置自动扫描包，使包下的注解生效--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;cn.hestialx.pojo&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>类的注解就和第七章中的使用注解开发内容一致</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span> <span class="comment">//Component没有传入value值时，默认value为类名称首字母小写</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;lx&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>！！！注意，在加载配置时要使用AnnotationConfigApplicationContext，并传递包名</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configTest1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ApplicationContext ac = <span class="keyword">new</span> AnnotationConfigApplicationContext(<span class="string">&quot;cn.hestialx.pojo&quot;</span>);</span><br><span class="line">    User u1 = ac.getBean(<span class="string">&quot;user&quot;</span>, User.class);</span><br><span class="line">    System.out.println(u1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-使用-Configuration（相当于xml配置方式）"><a href="#2-使用-Configuration（相当于xml配置方式）" class="headerlink" title="2.使用@Configuration（相当于xml配置方式）"></a>2.使用@Configuration（相当于xml配置方式）</h4><p>使用步骤：</p>
<ul>
<li><p>创建一个类hestialxConfig</p>
</li>
<li><p>添加注解@Configuration</p>
<ul>
<li>@Configuration可理解为用spring的时候xml里面的<beans>标签</beans></li>
</ul>
</li>
<li><p>编写方法，并加上@Bean注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">hestialxConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Student <span class="title">getStudent</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Student s = <span class="keyword">new</span> Student();</span><br><span class="line">        s.setName(<span class="string">&quot;lx&quot;</span>);</span><br><span class="line">        s.setId(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> s</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>@Bean可理解为用spring的时候xml里面的<bean>标签，其中bean的<strong>id</strong>默认为方法的名称</bean></li>
</ul>
</li>
<li><p>使用获取配置的对象</p>
<ul>
<li>注意，在new AnnotationConfigApplicationContext中传入注解@Configuration配置的类的class字节码对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">javaConfigTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ApplicationContext ac = <span class="keyword">new</span> AnnotationConfigApplicationContext(hestialxConfig.class);</span><br><span class="line">    User u1 = ac.getBean(<span class="string">&quot;getUser&quot;</span>, User.class);</span><br><span class="line">    System.out.println(u1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="import注解"><a href="#import注解" class="headerlink" title="import注解"></a>import注解</h4><p>在java配置类上使用import注解可以通过类的字节码对象引入其他配置类的信息</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import(hestialxConfig1.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">hestialxConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">        User u = <span class="keyword">new</span> User();</span><br><span class="line">        u.setName(<span class="string">&quot;lx&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="八、代理模式"><a href="#八、代理模式" class="headerlink" title="八、代理模式"></a>八、代理模式</h2><p>在代理模式（Proxy Pattern）中，一个类代表另一个类的功能。这种类型的设计模式属于结构型模式。</p>
<p>在代理模式中，我们创建具有现有对象的对象，以便向外界提供功能接口。</p>
<p><strong>意图：</strong>为其他对象提供一种代理以控制对这个对象的访问。</p>
<p><strong>主要解决：</strong>在直接访问对象时带来的问题，比如说：要访问的对象在远程的机器上。在面向对象系统中，有些对象由于某些原因（比如对象创建开销很大，或者某些操作需要安全控制，或者需要进程外的访问），直接访问会给使用者或者系统结构带来很多麻烦，我们可以在访问此对象时加上一个对此对象的访问层。</p>
<p><strong>何时使用：</strong>想在访问一个类时做一些控制。</p>
<p><strong>如何解决：</strong>增加中间层。</p>
<p><strong>关键代码：</strong>实现与被代理类组合。</p>
<p><strong>应用实例：</strong> 1、Windows 里面的快捷方式。 2、猪八戒去找高翠兰结果是孙悟空变的，可以这样理解：把高翠兰的外貌抽象出来，高翠兰本人和孙悟空都实现了这个接口，猪八戒访问高翠兰的时候看不出来这个是孙悟空，所以说孙悟空是高翠兰代理类。 3、买火车票不一定在火车站买，也可以去代售点。 4、一张支票或银行存单是账户中资金的代理。支票在市场交易中用来代替现金，并提供对签发人账号上资金的控制。 5、spring aop。</p>
<p><strong>优点：</strong> 1、职责清晰。 2、高扩展性。 3、智能化。</p>
<p><strong>缺点：</strong> 1、由于在客户端和真实主题之间增加了代理对象，因此有些类型的代理模式可能会造成请求的处理速度变慢。 2、实现代理模式需要额外的工作，有些代理模式的实现非常复杂。</p>
<p><strong>使用场景：</strong>按职责来划分，通常有以下使用场景： 1、远程代理。 2、虚拟代理。 3、Copy-on-Write 代理。 4、保护（Protect or Access）代理。 5、Cache代理。 6、防火墙（Firewall）代理。 7、同步化（Synchronization）代理。 8、智能引用（Smart Reference）代理。</p>
<p><strong>注意事项：</strong> 1、和适配器模式的区别：适配器模式主要改变所考虑对象的接口，而代理模式不能改变所代理类的接口。 2、和装饰器模式的区别：装饰器模式为了增强功能，而代理模式是为了加以控制。</p>
<h3 id="8-1-静态代理"><a href="#8-1-静态代理" class="headerlink" title="8.1 静态代理"></a>8.1 静态代理</h3><p><img src="/2022/03/19/spring/4.png" alt="image-20220323091526850"></p>
<p>场景描述：</p>
<p>租客租房，房东要出租，但是租客无法直接找到房东，代理中介代理实现了出租房屋，因此用户通过代理中介来租房</p>
<h4 id="1-出租接口"><a href="#1-出租接口" class="headerlink" title="1. 出租接口"></a>1. 出租接口</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">rent</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">chuzu</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-房东类型"><a href="#2-房东类型" class="headerlink" title="2. 房东类型"></a>2. 房东类型</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">landlord</span> <span class="keyword">implements</span> <span class="title">rent</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">chuzu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;出租房子&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-中介类型"><a href="#3-中介类型" class="headerlink" title="3. 中介类型"></a>3. 中介类型</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@landlordMAnno(&quot;cn.hestialx.myproxy.landlord&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">myProxy</span> <span class="keyword">implements</span> <span class="title">rent</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> landlord lld;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">myProxy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String v = myProxy.class.getAnnotation(landlordMAnno.class).value();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            lld = (landlord)Class.forName(v).newInstance();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">chuzu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(lld!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            charge();</span><br><span class="line">            lld.chuzu();</span><br><span class="line">            watchHouse();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;暂时无房&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">charge</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;收取中介费&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">watchHouse</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;看房&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="消费者类"><a href="#消费者类" class="headerlink" title="消费者类"></a>消费者类</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">customer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        myProxy mp = <span class="keyword">new</span> myProxy();</span><br><span class="line">        mp.chuzu();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-2-动态代理"><a href="#8-2-动态代理" class="headerlink" title="8.2 动态代理"></a>8.2 动态代理</h3><ul>
<li>动态代理和静态代理角色一样</li>
<li>动态代理的代理类是动态生成的，不是我们直接写好的</li>
<li>动态代理分为两大类：基于接口的动态代理，基于类的动态代理<ul>
<li>基于接口：JDK动态代理【选用】</li>
<li>基于类：cglib</li>
<li>java字节码实现：javassist（JBoss服务器）</li>
</ul>
</li>
</ul>
<h4 id="8-2-1-基于接口：JDK动态代理【-】"><a href="#8-2-1-基于接口：JDK动态代理【-】" class="headerlink" title="8.2.1 基于接口：JDK动态代理【*】"></a>8.2.1 基于接口：JDK动态代理【*】</h4><h5 id="Proxy类"><a href="#Proxy类" class="headerlink" title="Proxy类"></a>Proxy类</h5><ul>
<li><p>Proxy类中有一个方法newProxyInstance(ClassLoader loader,Class[] interfaces,InvocationHandler h);</p>
</li>
<li><p>参数:</p>
<ul>
<li><p>```<br>ClassLoader loader</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">  传递的是被代理类的类加载器ClassLoader</span><br><span class="line"></span><br><span class="line">  - 类加载器怎样获取:</span><br><span class="line">    - 得到其Class对象，在Class类中提供一个方法getClassLoader();</span><br><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  Class[] interfaces</span><br></pre></td></tr></table></figure>
<p>:要求:得到被代理对象所实现的接口的所有Class对象</p>
<ul>
<li>怎样获取所有实现接口的Class对象?<ul>
<li>得到其Class对象，在Class类中提供一个方法 getInterfaces();它返回的是Class[],就代表所实现接口的所有Class对象。</li>
</ul>
</li>
</ul>
</li>
<li><p>```<br>InvocationHandler h</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">    - InvocationHandler 是代理实例的**调用处理程序** 实现的接口。</span><br><span class="line"></span><br><span class="line">##### InvocationHandler接口</span><br><span class="line"></span><br><span class="line">InvocationHandler**接口**中有一个方法invoke;</span><br><span class="line"></span><br><span class="line">- 参数 **proxy** 就是**代理对象**</span><br><span class="line">- 参数 **method** 就是**被调用的方法**</span><br><span class="line">- 参数 **args** 就是调用的**被调用方法的参数**</span><br><span class="line">- 返回值,就是真实方法执行后返回的结果，会传递给代理对象调用的方法.</span><br><span class="line">  - public Object invoke(Object proxy, Method method, Object[] args);</span><br><span class="line"></span><br><span class="line">##### 例子：</span><br><span class="line"></span><br><span class="line">出租接口：</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">public interface rent &#123;</span><br><span class="line">    public abstract void chuzu();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>房东类，实现rent接口：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">landlord</span> <span class="keyword">implements</span> <span class="title">rent</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">chuzu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;出租房子&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代理方式一：显式的编写创建实现InvocationHandler接口的MyInvocationHandler类，提供获取代理对象的方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInvocationHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">    Object obj;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyInvocationHandler</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.obj = obj;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//处理代理实例返回结果</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        kanfang();</span><br><span class="line">        Object result = method.invoke(obj, args);</span><br><span class="line">        shouqian();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getProxy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(obj.getClass().getClassLoader(), obj.getClass().getInterfaces(), <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">kanfang</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;看房&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shouqian</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;收取中介费&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取代理对象，使用</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">customer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        rent proxy = (rent) <span class="keyword">new</span> MyInvocationHandler(<span class="keyword">new</span> landlord()).getProxy();</span><br><span class="line">        proxy.chuzu();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代理方式二：（隐式的获取代理对象）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        rent lld = <span class="keyword">new</span> landlord();</span><br><span class="line">        rent ll = (rent) Proxy.newProxyInstance(landlord.class.getClassLoader(), landlord.class.getInterfaces(), <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;看房&quot;</span>);</span><br><span class="line">                Object invoke = method.invoke(lld, args);</span><br><span class="line">                System.out.println(<span class="string">&quot;收取中介费&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> invoke;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        ll.chuzu();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="九、Spring实现AOP"><a href="#九、Spring实现AOP" class="headerlink" title="九、Spring实现AOP"></a>九、Spring实现AOP</h2><h3 id="9-1-方式一：使用Spring的API接口"><a href="#9-1-方式一：使用Spring的API接口" class="headerlink" title="9.1 方式一：使用Spring的API接口"></a>9.1 方式一：使用Spring的API接口</h3><h4 id="业务接口"><a href="#业务接口" class="headerlink" title="业务接口"></a>业务接口</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">select</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="待增强的业务实现类"><a href="#待增强的业务实现类" class="headerlink" title="待增强的业务实现类"></a>待增强的业务实现类</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span>  </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;添加一条数据&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;删除一条数据&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;更新一条数据&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">select</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;查询一条数据&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="方法返回值后增强增强类"><a href="#方法返回值后增强增强类" class="headerlink" title="方法返回值后增强增强类"></a>方法返回值后增强增强类</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AfterLog</span> <span class="keyword">implements</span> <span class="title">AfterReturningAdvice</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">(Object returnValue, Method method, Object[] args, Object target)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(target.getClass()+<span class="string">&quot;类的&quot;</span>+method.getName()+<span class="string">&quot;方法执行完毕！返回值为&quot;</span>+returnValue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="方法执行前增强"><a href="#方法执行前增强" class="headerlink" title="方法执行前增强"></a>方法执行前增强</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeforeLog</span> <span class="keyword">implements</span> <span class="title">MethodBeforeAdvice</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">(Method method, Object[] args, Object target)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(target.getClass().getName()+<span class="string">&quot;类的&quot;</span>+method.getName()+<span class="string">&quot;方法被执行了！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="xml配置"><a href="#xml配置" class="headerlink" title="xml配置"></a>xml配置</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">           https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置支持注解--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;context:annotation-config/&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置自动扫描包，使包下的注解生效--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;context:component-scan base-package=&quot;cn.hestialx.service&quot;/&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;context:component-scan base-package=&quot;cn.hestialx.log&quot;/&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;usc&quot;</span> <span class="attr">class</span>=<span class="string">&quot;cn.hestialx.service.UserServiceImpl&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;alog&quot;</span> <span class="attr">class</span>=<span class="string">&quot;cn.hestialx.log.AfterLog&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;blog&quot;</span> <span class="attr">class</span>=<span class="string">&quot;cn.hestialx.log.BeforeLog&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--方式一、使用原生的SpringAPI接口--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置aop：需要导入aop约束--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--切入点:expression表达式，execution(要执行的位置！* * * * * )--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pointcut1&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* cn.hestialx.service.UserServiceImpl.*(..))&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--执行环绕增强！--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;alog&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointcut1&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;blog&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointcut1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="execution表达式："><a href="#execution表达式：" class="headerlink" title="execution表达式："></a>execution表达式：</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">符号</th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">execution（）</td>
<td style="text-align:left">表达式的主体</td>
</tr>
<tr>
<td style="text-align:left">第一个”*“符号</td>
<td style="text-align:left">表示返回值的类型任意</td>
</tr>
<tr>
<td style="text-align:left">cn.hestialx.service.UserServiceImpl</td>
<td style="text-align:left">AOP所切的服务的包名，即，我们的业务部分</td>
</tr>
<tr>
<td style="text-align:left">包名后面的”.“</td>
<td style="text-align:left">表示当前包</td>
</tr>
<tr>
<td style="text-align:left">第二个”*“</td>
<td style="text-align:left">表示类名，*即所有类</td>
</tr>
<tr>
<td style="text-align:left">.*(..)</td>
<td style="text-align:left">表示任何方法名，括号表示参数，两个点表示任何参数类型</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p>在类名模式串中，.<em> 表示包下的所有类，..</em>表示包、子孙包下的所有类</p>
</blockquote>
<p>测试aop增强的方法（注意：动态代理代理的是接口，因此这里不能用实现类，<strong>应该返回一个接口</strong>）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test01</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">    <span class="comment">//动态代理代理的是接口，因此这里不能用实现类，应该返回一个接口</span></span><br><span class="line">    UserService usi = (UserService)ac.getBean(<span class="string">&quot;usc&quot;</span>, UserService.class);</span><br><span class="line">    usi.add();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-2-方式二、使用自定义的类来实现"><a href="#9-2-方式二、使用自定义的类来实现" class="headerlink" title="9.2 方式二、使用自定义的类来实现"></a>9.2 方式二、使用自定义的类来实现</h3><p>业务接口以及其实现类与上面都相同，这里不采用实现Spring API的方式来实现AOP切入</p>
<p>而是自定义类，然后自定义切面，进行切入点的配置和通知的配置</p>
<h4 id="自定义的类"><a href="#自定义的类" class="headerlink" title="自定义的类"></a>自定义的类</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAOPTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterRun</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;代码执行后！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeRun</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;代码执行前&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="xml配置（bean的配置使用了注解的方式）"><a href="#xml配置（bean的配置使用了注解的方式）" class="headerlink" title="xml配置（bean的配置使用了注解的方式）"></a>xml配置（bean的配置使用了注解的方式）</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">           https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置支持注解--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;context:annotation-config/&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置自动扫描包，使包下的注解生效--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;cn.hestialx.service&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;cn.hestialx.log&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;cn.hestialx.customAOP&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;bean id=&quot;usc&quot; class=&quot;cn.hestialx.service.UserServiceImpl&quot;/&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;bean id=&quot;alog&quot; class=&quot;cn.hestialx.log.AfterLog&quot;/&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;bean id=&quot;blog&quot; class=&quot;cn.hestialx.log.BeforeLog&quot;/&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--方式一、使用原生的SpringAPI接口--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置aop：需要导入aop约束--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;aop:config&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&amp;lt;!&amp;ndash;切入点:expression表达式，execution(要执行的位置！* * * * * )&amp;ndash;&amp;gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;aop:pointcut id=&quot;pointcut1&quot; expression=&quot;execution(* cn.hestialx.service.UserServiceImpl.*(..))&quot;/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&amp;lt;!&amp;ndash;执行环绕增强！&amp;ndash;&amp;gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;aop:advisor advice-ref=&quot;afterLog&quot; pointcut-ref=&quot;pointcut1&quot;/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;aop:advisor advice-ref=&quot;beforeLog&quot; pointcut-ref=&quot;pointcut1&quot;/&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;/aop:config&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--方式二：使用自定义的类实现AOP--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--自定义切面，ref 引用实现要切入的方法的类的引用--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;myAOPTest&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--定义切入点，需要增强的类中的方法--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;point1&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* cn.hestialx.service.UserServiceImpl.*(..))&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--定义通知（切入方法和切入位置的定义）--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">&quot;afterRun&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;point1&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;beforeRun&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;point1&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="测试运行"><a href="#测试运行" class="headerlink" title="测试运行"></a>测试运行</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test01</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">    <span class="comment">//动态代理代理的是接口，因此这里不能用实现类，应该返回一个接口</span></span><br><span class="line">    UserService usi = (UserService)ac.getBean(<span class="string">&quot;userServiceImpl&quot;</span>, UserService.class);</span><br><span class="line">    usi.add();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-3-方式三、注解实现（使用注解的方式实现方法二）"><a href="#9-3-方式三、注解实现（使用注解的方式实现方法二）" class="headerlink" title="9.3 方式三、注解实现（使用注解的方式实现方法二）"></a>9.3 方式三、注解实现（使用注解的方式实现方法二）</h3><ol>
<li><p>使用@Aspect注解标记切面类</p>
</li>
<li><p>使用@Before、@After、@Around等注解标记需要的切入方法，并传入切入点execution表达式</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAOP02</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Before(&quot;execution(* cn.hestialx.service.UserServiceImpl.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeRun</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;方法执行前！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@After(&quot;execution(* cn.hestialx.service.UserServiceImpl.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterRun</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;方法运行后！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Around(&quot;execution(* cn.hestialx.service.UserServiceImpl.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">aroundRun</span><span class="params">(ProceedingJoinPoint joinPoint)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;环绕前！&quot;</span>);</span><br><span class="line">        Signature signature = joinPoint.getSignature();</span><br><span class="line">        System.out.println(signature);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Object proceed = joinPoint.proceed();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            throwable.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;环绕后！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在xml中配置开启注解支持</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--方式三：通过注解--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>（可选）将proxy-target-class属性值设置为true</p>
<ul>
<li>默认值为false，表示使用JDK实现动态代理</li>
<li>设置为true后表示使用cglib实现动态代理</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--方式三：通过注解--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> <span class="attr">proxy-target-class</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="十、整合Mybatis"><a href="#十、整合Mybatis" class="headerlink" title="十、整合Mybatis"></a>十、整合Mybatis</h2><h3 id="10-1-什么是-MyBatis-Spring？"><a href="#10-1-什么是-MyBatis-Spring？" class="headerlink" title="10.1 什么是 MyBatis-Spring？"></a>10.1 什么是 MyBatis-Spring？</h3><p>​    MyBatis-Spring 会帮助你将 MyBatis 代码无缝地整合到 Spring 中。它将允许 MyBatis 参与到 Spring 的事务管理之中，创建映射器 mapper 和 <code>SqlSession</code> 并注入到 bean 中，以及将 Mybatis 的异常转换为 Spring 的 <code>DataAccessException</code>。 最终，可以做到应用代码不依赖于 MyBatis，Spring 或 MyBatis-Spring。</p>
<h3 id="10-2-回顾mybatis流程"><a href="#10-2-回顾mybatis流程" class="headerlink" title="10.2 回顾mybatis流程"></a>10.2 回顾mybatis流程</h3><h4 id="1-配置mybatis核心配置文件mybatis-config-xml"><a href="#1-配置mybatis核心配置文件mybatis-config-xml" class="headerlink" title="1. 配置mybatis核心配置文件mybatis-config.xml"></a>1. 配置mybatis核心配置文件mybatis-config.xml</h4><ul>
<li>配置environments，日志</li>
</ul>
<h4 id="2-编写pojo类，在核心配置文件中添加别名typeAliases配置"><a href="#2-编写pojo类，在核心配置文件中添加别名typeAliases配置" class="headerlink" title="2. 编写pojo类，在核心配置文件中添加别名typeAliases配置"></a>2. 编写pojo类，在核心配置文件中添加别名typeAliases配置</h4><h4 id="3-编写mapper接口和mapper-xml"><a href="#3-编写mapper接口和mapper-xml" class="headerlink" title="3. 编写mapper接口和mapper.xml"></a>3. 编写mapper接口和mapper.xml</h4><h4 id="4-在核心配置文件中注册mapper"><a href="#4-在核心配置文件中注册mapper" class="headerlink" title="4. 在核心配置文件中注册mapper"></a>4. 在核心配置文件中注册mapper</h4><h4 id="5-编写测试类"><a href="#5-编写测试类" class="headerlink" title="5. 编写测试类"></a>5. 编写测试类</h4><h3 id="10-3-方式一：SqlSessionTemplate"><a href="#10-3-方式一：SqlSessionTemplate" class="headerlink" title="10.3 方式一：SqlSessionTemplate"></a>10.3 方式一：SqlSessionTemplate</h3><h4 id="编写对应mapper接口实现类，在其中注入SqlSessionTemplate"><a href="#编写对应mapper接口实现类，在其中注入SqlSessionTemplate" class="headerlink" title="编写对应mapper接口实现类，在其中注入SqlSessionTemplate"></a><strong>编写对应mapper接口实现类，在其中注入SqlSessionTemplate</strong></h4><p>编写步骤：</p>
<ol>
<li>编写数据源配置</li>
<li>sqlSessionFactory</li>
<li>sqlSessionTemplate</li>
<li>编写对应接口的实现类</li>
<li>将自己写的实现类，注入sqlSessionTemplate，配置到spring中</li>
<li>测试</li>
</ol>
<h4 id="1-配置整合mybatis"><a href="#1-配置整合mybatis" class="headerlink" title="1. 配置整合mybatis"></a>1. 配置整合mybatis</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">           https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--整合Mybatis--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--1. Datasource,使用Spring的数据源替换Mybatis的配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;datasource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/user?serverTimezone=UTC<span class="symbol">&amp;amp;</span>characterEncoding=utf8<span class="symbol">&amp;amp;</span>useUnicode=true<span class="symbol">&amp;amp;</span>useSSL=false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;******&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--sqlSessionFactory--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;datasource&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--绑定mybatis配置文件（可以选择绑定，也可以全部使用Spring的配置方法）--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mybatis-config.xml&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 自动扫描mapping.xml文件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperLocations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:cn/hestialx/mapper/*.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--sqlSessionTemplate:就相当于mybatis的sqlSession--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionTemplate&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--由于没有set方法，因此只有通过构造方法注入--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;sqlSessionFactory&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-将mybatis配置整合到总的配置文件中"><a href="#2-将mybatis配置整合到总的配置文件中" class="headerlink" title="2. 将mybatis配置整合到总的配置文件中"></a>2. 将mybatis配置整合到总的配置文件中</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;springDao.xml&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-编写mapper接口实现类并将其注册到Spring的总配置文件中"><a href="#3-编写mapper接口实现类并将其注册到Spring的总配置文件中" class="headerlink" title="3. 编写mapper接口实现类并将其注册到Spring的总配置文件中"></a>3. 编写mapper接口实现类并将其注册到Spring的总配置文件中</h4><ul>
<li><p>在mapper接口实现类中要添加SqlSessionTemplate（相当于SqlSession），用来获取mapper对象调用方法</p>
</li>
<li><p>由于在注册时使用的属性注入，因此要提供set方法</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserMapperImpl</span> <span class="keyword">implements</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> SqlSessionTemplate sqlSessionTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSqlSessionTemplate</span><span class="params">(SqlSessionTemplate sqlSessionTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sqlSessionTemplate = sqlSessionTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findAllUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sqlSessionTemplate.getMapper(UserMapper.class).findAllUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userMapper&quot;</span> <span class="attr">class</span>=<span class="string">&quot;cn.hestialx.mapper.UserMapperImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionTemplate&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;sqlSessionTemplate&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="4-编写测试类测试"><a href="#4-编写测试类测试" class="headerlink" title="4. 编写测试类测试"></a>4. 编写测试类测试</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">    UserMapperImpl userMapper = ac.getBean(<span class="string">&quot;userMapper&quot;</span>, UserMapperImpl.class);</span><br><span class="line">    List&lt;User&gt; allUser = userMapper.findAllUser();</span><br><span class="line">    System.out.println(allUser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10-4-方式二：SqlSessionDaoSupport"><a href="#10-4-方式二：SqlSessionDaoSupport" class="headerlink" title="10.4 方式二：SqlSessionDaoSupport"></a>10.4 方式二：SqlSessionDaoSupport</h3><h4 id="编写对应mapper接口的实现类，继承SqlSessionDaoSupport"><a href="#编写对应mapper接口的实现类，继承SqlSessionDaoSupport" class="headerlink" title="编写对应mapper接口的实现类，继承SqlSessionDaoSupport"></a>编写对应mapper接口的实现类，继承SqlSessionDaoSupport</h4><p>编写步骤：</p>
<ol>
<li>编写数据源配置</li>
<li>sqlSessionFactory</li>
<li>编写对应接口的实现类</li>
<li>将自己写的实现类，注入sqlSessionFactory，配置到spring中</li>
<li>测试</li>
</ol>
<h4 id="1-mybatis配置"><a href="#1-mybatis配置" class="headerlink" title="1. mybatis配置"></a>1. mybatis配置</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">           http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">           https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--整合Mybatis--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--1. Datasource,使用Spring的数据源替换Mybatis的配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;datasource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/user?serverTimezone=UTC<span class="symbol">&amp;amp;</span>characterEncoding=utf8<span class="symbol">&amp;amp;</span>useUnicode=true<span class="symbol">&amp;amp;</span>useSSL=false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;******&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--sqlSessionFactory--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;datasource&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--绑定mybatis配置文件（可以选择绑定，也可以全部使用Spring的配置方法）--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mybatis-config.xml&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 自动扫描mapping.xml文件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperLocations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:cn/hestialx/mapper/*.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-将mybatis配置整合到总的配置文件中-1"><a href="#2-将mybatis配置整合到总的配置文件中-1" class="headerlink" title="2. 将mybatis配置整合到总的配置文件中"></a>2. 将mybatis配置整合到总的配置文件中</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;springDao.xml&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-编写mapper接口实现类并将其注册到Spring的总配置文件中-1"><a href="#3-编写mapper接口实现类并将其注册到Spring的总配置文件中-1" class="headerlink" title="3. 编写mapper接口实现类并将其注册到Spring的总配置文件中"></a>3. 编写mapper接口实现类并将其注册到Spring的总配置文件中</h4><ul>
<li>这里和上一种方式不同，需要注入的是SqlSessionFactory</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserMapperImpl02</span> <span class="keyword">extends</span> <span class="title">SqlSessionDaoSupport</span> <span class="keyword">implements</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findAllUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getSqlSession().getMapper(UserMapper.class).findAllUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userMapper02&quot;</span> <span class="attr">class</span>=<span class="string">&quot;cn.hestialx.mapper.UserMapperImpl02&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;sqlSessionFactory&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="4-测试"><a href="#4-测试" class="headerlink" title="4. 测试"></a>4. 测试</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test03</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">    UserMapper userMapper02 = ac.getBean(<span class="string">&quot;userMapper02&quot;</span>, UserMapper.class);</span><br><span class="line">    List&lt;User&gt; allUser = userMapper02.findAllUser();</span><br><span class="line">    System.out.println(allUser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10-5-总结"><a href="#10-5-总结" class="headerlink" title="10.5 总结"></a>10.5 总结</h3><ul>
<li>两种实现Mybatis和Spring整合的方法大致相同</li>
<li>都是首先在Spring中创建Datasource的Bean对象。</li>
<li>将数据源bean对象注入构建SqlSessionFactoryBean对象。<ul>
<li>在其中再注入扫描的mapperxml的路径</li>
</ul>
</li>
</ul>
<p>从这里开始两种方法产生区别</p>
<p>方式一：SqlSessionTemplate</p>
<ul>
<li>继续配置SqlSessionTemplate 的bean</li>
<li>编写对应mapper接口的实现类，注入sqlSessionTemplate对象</li>
<li>配置实现类bean</li>
<li>重写业务方法，通过sqlSessionTemplate获取Mapper</li>
</ul>
<p>方式二：SqlSessionTemplate</p>
<ul>
<li>编写对应mapper接口的实现类，继承SqlSessionDaoSupport</li>
<li>配置实现类bean，注入SqlSessionFactoryBean对象</li>
<li>重写业务方法，通过getSession()方法获取sqlSessionTemplate获取Mapper</li>
</ul>
<h2 id="十一、Spring事务管理"><a href="#十一、Spring事务管理" class="headerlink" title="十一、Spring事务管理"></a>十一、Spring事务管理</h2><p>Spring支持声明式事务管理和编码式事务管理，这里只介绍声明式事务</p>
<h3 id="实现类"><a href="#实现类" class="headerlink" title="实现类"></a>实现类</h3><ul>
<li>findAllUser()方法中既有插入也有删除、还有查询，我们希望在其中任何一个操作报错时进行回滚，因此必须开启事务，保证其原子性</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserMapperImpl02</span> <span class="keyword">extends</span> <span class="title">SqlSessionDaoSupport</span> <span class="keyword">implements</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findAllUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User tian = <span class="keyword">new</span> User(<span class="number">7</span>, <span class="string">&quot;tian&quot;</span>, <span class="string">&quot;safas@qq.com&quot;</span>);</span><br><span class="line">        insertUser(tian);</span><br><span class="line">        deleteUserById(<span class="number">7</span>);</span><br><span class="line">        <span class="keyword">return</span> getSqlSession().getMapper(UserMapper.class).findAllUser();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteUserById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getSqlSession().getMapper(UserMapper.class).deleteUserById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insertUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getSqlSession().getMapper(UserMapper.class).insertUser(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="11-1-声明式事务"><a href="#11-1-声明式事务" class="headerlink" title="11.1 声明式事务"></a>11.1 声明式事务</h3><h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><p>一个使用 MyBatis-Spring 的其中一个主要原因是它允许 MyBatis 参与到 Spring 的事务管理中。而不是给 MyBatis 创建一个新的专用事务管理器，MyBatis-Spring 借助了 Spring 中的 <code>DataSourceTransactionManager</code> 来实现事务管理。</p>
<p>一旦配置好了 Spring 的事务管理器，你就可以在 Spring 中按你平时的方式来配置事务。并且支持 <code>@Transactional</code> 注解和 AOP 风格的配置。在事务处理期间，一个单独的 <code>SqlSession</code> 对象将会被创建和使用。当事务完成时，这个 session 会以合适的方式提交或回滚。</p>
<p>事务配置好了以后，MyBatis-Spring 将会透明地管理事务。这样在你的 DAO 类中就不需要额外的代码了。</p>
<h3 id="标准配置"><a href="#标准配置" class="headerlink" title="标准配置"></a>标准配置</h3><p>要开启 Spring 的事务处理功能，在 Spring 的配置文件中创建一个 <code>DataSourceTransactionManager</code> 对象：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="配置AOP切入事务"><a href="#配置AOP切入事务" class="headerlink" title="配置AOP切入事务"></a>配置AOP切入事务</h3><p>注意：<tx:method name="find*" propagation="REQUIRED">中name是要开启事务的方法名，可以用*代表统配符</tx:method></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--结合AOP实现事务的织入--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置事务通知--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;txAvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--给那些方法配置事务--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--propagation是配置事务的传播特性--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;insert*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;delete*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;find*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;tx:method name=&quot;update*&quot; propagation=&quot;REQUIRED&quot;/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;tx:method name=&quot;query*&quot; read-only=&quot;true&quot;/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;tx:method name=&quot;*&quot; propagation=&quot;REQUIRED&quot;/&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置切入点，取名为txPiontCut--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;txPiontCut&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* cn.hestialx.mapper.*.*(..))&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置切入的方法--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;txAvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;txPiontCut&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="事务传播行为类型"><a href="#事务传播行为类型" class="headerlink" title="事务传播行为类型"></a>事务传播行为类型</h3><div class="table-container">
<table>
<thead>
<tr>
<th>事务传播行为类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>PROPAGATION_REQUIRED</td>
<td>如果当前没有事务，就新建一个事务，如果已经存在一个事务中，加入到这个事务中。这是最常见的选择。</td>
</tr>
<tr>
<td>PROPAGATION_SUPPORTS</td>
<td>支持当前事务，如果当前没有事务，就以非事务方式执行。</td>
</tr>
<tr>
<td>PROPAGATION_MANDATORY</td>
<td>使用当前的事务，如果当前没有事务，就抛出异常。</td>
</tr>
<tr>
<td>PROPAGATION_REQUIRES_NEW</td>
<td>新建事务，如果当前存在事务，把当前事务挂起。</td>
</tr>
<tr>
<td>PROPAGATION_NOT_SUPPORTED</td>
<td>以非事务方式执行操作，如果当前存在事务，就把当前事务挂起。</td>
</tr>
<tr>
<td>PROPAGATION_NEVER</td>
<td>以非事务方式执行，如果当前存在事务，则抛出异常。</td>
</tr>
<tr>
<td>PROPAGATION_NESTED</td>
<td>如果当前存在事务，则在嵌套事务内执行。如果当前没有事务，则执行与PROPAGATION_REQUIRED类 似的操作。</td>
</tr>
</tbody>
</table>
</div>
]]></content>
      <categories>
        <category>spring</category>
      </categories>
      <tags>
        <tag>spring</tag>
        <tag>ssm</tag>
      </tags>
  </entry>
  <entry>
    <title>springboot入门以及浅层原理分析</title>
    <url>/2022/04/22/springboot/</url>
    <content><![CDATA[<h1 id="springboot学习"><a href="#springboot学习" class="headerlink" title="springboot学习"></a>springboot学习</h1><h2 id="一、第一个springboot项目"><a href="#一、第一个springboot项目" class="headerlink" title="一、第一个springboot项目"></a>一、第一个springboot项目</h2><h3 id="1-项目创建"><a href="#1-项目创建" class="headerlink" title="1. 项目创建"></a>1. 项目创建</h3><ul>
<li><p>打开idea选择新建项目</p>
</li>
<li><p>选择Spring Initializr</p>
<p><img src="/2022/04/22/springboot/1.png" alt="image-20220425091624810"></p>
</li>
<li><p>选择项目jdk版本和配置</p>
<p><img src="/2022/04/22/springboot/2.png" alt="image-20220425092001453"></p>
</li>
<li><p>选择依赖和springboot版本</p>
<p><img src="/2022/04/22/springboot/3.png" alt="image-20220425092057356"></p>
</li>
<li><p>点击finish创建项目完成</p>
</li>
</ul>
<h3 id="2-项目结构"><a href="#2-项目结构" class="headerlink" title="2. 项目结构"></a>2. 项目结构</h3><p><img src="/2022/04/22/springboot/4.png" alt="image-20220425092825261"></p>
<p><strong>注意：</strong></p>
<ul>
<li><p>在上图结构中，我们的代码要写在SpringbootstudyApplication同级目录。</p>
</li>
<li><p>由于在创建时已经勾选了web依赖，项目中自动导入了web环境，并进行了自动装配，无需额外配置可以直接编写相应接口程序</p>
<p><img src="/2022/04/22/springboot/5.png" alt="image-20220425093231305"></p>
</li>
<li><p>在resources目录下的application.properties文件中可以修改springboot相关配置</p>
<p><img src="/2022/04/22/springboot/6.png" alt="image-20220425094010706"></p>
</li>
<li><p>我们可以在resources目录下创建banner.txt，改变启动时打印的内容</p>
<p>eg:(自动生成网站：<a href="https://www.bootschool.net/ascii-art/">https://www.bootschool.net/ascii-art/</a>)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">////////////////////////////////////////////////////////////////////</span><br><span class="line">//                          _ooOoo_                               //</span><br><span class="line">//                         o8888888o                              //</span><br><span class="line">//                         88&quot; . &quot;88                              //</span><br><span class="line">//                         (| ^_^ |)                              //</span><br><span class="line">//                         O\  =  /O                              //</span><br><span class="line">//                      ____/`---&#x27;\____                           //</span><br><span class="line">//                    .&#x27;  \\|     |//  `.                         //</span><br><span class="line">//                   /  \\|||  :  |||//  \                        //</span><br><span class="line">//                  /  _||||| -:- |||||-  \                       //</span><br><span class="line">//                  |   | \\\  -  /// |   |                       //</span><br><span class="line">//                  | \_|  &#x27;&#x27;\---/&#x27;&#x27;  |   |                       //</span><br><span class="line">//                  \  .-\__  `-`  ___/-. /                       //</span><br><span class="line">//                ___`. .&#x27;  /--.--\  `. . ___                     //</span><br><span class="line">//              .&quot;&quot; &#x27;&lt;  `.___\_&lt;|&gt;_/___.&#x27;  &gt;&#x27;&quot;&quot;.                  //</span><br><span class="line">//            | | :  `- \`.;`\ _ /`;.`/ - ` : | |                 //</span><br><span class="line">//            \  \ `-.   \_ __\ /__ _/   .-` /  /                 //</span><br><span class="line">//      ========`-.____`-.___\_____/___.-`____.-&#x27;========         //</span><br><span class="line">//                           `=---=&#x27;                              //</span><br><span class="line">//      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^        //</span><br><span class="line">//            佛祖保佑       永不宕机     永无BUG                 //</span><br><span class="line">////////////////////////////////////////////////////////////////////</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="二、自动装配原理"><a href="#二、自动装配原理" class="headerlink" title="二、自动装配原理"></a>二、自动装配原理</h2><h3 id="2-1-springboot的pom-xml"><a href="#2-1-springboot的pom-xml" class="headerlink" title="2.1. springboot的pom.xml"></a>2.1. springboot的pom.xml</h3><ul>
<li><p>spring-boot-dependencies：核心依赖（在父工程中）</p>
<p><strong>管理依赖版本</strong></p>
<p><img src="/2022/04/22/springboot/7.png" alt="image-20220425094818628"></p>
</li>
<li><p>启动器</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>启动器是springboot的启动场景</p>
</li>
<li><p>springboot会将所有的功能场景都变成一个个的启动器，需要使用功能时直接导入相应的启动器就行</p>
<p><strong>例如</strong>：spring-boot-starter-web，会帮我们自动导入web环境的所有依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/04/22/springboot/8.png" alt="image-20220425095859414"></p>
</li>
</ul>
</li>
</ul>
<h3 id="2-2-主程序"><a href="#2-2-主程序" class="headerlink" title="2.2. 主程序"></a>2.2. 主程序</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpingbootstudyApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpingbootstudyApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-1-SpringBootApplication注解"><a href="#2-2-1-SpringBootApplication注解" class="headerlink" title="2.2.1 SpringBootApplication注解"></a>2.2.1 SpringBootApplication注解</h4><p><strong>标注这个类是一个springboot应用：启动类下的所有资源被导入</strong></p>
<ul>
<li>包含以下注解</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootConfiguration</span>：springboot的配置</span><br><span class="line">	-----<span class="meta">@Configuration</span></span><br><span class="line">		------Component</span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span>：自动配置</span><br><span class="line">	-----<span class="meta">@AutoConfigurationPackage</span>：自动配置包</span><br><span class="line">		------<span class="meta">@Import(&#123;Registrar.class&#125;)</span>：导入自动配置包 注册器</span><br><span class="line">	-----<span class="meta">@Import(&#123;AutoConfigurationImportSelector.class&#125;)</span>：导入选择器</span><br><span class="line">		------AutoConfigurationImportSelector</span><br></pre></td></tr></table></figure>
<h4 id="2-2-2-SpringBootConfiguration"><a href="#2-2-2-SpringBootConfiguration" class="headerlink" title="2.2.2 @SpringBootConfiguration"></a>2.2.2 @SpringBootConfiguration</h4><p>包含@Configuration注解代表其是一个spring配置类</p>
<h4 id="2-2-3-EnableAutoConfiguration"><a href="#2-2-3-EnableAutoConfiguration" class="headerlink" title="2.2.3 @EnableAutoConfiguration"></a>2.2.3 @EnableAutoConfiguration</h4><ul>
<li><p>使用AutoConfigurationImportSelector类进行加载</p>
<ul>
<li><p>getAutoConfigurationEntry方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; configurations = <span class="keyword">this</span>.getCandidateConfigurations(annotationMetadata, attributes);</span><br></pre></td></tr></table></figure>
</li>
<li><p>```java<br>protected List<String> getCandidateConfigurations(AnnotationMetadata metadata, AnnotationAttributes attributes) {</String></p>
<pre><code>List&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames(this.getSpringFactoriesLoaderFactoryClass(), this.getBeanClassLoader());
Assert.notEmpty(configurations, &quot;No auto configuration classes found in META-INF/spring.factories. If you are using a custom packaging, make sure that file is correct.&quot;);
return configurations;
</code></pre><p>}</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">###  2.2.4 META-INF/spring.factories</span><br><span class="line"></span><br><span class="line">* 自动配置的核心文件：配置了自动配置类</span><br><span class="line"></span><br><span class="line">  ![image-20220425104537577](springboot/9.png)</span><br><span class="line"></span><br><span class="line">  ![image-20220425104620683](springboot/10.png)</span><br><span class="line"></span><br><span class="line">  **WebMvcAutoConfiguration**</span><br><span class="line"></span><br><span class="line">  我们在上面的自动配置类随便找一个打开看看，比如 ：WebMvcAutoConfiguration</span><br><span class="line"></span><br><span class="line">  ![图片](springboot/11.png)</span><br><span class="line"></span><br><span class="line">  可以看到这些一个个的都是JavaConfig配置类，而且都注入了一些Bean，可以找一些自己认识的类</span><br><span class="line"></span><br><span class="line">  所以，自动配置真正实现是从classpath中搜寻所有的META-INF/spring.factories配置文件 ，并将其中对应的 org.springframework.boot.autoconfigure. 包下的配置项，通过反射实例化为对应标注了 @Configuration的JavaConfig形式的IOC容器配置类 ， 然后将这些都汇总成为一个实例并加载到IOC容器中。</span><br><span class="line"></span><br><span class="line">  **结论：**</span><br><span class="line"></span><br><span class="line">  1. SpringBoot在启动的时候从类路径下的META-INF/spring.factories中获取EnableAutoConfiguration指定的值</span><br><span class="line"></span><br><span class="line">  2. 将这些值作为自动配置类导入容器 ， 自动配置类就生效 ， 帮我们进行自动配置工作；</span><br><span class="line"></span><br><span class="line">     ```java </span><br><span class="line">     @ConditionalOnxxx    主注解判断是否导入</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol>
<li><p>整个J2EE的整体解决方案和自动配置都在springboot-autoconfigure的jar包中；</p>
</li>
<li><p>它会给容器中导入非常多的自动配置类 （xxxAutoConfiguration）, 就是给容器中导入这个场景需要的所有组件 ， 并配置好这些组件 ；</p>
</li>
<li><p>有了自动配置类 ， 免去了我们手动编写配置注入功能组件等的工作；</p>
</li>
</ol>
</li>
</ul>
<p><strong>SpringApplication.run分析</strong></p>
<p>分析该方法主要分两部分，一部分是SpringApplication的实例化，二是run方法的执行；</p>
<h3 id="SpringApplication"><a href="#SpringApplication" class="headerlink" title="SpringApplication"></a>SpringApplication</h3><p><strong>这个类主要做了以下四件事情：</strong></p>
<p>1、推断应用的类型是普通的项目还是Web项目</p>
<p>2、查找并加载所有可用初始化启动器 ， 设置到initializers属性中</p>
<p>3、找出所有的应用程序监听器，设置到listeners属性中</p>
<p>4、推断并设置main方法的定义类，找到运行的主类</p>
<p>查看构造器：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">SpringApplication</span><span class="params">(ResourceLoader resourceLoader, Class... primarySources)</span> </span>&#123;    <span class="comment">// ......    this.webApplicationType = WebApplicationType.deduceFromClasspath();    this.setInitializers(this.getSpringFactoriesInstances();    this.setListeners(this.getSpringFactoriesInstances(ApplicationListener.class));    this.mainApplicationClass = this.deduceMainApplicationClass();&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="run方法流程分析"><a href="#run方法流程分析" class="headerlink" title="run方法流程分析"></a>run方法流程分析</h3><p><img src="/2022/04/22/springboot/12.png" alt="图片"></p>
<h2 id="三、springboot配置文件yaml"><a href="#三、springboot配置文件yaml" class="headerlink" title="三、springboot配置文件yaml"></a>三、springboot配置文件yaml</h2><p>SpringBoot使用一个全局的配置文件 ， 配置文件名称是固定的</p>
<ul>
<li><p>application.properties</p>
</li>
<li><ul>
<li>语法结构 ：key=value</li>
</ul>
</li>
<li><p>application.yml</p>
</li>
<li><ul>
<li>语法结构 ：key：空格 value</li>
</ul>
</li>
</ul>
<p><strong>配置文件的作用 ：</strong>修改SpringBoot自动配置的默认值，因为SpringBoot在底层都给我们自动配置好了；</p>
<p>比如我们可以在配置文件中修改Tomcat 默认启动的端口号！测试一下！</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8081</span></span><br></pre></td></tr></table></figure>
<h3 id="3-1-yaml概述"><a href="#3-1-yaml概述" class="headerlink" title="3.1 yaml概述"></a>3.1 yaml概述</h3><p>YAML是 “YAML Ain’t a Markup Language” （YAML不是一种标记语言）的递归缩写。在开发的这种语言时，YAML 的意思其实是：”Yet Another Markup Language”（仍是一种标记语言）</p>
<p><strong>这种语言以数据**</strong>作<strong>**为中心，而不是以标记语言为重点！</strong></p>
<p>以前的配置文件，大多数都是使用xml来配置；比如一个简单的端口配置，我们来对比下yaml和xml</p>
<p>传统xml配置：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">server</span>&gt;</span>    </span><br><span class="line">	<span class="tag">&lt;<span class="name">port</span>&gt;</span>8081<span class="tag">&lt;<span class="name">port</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>yaml配置：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">server：</span>  </span><br><span class="line">	<span class="attr">prot:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>
<h3 id="3-2-yaml基础语法"><a href="#3-2-yaml基础语法" class="headerlink" title="3.2 yaml基础语法"></a>3.2 yaml基础语法</h3><p>说明：语法要求严格！</p>
<p>1、空格不能省略</p>
<p>2、以缩进来控制层级关系，只要是左边对齐的一列数据都是同一个层级的。</p>
<p>3、属性和值的大小写都是十分敏感的。</p>
<p><strong>字面量：普通的值  [ 数字，布尔值，字符串  ]</strong></p>
<p>字面量直接写在后面就可以 ， 字符串默认不用加上双引号或者单引号；</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">k: v</span><br></pre></td></tr></table></figure>
<p>注意：</p>
<ul>
<li><p>“ ” 双引号，不会转义字符串里面的特殊字符 ， 特殊字符会作为本身想表示的意思；</p>
<p>比如 ：name: “kuang \n shen”  输出 ：kuang  换行  shen</p>
</li>
<li><p>‘’ 单引号，会转义特殊字符 ， 特殊字符最终会变成和普通字符一样输出</p>
<p>比如 ：name: ‘kuang \n shen’  输出 ：kuang  \n  shen</p>
</li>
</ul>
<p><strong>对象、Map（键值对）</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#对象、Map格式</span><br><span class="line">k:     </span><br><span class="line">	v1:    </span><br><span class="line">	v2:</span><br></pre></td></tr></table></figure>
<p>在下一行来写对象的属性和值得关系，注意缩进；比如：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">student:</span>    </span><br><span class="line">	<span class="attr">name:</span> <span class="string">qinjiang</span>    </span><br><span class="line">	<span class="attr">age:</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>行内写法</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">student:</span> &#123;<span class="attr">name:</span> <span class="string">qinjiang</span>,<span class="attr">age:</span> <span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure>
<p><strong>数组（ List、set ）</strong></p>
<p>用 - 值表示数组中的一个元素,比如：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">pets:</span> </span><br><span class="line">	<span class="bullet">-</span> <span class="string">cat</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">dog</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">pig</span></span><br></pre></td></tr></table></figure>
<p>行内写法</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">pets:</span> [<span class="string">cat</span>,<span class="string">dog</span>,<span class="string">pig</span>]</span><br></pre></td></tr></table></figure>
<p><strong>修改SpringBoot的默认端口号</strong></p>
<p>配置文件中添加，端口号的参数，就可以切换端口；</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:  port:</span> <span class="number">8082</span></span><br></pre></td></tr></table></figure>
<h3 id="3-3-注入配置文件"><a href="#3-3-注入配置文件" class="headerlink" title="3.3 注入配置文件"></a>3.3 注入配置文件</h3><p>yaml文件更强大的地方在于，他可以给我们的实体类直接注入匹配值！</p>
<h3 id="3-4-yaml注入配置文件"><a href="#3-4-yaml注入配置文件" class="headerlink" title="3.4 yaml注入配置文件"></a>3.4 yaml注入配置文件</h3><p>1、在springboot项目中的resources目录下新建一个文件 application.yml</p>
<p>2、编写一个实体类 Dog；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.springboot.pojo;</span><br><span class="line"><span class="meta">@Component</span>  <span class="comment">//注册bean到容器中</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> </span>&#123;    </span><br><span class="line">	<span class="keyword">private</span> String name;    </span><br><span class="line">	<span class="keyword">private</span> Integer age;        </span><br><span class="line">	<span class="comment">//有参无参构造、get、set方法、toString()方法  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3、思考，我们原来是如何给bean注入属性值的！@Value，给狗狗类测试一下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span> <span class="comment">//注册bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> </span>&#123;    </span><br><span class="line">	<span class="meta">@Value(&quot;阿黄&quot;)</span>    </span><br><span class="line">	<span class="keyword">private</span> String name;   </span><br><span class="line">    <span class="meta">@Value(&quot;18&quot;)</span>    </span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4、在SpringBoot的测试类下注入狗狗输出一下；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTestclass</span> DemoApplicationTests &#123;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="comment">//将狗狗自动注入进来    </span></span><br><span class="line">    Dog dog;</span><br><span class="line">    <span class="meta">@Test</span>    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;        </span><br><span class="line">    	System.out.println(dog); <span class="comment">//打印看下狗狗对象    </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果成功输出，@Value注入成功，这是我们原来的办法对吧。</p>
<p><img src="/2022/04/22/springboot/13.png" alt="图片"></p>
<p>5、我们在编写一个复杂一点的实体类：Person</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span> <span class="comment">//注册bean到容器中</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;    </span><br><span class="line">	<span class="keyword">private</span> String name;    </span><br><span class="line">	<span class="keyword">private</span> Integer age;    </span><br><span class="line">	<span class="keyword">private</span> Boolean happy;    </span><br><span class="line">	<span class="keyword">private</span> Date birth;    </span><br><span class="line">	<span class="keyword">private</span> Map&lt;String,Object&gt; maps;    </span><br><span class="line">	<span class="keyword">private</span> List&lt;Object&gt; lists;    </span><br><span class="line">	<span class="keyword">private</span> Dog dog;        </span><br><span class="line">	<span class="comment">//有参无参构造、get、set方法、toString()方法  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>6、我们来使用yaml配置的方式进行注入，大家写的时候注意区别和优势，我们编写一个yaml配置！</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">person:</span>  </span><br><span class="line">	<span class="attr">name:</span> <span class="string">qinjiang</span>  </span><br><span class="line">	<span class="attr">age:</span> <span class="number">3</span>  </span><br><span class="line">	<span class="attr">happy:</span> <span class="literal">false</span>  </span><br><span class="line">	<span class="attr">birth:</span> <span class="number">2000</span><span class="string">/01/01</span>  </span><br><span class="line">	<span class="attr">maps:</span> &#123;<span class="attr">k1:</span> <span class="string">v1</span>,<span class="attr">k2:</span> <span class="string">v2</span>&#125;  </span><br><span class="line">	<span class="attr">lists:</span>   </span><br><span class="line">		<span class="bullet">-</span> <span class="string">code</span>   </span><br><span class="line">		<span class="bullet">-</span> <span class="string">girl</span>   </span><br><span class="line">		<span class="bullet">-</span> <span class="string">music</span>  </span><br><span class="line">	<span class="attr">dog:</span>    </span><br><span class="line">		<span class="attr">name:</span> <span class="string">旺财</span>    </span><br><span class="line">		<span class="attr">age:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>7、我们刚才已经把person这个对象的所有值都写好了，我们现在来注入到我们的类中！</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*@ConfigurationProperties作用：将配置文件中配置的每一个属性的值，映射到这个组件中；告诉SpringBoot将本类中的所有属性和配置文件中相关的配置进行绑定参数 prefix = “person” : 将配置文件中的person下面的所有属性一一对应*/</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">//注册bean</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;    </span><br><span class="line">	<span class="keyword">private</span> String name;    </span><br><span class="line">	<span class="keyword">private</span> Integer age;    </span><br><span class="line">	<span class="keyword">private</span> Boolean happy;    </span><br><span class="line">	<span class="keyword">private</span> Date birth;    </span><br><span class="line">	<span class="keyword">private</span> Map&lt;String,Object&gt; maps;    </span><br><span class="line">	<span class="keyword">private</span> List&lt;Object&gt; lists;    </span><br><span class="line">	<span class="keyword">private</span> Dog dog;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8、IDEA 提示，springboot配置注解处理器没有找到，让我们看文档，我们可以查看文档，找到一个依赖！</p>
<p><img src="/2022/04/22/springboot/14.png" alt="图片"></p>
<p><img src="/2022/04/22/springboot/15.png" alt="图片"></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 导入配置文件处理器，配置文件进行绑定就会有提示，需要重启 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>9、确认以上配置都OK之后，我们去测试类中测试一下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DemoApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span>    </span><br><span class="line">    Person person; <span class="comment">//将person自动注入进来</span></span><br><span class="line">    <span class="meta">@Test</span>    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;        </span><br><span class="line">        System.out.println(person); <span class="comment">//打印person信息</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果：所有值全部注入成功！</p>
<p><img src="/2022/04/22/springboot/16.png" alt="图片"></p>
<p><strong>yaml配置注入到实体类完全OK！</strong></p>
<p>课堂测试：</p>
<p>1、将配置文件的key 值 和 属性的值设置为不一样，则结果输出为null，注入失败</p>
<p>2、在配置一个person2，然后将 @ConfigurationProperties(prefix = “person2”) 指向我们的person2；</p>
<h4 id="3-4-1-加载指定的配置文件"><a href="#3-4-1-加载指定的配置文件" class="headerlink" title="3.4.1 加载指定的配置文件"></a>3.4.1 加载指定的配置文件</h4><p><strong>@PropertySource ：</strong>加载指定的配置文件；</p>
<p><strong>@configurationProperties</strong>：默认从全局配置文件中获取值；</p>
<ul>
<li><p><strong>注意：</strong>使用@configurationProperties注解时可能会产生警告</p>
<p><img src="/2022/04/22/springboot/23.png" alt="image-20220507223404793"></p>
<p>需要添加依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">  </span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>1、我们去在resources目录下新建一个<strong>person.properties</strong>文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">name=kuangshen</span><br></pre></td></tr></table></figure>
<p>2、然后在我们的代码中指定加载person.properties文件</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PropertySource(value = &quot;classpath:person.properties&quot;)</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">//注册bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3、再次输出测试一下：指定配置文件绑定成功！</p>
<p><img src="/2022/04/22/springboot/17.png" alt="图片"></p>
<h4 id="3-4-2-配置文件占位符"><a href="#3-4-2-配置文件占位符" class="headerlink" title="3.4.2 配置文件占位符"></a>3.4.2 配置文件占位符</h4><p>配置文件还可以编写占位符生成随机数</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">person:</span>    </span><br><span class="line">	<span class="attr">name:</span> <span class="string">qinjiang$&#123;random.uuid&#125;</span> <span class="comment"># 随机uuid    </span></span><br><span class="line">	<span class="attr">age:</span> <span class="string">$&#123;random.int&#125;</span>  <span class="comment"># 随机int    happy: false    </span></span><br><span class="line">	<span class="attr">birth: 2000/01/01    maps:</span> &#123;<span class="attr">k1:</span> <span class="string">v1</span>,<span class="attr">k2:</span> <span class="string">v2</span>&#125;    </span><br><span class="line">	<span class="attr">lists:</span>      </span><br><span class="line">		<span class="bullet">-</span> <span class="string">code</span>      </span><br><span class="line">		<span class="bullet">-</span> <span class="string">girl</span>      </span><br><span class="line">		<span class="bullet">-</span> <span class="string">music</span>    </span><br><span class="line">	<span class="attr">dog:</span>      </span><br><span class="line">		<span class="attr">name:</span> <span class="string">$&#123;person.hello:other&#125;_旺财</span></span><br><span class="line">        <span class="attr">age:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h3 id="3-5-回顾properties配置"><a href="#3-5-回顾properties配置" class="headerlink" title="3.5 回顾properties配置"></a>3.5 回顾properties配置</h3><p>我们上面采用的yaml方法都是最简单的方式，开发中最常用的；也是springboot所推荐的！那我们来唠唠其他的实现方式，道理都是相同的；写还是那样写；配置文件除了yml还有我们之前常用的properties ， 我们没有讲，我们来唠唠！</p>
<p>【注意】properties配置文件在写中文的时候，会有乱码 ， 我们需要去IDEA中设置编码格式为UTF-8；</p>
<p>settings—&gt;FileEncodings 中配置；</p>
<p><img src="/2022/04/22/springboot/18.png" alt="图片"></p>
<p><strong>测试步骤：</strong></p>
<p>1、新建一个实体类User</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span> <span class="comment">//注册bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、编辑配置文件 user.properties</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user1.name=kuangshenuser1.age=18user1.sex=男</span><br></pre></td></tr></table></figure>
<p>3、我们在User类上使用@Value来进行注入！</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span> <span class="comment">//注册bean</span></span><br><span class="line"><span class="meta">@PropertySource(value = &quot;classpath:user.properties&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;    </span><br><span class="line">	<span class="comment">//直接使用@value    </span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;user.name&#125;&quot;)</span> <span class="comment">//从配置文件中取值    </span></span><br><span class="line">    <span class="keyword">private</span> String name;    </span><br><span class="line">    <span class="meta">@Value(&quot;#&#123;9*2&#125;&quot;)</span>  <span class="comment">// #&#123;SPEL&#125; Spring表达式    </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;    </span><br><span class="line">    <span class="meta">@Value(&quot;男&quot;)</span>  <span class="comment">// 字面量    </span></span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4、Springboot测试</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DemoApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span>    </span><br><span class="line">    User user;</span><br><span class="line">    <span class="meta">@Test</span>    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    	System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果正常输出：</p>
<p><img src="/2022/04/22/springboot/19.png" alt="图片"></p>
<h3 id="3-6-对比小结"><a href="#3-6-对比小结" class="headerlink" title="3.6 对比小结"></a>3.6 对比小结</h3><p>@Value这个使用起来并不友好！我们需要为每个属性单独注解赋值，比较麻烦；我们来看个功能对比图</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7KtjyIb9NEaYlz0tCWSiboOYjMibiaov73iaTsiaWEPoArDcAB1Ooibx9uR5JxtacIuicHblEtUI9SrySX2A/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>1、@ConfigurationProperties只需要写一次即可 ， @Value则需要每个字段都添加</p>
<p>2、松散绑定：这个什么意思呢? 比如我的yml中写的last-name，这个和lastName是一样的， - 后面跟着的字母默认是大写的。这就是松散绑定。可以测试一下</p>
<p>3、JSR303数据校验 ， 这个就是我们可以在字段是增加一层过滤器验证 ， 可以保证数据的合法性</p>
<p>4、复杂类型封装，yml中可以封装对象 ， 使用value就不支持</p>
<p><strong>结论：</strong></p>
<p>配置yml和配置properties都可以获取到值 ， 强烈推荐 yml；</p>
<p>如果我们在某个业务中，只需要获取配置文件中的某个值，可以使用一下 @value；</p>
<p>如果说，我们专门编写了一个JavaBean来和配置文件进行一一映射，就直接@configurationProperties，不要犹豫！</p>
<h2 id="四、JSR303数据校验"><a href="#四、JSR303数据校验" class="headerlink" title="四、JSR303数据校验"></a>四、JSR303数据校验</h2><h3 id="4-1-先看看如何使用"><a href="#4-1-先看看如何使用" class="headerlink" title="4.1 先看看如何使用"></a>4.1 先看看如何使用</h3><p>Springboot中可以用@validated来校验数据，如果数据异常则会统一抛出异常，方便异常中心统一处理。我们这里来写个注解让我们的name只能支持Email格式；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span> <span class="comment">//注册bean</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span></span><br><span class="line"><span class="meta">@Validated</span>  <span class="comment">//数据校验</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Email(message=&quot;邮箱格式错误&quot;)</span> <span class="comment">//name必须是邮箱格式    </span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果 ：default message [不是一个合法的电子邮件地址];</p>
<p><img src="/2022/04/22/springboot/20.png" alt="图片"></p>
<p><strong>使用数据校验，可以保证数据的正确性；</strong> </p>
<h3 id="4-2-常见参数"><a href="#4-2-常见参数" class="headerlink" title="4.2 常见参数"></a>4.2 常见参数</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@NotNull(message=&quot;名字不能为空&quot;)</span><br><span class="line">private String userName;</span><br><span class="line">@Max(value=120,message=&quot;年龄最大不能查过120&quot;)</span><br><span class="line">private int age;@Email(message=&quot;邮箱格式错误&quot;)</span><br><span class="line">private String email;</span><br><span class="line">空检查</span><br><span class="line">@Null       验证对象是否为null</span><br><span class="line">@NotNull    验证对象是否不为null, 无法查检长度为0的字符串</span><br><span class="line">@NotBlank   检查约束字符串是不是Null还有被Trim的长度是否大于0,只对字符串,且会去掉前后空格.</span><br><span class="line">@NotEmpty   检查约束元素是否为NULL或者是EMPTY.    </span><br><span class="line">Booelan检查</span><br><span class="line">@AssertTrue     验证 Boolean 对象是否为 true  </span><br><span class="line">@AssertFalse    验证 Boolean 对象是否为 false      </span><br><span class="line">长度检查</span><br><span class="line">@Size(min=, max=) 验证对象（Array,Collection,Map,String）长度是否在给定的范围之内  </span><br><span class="line">@Length(min=, max=) string is between min and max included.</span><br><span class="line">日期检查@Past       验证 Date 和 Calendar 对象是否在当前时间之前  </span><br><span class="line">@Future     验证 Date 和 Calendar 对象是否在当前时间之后  </span><br><span class="line">@Pattern    验证 String 对象是否符合正则表达式的规则</span><br><span class="line">.......等等除此以外，我们还可以自定义一些数据校验规则</span><br></pre></td></tr></table></figure>
<p>多环境切换</p>
<p>profile是Spring对不同环境提供不同配置功能的支持，可以通过激活不同的环境版本，实现快速切换环境；</p>
<h2 id="五、多配置文件"><a href="#五、多配置文件" class="headerlink" title="五、多配置文件"></a>五、多配置文件</h2><p>我们在主配置文件编写的时候，文件名可以是 application-{profile}.properties/yml , 用来指定多个环境版本；</p>
<p><strong>例如：</strong></p>
<p>application-test.properties 代表测试环境配置</p>
<p>application-dev.properties 代表开发环境配置</p>
<p>但是Springboot并不会直接启动这些配置文件，它<strong>默认使用application.properties主配置文件</strong>；</p>
<p>我们需要通过一个配置来选择需要激活的环境：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#比如在配置文件中指定使用dev环境，我们可以通过设置不同的端口号进行测试；#我们启动SpringBoot，就可以看到已经切换到dev下的配置了；spring.profiles.active=dev</span><br></pre></td></tr></table></figure>
<h3 id="5-1-yaml的多文档块"><a href="#5-1-yaml的多文档块" class="headerlink" title="5.1 yaml的多文档块"></a>5.1 yaml的多文档块</h3><p>和properties配置文件中一样，但是使用yml去实现不需要创建多个配置文件，更加方便了 !</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span>  </span><br><span class="line">	<span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"><span class="comment">#选择要激活那个环境块</span></span><br><span class="line"><span class="attr">spring:</span>  </span><br><span class="line">	<span class="attr">profiles:</span></span><br><span class="line">    	<span class="attr">active:</span> <span class="string">prod</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span>  </span><br><span class="line">	<span class="attr">port:</span> <span class="number">8083</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">activate:</span></span><br><span class="line">      <span class="attr">on-profile:</span> <span class="string">dev</span> <span class="comment">#配置环境的名称</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span>  </span><br><span class="line">	<span class="attr">port:</span> <span class="number">8084</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">activate:</span></span><br><span class="line">      <span class="attr">on-profile:</span>  <span class="string">prod</span>  <span class="comment">#配置环境的名称</span></span><br></pre></td></tr></table></figure>
<p><strong>注意：如果yml和properties同时都配置了端口，并且没有激活其他环境 ， 默认会使用properties配置文件的！</strong></p>
<h3 id="5-2-配置文件加载位置"><a href="#5-2-配置文件加载位置" class="headerlink" title="5.2 配置文件加载位置"></a>5.2 配置文件加载位置</h3><p><strong>外部加载配置文件的方式十分多，我们选择最常用的即可，在开发的资源文件中进行配置！</strong></p>
<p>官方外部配置文件说明参考文档</p>
<p><img src="/2022/04/22/springboot/24.png" alt="图片"></p>
<p>springboot 启动会扫描以下位置的application.properties或者application.yml文件作为Spring boot的默认配置文件：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">优先级1：项目路径下的config文件夹配置文件优先级2：项目路径下配置文件优先级3：资源路径下的config文件夹配置文件优先级4：资源路径下配置文件</span><br></pre></td></tr></table></figure>
<p>优先级由高到底，高优先级的配置会覆盖低优先级的配置；</p>
<p><strong>SpringBoot会从这四个位置全部加载主配置文件；</strong></p>
<p><strong>互补配置；</strong></p>
<p>我们在最低级的配置文件中设置一个项目访问路径的配置来测试互补问题；</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#配置项目的访问路径server.servlet.context-path=/kuang</span><br></pre></td></tr></table></figure>
<h3 id="5-3-拓展，运维小技巧"><a href="#5-3-拓展，运维小技巧" class="headerlink" title="5.3 拓展，运维小技巧"></a>5.3 拓展，运维小技巧</h3><p>指定位置加载配置文件</p>
<p>我们还可以通过spring.config.location来改变默认的配置文件位置</p>
<p>项目打包好以后，我们可以使用命令行参数的形式，启动项目的时候来指定配置文件的新位置；这种情况，一般是后期运维做的多，相同配置，外部指定的配置文件优先级最高</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java -jar spring-boot-config.jar --spring.config.location=F:/application.propertie</span><br></pre></td></tr></table></figure>
<p>自动配置原理</p>
<p>配置文件到底能写什么？怎么写？</p>
<p>SpringBoot官方文档中有大量的配置，我们无法全部记住</p>
<p><img src="/2022/04/22/springboot/21.png" alt="图片"></p>
<h2 id="六、分析自动配置原理"><a href="#六、分析自动配置原理" class="headerlink" title="六、分析自动配置原理"></a>六、分析自动配置原理</h2><p>我们以<strong>HttpEncodingAutoConfiguration（Http编码自动配置）</strong>为例解释自动配置原理；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//表示这是一个配置类，和以前编写的配置文件一样，也可以给容器中添加组件；</span></span><br><span class="line"><span class="meta">@Configuration</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">//启动指定类的ConfigurationProperties功能；</span></span><br><span class="line">  <span class="comment">//进入这个HttpProperties查看，将配置文件中对应的值和HttpProperties绑定起来；</span></span><br><span class="line">  <span class="comment">//并把HttpProperties加入到ioc容器中</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;HttpProperties.class&#125;)</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">//Spring底层@Conditional注解</span></span><br><span class="line">  <span class="comment">//根据不同的条件判断，如果满足指定的条件，整个配置类里面的配置就会生效；</span></span><br><span class="line">  <span class="comment">//这里的意思就是判断当前应用是否是web应用，如果是，当前配置类生效</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(</span></span><br><span class="line"><span class="meta">    type = Type.SERVLET</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//判断当前项目有没有这个类CharacterEncodingFilter；SpringMVC中进行乱码解决的过滤器；</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;CharacterEncodingFilter.class&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//判断配置文件中是否存在某个配置：spring.http.encoding.enabled；</span></span><br><span class="line">  <span class="comment">//如果不存在，判断也是成立的</span></span><br><span class="line">  <span class="comment">//即使我们配置文件中不配置pring.http.encoding.enabled=true，也是默认生效的；</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(</span></span><br><span class="line"><span class="meta">    prefix = &quot;spring.http.encoding&quot;,</span></span><br><span class="line"><span class="meta">    value = &#123;&quot;enabled&quot;&#125;,</span></span><br><span class="line"><span class="meta">    matchIfMissing = true</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpEncodingAutoConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="comment">//他已经和SpringBoot的配置文件映射了</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Encoding properties;</span><br><span class="line">    <span class="comment">//只有一个有参构造器的情况下，参数的值就会从容器中拿</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HttpEncodingAutoConfiguration</span><span class="params">(HttpProperties properties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.properties = properties.getEncoding();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//给容器中添加一个组件，这个组件的某些值需要从properties中获取</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span> <span class="comment">//判断容器没有这个组件？</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CharacterEncodingFilter <span class="title">characterEncodingFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        CharacterEncodingFilter filter = <span class="keyword">new</span> OrderedCharacterEncodingFilter();</span><br><span class="line">        filter.setEncoding(<span class="keyword">this</span>.properties.getCharset().name());</span><br><span class="line">        filter.setForceRequestEncoding(<span class="keyword">this</span>.properties.shouldForce(org.springframework.boot.autoconfigure.http.HttpProperties.Encoding.Type.REQUEST));</span><br><span class="line">        filter.setForceResponseEncoding(<span class="keyword">this</span>.properties.shouldForce(org.springframework.boot.autoconfigure.http.HttpProperties.Encoding.Type.RESPONSE));</span><br><span class="line">        <span class="keyword">return</span> filter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>一句话总结 ：根据当前不同的条件判断，决定这个配置类是否生效！</strong></p>
<ul>
<li>一但这个配置类生效；这个配置类就会给容器中添加各种组件；</li>
<li>这些组件的属性是从对应的properties类中获取的，这些类里面的每一个属性又是和配置文件绑定的；</li>
<li>所有在配置文件中能配置的属性都是在xxxxProperties类中封装着；</li>
<li>配置文件能配置什么就可以参照某个功能对应的这个属性类</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//从配置文件中获取指定的值和bean的属性进行绑定</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.http&quot;)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpProperties</span> </span>&#123;</span><br><span class="line">    <span class="comment">// .....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们去配置文件里面试试前缀，看提示！</p>
<p><img src="/2022/04/22/springboot/22.png" alt="图片"></p>
<p><strong>这就是自动装配的原理！</strong></p>
<h3 id="精髓"><a href="#精髓" class="headerlink" title="精髓"></a>精髓</h3><p>1、SpringBoot启动会加载大量的自动配置类</p>
<p>2、我们看我们需要的功能有没有在SpringBoot默认写好的自动配置类当中；</p>
<p>3、我们再来看这个自动配置类中到底配置了哪些组件；（只要我们要用的组件存在在其中，我们就不需要再手动配置了）</p>
<p>4、给容器中自动配置类添加组件的时候，会从properties类中获取某些属性。我们只需要在配置文件中指定这些属性的值即可；</p>
<p><strong>xxxxAutoConfigurartion：自动配置类；</strong>给容器中添加组件</p>
<p><strong>xxxxProperties:封装配置文件中相关属性；</strong></p>
<h3 id="了解：-Conditional"><a href="#了解：-Conditional" class="headerlink" title="了解：@Conditional"></a>了解：@Conditional</h3><p>了解完自动装配的原理后，我们来关注一个细节问题，<strong>自动配置类必须在一定的条件下才能生效；</strong></p>
<p><strong>@Conditional派生注解（Spring注解版原生的@Conditional作用）</strong></p>
<p>作用：必须是@Conditional指定的条件成立，才给容器中添加组件，配置配里面的所有内容才生效；</p>
<p><img src="/2022/04/22/springboot/25.png" alt="图片"></p>
<p><strong>那么多的自动配置类，必须在一定的条件下才能生效；也就是说，我们加载了这么多的配置类，但不是所有的都生效了。</strong></p>
<p>我们怎么知道哪些自动配置类生效？</p>
<p><strong>我们可以通过启用 debug=true属性；来让控制台打印自动配置报告，这样我们就可以很方便的知道哪些自动配置类生效；</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#开启springboot的调试类debug=true</span><br></pre></td></tr></table></figure>
<p><strong>Positive matches:（自动配置类启用的：正匹配）</strong></p>
<p><strong>Negative matches:（没有启动，没有匹配成功的自动配置类：负匹配）</strong></p>
<p><strong>Unconditional classes: （没有条件的类）</strong></p>
<p>【演示：查看输出的日志】</p>
<p>掌握吸收理解原理，即可以不变应万变！</p>
]]></content>
      <categories>
        <category>springboot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
      </tags>
  </entry>
  <entry>
    <title>springboot+thymeleaf静态资源</title>
    <url>/2022/04/26/springbootweb1/</url>
    <content><![CDATA[<h1 id="SpringbootWeb开发"><a href="#SpringbootWeb开发" class="headerlink" title="SpringbootWeb开发"></a>SpringbootWeb开发</h1><p>静态资源处理</p>
<h2 id="一、静态资源映射规则"><a href="#一、静态资源映射规则" class="headerlink" title="一、静态资源映射规则"></a>一、静态资源映射规则</h2><p><strong>首先，我们搭建一个普通的SpringBoot项目，回顾一下HelloWorld程序！</strong></p>
<p>写请求非常简单，那我们要引入我们前端资源，我们项目中有许多的静态资源，比如css，js等文件，这个SpringBoot怎么处理呢？</p>
<p>如果我们是一个web应用，我们的main下会有一个webapp，我们以前都是将所有的页面导在这里面的，对吧！但是我们现在的pom呢，打包方式是为jar的方式，那么这种方式SpringBoot能不能来给我们写页面呢？当然是可以的，但是SpringBoot对于静态资源放置的位置，是有规定的！</p>
<p><strong>我们先来聊聊这个静态资源映射规则：</strong></p>
<p>SpringBoot中，SpringMVC的web配置都在 WebMvcAutoConfiguration 这个配置类里面；</p>
<p>我们可以去看看 WebMvcAutoConfigurationAdapter 中有很多配置方法；</p>
<p>有一个方法：addResourceHandlers 添加资源处理</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.resourceProperties.isAddMappings()) &#123;</span><br><span class="line">        <span class="comment">// 已禁用默认资源处理</span></span><br><span class="line">        logger.debug(<span class="string">&quot;Default resource handling disabled&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 缓存控制</span></span><br><span class="line">    Duration cachePeriod = <span class="keyword">this</span>.resourceProperties.getCache().getPeriod();</span><br><span class="line">    CacheControl cacheControl = <span class="keyword">this</span>.resourceProperties.getCache().getCachecontrol().toHttpCacheControl();</span><br><span class="line">    <span class="comment">// webjars 配置</span></span><br><span class="line">    <span class="keyword">if</span> (!registry.hasMappingForPattern(<span class="string">&quot;/webjars/**&quot;</span>)) &#123;</span><br><span class="line">        customizeResourceHandlerRegistration(registry.addResourceHandler(<span class="string">&quot;/webjars/**&quot;</span>)</span><br><span class="line">                                             .addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>)</span><br><span class="line">                                             .setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 静态资源配置</span></span><br><span class="line">    String staticPathPattern = <span class="keyword">this</span>.mvcProperties.getStaticPathPattern();</span><br><span class="line">    <span class="keyword">if</span> (!registry.hasMappingForPattern(staticPathPattern)) &#123;</span><br><span class="line">        customizeResourceHandlerRegistration(registry.addResourceHandler(staticPathPattern)</span><br><span class="line">                                             .addResourceLocations(getResourceLocations(<span class="keyword">this</span>.resourceProperties.getStaticLocations()))</span><br><span class="line">                                             .setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>读一下源代码：比如所有的 /webjars/** ， 都需要去 classpath:/META-INF/resources/webjars/ 找对应的资源；</p>
<h3 id="1-1-什么是webjars-呢？"><a href="#1-1-什么是webjars-呢？" class="headerlink" title="1.1 什么是webjars 呢？"></a>1.1 什么是webjars 呢？</h3><p>Webjars本质就是以jar包的方式引入我们的静态资源 ， 我们以前要导入一个静态资源文件，直接导入即可。</p>
<p>使用SpringBoot需要使用Webjars，我们可以去搜索一下：</p>
<p>网站：<a href="https://www.webjars.org">https://www.webjars.org</a> </p>
<p>要使用jQuery，我们只要要引入jQuery对应版本的pom依赖即可！</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jquery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>导入完毕，查看webjars目录结构，并访问Jquery.js文件！</p>
<p><img src="/2022/04/26/springbootweb1/1.jpg" alt="图片"></p>
<p>访问：只要是静态资源，SpringBoot就会去对应的路径寻找资源，我们这里访问：<a href="http://localhost:8080/webjars/jquery/3.4.1/jquery.js">http://localhost:8080/webjars/jquery/3.4.1/jquery.js</a></p>
<p><img src="/2022/04/26/springbootweb1/2.jpg" alt="图片"></p>
<h3 id="1-2-第二种静态资源映射规则"><a href="#1-2-第二种静态资源映射规则" class="headerlink" title="1. 2 第二种静态资源映射规则"></a>1. 2 第二种静态资源映射规则</h3><p>那我们项目中要是使用自己的静态资源该怎么导入呢？我们看下一行代码；</p>
<p>我们去找staticPathPattern发现第二种映射规则 ：/** , 访问当前的项目任意资源，它会去找 resourceProperties 这个类，我们可以点进去看一下分析：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 进入方法</span></span><br><span class="line"><span class="keyword">public</span> String[] getStaticLocations() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.staticLocations;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 找到对应的值</span></span><br><span class="line"><span class="keyword">private</span> String[] staticLocations = CLASSPATH_RESOURCE_LOCATIONS;</span><br><span class="line"><span class="comment">// 找到路径</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] CLASSPATH_RESOURCE_LOCATIONS = &#123; </span><br><span class="line">    <span class="string">&quot;classpath:/META-INF/resources/&quot;</span>,</span><br><span class="line">  <span class="string">&quot;classpath:/resources/&quot;</span>, </span><br><span class="line">    <span class="string">&quot;classpath:/static/&quot;</span>, </span><br><span class="line">    <span class="string">&quot;classpath:/public/&quot;</span> </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ResourceProperties 可以设置和我们静态资源有关的参数；这里面指向了它会去寻找资源的文件夹，即上面数组的内容。</p>
<p>所以得出结论，以下四个目录存放的静态资源可以被我们识别：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;classpath:/META-INF/resources/&quot;</span><br><span class="line">&quot;classpath:/resources/&quot;</span><br><span class="line">&quot;classpath:/static/&quot;</span><br><span class="line">&quot;classpath:/public/&quot;</span><br></pre></td></tr></table></figure>
<p>我们可以在resources根目录下新建对应的文件夹，都可以存放我们的静态文件；</p>
<p>比如我们访问 <a href="http://localhost:8080/1.js">http://localhost:8080/1.js</a> , 他就会去这些文件夹中寻找对应的静态资源文件；</p>
<h3 id="1-3-自定义静态资源路径"><a href="#1-3-自定义静态资源路径" class="headerlink" title="1.3 自定义静态资源路径"></a>1.3 自定义静态资源路径</h3><p>我们也可以自己通过配置文件来指定一下，哪些文件夹是需要我们放静态资源文件的，在application.properties中配置；</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">spring.resources.static-locations=classpath:/coding/,classpath:/kuang/</span><br></pre></td></tr></table></figure>
<p>一旦自己定义了静态文件夹的路径，原来的自动配置就都会失效了！</p>
<p>首页处理</p>
<p>静态资源文件夹说完后，我们继续向下看源码！可以看到一个欢迎页的映射，就是我们的首页！</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> WelcomePageHandlerMapping <span class="title">welcomePageHandlerMapping</span><span class="params">(ApplicationContext applicationContext,FormattingConversionService mvcConversionService,ResourceUrlProvider mvcResourceUrlProvider)</span> </span>&#123;</span><br><span class="line">    WelcomePageHandlerMapping welcomePageHandlerMapping = <span class="keyword">new</span> WelcomePageHandlerMapping(</span><br><span class="line">        <span class="keyword">new</span> TemplateAvailabilityProviders(applicationContext), applicationContext, getWelcomePage(), <span class="comment">// getWelcomePage 获得欢迎页</span></span><br><span class="line">        <span class="keyword">this</span>.mvcProperties.getStaticPathPattern());</span><br><span class="line">    welcomePageHandlerMapping.setInterceptors(getInterceptors(mvcConversionService, mvcResourceUrlProvider));</span><br><span class="line">    <span class="keyword">return</span> welcomePageHandlerMapping;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>点进去继续</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Optional&lt;Resource&gt; <span class="title">getWelcomePage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String[] locations = getResourceLocations(<span class="keyword">this</span>.resourceProperties.getStaticLocations());</span><br><span class="line">    <span class="comment">// ::是java8 中新引入的运算符</span></span><br><span class="line">    <span class="comment">// Class::function的时候function是属于Class的，应该是静态方法。</span></span><br><span class="line">    <span class="comment">// this::function的funtion是属于这个对象的。</span></span><br><span class="line">    <span class="comment">// 简而言之，就是一种语法糖而已，是一种简写</span></span><br><span class="line">    <span class="keyword">return</span> Arrays.stream(locations).map(<span class="keyword">this</span>::getIndexHtml).filter(<span class="keyword">this</span>::isReadable).findFirst();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 欢迎页就是一个location下的的 index.html 而已</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Resource <span class="title">getIndexHtml</span><span class="params">(String location)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.resourceLoader.getResource(location + <span class="string">&quot;index.html&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>欢迎页，静态资源文件夹下的所有 index.html 页面；被 /** 映射。</p>
<p>比如我访问  <a href="http://localhost:8080/">http://localhost:8080/</a> ，就会找静态资源文件夹下的 index.html</p>
<p>新建一个 index.html ，在我们上面的3个目录中任意一个；然后访问测试  <a href="http://localhost:8080/">http://localhost:8080/</a>  看结果！</p>
<h3 id="1-4-关于网站图标说明："><a href="#1-4-关于网站图标说明：" class="headerlink" title="1.4 关于网站图标说明："></a>1.4 <strong>关于网站图标说明</strong>：</h3><p><img src="/2022/04/26/springbootweb1/3.jpg" alt="图片"></p>
<p>与其他静态资源一样，Spring Boot在配置的静态内容位置中查找 favicon.ico。如果存在这样的文件，它将自动用作应用程序的favicon。</p>
<p>1、关闭SpringBoot默认图标</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#关闭默认图标</span></span><br><span class="line"><span class="string">spring.mvc.favicon.enabled=false</span></span><br></pre></td></tr></table></figure>
<p>2、自己放一个图标在静态资源目录下，我放在 public 目录下</p>
<p>3、清除浏览器缓存！刷新网页，发现图标已经变成自己的了！</p>
<p><img src="/2022/04/26/springbootweb1/4.jpg" alt="图片"></p>
<h3 id="1-5-首页"><a href="#1-5-首页" class="headerlink" title="1.5 首页"></a>1.5 首页</h3><ul>
<li>默认将静态资源路径下的index.html作为首页</li>
</ul>
<h2 id="二、Thymeleaf"><a href="#二、Thymeleaf" class="headerlink" title="二、Thymeleaf"></a>二、Thymeleaf</h2><h3 id="2-1-引入Thymeleaf"><a href="#2-1-引入Thymeleaf" class="headerlink" title="2.1. 引入Thymeleaf"></a>2.1. 引入Thymeleaf</h3><p>怎么引入呢，对于springboot来说，什么事情不都是一个start的事情嘛，我们去在项目中引入一下。给大家三个网址：</p>
<p>Thymeleaf 官网：<a href="https://www.thymeleaf.org/">https://www.thymeleaf.org/</a></p>
<p>Thymeleaf 在Github 的主页：<a href="https://github.com/thymeleaf/thymeleaf">https://github.com/thymeleaf/thymeleaf</a></p>
<p>Spring官方文档：找到我们对应的版本</p>
<p><a href="https://docs.spring.io/spring-boot/docs/2.2.5.RELEASE/reference/htmlsingle/#using-boot-starter">https://docs.spring.io/spring-boot/docs/2.2.5.RELEASE/reference/htmlsingle/#using-boot-starter</a> </p>
<p>找到对应的pom依赖：可以适当点进源码看下本来的包！</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--thymeleaf--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-2-Thymeleaf分析"><a href="#2-2-Thymeleaf分析" class="headerlink" title="2.2 Thymeleaf分析"></a>2.2 Thymeleaf分析</h3><p>前面呢，我们已经引入了Thymeleaf，那这个要怎么使用呢？</p>
<p>我们首先得按照SpringBoot的自动配置原理看一下我们这个Thymeleaf的自动配置规则，在按照那个规则，我们进行使用。</p>
<p>我们去找一下Thymeleaf的自动配置类：ThymeleafProperties</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationProperties(</span></span><br><span class="line"><span class="meta">    prefix = &quot;spring.thymeleaf&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThymeleafProperties</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Charset DEFAULT_ENCODING;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_PREFIX = <span class="string">&quot;classpath:/templates/&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_SUFFIX = <span class="string">&quot;.html&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> checkTemplate = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> checkTemplateLocation = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">private</span> String prefix = <span class="string">&quot;classpath:/templates/&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> String suffix = <span class="string">&quot;.html&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> String mode = <span class="string">&quot;HTML&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> Charset encoding;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以在其中看到默认的前缀和后缀！</p>
<p>我们只需要把我们的html页面放在类路径下的templates下，thymeleaf就可以帮我们自动渲染了。</p>
<p>使用thymeleaf什么都不需要配置，只需要将他放在指定的文件夹下即可！</p>
<h3 id="2-3-Thymeleaf-语法学习"><a href="#2-3-Thymeleaf-语法学习" class="headerlink" title="2.3 Thymeleaf 语法学习"></a>2.3 Thymeleaf 语法学习</h3><p>要学习语法，还是参考官网文档最为准确，我们找到对应的版本看一下；</p>
<p>Thymeleaf 官网：<a href="https://www.thymeleaf.org/">https://www.thymeleaf.org/</a> ， 简单看一下官网！我们去下载Thymeleaf的官方文档！</p>
<p><strong>我们做个最简单的练习 ：我们需要查出一些数据，在页面中展示</strong></p>
<p>1、修改测试请求，增加数据传输；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/t1&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line">    <span class="comment">//存入数据</span></span><br><span class="line">    model.addAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;Hello,Thymeleaf&quot;</span>);</span><br><span class="line">    <span class="comment">//classpath:/templates/test.html</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;test&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、我们要使用thymeleaf，需要在html文件中导入命名空间的约束，方便提示。</p>
<p>我们可以去官方文档的#3中看一下命名空间拿来过来：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">xmlns:th=&quot;http://www.thymeleaf.org&quot;</span><br></pre></td></tr></table></figure>
<p>3、我们去编写下前端页面</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>狂神说<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>测试页面<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--th:text就是将div中的内容设置为它指定的值，和之前学习的Vue一样--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;msg&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-4-语法细节"><a href="#2-4-语法细节" class="headerlink" title="2.4 语法细节"></a>2.4 语法细节</h3><p><strong>1、我们可以使用任意的 th:attr 来替换Html中原生属性的值！</strong></p>
<p><img src="/2022/04/26/springbootweb1/5.jpg" alt="图片"></p>
<p><strong>2、我们能写哪些表达式呢？</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">Simple expressions:（表达式语法）</span><br><span class="line">Variable Expressions: $&#123;...&#125;：获取变量值；OGNL；</span><br><span class="line">    <span class="number">1</span>）、获取对象的属性、调用方法</span><br><span class="line">    <span class="number">2</span>）、使用内置的基本对象：#<span class="number">18</span></span><br><span class="line">         #ctx : the context object.</span><br><span class="line">         #vars: the context variables.</span><br><span class="line">         #locale : the context locale.</span><br><span class="line">         #request : (only <span class="keyword">in</span> Web Contexts) the HttpServletRequest object.</span><br><span class="line">         #response : (only <span class="keyword">in</span> Web Contexts) the HttpServletResponse object.</span><br><span class="line">         #session : (only <span class="keyword">in</span> Web Contexts) the HttpSession object.</span><br><span class="line">         #servletContext : (only <span class="keyword">in</span> Web Contexts) the ServletContext object.</span><br><span class="line"></span><br><span class="line">    <span class="number">3</span>）、内置的一些工具对象：</span><br><span class="line">　　　　　　#execInfo : information about the template being processed.</span><br><span class="line">　　　　　　#uris : methods <span class="keyword">for</span> escaping parts <span class="keyword">of</span> URLs/URIs</span><br><span class="line">　　　　　　#conversions : methods <span class="keyword">for</span> executing the configured conversion service (<span class="keyword">if</span> any).</span><br><span class="line">　　　　　　#dates : methods <span class="keyword">for</span> java.util.Date objects: formatting, component extraction, etc.</span><br><span class="line">　　　　　　#calendars : analogous to #dates , but <span class="keyword">for</span> java.util.Calendar objects.</span><br><span class="line">　　　　　　#numbers : methods <span class="keyword">for</span> formatting numeric objects.</span><br><span class="line">　　　　　　#strings : methods <span class="keyword">for</span> <span class="built_in">String</span> objects: contains, startsWith, prepending/appending, etc.</span><br><span class="line">　　　　　　#objects : methods <span class="keyword">for</span> objects <span class="keyword">in</span> general.</span><br><span class="line">　　　　　　#bools : methods <span class="keyword">for</span> boolean evaluation.</span><br><span class="line">　　　　　　#arrays : methods <span class="keyword">for</span> arrays.</span><br><span class="line">　　　　　　#lists : methods <span class="keyword">for</span> lists.</span><br><span class="line">　　　　　　#sets : methods <span class="keyword">for</span> sets.</span><br><span class="line">　　　　　　#maps : methods <span class="keyword">for</span> maps.</span><br><span class="line">　　　　　　#aggregates : methods <span class="keyword">for</span> creating aggregates on arrays or collections.</span><br><span class="line">==================================================================================</span><br><span class="line"></span><br><span class="line">  Selection Variable Expressions: *&#123;...&#125;：选择表达式：和$&#123;&#125;在功能上是一样；</span><br><span class="line">  Message Expressions: #&#123;...&#125;：获取国际化内容</span><br><span class="line">  Link URL Expressions: @&#123;...&#125;：定义URL；</span><br><span class="line">  Fragment Expressions: ~&#123;...&#125;：片段引用表达式</span><br><span class="line"></span><br><span class="line">Literals（字面量）</span><br><span class="line">      Text literals: <span class="string">&#x27;one text&#x27;</span> , <span class="string">&#x27;Another one!&#x27;</span> ,…</span><br><span class="line">      <span class="built_in">Number</span> literals: <span class="number">0</span> , <span class="number">34</span> , <span class="number">3.0</span> , <span class="number">12.3</span> ,…</span><br><span class="line">      <span class="built_in">Boolean</span> literals: <span class="literal">true</span> , <span class="literal">false</span></span><br><span class="line">      Null literal: <span class="literal">null</span></span><br><span class="line">      Literal tokens: one , sometext , main ,…</span><br><span class="line">      </span><br><span class="line">Text operations:（文本操作）</span><br><span class="line">    <span class="built_in">String</span> concatenation: +</span><br><span class="line">    Literal substitutions: |The name is $&#123;name&#125;|</span><br><span class="line">    </span><br><span class="line">Arithmetic operations:（数学运算）</span><br><span class="line">    Binary operators: + , - , * , / , %</span><br><span class="line">    Minus sign (unary operator): -</span><br><span class="line">    </span><br><span class="line"><span class="built_in">Boolean</span> operations:（布尔运算）</span><br><span class="line">    Binary operators: and , or</span><br><span class="line">    <span class="built_in">Boolean</span> negation (unary operator): ! , not</span><br><span class="line">    </span><br><span class="line">Comparisons and equality:（比较运算）</span><br><span class="line">    <span class="attr">Comparators</span>: &gt; , &lt; , &gt;= , &lt;= ( gt , lt , ge , le )</span><br><span class="line">    Equality operators: == , != ( eq , ne )</span><br><span class="line">    </span><br><span class="line">Conditional operators:条件运算（三元运算符）</span><br><span class="line">    If-then: (<span class="keyword">if</span>) ? (then)</span><br><span class="line">    If-then-<span class="keyword">else</span>: (<span class="keyword">if</span>) ? (then) : (<span class="keyword">else</span>)</span><br><span class="line">    <span class="attr">Default</span>: (value) ?: (defaultvalue)</span><br><span class="line">    </span><br><span class="line">Special tokens:</span><br><span class="line">    No-Operation: _</span><br></pre></td></tr></table></figure>
<p><strong>练习测试：</strong></p>
<p>1、 我们编写一个Controller，放一些数据</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/t2&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test2</span><span class="params">(Map&lt;String,Object&gt; map)</span></span>&#123;</span><br><span class="line">    <span class="comment">//存入数据</span></span><br><span class="line">    map.put(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;&lt;h1&gt;Hello&lt;/h1&gt;&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;users&quot;</span>, Arrays.asList(<span class="string">&quot;qinjiang&quot;</span>,<span class="string">&quot;kuangshen&quot;</span>));</span><br><span class="line">    <span class="comment">//classpath:/templates/test.html</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;test&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、测试页面取出数据</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>狂神说<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>测试页面<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;msg&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--不转义--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:utext</span>=<span class="string">&quot;$&#123;msg&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--遍历数据--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--th:each每次遍历都会生成当前这个标签：官网#9--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h4</span> <span class="attr">th:each</span>=<span class="string">&quot;user :$&#123;users&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h4</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--行内写法：官网#12--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:each</span>=<span class="string">&quot;user:$&#123;users&#125;&quot;</span>&gt;</span>[[$&#123;user&#125;]]<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>springboot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
      </tags>
  </entry>
  <entry>
    <title>springboot数据库</title>
    <url>/2022/05/02/springbootweb3/</url>
    <content><![CDATA[<h1 id="Springboot数据库交互"><a href="#Springboot数据库交互" class="headerlink" title="Springboot数据库交互"></a>Springboot数据库交互</h1><h2 id="一、SpringBoot-整合-JDBC"><a href="#一、SpringBoot-整合-JDBC" class="headerlink" title="一、SpringBoot 整合 JDBC"></a>一、SpringBoot 整合 JDBC</h2><h3 id="1-1-创建测试项目测试数据源"><a href="#1-1-创建测试项目测试数据源" class="headerlink" title="1.1 创建测试项目测试数据源"></a>1.1 创建测试项目测试数据源</h3><ol>
<li><p>我去新建一个项目测试：springboot-data-jdbc ; 引入相应的模块！基础模块</p>
<p><img src="/2022/05/02/springbootweb3/1.png" alt="1595741635349"></p>
</li>
<li><p>项目建好之后，发现自动帮我们导入了如下的启动器：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写yaml配置文件连接数据库；</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">admin</span></span><br><span class="line">    <span class="comment">#?serverTimezone=UTC解决时区的报错</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/mybatis?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置完这一些东西后，我们就可以直接去使用了，因为SpringBoot已经默认帮我们进行了自动配置；去测试类测试一下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpringbootDataJdbcApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//DI注入数据源</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">//看一下默认数据源</span></span><br><span class="line">        System.out.println(dataSource.getClass());</span><br><span class="line">        <span class="comment">//获得连接</span></span><br><span class="line">        Connection connection = dataSource.getConnection();</span><br><span class="line">        System.out.println(connection);</span><br><span class="line">        <span class="comment">//关闭连接</span></span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>结果：我们可以看到他默认给我们配置的数据源为 : class com.zaxxer.hikari.HikariDataSource ， 我们并没有手动配置</p>
<p>我们来全局搜索一下，找到数据源的所有自动配置都在 ：DataSourceAutoConfiguration文件：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Import(</span></span><br><span class="line"><span class="meta">    &#123;Hikari.class, Tomcat.class, Dbcp2.class, Generic.class, DataSourceJmxConfiguration.class&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PooledDataSourceConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">PooledDataSourceConfiguration</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里导入的类都在 DataSourceConfiguration 配置类下，可以看出 Spring Boot 2.2.5 默认使用HikariDataSource 数据源，而以前版本，如 Spring Boot 1.5 默认使用 org.apache.tomcat.jdbc.pool.DataSource 作为数据源；</p>
<p><strong><font color="red">HikariDataSource 号称 Java WEB 当前速度最快的数据源，相比于传统的 C3P0 、DBCP、Tomcat jdbc 等连接池更加优秀；</font></strong></p>
<p><strong>可以使用 spring.datasource.type 指定自定义的数据源类型，值为 要使用的连接池实现的完全限定名。</strong></p>
<p>关于数据源我们并不做介绍，有了数据库连接，显然就可以 CRUD 操作数据库了。但是我们需要先了解一个对象 JdbcTemplate</p>
<h3 id="1-2-JDBCTemplate"><a href="#1-2-JDBCTemplate" class="headerlink" title="1.2 JDBCTemplate"></a>1.2 JDBCTemplate</h3><ol>
<li><p>有了数据源(com.zaxxer.hikari.HikariDataSource)，然后可以拿到数据库连接(java.sql.Connection)，有了连接，就可以使用原生的 JDBC 语句来操作数据库；</p>
</li>
<li><p>即使不使用第三方第数据库操作框架，如 MyBatis等，Spring 本身也对原生的JDBC 做了轻量级的封装，即JdbcTemplate。</p>
</li>
<li><p>数据库操作的所有 CRUD 方法都在 JdbcTemplate 中。</p>
</li>
<li><p>Spring Boot 不仅提供了默认的数据源，同时默认已经配置好了 JdbcTemplate 放在了容器中，程序员只需自己注入即可使用</p>
</li>
<li><p>JdbcTemplate 的自动配置是依赖 org.springframework.boot.autoconfigure.jdbc 包下的 JdbcTemplateConfiguration 类</p>
</li>
</ol>
<p><strong>JdbcTemplate主要提供以下几类方法：</strong></p>
<ul>
<li>execute方法：可以用于执行任何SQL语句，一般用于执行DDL语句；</li>
<li>update方法及batchUpdate方法：update方法用于执行新增、修改、删除等语句；batchUpdate方法用于执行批处理相关语句；</li>
<li>query方法及queryForXXX方法：用于执行查询相关语句；</li>
<li>call方法：用于执行存储过程、函数相关语句。</li>
</ul>
<h3 id="1-3-测试"><a href="#1-3-测试" class="headerlink" title="1.3 测试"></a>1.3 测试</h3><p>编写一个Controller，注入 jdbcTemplate，编写测试方法进行访问测试；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> nuc.ss.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询数据库的所有信息</span></span><br><span class="line">    <span class="comment">// 没有实体类，获取数据库的东西，怎么获取？ Map</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/userList&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Map&lt;String,Object&gt;&gt; userList() &#123;</span><br><span class="line">        String sql = <span class="string">&quot;select * from user&quot;</span>;</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; maps = jdbcTemplate.queryForList(sql);</span><br><span class="line">        <span class="keyword">return</span> maps;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/addUser&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;insert into mybatis.user(id, name, pwd) values(7,&#x27;小明&#x27;,&#x27;123456&#x27;)&quot;</span>;</span><br><span class="line">        jdbcTemplate.update(sql);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;update-ok&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/updateUser/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">updateUser</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;update mybatis.user set name  = ?,pwd = ? where id = &quot;</span> + id;</span><br><span class="line">        <span class="comment">//封装</span></span><br><span class="line">        Object[] objects = <span class="keyword">new</span> Object[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">        objects[<span class="number">0</span>] = <span class="string">&quot;小明2&quot;</span>;</span><br><span class="line">        objects[<span class="number">1</span>] = <span class="string">&quot;aaaaaaa&quot;</span>;</span><br><span class="line"></span><br><span class="line">        jdbcTemplate.update(sql,objects);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;update-ok&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/deleteUser/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteUser</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;delete from mybatis.user where id = ?&quot;</span>;</span><br><span class="line">        jdbcTemplate.update(sql,id);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;update-ok&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>测试请求，结果正常；</p>
<p>到此，CURD的基本操作，使用 JDBC 就搞定了。</p>
<h2 id="二、集成Druid"><a href="#二、集成Druid" class="headerlink" title="二、集成Druid"></a>二、集成Druid</h2><h3 id="2-1-Druid简介"><a href="#2-1-Druid简介" class="headerlink" title="2.1 Druid简介"></a>2.1 Druid简介</h3><ul>
<li><p>Java程序很大一部分要操作数据库，为了提高性能操作数据库的时候，又不得不使用数据库连接池。</p>
</li>
<li><p>Druid 是阿里巴巴开源平台上一个数据库连接池实现，结合了 C3P0、DBCP 等 DB 池的优点，同时加入了日志监控。</p>
</li>
<li><p>Druid 可以很好的监控 DB 池连接和 SQL 的执行情况，天生就是针对监控而生的 DB 连接池。</p>
</li>
<li><p>Druid已经在阿里巴巴部署了超过600个应用，经过一年多生产环境大规模部署的严苛考验。</p>
</li>
<li><p>Spring Boot 2.0 以上默认使用 Hikari 数据源，可以说 Hikari 与 Driud 都是当前 Java Web 上最优秀的数据源，我们来重点介绍 Spring Boot 如何集成 Druid 数据源，如何实现数据库监控。</p>
</li>
<li><p>Github地址：<a href="https://github.com/alibaba/druid/">https://github.com/alibaba/druid/</a></p>
</li>
</ul>
<p><strong>com.alibaba.druid.pool.DruidDataSource 基本配置参数如下：</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"><strong>配置</strong></th>
<th style="text-align:center"><strong>缺省值</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">name</td>
<td style="text-align:center"></td>
<td>配置这个属性的意义在于，如果存在多个数据源，监控的时候可以通过名字来区分开来。 如果没有配置，将会生成一个名字，格式是：“DataSource-” + System.identityHashCode(this)</td>
</tr>
<tr>
<td style="text-align:center">jdbcUrl</td>
<td style="text-align:center"></td>
<td>连接数据库的url，不同数据库不一样。例如： mysql : jdbc:mysql://10.20.153.104:3306/druid2 oracle : jdbc:oracle:thin:@10.20.149.85:1521:ocnauto</td>
</tr>
<tr>
<td style="text-align:center">username</td>
<td style="text-align:center"></td>
<td>连接数据库的用户名</td>
</tr>
<tr>
<td style="text-align:center">password</td>
<td style="text-align:center"></td>
<td>连接数据库的密码。如果你不希望密码直接写在配置文件中，可以使用ConfigFilter。详细看这里：<a href="https://github.com/alibaba/druid/wiki/%E4%BD%BF%E7%94%A8ConfigFilter">https://github.com/alibaba/druid/wiki/%E4%BD%BF%E7%94%A8ConfigFilter</a></td>
</tr>
<tr>
<td style="text-align:center">driverClassName</td>
<td style="text-align:center">根据url自动识别</td>
<td>这一项可配可不配，如果不配置druid会根据url自动识别dbType，然后选择相应的driverClassName(建议配置下)</td>
</tr>
<tr>
<td style="text-align:center">initialSize</td>
<td style="text-align:center">0</td>
<td>初始化时建立物理连接的个数。初始化发生在显示调用init方法，或者第一次getConnection时</td>
</tr>
<tr>
<td style="text-align:center">maxActive</td>
<td style="text-align:center">8</td>
<td>最大连接池数量</td>
</tr>
<tr>
<td style="text-align:center">maxIdle</td>
<td style="text-align:center">8</td>
<td>已经不再使用，配置了也没效果</td>
</tr>
<tr>
<td style="text-align:center">minIdle</td>
<td style="text-align:center"></td>
<td>最小连接池数量</td>
</tr>
<tr>
<td style="text-align:center">maxWait</td>
<td style="text-align:center"></td>
<td>获取连接时最大等待时间，单位毫秒。配置了maxWait之后，缺省启用公平锁，并发效率会有所下降，如果需要可以通过配置useUnfairLock属性为true使用非公平锁。</td>
</tr>
<tr>
<td style="text-align:center">poolPreparedStatements</td>
<td style="text-align:center">false</td>
<td>是否缓存preparedStatement，也就是PSCache。PSCache对支持游标的数据库性能提升巨大，比如说oracle。在mysql下建议关闭。</td>
</tr>
<tr>
<td style="text-align:center">maxOpenPreparedStatements</td>
<td style="text-align:center">-1</td>
<td>要启用PSCache，必须配置大于0，当大于0时，poolPreparedStatements自动触发修改为true。在Druid中，不会存在Oracle下PSCache占用内存过多的问题，可以把这个数值配置大一些，比如说100</td>
</tr>
<tr>
<td style="text-align:center">validationQuery</td>
<td style="text-align:center"></td>
<td>用来检测连接是否有效的sql，要求是一个查询语句。如果validationQuery为null，testOnBorrow、testOnReturn、testWhileIdle都不会其作用。</td>
</tr>
<tr>
<td style="text-align:center">validationQueryTimeout</td>
<td style="text-align:center"></td>
<td>单位:秒，检测连接是否有效的超时时间。底层调用jdbc<br>Statement对象的void setQueryTimeout(int seconds)方法</td>
</tr>
<tr>
<td style="text-align:center">testOnBorrow</td>
<td style="text-align:center">true</td>
<td>申请连接时执行validationQuery检测连接是否有效，做了这个配置会降低性能</td>
</tr>
<tr>
<td style="text-align:center">testOnReturn</td>
<td style="text-align:center">false</td>
<td>归还连接时执行validationQuery检测连接是否有效，做了这个配置会降低性能</td>
</tr>
<tr>
<td style="text-align:center">testWhileIdle</td>
<td style="text-align:center">false</td>
<td>建议配置为true，不影响性能，并且保证安全性。申请连接的时候检测，如果空闲时间大于timeBetweenEvictionRunsMillis，执行validationQuery检测连接是否有效</td>
</tr>
<tr>
<td style="text-align:center">timeBetweenEvictionRunsMillis</td>
<td style="text-align:center">1分钟<br>( 1.0.14 )</td>
<td>有两个含义： 1) Destroy线程会检测连接的间隔时间 2) testWhileIdle的判断依据，详细看testWhileIdle属性的说明</td>
</tr>
<tr>
<td style="text-align:center">numTestsPerEvictionRun</td>
<td style="text-align:center"></td>
<td>不再使用，一个DruidDataSource只支持一个EvictionRun</td>
</tr>
<tr>
<td style="text-align:center">minEvictableIdleTimeMillis</td>
<td style="text-align:center">30分钟<br>( 1.0.14 )</td>
<td>连接保持空闲而不被驱逐的最长时间</td>
</tr>
<tr>
<td style="text-align:center">connectionInitSqls</td>
<td style="text-align:center"></td>
<td>物理连接初始化的时候执行的sql</td>
</tr>
<tr>
<td style="text-align:center">exceptionSorter</td>
<td style="text-align:center">根据dbType自动识别</td>
<td>当数据库抛出一些不可恢复的异常时，抛弃连接</td>
</tr>
<tr>
<td style="text-align:center">filters</td>
<td style="text-align:center"></td>
<td>属性类型是字符串，通过别名的方式配置扩展插件，常用的插件有： 监控统计用的filter:stat日志用的filter:log4j防御sql注入的filter:wall</td>
</tr>
<tr>
<td style="text-align:center">proxyFilters</td>
<td style="text-align:center"></td>
<td>类型是List<com.alibaba.druid.filter.Filter>，如果同时配置了filters和proxyFilters，是组合关系，并非替换关系</com.alibaba.druid.filter.Filter></td>
</tr>
</tbody>
</table>
</div>
<h3 id="2-2-配置数据源"><a href="#2-2-配置数据源" class="headerlink" title="2.2 配置数据源"></a>2.2 配置数据源</h3><ol>
<li><p>添加上 Druid 数据源依赖，这个依赖可以从Maven仓库官网<a href="https://mvnrepository.com/artifact/com.alibaba/druid"><font color="red">Maven Respository</font></a>中获取</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.23<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/05/02/springbootweb3/2.png" alt="image-20200727215315060"></p>
</li>
<li><p>切换数据源；之前已经说过 Spring Boot 2.0 以上默认使用 <code>com.zaxxer.hikari.HikariDataSource</code>数据源，但可以通过 <code>spring.datasource.type</code> 指定数据源。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    username: root</span><br><span class="line">    password: 123456</span><br><span class="line">    url: jdbc:mysql://localhost:3306/springboot?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8</span><br><span class="line">    driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">    type: com.alibaba.druid.pool.DruidDataSource # 自定义数据源</span><br></pre></td></tr></table></figure>
</li>
<li><p>数据源切换之后，在测试类中注入 DataSource，然后获取到它，输出一看便知是否成功切换；</p>
<p><img src="/2022/05/02/springbootweb3/3.png" alt="image-20200727222109497"></p>
</li>
<li><p>切换成功！既然切换成功，就可以设置数据源连接初始化大小、最大连接数、等待时间、最小连接数 等设置项；可以查看源码</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="comment">#?serverTimezone=UTC解决时区的报错</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/springboot?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#Spring Boot 默认是不注入这些属性值的，需要自己绑定</span></span><br><span class="line">    <span class="comment">#druid 数据源专有配置</span></span><br><span class="line">    <span class="attr">initialSize:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">minIdle:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">maxActive:</span> <span class="number">20</span></span><br><span class="line">    <span class="attr">maxWait:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">timeBetweenEvictionRunsMillis:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">minEvictableIdleTimeMillis:</span> <span class="number">300000</span></span><br><span class="line">    <span class="attr">validationQuery:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="string">FROM</span> <span class="string">DUAL</span></span><br><span class="line">    <span class="attr">testWhileIdle:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">testOnBorrow:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">testOnReturn:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">poolPreparedStatements:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#配置监控统计拦截的filters，stat:监控统计、log4j：日志记录、wall：防御sql注入</span></span><br><span class="line">    <span class="comment">#如果允许时报错  java.lang.ClassNotFoundException: org.apache.log4j.Priority</span></span><br><span class="line">    <span class="comment">#则导入 log4j 依赖即可，Maven 地址：https://mvnrepository.com/artifact/log4j/log4j</span></span><br><span class="line">    <span class="attr">filters:</span> <span class="string">stat,wall,log4j</span></span><br><span class="line">    <span class="attr">maxPoolPreparedStatementPerConnectionSize:</span> <span class="number">20</span></span><br><span class="line">    <span class="attr">useGlobalDataSourceStat:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">connectionProperties:</span> <span class="string">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>导入Log4j 的依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/log4j/log4j --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>现在需要程序员自己为 DruidDataSource 绑定全局配置文件中的参数，再添加到容器中，而不再使用 Spring Boot 的自动生成了；我们需要 自己添加 DruidDataSource 组件到容器中，并绑定属性；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> nuc.ss.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DruidConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">       将自定义的 Druid数据源添加到容器中，不再让 Spring Boot 自动创建</span></span><br><span class="line"><span class="comment">       绑定全局配置文件中的 druid 数据源属性到 com.alibaba.druid.pool.DruidDataSource从而让它们生效</span></span><br><span class="line"><span class="comment">       @ConfigurationProperties(prefix = &quot;spring.datasource&quot;)：作用就是将 全局配置文件中</span></span><br><span class="line"><span class="comment">       前缀为 spring.datasource的属性值注入到 com.alibaba.druid.pool.DruidDataSource 的同名参数中</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">druidDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>去测试类中测试一下；看是否成功！</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpringbootDataJdbcApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//DI注入数据源</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">//看一下默认数据源</span></span><br><span class="line">        System.out.println(dataSource.getClass());</span><br><span class="line">        <span class="comment">//获得连接</span></span><br><span class="line">        Connection connection =   dataSource.getConnection();</span><br><span class="line">        System.out.println(connection);</span><br><span class="line"></span><br><span class="line">        DruidDataSource druidDataSource = (DruidDataSource) dataSource;</span><br><span class="line">        System.out.println(<span class="string">&quot;druidDataSource 数据源最大连接数：&quot;</span> + druidDataSource.getMaxActive());</span><br><span class="line">        System.out.println(<span class="string">&quot;druidDataSource 数据源初始化连接数：&quot;</span> + druidDataSource.getInitialSize());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//关闭连接</span></span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>输出结果 ：可见配置参数已经生效！</p>
<p><img src="/2022/05/02/springbootweb3/4.png" alt="image-20200727233746228"></p>
</li>
</ol>
<h3 id="2-3-配置Druid数据源监控"><a href="#2-3-配置Druid数据源监控" class="headerlink" title="2.3 配置Druid数据源监控"></a>2.3 配置Druid数据源监控</h3><p>Druid 数据源具有监控的功能，并提供了一个 web 界面方便用户查看，类似安装 路由器 时，人家也提供了一个默认的 web 页面。</p>
<p>所以第一步需要设置 Druid 的后台管理页面，比如 登录账号、密码 等；配置后台管理；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//配置 Druid 监控管理后台的Servlet；</span></span><br><span class="line"><span class="comment">//内置 Servlet 容器时没有web.xml文件，所以使用 Spring Boot 的注册 Servlet 方式</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">statViewServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ServletRegistrationBean bean = <span class="keyword">new</span> ServletRegistrationBean(<span class="keyword">new</span> StatViewServlet(), <span class="string">&quot;/druid/*&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这些参数可以在 com.alibaba.druid.support.http.StatViewServlet </span></span><br><span class="line">    <span class="comment">// 的父类 com.alibaba.druid.support.http.ResourceServlet 中找到</span></span><br><span class="line">    Map&lt;String, String&gt; initParams = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    initParams.put(<span class="string">&quot;loginUsername&quot;</span>, <span class="string">&quot;root&quot;</span>); <span class="comment">//后台管理界面的登录账号</span></span><br><span class="line">    initParams.put(<span class="string">&quot;loginPassword&quot;</span>, <span class="string">&quot;admin&quot;</span>); <span class="comment">//后台管理界面的登录密码</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//后台允许谁可以访问</span></span><br><span class="line">    <span class="comment">//initParams.put(&quot;allow&quot;, &quot;localhost&quot;)：表示只有本机可以访问</span></span><br><span class="line">    <span class="comment">//initParams.put(&quot;allow&quot;, &quot;&quot;)：为空或者为null时，表示允许所有访问</span></span><br><span class="line">    initParams.put(<span class="string">&quot;allow&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="comment">//deny：Druid 后台拒绝谁访问</span></span><br><span class="line">    <span class="comment">//initParams.put(&quot;kuangshen&quot;, &quot;192.168.1.20&quot;);表示禁止此ip访问</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置初始化参数</span></span><br><span class="line">    bean.setInitParameters(initParams);</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置完毕后，我们可以选择访问 ：<a href="http://localhost:8080/druid/login.html">http://localhost:8080/druid/login.html</a></p>
<p><img src="/2022/05/02/springbootweb3/5.png" alt="image-20200727233409312"></p>
<p>进入之后</p>
<p><img src="/2022/05/02/springbootweb3/6.png" alt="image-20200727233436583"></p>
<p><strong>配置 Druid web 监控 filter 过滤器</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//配置 Druid 监控 之  web 监控的 filter</span></span><br><span class="line"><span class="comment">//WebStatFilter：用于配置Web和Druid数据源之间的管理关联监控统计</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">webStatFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    FilterRegistrationBean bean = <span class="keyword">new</span> FilterRegistrationBean();</span><br><span class="line">    bean.setFilter(<span class="keyword">new</span> WebStatFilter());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//exclusions：设置哪些请求进行过滤排除掉，从而不进行统计</span></span><br><span class="line">    Map&lt;String, String&gt; initParams = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    initParams.put(<span class="string">&quot;exclusions&quot;</span>, <span class="string">&quot;*.js,*.css,/druid/*,/jdbc/*&quot;</span>);</span><br><span class="line">    bean.setInitParameters(initParams);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//&quot;/*&quot; 表示过滤所有请求</span></span><br><span class="line">    bean.setUrlPatterns(Arrays.asList(<span class="string">&quot;/*&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="三、整合MyBatis"><a href="#三、整合MyBatis" class="headerlink" title="三、整合MyBatis"></a>三、整合MyBatis</h2><p>官方文档：<a href="http://mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/">http://mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/</a></p>
<p>Maven仓库地址：<a href="https://mvnrepository.com/artifact/org.mybatis.spring.boot/mybatis-spring-boot-starter/2.1.3">https://mvnrepository.com/artifact/org.mybatis.spring.boot/mybatis-spring-boot-starter/2.1.3</a></p>
<p><img src="/2022/05/02/springbootweb3/7.png" alt="image-20200728083023851"></p>
<h3 id="3-1-整合测试"><a href="#3-1-整合测试" class="headerlink" title="3.1 整合测试"></a>3.1 整合测试</h3><ol>
<li><p>导入 MyBatis 所需要的依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置数据库连接信息（不变）</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">admin</span></span><br><span class="line">    <span class="comment">#?serverTimezone=UTC解决时区的报错</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/mybatis?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#Spring Boot 默认是不注入这些属性值的，需要自己绑定</span></span><br><span class="line">    <span class="comment">#druid 数据源专有配置</span></span><br><span class="line">    <span class="attr">initialSize:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">minIdle:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">maxActive:</span> <span class="number">20</span></span><br><span class="line">    <span class="attr">maxWait:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">timeBetweenEvictionRunsMillis:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">minEvictableIdleTimeMillis:</span> <span class="number">300000</span></span><br><span class="line">    <span class="attr">validationQuery:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="string">FROM</span> <span class="string">DUAL</span></span><br><span class="line">    <span class="attr">testWhileIdle:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">testOnBorrow:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">testOnReturn:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">poolPreparedStatements:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#配置监控统计拦截的filters，stat:监控统计、log4j：日志记录、wall：防御sql注入</span></span><br><span class="line">    <span class="comment">#如果允许时报错  java.lang.ClassNotFoundException: org.apache.log4j.Priority</span></span><br><span class="line">    <span class="comment">#则导入 log4j 依赖即可，Maven 地址：https://mvnrepository.com/artifact/log4j/log4j</span></span><br><span class="line">    <span class="attr">filters:</span> <span class="string">stat,wall,log4j</span></span><br><span class="line">    <span class="attr">maxPoolPreparedStatementPerConnectionSize:</span> <span class="number">20</span></span><br><span class="line">    <span class="attr">useGlobalDataSourceStat:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">connectionProperties:</span> <span class="string">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试数据库是否连接成功！</strong></p>
</li>
<li><p><strong>创建实体类，导入 Lombok！</strong></p>
<p><code>User.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> nuc.ss.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String pwd;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>创建mapper目录以及对应的 Mapper 接口</strong></p>
<p><code>UserMapper.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> nuc.ss.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> nuc.ss.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个注解表示了这是一个 mybatis 的 mapper 类</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">queryUserList</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">User <span class="title">queryUserById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">addUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteUser</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>对应的Mapper映射文件</strong></p>
<p><code>UserMapper.xml</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--namespace=绑定一个对应的Dao/Mapper接口--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;nuc.ss.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;queryUserList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        select * from mybatis.user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;queryUserById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        select * from mybatis.user where id = #&#123;id&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        insert into mybatis.user (id, name, pwd) values (#&#123;id&#125;,#&#123;name&#125;,#&#123;pwd&#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        update mybatis.user set name=#&#123;name&#125;,pwd = #&#123;pwd&#125; where id = #&#123;id&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        delete from mybatis.user where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>maven配置资源过滤问题</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>编写部门的 UserController 进行测试！</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/queryUserList&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">queryUserList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; userList = userMapper.queryUserList();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (User user : userList) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> userList;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">     <span class="comment">//添加一个用户</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/addUser&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        userMapper.addUser(<span class="keyword">new</span> User(<span class="number">7</span>,<span class="string">&quot;阿毛&quot;</span>,<span class="string">&quot;123456&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//修改一个用户</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/updateUser&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">updateUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        userMapper.updateUser(<span class="keyword">new</span> User(<span class="number">7</span>,<span class="string">&quot;阿毛&quot;</span>,<span class="string">&quot;123456&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/deleteUser&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        userMapper.deleteUser(<span class="number">7</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>启动项目访问进行测试！</strong></p>
]]></content>
      <categories>
        <category>springboot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
      </tags>
  </entry>
  <entry>
    <title>springboot自动装配和国际化处理</title>
    <url>/2022/04/29/springbootweb2/</url>
    <content><![CDATA[<h1 id="Springboot-MVC"><a href="#Springboot-MVC" class="headerlink" title="Springboot MVC"></a>Springboot MVC</h1><h2 id="一、spring-mvc-自动装配"><a href="#一、spring-mvc-自动装配" class="headerlink" title="一、spring mvc 自动装配"></a>一、spring mvc 自动装配</h2><h3 id="1-1ContentNegotiatingViewResolver-内容协商视图解析器"><a href="#1-1ContentNegotiatingViewResolver-内容协商视图解析器" class="headerlink" title="1.1ContentNegotiatingViewResolver 内容协商视图解析器"></a>1.1ContentNegotiatingViewResolver 内容协商视图解析器</h3><p>自动配置了ViewResolver，就是我们之前学习的SpringMVC的视图解析器；</p>
<p>即根据方法的返回值取得视图对象（View），然后由视图对象决定如何渲染（转发，重定向）。</p>
<p>我们去看看这里的源码：我们找到 WebMvcAutoConfiguration ， 然后搜索ContentNegotiatingViewResolver。找到如下方法！</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(ViewResolver.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(name = &quot;viewResolver&quot;, value = ContentNegotiatingViewResolver.class)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ContentNegotiatingViewResolver <span class="title">viewResolver</span><span class="params">(BeanFactory beanFactory)</span> </span>&#123;</span><br><span class="line">    ContentNegotiatingViewResolver resolver = <span class="keyword">new</span> ContentNegotiatingViewResolver();</span><br><span class="line">    resolver.setContentNegotiationManager(beanFactory.getBean(ContentNegotiationManager.class));</span><br><span class="line">    <span class="comment">// ContentNegotiatingViewResolver使用所有其他视图解析器来定位视图，因此它应该具有较高的优先级</span></span><br><span class="line">    resolver.setOrder(Ordered.HIGHEST_PRECEDENCE);</span><br><span class="line">    <span class="keyword">return</span> resolver;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以点进这类看看！找到对应的解析视图的代码；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Nullable</span> <span class="comment">// 注解说明：@Nullable 即参数可为null</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> View <span class="title">resolveViewName</span><span class="params">(String viewName, Locale locale)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    RequestAttributes attrs = RequestContextHolder.getRequestAttributes();</span><br><span class="line">    Assert.state(attrs <span class="keyword">instanceof</span> ServletRequestAttributes, <span class="string">&quot;No current ServletRequestAttributes&quot;</span>);</span><br><span class="line">    List&lt;MediaType&gt; requestedMediaTypes = <span class="keyword">this</span>.getMediaTypes(((ServletRequestAttributes)attrs).getRequest());</span><br><span class="line">    <span class="keyword">if</span> (requestedMediaTypes != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 获取候选的视图对象</span></span><br><span class="line">        List&lt;View&gt; candidateViews = <span class="keyword">this</span>.getCandidateViews(viewName, locale, requestedMediaTypes);</span><br><span class="line">        <span class="comment">// 选择一个最适合的视图对象，然后把这个对象返回</span></span><br><span class="line">        View bestView = <span class="keyword">this</span>.getBestView(candidateViews, requestedMediaTypes, attrs);</span><br><span class="line">        <span class="keyword">if</span> (bestView != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> bestView;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// .....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们继续点进去看，他是怎么获得候选的视图的呢？</p>
<p>getCandidateViews中看到他是把所有的视图解析器拿来，进行while循环，挨个解析！</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Iterator var5 = this.viewResolvers.iterator();</span><br></pre></td></tr></table></figure>
<p>所以得出结论：<strong>ContentNegotiatingViewResolver 这个视图解析器就是用来组合所有的视图解析器的</strong> </p>
<p>我们再去研究下他的组合逻辑，看到有个属性viewResolvers，看看它是在哪里进行赋值的！</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initServletContext</span><span class="params">(ServletContext servletContext)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 这里它是从beanFactory工具中获取容器中的所有视图解析器</span></span><br><span class="line">    <span class="comment">// ViewRescolver.class 把所有的视图解析器来组合的</span></span><br><span class="line">    Collection&lt;ViewResolver&gt; matchingBeans = BeanFactoryUtils.beansOfTypeIncludingAncestors(<span class="keyword">this</span>.obtainApplicationContext(), ViewResolver.class).values();</span><br><span class="line">    ViewResolver viewResolver;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.viewResolvers == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.viewResolvers = <span class="keyword">new</span> ArrayList(matchingBeans.size());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...............</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>既然它是在容器中去找视图解析器，我们是否可以猜想，我们就可以去实现一个视图解析器了呢？</p>
<p>我们可以自己给容器中去添加一个视图解析器；这个类就会帮我们自动的将它组合进来；<strong>我们去实现一下</strong></p>
<p>1、我们在我们的主程序中去写一个视图解析器来试试；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Bean</span> <span class="comment">//放到bean中</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ViewResolver <span class="title">myViewResolver</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MyViewResolver();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//我们写一个静态内部类，视图解析器就需要实现ViewResolver接口</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyViewResolver</span> <span class="keyword">implements</span> <span class="title">ViewResolver</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">resolveViewName</span><span class="params">(String s, Locale locale)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、怎么看我们自己写的视图解析器有没有起作用呢？</p>
<p>我们给 DispatcherServlet 中的 doDispatch方法 加个断点进行调试一下，因为所有的请求都会走到这个方法中</p>
<p>3、我们启动我们的项目，然后随便访问一个页面，看一下Debug信息；</p>
<p>找到视图解析器，我们看到我们自己定义的就在这里了；</p>
<h2 id="二、转换器和格式化器"><a href="#二、转换器和格式化器" class="headerlink" title="二、转换器和格式化器"></a>二、转换器和格式化器</h2><p>找到格式化转换器：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> FormattingConversionService <span class="title">mvcConversionService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 拿到配置文件中的格式化规则</span></span><br><span class="line">    WebConversionService conversionService = </span><br><span class="line">        <span class="keyword">new</span> WebConversionService(<span class="keyword">this</span>.mvcProperties.getDateFormat());</span><br><span class="line">    addFormatters(conversionService);</span><br><span class="line">    <span class="keyword">return</span> conversionService;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>点击去：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getDateFormat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.dateFormat;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Date format to use. For instance, `dd/MM/yyyy`. 默认的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> String dateFormat;</span><br></pre></td></tr></table></figure>
<p>可以看到在我们的Properties文件中，我们可以进行自动配置它！</p>
<p>如果配置了自己的格式化方式，就会注册到Bean中生效，我们可以在配置文件中配置日期格式化的规则：</p>
<p><img src="/2022/04/29/springbootweb2/1.png" alt="图片"></p>
<p>其余的就不一一举例了，大家可以下去多研究探讨即可！</p>
<h2 id="三、修改SpringBoot的默认配置"><a href="#三、修改SpringBoot的默认配置" class="headerlink" title="三、修改SpringBoot的默认配置"></a>三、修改SpringBoot的默认配置</h2><p>这么多的自动配置，原理都是一样的，通过这个WebMVC的自动配置原理分析，我们要学会一种学习方式，通过源码探究，得出结论；这个结论一定是属于自己的，而且一通百通。</p>
<p>SpringBoot的底层，大量用到了这些设计细节思想，所以，没事需要多阅读源码！得出结论；</p>
<p>SpringBoot在自动配置很多组件的时候，先看容器中有没有用户自己配置的（如果用户自己配置@bean），如果有就用用户配置的，如果没有就用自动配置的；</p>
<p>如果有些组件可以存在多个，比如我们的视图解析器，就将用户配置的和自己默认的组合起来！</p>
<p><strong>扩展使用SpringMVC</strong>  官方文档如下：</p>
<p>If you want to keep Spring Boot MVC features and you want to add additional MVC configuration (interceptors, formatters, view controllers, and other features), you can add your own @Configuration class of type WebMvcConfigurer but without @EnableWebMvc. If you wish to provide custom instances of RequestMappingHandlerMapping, RequestMappingHandlerAdapter, or ExceptionHandlerExceptionResolver, you can declare a WebMvcRegistrationsAdapter instance to provide such components.</p>
<p>我们要做的就是编写一个@Configuration注解类，并且类型要为WebMvcConfigurer，还不能标注@EnableWebMvc注解；我们去自己写一个；我们新建一个包叫config，写一个类MyMvcConfig；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//应为类型要求为WebMvcConfigurer，所以我们实现其接口</span></span><br><span class="line"><span class="comment">//可以使用自定义类扩展MVC的功能</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 浏览器发送/test ， 就会跳转到test页面；</span></span><br><span class="line">        registry.addViewController(<span class="string">&quot;/test&quot;</span>).setViewName(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们去浏览器访问一下：</p>
<p><img src="/2022/04/29/springbootweb2/2.png" alt="图片"></p>
<p><strong>确实也跳转过来了！所以说，我们要扩展SpringMVC，官方就推荐我们这么去使用，既保SpringBoot留所有的自动配置，也能用我们扩展的配置！</strong></p>
<p>我们可以去分析一下原理：</p>
<p>1、WebMvcAutoConfiguration 是 SpringMVC的自动配置类，里面有一个类WebMvcAutoConfigurationAdapter</p>
<p>2、这个类上有一个注解，在做其他自动配置时会导入：@Import(EnableWebMvcConfiguration.class)</p>
<p>3、我们点进EnableWebMvcConfiguration这个类看一下，它继承了一个父类：DelegatingWebMvcConfiguration</p>
<p>这个父类中有这样一段代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DelegatingWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurationSupport</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebMvcConfigurerComposite configurers = <span class="keyword">new</span> WebMvcConfigurerComposite();</span><br><span class="line">    </span><br><span class="line">  <span class="comment">// 从容器中获取所有的webmvcConfigurer</span></span><br><span class="line">    <span class="meta">@Autowired(required = false)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConfigurers</span><span class="params">(List&lt;WebMvcConfigurer&gt; configurers)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!CollectionUtils.isEmpty(configurers)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.configurers.addWebMvcConfigurers(configurers);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4、我们可以在这个类中去寻找一个我们刚才设置的viewController当做参考，发现它调用了一个</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.configurers.addViewControllers(registry);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5、我们点进去看一下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">    Iterator var2 = <span class="keyword">this</span>.delegates.iterator();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(var2.hasNext()) &#123;</span><br><span class="line">        <span class="comment">// 将所有的WebMvcConfigurer相关配置来一起调用！包括我们自己配置的和Spring给我们配置的</span></span><br><span class="line">        WebMvcConfigurer delegate = (WebMvcConfigurer)var2.next();</span><br><span class="line">        delegate.addViewControllers(registry);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以得出结论：所有的WebMvcConfiguration都会被作用，不止Spring自己的配置类，我们自己的配置类当然也会被调用；</p>
<h2 id="四、全面接管SpringMVC"><a href="#四、全面接管SpringMVC" class="headerlink" title="四、全面接管SpringMVC"></a>四、全面接管SpringMVC</h2><p>官方文档：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">If you want to take complete control of Spring MVCyou can add your own @Configuration annotated with @EnableWebMvc.</span><br></pre></td></tr></table></figure>
<p>全面接管即：SpringBoot对SpringMVC的自动配置不需要了，所有都是我们自己去配置！</p>
<p>只需在我们的配置类中要加一个@EnableWebMvc。</p>
<p>我们看下如果我们全面接管了SpringMVC了，我们之前SpringBoot给我们配置的静态资源映射一定会无效，我们可以去测试一下；</p>
<p>不加注解之前，访问首页：</p>
<p><img src="/2022/04/29/springbootweb2/3.png" alt="图片"></p>
<p>给配置类加上注解：@EnableWebMvc</p>
<p><img src="/2022/04/29/springbootweb2/4.png" alt="图片"></p>
<p>我们发现所有的SpringMVC自动配置都失效了！回归到了最初的样子；</p>
<p><strong>当然，我们开发中，不推荐使用全面接管SpringMVC</strong></p>
<p>思考问题？为什么加了一个注解，自动配置就失效了！我们看下源码：</p>
<p>1、这里发现它是导入了一个类，我们可以继续进去看</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Import(&#123;DelegatingWebMvcConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableWebMvc &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、它继承了一个父类 WebMvcConfigurationSupport</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DelegatingWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurationSupport</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3、我们来回顾一下Webmvc自动配置类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class &#125;)</span></span><br><span class="line"><span class="comment">// 这个注解的意思就是：容器中没有这个组件的时候，这个自动配置类才生效</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(&#123; DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class,</span></span><br><span class="line"><span class="meta">    ValidationAutoConfiguration.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcAutoConfiguration</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>总结一句话：@EnableWebMvc将WebMvcConfigurationSupport组件导入进来了；</p>
<p>而导入的WebMvcConfigurationSupport只是SpringMVC最基本的功能！</p>
<p><strong>在SpringBoot中会有非常多的扩展配置，只要看见了这个，我们就应该多留心注意~</strong></p>
<h1 id="Springboot-国际化"><a href="#Springboot-国际化" class="headerlink" title="Springboot 国际化"></a>Springboot 国际化</h1><p>页面国际化</p>
<p>有的时候，我们的网站会去涉及中英文甚至多语言的切换，这时候我们就需要学习国际化了！</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>先在IDEA中统一设置properties的编码问题！</p>
<p><img src="/2022/04/29/springbootweb2/5.png" alt="图片"></p>
<p>编写国际化配置文件，抽取页面需要显示的国际化页面消息。我们可以去登录页面查看一下，哪些内容我们需要编写国际化的配置！</p>
<h2 id="配置文件编写"><a href="#配置文件编写" class="headerlink" title="配置文件编写"></a>配置文件编写</h2><p>1、我们在resources资源文件下新建一个i18n目录，存放国际化配置文件</p>
<p>2、建立一个login.properties文件，还有一个login_zh_CN.properties；发现IDEA自动识别了我们要做国际化操作；文件夹变了！</p>
<p><img src="/2022/04/29/springbootweb2/6.png" alt="图片"></p>
<p>3、我们可以在这上面去新建一个文件；</p>
<p><img src="/2022/04/29/springbootweb2/7.png" alt="图片"></p>
<p>弹出如下页面：我们再添加一个英文的；</p>
<p><img src="/2022/04/29/springbootweb2/8.png" alt="图片"></p>
<p>这样就快捷多了！</p>
<p><img src="/2022/04/29/springbootweb2/9.png" alt="图片"></p>
<p><strong>4、接下来，我们就来编写配置，我们可以看到idea下面有另外一个视图；</strong></p>
<p><img src="/2022/04/29/springbootweb2/10.png" alt="图片"></p>
<p>这个视图我们点击 + 号就可以直接添加属性了；我们新建一个login.tip，可以看到边上有三个文件框可以输入</p>
<p><img src="/2022/04/29/springbootweb2/11.png" alt="图片"></p>
<p>我们添加一下首页的内容！</p>
<p><img src="/2022/04/29/springbootweb2/12.png" alt="图片"></p>
<p>然后依次添加其他页面内容即可！</p>
<p><img src="/2022/04/29/springbootweb2/13.png" alt="图片"></p>
<p>然后去查看我们的配置文件；</p>
<p>login.properties ：默认</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">login.btn=登录</span><br><span class="line">login.password=密码</span><br><span class="line">login.remember=记住我</span><br><span class="line">login.tip=请登录</span><br><span class="line">login.username=用户名</span><br></pre></td></tr></table></figure>
<p>英文：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">login.btn=Sign in</span><br><span class="line">login.password=Password</span><br><span class="line">login.remember=Remember me</span><br><span class="line">login.tip=Please sign in</span><br><span class="line">login.username=Username</span><br></pre></td></tr></table></figure>
<p>中文：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">login.btn=登录login.password=密码login.remember=记住我login.tip=请登录login.username=用户名</span><br></pre></td></tr></table></figure>
<p>OK，配置文件步骤搞定！</p>
<h2 id="配置文件生效探究"><a href="#配置文件生效探究" class="headerlink" title="配置文件生效探究"></a>配置文件生效探究</h2><p>我们去看一下SpringBoot对国际化的自动配置！这里又涉及到一个类：MessageSourceAutoConfiguration</p>
<p>里面有一个方法，这里发现SpringBoot已经自动配置好了管理我们国际化资源文件的组件 ResourceBundleMessageSource；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取 properties 传递过来的值进行判断</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> MessageSource <span class="title">messageSource</span><span class="params">(MessageSourceProperties properties)</span> </span>&#123;</span><br><span class="line">    ResourceBundleMessageSource messageSource = <span class="keyword">new</span> ResourceBundleMessageSource();</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasText(properties.getBasename())) &#123;</span><br><span class="line">        <span class="comment">// 设置国际化文件的基础名（去掉语言国家代码的）</span></span><br><span class="line">        messageSource.setBasenames(</span><br><span class="line">            StringUtils.commaDelimitedListToStringArray(</span><br><span class="line">                                       StringUtils.trimAllWhitespace(properties.getBasename())));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (properties.getEncoding() != <span class="keyword">null</span>) &#123;</span><br><span class="line">        messageSource.setDefaultEncoding(properties.getEncoding().name());</span><br><span class="line">    &#125;</span><br><span class="line">    messageSource.setFallbackToSystemLocale(properties.isFallbackToSystemLocale());</span><br><span class="line">    Duration cacheDuration = properties.getCacheDuration();</span><br><span class="line">    <span class="keyword">if</span> (cacheDuration != <span class="keyword">null</span>) &#123;</span><br><span class="line">        messageSource.setCacheMillis(cacheDuration.toMillis());</span><br><span class="line">    &#125;</span><br><span class="line">    messageSource.setAlwaysUseMessageFormat(properties.isAlwaysUseMessageFormat());</span><br><span class="line">    messageSource.setUseCodeAsDefaultMessage(properties.isUseCodeAsDefaultMessage());</span><br><span class="line">    <span class="keyword">return</span> messageSource;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们真实 的情况是放在了i18n目录下，所以我们要去配置这个messages的路径；</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">spring.messages.basename=i18n.login</span><br></pre></td></tr></table></figure>
<h2 id="配置页面国际化值"><a href="#配置页面国际化值" class="headerlink" title="配置页面国际化值"></a>配置页面国际化值</h2><p>去页面获取国际化的值，查看Thymeleaf的文档，找到message取值操作为：#{…}。我们去页面测试下：</p>
<p>IDEA还有提示，非常智能的！</p>
<p><img src="/2022/04/29/springbootweb2/14.png" alt="图片"></p>
<p>我们可以去启动项目，访问一下，发现已经自动识别为中文的了！</p>
<p><img src="/2022/04/29/springbootweb2/15.png" alt="图片"></p>
<p><strong>但是我们想要更好！可以根据按钮自动切换中文英文！</strong></p>
<h2 id="配置国际化解析"><a href="#配置国际化解析" class="headerlink" title="配置国际化解析"></a>配置国际化解析</h2><p>在Spring中有一个国际化的Locale （区域信息对象）；里面有一个叫做LocaleResolver （获取区域信息对象）的解析器！</p>
<p>我们去我们webmvc自动配置文件，寻找一下！看到SpringBoot默认配置：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;spring.mvc&quot;, name = &quot;locale&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> LocaleResolver <span class="title">localeResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 容器中没有就自己配，有的话就用用户配置的</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.mvcProperties.getLocaleResolver() == WebMvcProperties.LocaleResolver.FIXED) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FixedLocaleResolver(<span class="keyword">this</span>.mvcProperties.getLocale());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 接收头国际化分解</span></span><br><span class="line">    AcceptHeaderLocaleResolver localeResolver = <span class="keyword">new</span> AcceptHeaderLocaleResolver();</span><br><span class="line">    localeResolver.setDefaultLocale(<span class="keyword">this</span>.mvcProperties.getLocale());</span><br><span class="line">    <span class="keyword">return</span> localeResolver;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AcceptHeaderLocaleResolver 这个类中有一个方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Locale <span class="title">resolveLocale</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">    Locale defaultLocale = <span class="keyword">this</span>.getDefaultLocale();</span><br><span class="line">    <span class="comment">// 默认的就是根据请求头带来的区域信息获取Locale进行国际化</span></span><br><span class="line">    <span class="keyword">if</span> (defaultLocale != <span class="keyword">null</span> &amp;&amp; request.getHeader(<span class="string">&quot;Accept-Language&quot;</span>) == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> defaultLocale;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        Locale requestLocale = request.getLocale();</span><br><span class="line">        List&lt;Locale&gt; supportedLocales = <span class="keyword">this</span>.getSupportedLocales();</span><br><span class="line">        <span class="keyword">if</span> (!supportedLocales.isEmpty() &amp;&amp; !supportedLocales.contains(requestLocale)) &#123;</span><br><span class="line">            Locale supportedLocale = <span class="keyword">this</span>.findSupportedLocale(request, supportedLocales);</span><br><span class="line">            <span class="keyword">if</span> (supportedLocale != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> supportedLocale;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> defaultLocale != <span class="keyword">null</span> ? defaultLocale : requestLocale;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> requestLocale;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那假如我们现在想点击链接让我们的国际化资源生效，就需要让我们自己的Locale生效！</p>
<p>我们去自己写一个自己的LocaleResolver，可以在链接上携带区域信息！</p>
<p>修改一下前端页面的跳转连接：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 这里传入参数不需要使用 ？使用 （key=value）--&gt;</span><br><span class="line">&lt;a class=&quot;btn btn-sm&quot; th:href=&quot;@&#123;/index.html(l=&#x27;zh_CN&#x27;)&#125;&quot;&gt;中文&lt;/a&gt;</span><br><span class="line">&lt;a class=&quot;btn btn-sm&quot; th:href=&quot;@&#123;/index.html(l=&#x27;en_US&#x27;)&#125;&quot;&gt;English&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<p>我们去写一个处理的组件类！</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kuang.component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.LocaleResolver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"></span><br><span class="line"><span class="comment">//可以在链接上携带区域信息</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLocaleResolver</span> <span class="keyword">implements</span> <span class="title">LocaleResolver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//解析请求</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Locale <span class="title">resolveLocale</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        String language = request.getParameter(<span class="string">&quot;l&quot;</span>);</span><br><span class="line">        Locale locale = Locale.getDefault(); <span class="comment">// 如果没有获取到就使用系统默认的</span></span><br><span class="line">        <span class="comment">//如果请求链接不为空</span></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(language))&#123;</span><br><span class="line">            <span class="comment">//分割请求参数</span></span><br><span class="line">            String[] split = language.split(<span class="string">&quot;_&quot;</span>);</span><br><span class="line">            <span class="comment">//国家，地区</span></span><br><span class="line">            locale = <span class="keyword">new</span> Locale(split[<span class="number">0</span>],split[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> locale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocale</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Locale locale)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了让我们的区域化信息能够生效，我们需要再配置一下这个组件！在我们自己的MvcConofig下添加bean；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> LocaleResolver <span class="title">localeResolver</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MyLocaleResolver();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>我们重启项目，来访问一下，发现点击按钮可以实现成功切换！搞定收工！</strong></p>
]]></content>
      <categories>
        <category>springboot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
      </tags>
  </entry>
  <entry>
    <title>swagger</title>
    <url>/2022/05/04/swagger/</url>
    <content><![CDATA[<h1 id="Swagger"><a href="#Swagger" class="headerlink" title="Swagger"></a>Swagger</h1><ul>
<li><p>了解Swagger的概念及作用</p>
</li>
<li><p>了解前后端分离</p>
</li>
<li><p>在springboot中集成swagger</p>
</li>
<li><p>Swagger简介</p>
<p><strong>前后端分离</strong></p>
<p>Vue+SpringBoot</p>
<p>后端时代：前端只用管理静态页面；html==&gt;后端。模板引擎JSP=&gt;后端才是主力</p>
<p><strong>前后端分离时代</strong></p>
<ul>
<li>前端 -&gt; 前端控制层、视图层<ul>
<li>伪造后端数据，json。已经存在了，不需要后端，前端工程队依旧能够跑起来</li>
</ul>
</li>
<li>后端 -&gt; 后端控制层、服务层、数据访问层</li>
<li>前后端通过API进行交互</li>
<li>前后端相对独立且松耦合</li>
</ul>
<p><strong>产生的问题</strong></p>
<ul>
<li>前后端集成联调，前端或者后端无法做到“及时协商，尽早解决”，最终导致问题集中爆发</li>
</ul>
<p><strong>解决方案</strong></p>
<ul>
<li>首先定义schema [ 计划的提纲 ]，并实时跟踪最新的API，降低集成风险；</li>
<li>早些年：指定word计划文档；</li>
<li>前后端分离：<ul>
<li>前端测试后端接口：postman</li>
<li>后端提供接口，需要实时更新最新的消息及改动</li>
</ul>
</li>
</ul>
<h2 id="Swagger-1"><a href="#Swagger-1" class="headerlink" title="Swagger"></a>Swagger</h2><ul>
<li>号称世界上最流行的API框架</li>
<li>Restful Api 文档在线自动生成器 =&gt; <font color="red"><strong>API 文档 与API 定义同步更新</strong></font></li>
<li>直接运行，在线测试API</li>
<li>支持多种语言 （如：Java，PHP等）</li>
<li>官网：<a href="https://swagger.io/">https://swagger.io/</a></li>
</ul>
</li>
</ul>
<h2 id="一、springboot-整合Swagger"><a href="#一、springboot-整合Swagger" class="headerlink" title="一、springboot 整合Swagger"></a>一、springboot 整合Swagger</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/io.springfox/springfox-boot-starter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol>
<li><p>编写HelloController，测试确保运行成功！</p>
</li>
<li><p>要使用Swagger，我们需要编写一个配置类-SwaggerConfig来配置 Swagger</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> <span class="comment">//配置类</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span><span class="comment">// 开启Swagger2的自动配置</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfig</span> </span>&#123;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>访问测试 ：<a href="http://localhost:8080/swagger-ui.html">http://localhost:8080/swagger-ui.html</a> ，可以看到swagger的界面；</p>
</li>
</ol>
<p><strong>使用spring 2.6x版本会报空指针异常</strong></p>
<p>#因为Springfox使用的路径匹配是基于AntPathMatcher的，而Spring Boot 2.6.X使用的是PathPatternMatcher。<br>#解决：在application.properties里配置</p>
<p><img src="/2022/05/04/swagger/1.png" alt="image-20200731132229265"></p>
<h2 id="二、配置Swagger消息"><a href="#二、配置Swagger消息" class="headerlink" title="二、配置Swagger消息"></a>二、配置Swagger消息</h2><ol>
<li><p>Swagger实例Bean是Docket，所以通过配置Docket实例来配置Swaggger。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span> <span class="comment">//配置docket以配置Swagger具体参数</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Docket <span class="title">docket</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>可以通过apiInfo()属性配置文档信息</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//配置文档信息</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   Contact contact = <span class="keyword">new</span> Contact(<span class="string">&quot;联系人名字&quot;</span>, <span class="string">&quot;http://xxx.xxx.com/联系人访问链接&quot;</span>, <span class="string">&quot;联系人邮箱&quot;</span>);</span><br><span class="line">    <span class="comment">//使用ApiInfoBuilder可以不用设置所有参数</span></span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder().contact(contact).title(<span class="string">&quot;Swagger学习&quot;</span>).description(<span class="string">&quot;学习演示如何配置Swagger&quot;</span>).extensions(<span class="keyword">new</span> ArrayList&lt;&gt;()).build();</span><br><span class="line">  </span><br><span class="line">   <span class="comment">/**使用全参构造器</span></span><br><span class="line"><span class="comment">   * return new ApiInfo(</span></span><br><span class="line"><span class="comment">           &quot;Swagger学习&quot;, // 标题</span></span><br><span class="line"><span class="comment">           &quot;学习演示如何配置Swagger&quot;, // 描述</span></span><br><span class="line"><span class="comment">           &quot;v1.0&quot;, // 版本</span></span><br><span class="line"><span class="comment">           &quot;http://terms.service.url/组织链接&quot;, // 组织链接</span></span><br><span class="line"><span class="comment">           contact, // 联系人信息</span></span><br><span class="line"><span class="comment">           &quot;Apach 2.0 许可&quot;, // 许可</span></span><br><span class="line"><span class="comment">           &quot;许可链接&quot;, // 许可连接</span></span><br><span class="line"><span class="comment">           new ArrayList&lt;&gt;()// 扩展</span></span><br><span class="line"><span class="comment">  	);</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Docket 实例关联上 apiInfo()</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Docket <span class="title">docket</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2).apiInfo(apiInfo());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启项目，访问测试 <a href="http://localhost:8080/swagger-ui.html">http://localhost:8080/swagger-ui.html</a>  看下效果；</p>
</li>
</ol>
<p><img src="/2022/05/04/swagger/2.png" alt="image-20200731161851136"></p>
<h2 id="三、配置扫描接口"><a href="#三、配置扫描接口" class="headerlink" title="三、配置扫描接口"></a>三、配置扫描接口</h2><ol>
<li><p>构建Docket时通过select()方法配置怎么扫描接口。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Docket <span class="title">docket</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">      .apiInfo(apiInfo())</span><br><span class="line">      .select()<span class="comment">// 通过.select()方法，去配置扫描接口,RequestHandlerSelectors配置如何扫描接口</span></span><br><span class="line">      .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;nuc.ss.swagger.controller&quot;</span>))</span><br><span class="line">      .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启项目测试，由于我们配置根据包的路径扫描接口，所以我们只能看到一个类</p>
</li>
</ol>
<h3 id="其他配置方法"><a href="#其他配置方法" class="headerlink" title="其他配置方法"></a>其他配置方法</h3><ol>
<li><p>除了通过包路径配置扫描接口外，还可以通过配置其他方式扫描接口，这里注释一下所有的配置方式：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">basePackage(final String basePackage) // 根据包路径扫描接口</span><br><span class="line">any() // 扫描所有，项目中的所有接口都会被扫描到</span><br><span class="line">none() // 不扫描接口</span><br><span class="line">// 通过方法上的注解扫描，如withMethodAnnotation(GetMapping.class)只扫描get请求</span><br><span class="line">withMethodAnnotation(final Class&lt;? extends Annotation&gt; annotation)</span><br><span class="line">// 通过类上的注解扫描，如.withClassAnnotation(Controller.class)只扫描有controller注解的类中的接口</span><br><span class="line">withClassAnnotation(final Class&lt;? extends Annotation&gt; annotation)</span><br></pre></td></tr></table></figure>
</li>
<li><p>除此之外，我们还可以配置接口扫描过滤：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Docket <span class="title">docket</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">      .apiInfo(apiInfo())</span><br><span class="line">      .select()</span><br><span class="line">      .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.kuang.swagger.controller&quot;</span>))</span><br><span class="line">       <span class="comment">// 配置如何通过path过滤,即这里只扫描请求以/ss开头的接口</span></span><br><span class="line">      .paths(PathSelectors.ant(<span class="string">&quot;/ss/**&quot;</span>))</span><br><span class="line">      .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>这里的可选值还有</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">any() // 任何请求都扫描</span><br><span class="line">none() // 任何请求都不扫描</span><br><span class="line">regex(final String pathRegex) // 通过正则表达式控制</span><br><span class="line">ant(final String antPattern) // 通过ant()控制</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="四、配置Swagger开关"><a href="#四、配置Swagger开关" class="headerlink" title="四、配置Swagger开关"></a>四、配置Swagger开关</h2><ol>
<li><p>通过enable()方法配置是否启用swagger，如果是false，swagger将不能在浏览器中访问了</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Docket <span class="title">docket</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">      .apiInfo(apiInfo())</span><br><span class="line">      .enable(<span class="keyword">false</span>) <span class="comment">//配置是否启用Swagger，如果是false，在浏览器将无法访问</span></span><br><span class="line">      .select()</span><br><span class="line">      .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;nuc.ss.swagger.controller&quot;</span>))</span><br><span class="line">      .paths(PathSelectors.ant(<span class="string">&quot;/ss/**&quot;</span>))</span><br><span class="line">      .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><img src="/2022/05/04/swagger/3.png" alt="image-20200731190614381"></p>
<ol>
<li><p>如何动态配置当项目处于test、dev环境时显示swagger，处于prod时不显示？</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Docket <span class="title">docket</span><span class="params">(Environment environment)</span> </span>&#123;</span><br><span class="line">   <span class="comment">// 设置要显示swagger的环境</span></span><br><span class="line">   Profiles of = Profiles.of(<span class="string">&quot;dev&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">   <span class="comment">// 判断当前是否处于该环境</span></span><br><span class="line">   <span class="comment">// 通过 enable() 接收此参数判断是否要显示</span></span><br><span class="line">   <span class="keyword">boolean</span> b = environment.acceptsProfiles(of);</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">      .apiInfo(apiInfo())</span><br><span class="line">      .enable(b)</span><br><span class="line">      .select()</span><br><span class="line">      .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.kuang.swagger.controller&quot;</span>))</span><br><span class="line">      .paths(PathSelectors.ant(<span class="string">&quot;/ss/**&quot;</span>))</span><br><span class="line">      .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>可以在项目中增加配置文件</p>
<ul>
<li><p>dev测试环境</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8081</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/05/04/swagger/4.png" alt="image-20200731193109826"></p>
<p>项目运行结果</p>
<p><img src="/2022/05/04/swagger/5.png" alt="image-20200731193425090"></p>
</li>
<li><p>pro测试环境</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8082</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/05/04/swagger/6.png" alt="image-20200731194455510"></p>
<p>项目运行结果</p>
<p><img src="/2022/05/04/swagger/7.png" alt="image-20200731194559290"></p>
</li>
</ul>
</li>
</ol>
<h2 id="五、配置API分组"><a href="#五、配置API分组" class="headerlink" title="五、配置API分组"></a>五、配置API分组</h2><ol>
<li><p>如果没有配置分组，默认是default。通过groupName()方法即可配置分组：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Docket <span class="title">docket</span><span class="params">(Environment environment)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2).apiInfo(apiInfo())</span><br><span class="line">      .groupName(<span class="string">&quot;狂神&quot;</span>) <span class="comment">// 配置分组</span></span><br><span class="line">       <span class="comment">// 省略配置....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启项目查看分组</p>
<p><img src="/2022/05/04/swagger/8.png" alt="image-20200731195354714"></p>
</li>
<li><p>如何配置多个分组？配置多个分组只需要配置多个docket即可：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Docket <span class="title">docket1</span><span class="params">()</span></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2).groupName(<span class="string">&quot;group1&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Docket <span class="title">docket2</span><span class="params">()</span></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2).groupName(<span class="string">&quot;group2&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Docket <span class="title">docket3</span><span class="params">()</span></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2).groupName(<span class="string">&quot;group3&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启项目查看即可</p>
<p><img src="/2022/05/04/swagger/9.png" alt="image-20200731195543102"></p>
</li>
</ol>
<h2 id="六、实体配置"><a href="#六、实体配置" class="headerlink" title="六、实体配置"></a>六、实体配置</h2><ol>
<li><p>新建一个实体类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//@Api(&quot;注释&quot;)</span></span><br><span class="line"><span class="meta">@ApiModel(&quot;用户实体&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;用户名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;密码&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>只要这个实体在<strong>请求接口</strong>的返回值上（即使是泛型），都能映射到实体项中：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//   /error默认错误请求</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//只要我们的接口中，返回值中存在实体类，他就会被扫描到Swagger中</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/user&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">user</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启查看测试</p>
<p><img src="/2022/05/04/swagger/11.png" alt="image-20220505152326619"></p>
</li>
</ol>
<h2 id="七、常用注解"><a href="#七、常用注解" class="headerlink" title="七、常用注解"></a>七、常用注解</h2><p>Swagger的所有注解定义在io.swagger.annotations包下</p>
<p>下面列一些经常用到的，未列举出来的可以另行查阅说明：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Swagger注解</th>
<th>简单说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>@Api(tags = “xxx模块说明”)</td>
<td>作用在模块类上</td>
</tr>
<tr>
<td>@ApiOperation(“xxx接口说明”)</td>
<td>作用在接口方法上</td>
</tr>
<tr>
<td>@ApiModel(“xxxPOJO说明”)</td>
<td>作用在模型类上：如VO、BO</td>
</tr>
<tr>
<td>@ApiModelProperty(value = “xxx属性说明”,hidden = true)</td>
<td>作用在类方法和属性上，hidden设置为true可以隐藏该属性</td>
</tr>
<tr>
<td>@ApiParam(“xxx参数说明”)</td>
<td>作用在参数、方法和字段上，类似@ApiModelProperty</td>
</tr>
</tbody>
</table>
</div>
<p>我们也可以给请求的接口配置一些注释</p>
<ol>
<li><p>在HelloController控制类中的接口添加api接口注释</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">    ......</span><br><span class="line">    <span class="meta">@ApiOperation(&quot;Hello控制接口&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello2</span><span class="params">(<span class="meta">@ApiParam(&quot;用户名&quot;)</span> String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span> + username;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiOperation(&quot;get测试&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/get&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">hello2</span><span class="params">(<span class="meta">@ApiParam(&quot;用户&quot;)</span> User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><p>进行try it out测试</p>
<p><img src="/2022/05/04/swagger/12.png" alt="image-20200731202958255"></p>
<p>测试结果</p>
<p><img src="/2022/05/04/swagger/13.png" alt="image-20200731203034702"></p>
</li>
</ol>
<p><strong>总结：</strong></p>
<ol>
<li><p>这样的话，可以给一些比较难理解的属性或者接口，增加一些配置信息，让人更容易阅读！</p>
</li>
<li><p>相较于传统的Postman或Curl方式测试接口，使用swagger简直就是傻瓜式操作，不需要额外说明文档(写得好本身就是文档)而且更不容易出错，只需要录入数据然后点击Execute，如果再配合自动化框架，可以说基本就不需要人为操作了。</p>
</li>
<li><p>Swagger是个优秀的工具，现在国内已经有很多的中小型互联网公司都在使用它，相较于传统的要先出Word接口文档再测试的方式，显然这样也更符合现在的快速迭代开发行情。当然了，提醒下大家在正式环境要记得关闭Swagger，一来出于安全考虑二来也可以节省运行时内存。</p>
</li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>swagger</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>swagger</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo问题集合</title>
    <url>/2021/09/24/test-my-site/</url>
    <content><![CDATA[<h1 id="1-更换next主题无法显示博客页面"><a href="#1-更换next主题无法显示博客页面" class="headerlink" title="1.更换next主题无法显示博客页面"></a>1.更换next主题无法显示博客页面</h1><p>新版hexo没有安装：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm i hexo-renderer-swig </span><br></pre></td></tr></table></figure>
<h1 id="2-next主题添加搜索功能"><a href="#2-next主题添加搜索功能" class="headerlink" title="2.next主题添加搜索功能"></a>2.next主题添加搜索功能</h1><ol>
<li><p>下载插件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install hexo-generator-searchdb --save</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>修改站点配置文件———添加</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">search:</span><br><span class="line">  path: search.xml</span><br><span class="line">  field: post</span><br><span class="line">  format: html</span><br><span class="line">  limit: 10000</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改主题配置文件———修改local_search的enable为true：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># Local search</span><br><span class="line"># Dependencies: https://github.com/flashlab/hexo-generator-search</span><br><span class="line">local_search:</span><br><span class="line">  enable: true</span><br><span class="line">  # if auto, trigger search by changing input</span><br><span class="line">  # if manual, trigger search by pressing enter key or search button</span><br><span class="line">  trigger: auto</span><br><span class="line">  # show top n results per article, show all results by setting to -1</span><br><span class="line">  top_n_per_article: 1</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="3-添加图片"><a href="#3-添加图片" class="headerlink" title="3.添加图片"></a>3.添加图片</h1><h2 id="第一步：安装插件，在hexo根目录打开Git-Bash-执行"><a href="#第一步：安装插件，在hexo根目录打开Git-Bash-执行" class="headerlink" title="第一步：安装插件，在hexo根目录打开Git Bash,执行"></a>第一步：安装插件，在hexo根目录打开Git Bash,执行</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install hexo-asset-image --save</span><br></pre></td></tr></table></figure>
<h2 id="第二步：打开hexo的配置文件-config-yml"><a href="#第二步：打开hexo的配置文件-config-yml" class="headerlink" title="第二步：打开hexo的配置文件_config.yml"></a>第二步：打开hexo的配置文件_config.yml</h2><h2 id="找到-post-asset-folder，把这个选项从false改成true"><a href="#找到-post-asset-folder，把这个选项从false改成true" class="headerlink" title="找到 post_asset_folder，把这个选项从false改成true"></a>找到 post_asset_folder，把这个选项从false改成true</h2><h2 id="第三步：打开"><a href="#第三步：打开" class="headerlink" title="第三步：打开"></a>第三步：打开</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/node_modules/hexo-asset-image/index.js</span><br></pre></td></tr></table></figure>
<p>将内容更换为下面的代码<br> （在此感谢Ericam_ 大神：<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fblog.csdn.net%2Fxjm850552586">https://blog.csdn.net/xjm850552586</a>）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">var cheerio = require(<span class="string">&#x27;cheerio&#x27;</span>);</span><br><span class="line"></span><br><span class="line">// http://stackoverflow.com/questions/14480345/how-to-get-the-nth-occurrence-in-a-string</span><br><span class="line"><span class="keyword">function</span> getPosition(str, m, i) &#123;</span><br><span class="line">  <span class="built_in">return</span> str.split(m, i).join(m).length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var version = String(hexo.version).split(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">hexo.extend.filter.register(<span class="string">&#x27;after_post_render&#x27;</span>, <span class="keyword">function</span>(data)&#123;</span><br><span class="line">  var config = hexo.config;</span><br><span class="line">  <span class="keyword">if</span>(config.post_asset_folder)&#123;</span><br><span class="line">        var link = data.permalink;</span><br><span class="line">    <span class="keyword">if</span>(version.length &gt; 0 &amp;&amp; Number(version[0]) == 3)</span><br><span class="line">       var beginPos = getPosition(link, <span class="string">&#x27;/&#x27;</span>, 1) + 1;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">       var beginPos = getPosition(link, <span class="string">&#x27;/&#x27;</span>, 3) + 1;</span><br><span class="line">    // In hexo 3.1.1, the permalink of <span class="string">&quot;about&quot;</span> page is like <span class="string">&quot;.../about/index.html&quot;</span>.</span><br><span class="line">    var endPos = link.lastIndexOf(<span class="string">&#x27;/&#x27;</span>) + 1;</span><br><span class="line">    link = link.substring(beginPos, endPos);</span><br><span class="line"></span><br><span class="line">    var toprocess = [<span class="string">&#x27;excerpt&#x27;</span>, <span class="string">&#x27;more&#x27;</span>, <span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="keyword">for</span>(var i = 0; i &lt; toprocess.length; i++)&#123;</span><br><span class="line">      var key = toprocess[i];</span><br><span class="line"> </span><br><span class="line">      var $ = cheerio.load(data[key], &#123;</span><br><span class="line">        ignoreWhitespace: <span class="literal">false</span>,</span><br><span class="line">        xmlMode: <span class="literal">false</span>,</span><br><span class="line">        lowerCaseTags: <span class="literal">false</span>,</span><br><span class="line">        decodeEntities: <span class="literal">false</span></span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      $(<span class="string">&#x27;img&#x27;</span>).each(<span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">        <span class="keyword">if</span> ($(this).attr(<span class="string">&#x27;src&#x27;</span>))&#123;</span><br><span class="line">            // For windows style path, we replace <span class="string">&#x27;\&#x27;</span> to <span class="string">&#x27;/&#x27;</span>.</span><br><span class="line">            var src = $(this).attr(<span class="string">&#x27;src&#x27;</span>).replace(<span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span>(!/http[s]*.*|\/\/.*/.<span class="built_in">test</span>(src) &amp;&amp;</span><br><span class="line">               !/^\s*\//.<span class="built_in">test</span>(src)) &#123;</span><br><span class="line">              // For <span class="string">&quot;about&quot;</span> page, the first part of <span class="string">&quot;src&quot;</span> can<span class="string">&#x27;t be removed.</span></span><br><span class="line"><span class="string">              // In addition, to support multi-level local directory.</span></span><br><span class="line"><span class="string">              var linkArray = link.split(&#x27;</span>/<span class="string">&#x27;).filter(function(elem)&#123;</span></span><br><span class="line"><span class="string">                return elem != &#x27;</span><span class="string">&#x27;;</span></span><br><span class="line"><span class="string">              &#125;);</span></span><br><span class="line"><span class="string">              var srcArray = src.split(&#x27;</span>/<span class="string">&#x27;).filter(function(elem)&#123;</span></span><br><span class="line"><span class="string">                return elem != &#x27;</span><span class="string">&#x27; &amp;&amp; elem != &#x27;</span>.<span class="string">&#x27;;</span></span><br><span class="line"><span class="string">              &#125;);</span></span><br><span class="line"><span class="string">              if(srcArray.length &gt; 1)</span></span><br><span class="line"><span class="string">                srcArray.shift();</span></span><br><span class="line"><span class="string">              src = srcArray.join(&#x27;</span>/<span class="string">&#x27;);</span></span><br><span class="line"><span class="string">              $(this).attr(&#x27;</span>src<span class="string">&#x27;, config.root + link + src);</span></span><br><span class="line"><span class="string">              console.info&amp;&amp;console.info(&quot;update link as:--&gt;&quot;+config.root + link + src);</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125;else&#123;</span></span><br><span class="line"><span class="string">            console.info&amp;&amp;console.info(&quot;no src attr, skipped...&quot;);</span></span><br><span class="line"><span class="string">            console.info&amp;&amp;console.info($(this));</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;);</span></span><br><span class="line"><span class="string">      data[key] = $.html();</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;);</span></span><br></pre></td></tr></table></figure>
<p>第四步：现在就可以插入图片了，比如hexo new post photo之后<br> 就在source/_posts生成photo.md文件和photo文件夹，我们把要插入的图片复制到photo文件夹内，<br> 在photo.md文件里面按markdown的标准写,（我的文件名是head.jpeg）比如</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">![这是代替图片的文字，随便写](head.jpeg)</span><br></pre></td></tr></table></figure>
<h1 id="4-文章折叠"><a href="#4-文章折叠" class="headerlink" title="4.文章折叠"></a>4.文章折叠</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- more --&gt;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo_next主题</tag>
      </tags>
  </entry>
  <entry>
    <title>tomcat</title>
    <url>/2021/12/02/tomcat/</url>
    <content><![CDATA[<h3 id="一、tomcat服务器"><a href="#一、tomcat服务器" class="headerlink" title="一、tomcat服务器"></a>一、tomcat服务器</h3><h5 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h5><p>​    Tomcat是Apache 软件基金会（Apache Software Foundation）的Jakarta 项目中的一个核心项目，由Apache、Sun 和其他一些公司及个人共同开发而成。由于有了Sun 的参与和支持，最新的Servlet 和JSP 规范总是能在Tomcat 中得到体现，Tomcat 5支持最新的Servlet 2.4 和JSP 2.0 规范。因为Tomcat 技术先进、性能稳定，而且免费，因而深受Java 爱好者的喜爱并得到了部分软件开发商的认可，成为比较流行的Web 应用服务器。</p>
<h5 id="2-使用"><a href="#2-使用" class="headerlink" title="2. 使用"></a>2. 使用</h5><ol>
<li><p>下载</p>
<p><a href="https://tomcat.apache.org/">tomcat官网下载</a></p>
</li>
<li><p>安装</p>
<p>解压压缩包，注意目录不要有中文和空格</p>
</li>
<li><p>卸载</p>
<p>删除目录</p>
</li>
<li><p>启动</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. bin目录下: 运行startup.bat文件</span><br><span class="line">如果失败：</span><br><span class="line">	cmd输入netstat -ano，查看端口8080是否被占用</span><br></pre></td></tr></table></figure>
</li>
<li><p>关闭</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. bin目录下: 运行shutdown.bat文件</span><br><span class="line">2. ctrl + c</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>配置</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 修改默认端口号 （80则可以直接用域名或者ip访问）</span><br><span class="line">打开 server.xml</span><br><span class="line">修改：port=&quot;80&quot;</span><br><span class="line">  &lt;Connector executor=&quot;tomcatThreadPool&quot;</span><br><span class="line">               port=&quot;80&quot; protocol=&quot;HTTP/1.1&quot;</span><br><span class="line">               connectionTimeout=&quot;20000&quot;</span><br><span class="line">               redirectPort=&quot;8443&quot; /&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="3-目录结构"><a href="#3-目录结构" class="headerlink" title="3. 目录结构"></a>3. 目录结构</h5><p><img src="/2021/12/02/tomcat/1.png" alt></p>
<h5 id="4-项目部署"><a href="#4-项目部署" class="headerlink" title="4. 项目部署"></a>4. 项目部署</h5><ul>
<li><ol>
<li>将项目放到webapps目录下</li>
</ol>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">通常直接将项目打包成war包，放入webapps目录下，tomcat会自动解析，删除war包，会自动将解析的项目删除。</span><br></pre></td></tr></table></figure>
<ul>
<li><ol>
<li>配置 server.xml</li>
</ol>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">在&lt;Host&gt;标签体中配置</span><br><span class="line">&lt;Context docBase=&quot;D:\hello&quot; path=&quot;/hehe&quot;&gt;</span><br><span class="line">docBase 代表项目存放路径</span><br><span class="line">path 代表访问路径</span><br></pre></td></tr></table></figure>
<ul>
<li><ol>
<li>在conf\Catalina\localhost创建xml配置文件（推荐）</li>
</ol>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;Context docBase=&quot;D:\hello&quot;&gt;</span><br><span class="line">访问路径为xml文件名</span><br></pre></td></tr></table></figure>
<h5 id="5-Javaweb-动态项目目录结构"><a href="#5-Javaweb-动态项目目录结构" class="headerlink" title="5. Javaweb 动态项目目录结构"></a>5. Javaweb 动态项目目录结构</h5><p>java动态项目的目录结构∶</p>
<p>—项目的根目录</p>
<p>​    —wEB-INF目录︰</p>
<p>​        — web.xml : web项目的核心配置文件</p>
<p>​        — classes目录︰放置字节码文件的目录</p>
<p>​        — lib目录∶放置依赖的jar包</p>
<h5 id="6-tomcat集成到idea"><a href="#6-tomcat集成到idea" class="headerlink" title="6. tomcat集成到idea"></a>6. tomcat集成到idea</h5><ol>
<li><p>集成</p>
<ul>
<li>点击run/Edit Configurations…</li>
</ul>
<p><img src="/2021/12/02/tomcat/2.png" alt></p>
<ul>
<li></li>
</ul>
</li>
<li><p>创建javaee项目</p>
<ul>
<li>添加modules，选择JavaEnterprise，勾选Web Application，勾选web.xml</li>
</ul>
</li>
<li><p>部署项目</p>
</li>
</ol>
]]></content>
      <categories>
        <category>tomcat</category>
      </categories>
      <tags>
        <tag>tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title>verification_code</title>
    <url>/2021/12/06/verification-code/</url>
    <content><![CDATA[<h2 id="1-response运行流程"><a href="#1-response运行流程" class="headerlink" title="1.response运行流程"></a>1.response运行流程</h2><p><img src="/2021/12/06/verification-code/1.jpg" alt></p>
<h2 id="2-response设置http响应"><a href="#2-response设置http响应" class="headerlink" title="2.response设置http响应"></a>2.response设置http响应</h2><p><strong>http响应</strong><br><img src="/2021/12/06/verification-code/2.jpg" alt></p>
<h3 id="设置http响应行中的状态码"><a href="#设置http响应行中的状态码" class="headerlink" title="设置http响应行中的状态码"></a>设置http响应行中的状态码</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">response.setStatus(302);//302表示重定向</span><br></pre></td></tr></table></figure>
<h3 id="通过response设置响应头"><a href="#通过response设置响应头" class="headerlink" title="通过response设置响应头"></a>通过response设置响应头</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//add表示添加，set表示设置</span><br><span class="line">addHeader(String name,String value);</span><br><span class="line">addIntHeader(String name,int value);</span><br><span class="line">addDateHeader(String name,long date);</span><br><span class="line">setHeader(String name,String value);//重要</span><br><span class="line">setDateHeader(String name,long date);</span><br><span class="line">addIntHeader(String name,int value);</span><br><span class="line">response.sendRedirect(&quot;&quot;);//重定向</span><br><span class="line">//其中响应头Location，url为跳转</span><br><span class="line">//refresh,秒数;url=&quot;url&quot;.表示定时刷新</span><br></pre></td></tr></table></figure>
<h3 id="通过response设置响应体"><a href="#通过response设置响应体" class="headerlink" title="通过response设置响应体"></a>通过response设置响应体</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//防止乱码</span><br><span class="line">response.setHeader(&quot;Content-Type&quot;,&quot;text/html;charset=UTF-8&quot;);//设置文件编码格式</span><br><span class="line">//或者</span><br><span class="line">response.setContentType(&quot;text/html;charset=UTF-8&quot;);//设置文件编码格式</span><br><span class="line">PrintWrite writer = response.getWriter();</span><br><span class="line">writer.write(&quot;&quot;);</span><br></pre></td></tr></table></figure>
<h3 id="使用response的outputstream-下载功能"><a href="#使用response的outputstream-下载功能" class="headerlink" title="使用response的outputstream(下载功能)"></a>使用response的outputstream(下载功能)</h3><h4 id="文件下载"><a href="#文件下载" class="headerlink" title="文件下载"></a>文件下载</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//获取页面访问时传递的文件名参数</span><br><span class="line">String filename = request.getParameter(&quot;filename&quot;);</span><br><span class="line">//设置下载文件的类型---客户端通过文件的mime类型去区分类型</span><br><span class="line">response.setContentType(this.getServletContext().getMimeType(filename));</span><br><span class="line">//告诉客户端该文件不是直接打开而是(下载)</span><br><span class="line">response.setHeader(&quot;Content-Disposition&quot;,&quot;attachment;filename=&quot;+filename);</span><br><span class="line">ServletOutputStream out = response.getOutputStream();</span><br><span class="line">//获取服务器上的文件</span><br><span class="line">String realpath = this.getServletContext().getRealPath(&quot;相对路径&quot;);</span><br><span class="line">//读取服务器文件</span><br><span class="line">InputStream in = new FileInputStream(realpath);</span><br><span class="line">int len = 0;</span><br><span class="line">byte[] buffer = new byte[1024];</span><br><span class="line">while((len=in.read(buffer))&gt;0)&#123;</span><br><span class="line">    out.write(buffer,0,len);</span><br><span class="line">&#125;</span><br><span class="line">in.close();</span><br><span class="line">out.close();</span><br></pre></td></tr></table></figure>
<h4 id="文件下载名中文乱码问题"><a href="#文件下载名中文乱码问题" class="headerlink" title="文件下载名中文乱码问题"></a>文件下载名中文乱码问题</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//解决获取中文参数乱码问题</span><br><span class="line">filename = new String(filename.getBytes(&quot;ISO8859-1&quot;),&quot;utf-8&quot;);</span><br><span class="line"></span><br><span class="line">//各个浏览器兼容</span><br><span class="line">// 解决中文文件名乱码问题  </span><br><span class="line">if (request.getHeader(&quot;User-Agent&quot;).toLowerCase()  </span><br><span class="line">        .indexOf(&quot;firefox&quot;) &gt; 0) &#123;  </span><br><span class="line">        fname = new String(fileName.getBytes(&quot;UTF-8&quot;), &quot;ISO8859-1&quot;); // firefox浏览器  </span><br><span class="line">&#125; else if (request.getHeader(&quot;User-Agent&quot;).toUpperCase()  </span><br><span class="line">        .indexOf(&quot;MSIE&quot;) &gt; 0) &#123;  </span><br><span class="line">    fname = URLEncoder.encode(fileName, &quot;UTF-8&quot;);// IE浏览器  </span><br><span class="line">&#125;else if (request.getHeader(&quot;User-Agent&quot;).toUpperCase()  </span><br><span class="line">        .indexOf(&quot;CHROME&quot;) &gt; 0) &#123;  </span><br><span class="line">    fname = new String(fileName.getBytes(&quot;UTF-8&quot;), &quot;ISO8859-1&quot;);// 谷歌  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-应用实例动态生成验证码"><a href="#3-应用实例动态生成验证码" class="headerlink" title="3.应用实例动态生成验证码"></a>3.应用实例动态生成验证码</h2><h3 id="生成验证码工具类"><a href="#生成验证码工具类" class="headerlink" title="生成验证码工具类"></a>生成验证码工具类</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> yanzheng;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.Color;</span><br><span class="line"><span class="keyword">import</span> java.awt.Font;</span><br><span class="line"><span class="keyword">import</span> java.awt.Graphics;</span><br><span class="line"><span class="keyword">import</span> java.awt.Graphics2D;</span><br><span class="line"><span class="keyword">import</span> java.awt.RenderingHints;</span><br><span class="line"><span class="keyword">import</span> java.awt.geom.AffineTransform;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VerifyCodeUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用到Algerian字体，系统里没有的话需要安装字体，字体只显示大写，去掉了1,0,i,o几个容易混淆的字符</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String VERIFY_CODES = <span class="string">&quot;23456789ABCDEFGHJKLMNPQRSTUVWXYZ&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Random random = <span class="keyword">new</span> Random();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用系统默认字符源生成验证码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> verifySize    验证码长度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">generateVerifyCode</span><span class="params">(<span class="keyword">int</span> verifySize)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> generateVerifyCode(verifySize, VERIFY_CODES);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用指定源生成验证码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> verifySize    验证码长度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sources   验证码字符源</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">generateVerifyCode</span><span class="params">(<span class="keyword">int</span> verifySize, String sources)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(sources == <span class="keyword">null</span> || sources.length() == <span class="number">0</span>)&#123;</span><br><span class="line">            sources = VERIFY_CODES;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> codesLen = sources.length();</span><br><span class="line">        Random rand = <span class="keyword">new</span> Random(System.currentTimeMillis());</span><br><span class="line">        StringBuilder verifyCode = <span class="keyword">new</span> StringBuilder(verifySize);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; verifySize; i++)&#123;</span><br><span class="line">            verifyCode.append(sources.charAt(rand.nextInt(codesLen-<span class="number">1</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> verifyCode.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成随机验证码文件,并返回验证码值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> w</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> h</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputFile</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> verifySize</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">outputVerifyImage</span><span class="params">(<span class="keyword">int</span> w, <span class="keyword">int</span> h, File outputFile, <span class="keyword">int</span> verifySize)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">        String verifyCode = generateVerifyCode(verifySize);</span><br><span class="line">        outputImage(w, h, outputFile, verifyCode);</span><br><span class="line">        <span class="keyword">return</span> verifyCode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 输出随机验证码图片流,并返回验证码值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> w</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> h</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> os</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> verifySize</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">outputVerifyImage</span><span class="params">(<span class="keyword">int</span> w, <span class="keyword">int</span> h, OutputStream os, <span class="keyword">int</span> verifySize)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">        String verifyCode = generateVerifyCode(verifySize);</span><br><span class="line">        outputImage(w, h, os, verifyCode);</span><br><span class="line">        <span class="keyword">return</span> verifyCode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成指定验证码图像文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> w</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> h</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputFile</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">outputImage</span><span class="params">(<span class="keyword">int</span> w, <span class="keyword">int</span> h, File outputFile, String code)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(outputFile == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        File dir = outputFile.getParentFile();</span><br><span class="line">        <span class="keyword">if</span>(!dir.exists())&#123;</span><br><span class="line">            dir.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            outputFile.createNewFile();</span><br><span class="line">            FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(outputFile);</span><br><span class="line">            outputImage(w, h, fos, code);</span><br><span class="line">            fos.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span>(IOException e)&#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 输出指定验证码图片流</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> w</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> h</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> os</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">outputImage</span><span class="params">(<span class="keyword">int</span> w, <span class="keyword">int</span> h, OutputStream os, String code)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">        <span class="keyword">int</span> verifySize = code.length();</span><br><span class="line">        BufferedImage image = <span class="keyword">new</span> BufferedImage(w, h, BufferedImage.TYPE_INT_RGB);</span><br><span class="line">        Random rand = <span class="keyword">new</span> Random();</span><br><span class="line">        Graphics2D g2 = image.createGraphics();</span><br><span class="line">        g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING,RenderingHints.VALUE_ANTIALIAS_ON);</span><br><span class="line">        Color[] colors = <span class="keyword">new</span> Color[<span class="number">5</span>];</span><br><span class="line">        Color[] colorSpaces = <span class="keyword">new</span> Color[] &#123; Color.WHITE, Color.CYAN,</span><br><span class="line">                Color.GRAY, Color.LIGHT_GRAY, Color.MAGENTA, Color.ORANGE,</span><br><span class="line">                Color.PINK, Color.YELLOW &#125;;</span><br><span class="line">        <span class="keyword">float</span>[] fractions = <span class="keyword">new</span> <span class="keyword">float</span>[colors.length];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; colors.length; i++)&#123;</span><br><span class="line">            colors[i] = colorSpaces[rand.nextInt(colorSpaces.length)];</span><br><span class="line">            fractions[i] = rand.nextFloat();</span><br><span class="line">        &#125;</span><br><span class="line">        Arrays.sort(fractions);</span><br><span class="line"></span><br><span class="line">        g2.setColor(Color.GRAY);<span class="comment">// 设置边框色</span></span><br><span class="line">        g2.fillRect(<span class="number">0</span>, <span class="number">0</span>, w, h);</span><br><span class="line"></span><br><span class="line">        Color c = getRandColor(<span class="number">200</span>, <span class="number">250</span>);</span><br><span class="line">        g2.setColor(c);<span class="comment">// 设置背景色</span></span><br><span class="line">        g2.fillRect(<span class="number">0</span>, <span class="number">2</span>, w, h-<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//绘制干扰线</span></span><br><span class="line">        Random random = <span class="keyword">new</span> Random();</span><br><span class="line">        g2.setColor(getRandColor(<span class="number">160</span>, <span class="number">200</span>));<span class="comment">// 设置线条的颜色</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> x = random.nextInt(w - <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">int</span> y = random.nextInt(h - <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">int</span> xl = random.nextInt(<span class="number">6</span>) + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">int</span> yl = random.nextInt(<span class="number">12</span>) + <span class="number">1</span>;</span><br><span class="line">            g2.drawLine(x, y, x + xl + <span class="number">40</span>, y + yl + <span class="number">20</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加噪点</span></span><br><span class="line">        <span class="keyword">float</span> yawpRate = <span class="number">0.05f</span>;<span class="comment">// 噪声率</span></span><br><span class="line">        <span class="keyword">int</span> area = (<span class="keyword">int</span>) (yawpRate * w * h);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; area; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> x = random.nextInt(w);</span><br><span class="line">            <span class="keyword">int</span> y = random.nextInt(h);</span><br><span class="line">            <span class="keyword">int</span> rgb = getRandomIntColor();</span><br><span class="line">            image.setRGB(x, y, rgb);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        shear(g2, w, h, c);<span class="comment">// 使图片扭曲</span></span><br><span class="line"></span><br><span class="line">        g2.setColor(getRandColor(<span class="number">100</span>, <span class="number">160</span>));</span><br><span class="line">        <span class="keyword">int</span> fontSize = h-<span class="number">4</span>;</span><br><span class="line">        Font font = <span class="keyword">new</span> Font(<span class="string">&quot;Algerian&quot;</span>, Font.ITALIC, fontSize);</span><br><span class="line">        g2.setFont(font);</span><br><span class="line">        <span class="keyword">char</span>[] chars = code.toCharArray();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; verifySize; i++)&#123;</span><br><span class="line">            AffineTransform affine = <span class="keyword">new</span> AffineTransform();</span><br><span class="line">            affine.setToRotation(Math.PI / <span class="number">4</span> * rand.nextDouble() * (rand.nextBoolean() ? <span class="number">1</span> : -<span class="number">1</span>), (w / verifySize) * i + fontSize/<span class="number">2</span>, h/<span class="number">2</span>);</span><br><span class="line">            g2.setTransform(affine);</span><br><span class="line">            g2.drawChars(chars, i, <span class="number">1</span>, ((w-<span class="number">10</span>) / verifySize) * i + <span class="number">5</span>, h/<span class="number">2</span> + fontSize/<span class="number">2</span> - <span class="number">10</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        g2.dispose();</span><br><span class="line">        ImageIO.write(image, <span class="string">&quot;png&quot;</span>, os);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Color <span class="title">getRandColor</span><span class="params">(<span class="keyword">int</span> fc, <span class="keyword">int</span> bc)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (fc &gt; <span class="number">255</span>)</span><br><span class="line">            fc = <span class="number">255</span>;</span><br><span class="line">        <span class="keyword">if</span> (bc &gt; <span class="number">255</span>)</span><br><span class="line">            bc = <span class="number">255</span>;</span><br><span class="line">        <span class="keyword">int</span> r = fc + random.nextInt(bc - fc);</span><br><span class="line">        <span class="keyword">int</span> g = fc + random.nextInt(bc - fc);</span><br><span class="line">        <span class="keyword">int</span> b = fc + random.nextInt(bc - fc);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Color(r, g, b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getRandomIntColor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] rgb = getRandomRgb();</span><br><span class="line">        <span class="keyword">int</span> color = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> c : rgb) &#123;</span><br><span class="line">            color = color &lt;&lt; <span class="number">8</span>;</span><br><span class="line">            color = color | c;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span>[] getRandomRgb() &#123;</span><br><span class="line">        <span class="keyword">int</span>[] rgb = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            rgb[i] = random.nextInt(<span class="number">255</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rgb;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">shear</span><span class="params">(Graphics g, <span class="keyword">int</span> w1, <span class="keyword">int</span> h1, Color color)</span> </span>&#123;</span><br><span class="line">        shearX(g, w1, h1, color);</span><br><span class="line">        shearY(g, w1, h1, color);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">shearX</span><span class="params">(Graphics g, <span class="keyword">int</span> w1, <span class="keyword">int</span> h1, Color color)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> period = random.nextInt(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> borderGap = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">int</span> frames = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> phase = random.nextInt(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; h1; i++) &#123;</span><br><span class="line">            <span class="keyword">double</span> d = (<span class="keyword">double</span>) (period &gt;&gt; <span class="number">1</span>)</span><br><span class="line">                    * Math.sin((<span class="keyword">double</span>) i / (<span class="keyword">double</span>) period</span><br><span class="line">                            + (<span class="number">6.2831853071795862D</span> * (<span class="keyword">double</span>) phase)</span><br><span class="line">                            / (<span class="keyword">double</span>) frames);</span><br><span class="line">            g.copyArea(<span class="number">0</span>, i, w1, <span class="number">1</span>, (<span class="keyword">int</span>) d, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span> (borderGap) &#123;</span><br><span class="line">                g.setColor(color);</span><br><span class="line">                g.drawLine((<span class="keyword">int</span>) d, i, <span class="number">0</span>, i);</span><br><span class="line">                g.drawLine((<span class="keyword">int</span>) d + w1, i, w1, i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">shearY</span><span class="params">(Graphics g, <span class="keyword">int</span> w1, <span class="keyword">int</span> h1, Color color)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> period = random.nextInt(<span class="number">40</span>) + <span class="number">10</span>; <span class="comment">// 50;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> borderGap = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">int</span> frames = <span class="number">20</span>;</span><br><span class="line">        <span class="keyword">int</span> phase = <span class="number">7</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w1; i++) &#123;</span><br><span class="line">            <span class="keyword">double</span> d = (<span class="keyword">double</span>) (period &gt;&gt; <span class="number">1</span>)</span><br><span class="line">                    * Math.sin((<span class="keyword">double</span>) i / (<span class="keyword">double</span>) period</span><br><span class="line">                            + (<span class="number">6.2831853071795862D</span> * (<span class="keyword">double</span>) phase)</span><br><span class="line">                            / (<span class="keyword">double</span>) frames);</span><br><span class="line">            g.copyArea(i, <span class="number">0</span>, <span class="number">1</span>, h1, <span class="number">0</span>, (<span class="keyword">int</span>) d);</span><br><span class="line">            <span class="keyword">if</span> (borderGap) &#123;</span><br><span class="line">                g.setColor(color);</span><br><span class="line">                g.drawLine(i, (<span class="keyword">int</span>) d, i, <span class="number">0</span>);</span><br><span class="line">                g.drawLine(i, (<span class="keyword">int</span>) d + h1, i, h1);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">        File dir = <span class="keyword">new</span> File(<span class="string">&quot;C:/Users/H__D/Desktop/&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> w = <span class="number">200</span>, h = <span class="number">80</span>;</span><br><span class="line">        String verifyCode = generateVerifyCode(<span class="number">4</span>);</span><br><span class="line">        File file = <span class="keyword">new</span> File(dir, verifyCode + <span class="string">&quot;.jpg&quot;</span>);</span><br><span class="line">        outputImage(w, h, file, verifyCode);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用流程"><a href="#使用流程" class="headerlink" title="使用流程"></a>使用流程</h3><p><img src="/2021/12/06/verification-code/3.jpg" alt></p>
<h3 id="服务端生成验证码servlet"><a href="#服务端生成验证码servlet" class="headerlink" title="服务端生成验证码servlet"></a>服务端生成验证码servlet</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> testserver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> yanzheng.VerifyCodeUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet implementation class servletyanzheng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/niceyz&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">servletyanzheng</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">       </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        resp.setHeader(<span class="string">&quot;Pragma&quot;</span>, <span class="string">&quot;No-cache&quot;</span>);</span><br><span class="line">        resp.setHeader(<span class="string">&quot;Cache-Control&quot;</span>, <span class="string">&quot;no-cache&quot;</span>);</span><br><span class="line">        resp.setDateHeader(<span class="string">&quot;Expires&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        resp.setContentType(<span class="string">&quot;image/jpeg&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//生成随机字串</span></span><br><span class="line">        String verifyCode = VerifyCodeUtils.generateVerifyCode(<span class="number">4</span>);</span><br><span class="line">        <span class="comment">//存入会话session</span></span><br><span class="line">        req.getSession().setAttribute(<span class="string">&quot;CODE&quot;</span>, verifyCode.toLowerCase());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//生成图片</span></span><br><span class="line">        <span class="keyword">int</span> width = <span class="number">100</span>;<span class="comment">//宽</span></span><br><span class="line">        <span class="keyword">int</span> height = <span class="number">40</span>;<span class="comment">//高</span></span><br><span class="line">        VerifyCodeUtils.outputImage(width, height, resp.getOutputStream(), verifyCode);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        doGet(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="服务器端验证验证码servlet"><a href="#服务器端验证验证码servlet" class="headerlink" title="服务器端验证验证码servlet"></a>服务器端验证验证码servlet</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> testserver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/yz&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">yanzheng</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        String code = req.getParameter(<span class="string">&quot;code&quot;</span>);</span><br><span class="line">        String key = (String) req.getSession().getAttribute(<span class="string">&quot;CODE&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(code != <span class="keyword">null</span> &amp;&amp; code.equalsIgnoreCase(key))&#123;</span><br><span class="line">            req.getSession().removeAttribute(<span class="string">&quot;CODE&quot;</span>);</span><br><span class="line">            resp.getWriter().println(<span class="keyword">true</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            resp.getWriter().println(<span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">super</span>.doGet(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="前端html文件"><a href="#前端html文件" class="headerlink" title="前端html文件"></a>前端html文件</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">    pageEncoding=<span class="string">&quot;UTF-8&quot;</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//改变验证码事件</span></span><br><span class="line">    <span class="function">function <span class="title">changeImg</span><span class="params">(obj)</span></span>&#123;</span><br><span class="line">    	obj.src=<span class="string">&quot;/atest/niceyz?time=&quot;</span>+<span class="keyword">new</span> Date().getTime();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//提交验证并验证验证码</span></span><br><span class="line">    <span class="function">function <span class="title">submit</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">var</span> input = document.getElementsByTagName(<span class="string">&#x27;input&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">        window.location.href=<span class="string">&quot;/atest/yz?code=&quot;</span>+input.value;  </span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h2&gt;测试验证码：&lt;/h2&gt;</span><br><span class="line">    请输入验证码：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;code&quot;</span> /&gt;</span><br><span class="line">    &lt;img id=<span class="string">&quot;codeimg&quot;</span> src=<span class="string">&quot;/atest/niceyz&quot;</span> onclick=<span class="string">&quot;changeImg(this)&quot;</span>&gt;   </span><br><span class="line">    &lt;button onclick=<span class="string">&quot;submit()&quot;</span>&gt;提交&lt;/button&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>servlet</category>
      </categories>
      <tags>
        <tag>验证码</tag>
      </tags>
  </entry>
  <entry>
    <title>vuecli和vuerouter</title>
    <url>/2022/04/10/vuecli/</url>
    <content><![CDATA[<h1 id="一、vuecli学习"><a href="#一、vuecli学习" class="headerlink" title="一、vuecli学习"></a>一、vuecli学习</h1><h2 id="1-安装vuecli"><a href="#1-安装vuecli" class="headerlink" title="1. 安装vuecli"></a>1. 安装vuecli</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install -g @vue/cli</span><br></pre></td></tr></table></figure>
<h2 id="2-创建vue项目"><a href="#2-创建vue项目" class="headerlink" title="2.  创建vue项目"></a>2.  创建vue项目</h2><p>运行以下命令来创建一个新项目：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vue create hello-world</span><br></pre></td></tr></table></figure>
<p><code>vue create</code> 命令有一些可选项，你可以通过运行以下命令进行探索：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vue create --help</span><br><span class="line">用法：create [options] &lt;app-name&gt;</span><br><span class="line"></span><br><span class="line">创建一个由 `vue-cli-service` 提供支持的新项目</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">选项：</span><br><span class="line"></span><br><span class="line">  -p, --preset &lt;presetName&gt;       忽略提示符并使用已保存的或远程的预设选项</span><br><span class="line">  -d, --default                   忽略提示符并使用默认预设选项</span><br><span class="line">  -i, --inlinePreset &lt;json&gt;       忽略提示符并使用内联的 JSON 字符串预设选项</span><br><span class="line">  -m, --packageManager &lt;command&gt;  在安装依赖时使用指定的 npm 客户端</span><br><span class="line">  -r, --registry &lt;url&gt;            在安装依赖时使用指定的 npm registry</span><br><span class="line">  -g, --git [message]             强制 / 跳过 git 初始化，并可选的指定初始化提交信息</span><br><span class="line">  -n, --no-git                    跳过 git 初始化</span><br><span class="line">  -f, --force                     覆写目标目录可能存在的配置</span><br><span class="line">  -c, --clone                     使用 git clone 获取远程预设选项</span><br><span class="line">  -x, --proxy                     使用指定的代理创建项目</span><br><span class="line">  -b, --bare                      创建项目时省略默认组件中的新手指导信息</span><br><span class="line">  -h, --help                      输出使用帮助信息</span><br></pre></td></tr></table></figure>
<h2 id="3-运行项目"><a href="#3-运行项目" class="headerlink" title="3. 运行项目"></a>3. 运行项目</h2><ol>
<li><p>进入项目目录</p>
</li>
<li><p>输入yarn serve 命令运行</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yarn serve</span><br></pre></td></tr></table></figure>
</li>
<li><p>输入 yarn build 来构建项目，发布</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yarn build</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装axios</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yarn add axios</span><br></pre></td></tr></table></figure>
<ul>
<li><p>使用axios</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    axios.get(<span class="string">&#x27;/axxx&#x27;</span>).then(<span class="function"><span class="params">req</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(req)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h2 id="4-项目结构"><a href="#4-项目结构" class="headerlink" title="4. 项目结构"></a>4. 项目结构</h2><p><strong>vue-cli目录解析：</strong></p>
<ol>
<li>build 文件夹：用于存放 webpack 相关配置和脚本。开发中仅 偶尔使用 到此文件夹下 webpack.base.conf.js 用于配置 less、sass等css预编译库，或者配置一下 UI 库。</li>
<li>config 文件夹：主要存放配置文件，用于区分开发环境、线上环境的不同。 常用到此文件夹下 config.js 配置开发环境的 端口号、是否开启热加载 或者 设置生产环境的静态资源相对路径、是否开启gzip压缩、npm run build 命令打包生成静态资源的名称和路径等。</li>
<li>dist 文件夹：默认 npm run build 命令打包生成的静态资源文件，用于生产部署。</li>
<li>node_modules：存放npm命令下载的开发环境和生产环境的依赖包。</li>
<li>src: 存放项目源码及需要引用的资源文件。</li>
<li>src下assets：存放项目中需要用到的资源文件，css、js、images等。</li>
<li>src下componets：存放vue开发中一些公共组件：header.vue、footer.vue等。</li>
<li>src下emit：自己配置的vue集中式事件管理机制。</li>
<li>src下router：vue-router vue路由的配置文件。</li>
<li>src下service：自己配置的vue请求后台接口方法。</li>
<li>src下page：存在vue页面组件的文件夹。</li>
<li>src下util：存放vue开发过程中一些公共的.js方法。</li>
<li>src下vuex：存放 vuex 为vue专门开发的状态管理器。</li>
<li>src下app.vue：使用标签<code>&lt;route-view&gt;&lt;/router-view&gt;</code>渲染整个工程的.vue组件。</li>
<li>src下main.js：vue-cli工程的入口文件。</li>
<li>index.html：设置项目的一些meta头信息和提供<code>&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</code>用于挂载 vue 节点。</li>
<li>package.json：用于 node_modules资源部 和 启动、打包项目的 npm 命令管理。</li>
</ol>
<h2 id="5-自定义组件可能产生的问题"><a href="#5-自定义组件可能产生的问题" class="headerlink" title="5. 自定义组件可能产生的问题"></a>5. 自定义组件可能产生的问题</h2><h3 id="1-Vue脚手架报错-Component-name-“Content”-should-always-be-multi-word-vue-multi-word-component-names"><a href="#1-Vue脚手架报错-Component-name-“Content”-should-always-be-multi-word-vue-multi-word-component-names" class="headerlink" title="1. Vue脚手架报错 Component name “Content” should always be multi-word vue/multi-word-component-names"></a>1. Vue脚手架报错 Component name “Content” should always be multi-word vue/multi-word-component-names</h3><ul>
<li><p>这其实是<strong>语法检查的时候把不规范的代码(即命名不规范)当成了错误</strong></p>
</li>
<li><p><strong>官方文档上面的风格建议我们使用大驼峰或-衔接的方式命名组件</strong></p>
</li>
</ul>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h4><ul>
<li><p>更改组件名(这个比较麻烦),也就是重新起个组件名,使其符合命名规范,如: ContentName 或者 content-name</p>
</li>
<li><p>修改配置项,关闭语法检查</p>
<ol>
<li><p>在项目的<strong>根目录</strong>找到(没有就创建)<code>vue.config.js</code>文件</p>
</li>
<li><p>在文件中添加如下内容</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; defineConfig &#125; = <span class="built_in">require</span>(<span class="string">&#x27;@vue/cli-service&#x27;</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = defineConfig(&#123;</span><br><span class="line"> <span class="attr">lintOnSave</span>:<span class="literal">false</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
<h1 id="二、-vue-router-路由"><a href="#二、-vue-router-路由" class="headerlink" title="二、 vue router 路由"></a>二、 vue router 路由</h1><h2 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1. 介绍"></a>1. 介绍</h2><p>Vue Router 是 <a href="https://vuejs.org/">Vue.js</a> 的官方路由器。它与 Vue .js核心深度集成，使使用 Vue 构建单页应用程序变得轻而易举.js。功能包括：</p>
<ul>
<li>嵌套路由映射</li>
<li>动态路由</li>
<li>模块化、基于组件的路由器配置</li>
<li>路由参数、查询、通配符</li>
<li>查看由 Vue.js 的过渡系统提供支持的过渡效果</li>
<li>细粒度导航控制</li>
<li>具有自动活动 CSS 类的链接</li>
<li>HTML5 历史模式或哈希模式</li>
<li>可自定义的滚动行为</li>
<li>正确的 URL 编码</li>
</ul>
<h2 id="2-安装"><a href="#2-安装" class="headerlink" title="2.  安装"></a>2.  安装</h2><p><strong>npm</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install vue-router@4</span><br></pre></td></tr></table></figure>
<p><strong>yarn</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yarn add vue-router@4</span><br></pre></td></tr></table></figure>
<h2 id="3-入门"><a href="#3-入门" class="headerlink" title="3.  入门"></a>3.  入门</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/vue@next&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/vue-router@4&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello App!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--使用 router-link 组件进行导航 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--通过传递 `to` 来指定链接 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--`&lt;router-link&gt;` 将呈现一个带有正确 `href` 属性的 `&lt;a&gt;` 标签--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>Go to Home<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span>&gt;</span>Go to About<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 路由出口 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 路由匹配到的组件将渲染在这里 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 1. 定义路由组件.</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 也可以从其他文件导入</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> Home = &#123; <span class="attr">template</span>: <span class="string">&#x27;&lt;div&gt;Home&lt;/div&gt;&#x27;</span> &#125;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> About = &#123; <span class="attr">template</span>: <span class="string">&#x27;&lt;div&gt;About&lt;/div&gt;&#x27;</span> &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 2. 定义一些路由</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 每个路由都需要映射到一个组件。</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 我们后面再讨论嵌套路由。</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> routes = [</span></span><br><span class="line"><span class="javascript">            &#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>, <span class="attr">component</span>: Home &#125;,</span></span><br><span class="line"><span class="javascript">            &#123; <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>, <span class="attr">component</span>: About &#125;,</span></span><br><span class="line"><span class="javascript">        ]</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 3. 创建路由实例并传递 `routes` 配置</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 你可以在这里输入更多的配置，但我们在这里</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 暂时保持简单</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> router = VueRouter.createRouter(&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 4. 内部提供了 history 模式的实现。为了简单起见，我们在这里使用 hash 模式。</span></span></span><br><span class="line"><span class="javascript">            <span class="attr">history</span>: VueRouter.createWebHashHistory(),</span></span><br><span class="line"><span class="javascript">            routes, <span class="comment">// `routes: routes` 的缩写</span></span></span><br><span class="line"><span class="javascript">        &#125;)</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 5. 创建并挂载根实例</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> app = Vue.createApp(&#123;&#125;)</span></span><br><span class="line"><span class="javascript">        <span class="comment">//确保 _use_ 路由实例使</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//整个应用支持路由。</span></span></span><br><span class="line"><span class="javascript">        app.use(router)</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        app.mount(<span class="string">&#x27;#app&#x27;</span>)</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 现在，应用已经启动了！</span></span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="4-在vuecli中使用vue-router"><a href="#4-在vuecli中使用vue-router" class="headerlink" title="4. 在vuecli中使用vue router"></a>4. 在vuecli中使用vue router</h2><h4 id="1-编写FirstHead组件"><a href="#1-编写FirstHead组件" class="headerlink" title="1. 编写FirstHead组件"></a>1. 编写FirstHead组件</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">FirstHead.vue</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">name</span>: <span class="string">&#x27;FirstHead&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="attr">props</span>: &#123;</span></span><br><span class="line"><span class="javascript">            <span class="attr">msg</span>: <span class="built_in">String</span></span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-编写FirstContent组件"><a href="#2-编写FirstContent组件" class="headerlink" title="2. 编写FirstContent组件"></a>2. 编写FirstContent组件</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">FirstContent.vue</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">name</span>: <span class="string">&#x27;FirstContent&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="attr">props</span>: &#123;</span></span><br><span class="line"><span class="javascript">            <span class="attr">msg</span>: <span class="built_in">String</span></span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-在App-vue中编写路由连接和出口"><a href="#3-在App-vue中编写路由连接和出口" class="headerlink" title="3. 在App.vue中编写路由连接和出口"></a>3. 在App.vue中编写路由连接和出口</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello App!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用 router-link 组件进行导航 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--通过传递 `to` 来指定链接 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--`&lt;router-link&gt;` 将呈现一个带有正确 `href` 属性的 `&lt;a&gt;` 标签--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>Go to Home<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span>&gt;</span>Go to About<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 路由出口 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 路由匹配到的组件将渲染在这里 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">router-view</span> <span class="attr">msg</span>=<span class="string">&quot;hello world&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="4-在main-js中对App组件的路由进行绑定"><a href="#4-在main-js中对App组件的路由进行绑定" class="headerlink" title="4. 在main.js中对App组件的路由进行绑定"></a>4. 在main.js中对App组件的路由进行绑定</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;createRouter,createWebHashHistory&#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> FirstHead <span class="keyword">from</span> <span class="string">&#x27;./components/firstHead.vue&#x27;</span> </span><br><span class="line"><span class="keyword">import</span> FirstContent <span class="keyword">from</span> <span class="string">&#x27;./components/firstContent.vue&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 定义一些路由</span></span><br><span class="line">        <span class="comment">// 每个路由都需要映射到一个组件。</span></span><br><span class="line">        <span class="comment">// 我们后面再讨论嵌套路由。</span></span><br><span class="line">        <span class="keyword">const</span> routes = [</span><br><span class="line">            &#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>, <span class="attr">component</span>: FirstHead &#125;,</span><br><span class="line">            &#123; <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>, <span class="attr">component</span>: FirstContent &#125;,</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 创建路由实例并传递 `routes` 配置</span></span><br><span class="line">        <span class="comment">// 你可以在这里输入更多的配置，但我们在这里</span></span><br><span class="line">        <span class="comment">// 暂时保持简单</span></span><br><span class="line">        <span class="keyword">const</span> router = createRouter(&#123;</span><br><span class="line">            <span class="comment">// 4. 内部提供了 history 模式的实现。为了简单起见，我们在这里使用 hash 模式。</span></span><br><span class="line">            <span class="attr">history</span>: createWebHashHistory(),</span><br><span class="line">            routes, <span class="comment">// `routes: routes` 的缩写</span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">createApp(App).use(router).mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="5-对路由信息进行解耦"><a href="#5-对路由信息进行解耦" class="headerlink" title="5. 对路由信息进行解耦"></a>5. 对路由信息进行解耦</h2><ul>
<li>在上述4中路由配置信息都写在了main.js中，如果之后路由信息变得很庞大会变得难以维护</li>
<li>因此我们可以将路由信息集中的编写在router文件下的js文件中并使用export导出方便使用</li>
</ul>
<p>编写router目录下的index.js文件</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createRouter,createWebHashHistory&#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> FirstHead <span class="keyword">from</span> <span class="string">&#x27;./components/firstHead.vue&#x27;</span> </span><br><span class="line"><span class="keyword">import</span> FirstContent <span class="keyword">from</span> <span class="string">&#x27;./components/firstContent.vue&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 定义一些路由</span></span><br><span class="line"><span class="comment">// 每个路由都需要映射到一个组件。</span></span><br><span class="line"><span class="comment">// 我们后面再讨论嵌套路由。</span></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>, <span class="attr">component</span>: FirstHead &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>, <span class="attr">component</span>: FirstContent &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 创建路由实例并传递 `routes` 配置</span></span><br><span class="line"><span class="comment">// 你可以在这里输入更多的配置，但我们在这里</span></span><br><span class="line"><span class="comment">// 暂时保持简单</span></span><br><span class="line"><span class="keyword">const</span> router = createRouter(&#123;</span><br><span class="line">    <span class="comment">// 4. 内部提供了 history 模式的实现。为了简单起见，我们在这里使用 hash 模式。</span></span><br><span class="line">    <span class="attr">history</span>: createWebHashHistory(),</span><br><span class="line">    routes, <span class="comment">// `routes: routes` 的缩写</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure>
<p>此时main.js就变得十分简洁了</p>
<ul>
<li>注意需要main.js导入index.js时，如果需要导入的文件名称为index.js，则导入路径中index.js可以省略，只用配置其父文件路径</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br><span class="line"></span><br><span class="line">createApp(App).use(router).mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="6-带参数的动态路由匹配"><a href="#6-带参数的动态路由匹配" class="headerlink" title="6. 带参数的动态路由匹配"></a>6. 带参数的动态路由匹配</h2><p>很多时候，我们需要将给定匹配模式的路由映射到同一个组件。例如，我们可能有一个 <code>User</code> 组件，它应该对所有用户进行渲染，但用户 ID 不同。在 Vue Router 中，我们可以在路径中使用一个动态字段来实现，我们称之为 <em>路径参数</em> ：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> User = &#123;</span><br><span class="line">  <span class="attr">template</span>: <span class="string">&#x27;&lt;div&gt;User&lt;/div&gt;&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这些都会传递给 `createRouter`</span></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  <span class="comment">// 动态字段以冒号开始</span></span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/users/:id&#x27;</span>, <span class="attr">component</span>: User &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>现在像 <code>/users/johnny</code> 和 <code>/users/jolyne</code> 这样的 URL 都会映射到同一个路由。</p>
<p><em>路径参数</em> 用冒号 <code>:</code> 表示。当一个路由被匹配时，它的 <em>params</em> 的值将在每个组件中以 <code>this.$route.params</code> 的形式暴露出来。因此，我们可以通过更新 <code>User</code> 的模板来呈现当前的用户 ID：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> User = &#123;</span><br><span class="line">  <span class="attr">template</span>: <span class="string">&#x27;&lt;div&gt;User &#123;&#123; $route.params.id &#125;&#125;&lt;/div&gt;&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你可以在同一个路由中设置有多个 <em>路径参数</em>，它们会映射到 <code>$route.params</code> 上的相应字段。例如：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>匹配模式</th>
<th>匹配路径</th>
<th>$route.params</th>
</tr>
</thead>
<tbody>
<tr>
<td>/users/:username</td>
<td>/users/eduardo</td>
<td><code>&#123; username: &#39;eduardo&#39; &#125;</code></td>
</tr>
<tr>
<td>/users/:username/posts/:postId</td>
<td>/users/eduardo/posts/123</td>
<td><code>&#123; username: &#39;eduardo&#39;, postId: &#39;123</code></td>
</tr>
</tbody>
</table>
</div>
<h4 id="6-1-在参数中自定义正则"><a href="#6-1-在参数中自定义正则" class="headerlink" title="6.1 在参数中自定义正则"></a>6.1 在参数中自定义正则</h4><p>当定义像 <code>:userId</code> 这样的参数时，我们内部使用以下的正则 <code>([^/]+)</code> (至少有一个字符不是斜杠 <code>/</code> )来从 URL 中提取参数。这很好用，除非你需要根据参数的内容来区分两个路由。想象一下，两个路由 <code>/:orderId</code> 和 <code>/:productName</code>，两者会匹配完全相同的 URL，所以我们需要一种方法来区分它们。最简单的方法就是在路径中添加一个静态部分来区分它们：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  <span class="comment">// 匹配 /o/3549</span></span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/o/:orderId&#x27;</span> &#125;,</span><br><span class="line">  <span class="comment">// 匹配 /p/books</span></span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/p/:productName&#x27;</span> &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>但在某些情况下，我们并不想添加静态的 <code>/o</code> <code>/p</code> 部分。由于，<code>orderId</code> 总是一个数字，而 <code>productName</code> 可以是任何东西，所以我们可以在括号中为参数指定一个自定义的正则：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  <span class="comment">// /:orderId -&gt; 仅匹配数字</span></span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/:orderId(\\d+)&#x27;</span> &#125;,</span><br><span class="line">  <span class="comment">// /:productName -&gt; 匹配其他任何内容</span></span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/:productName&#x27;</span> &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>现在，转到 <code>/25</code> 将匹配 <code>/:orderId</code>，其他情况将会匹配 <code>/:productName</code>。</p>
<p><code>routes</code> 数组的顺序并不重要!</p>
<h4 id="6-2-可重复的参数"><a href="#6-2-可重复的参数" class="headerlink" title="6.2 可重复的参数"></a>6.2 可重复的参数</h4><p>如果你需要匹配具有多个部分的路由，如 <code>/first/second/third</code>，你应该用 <code>*</code>（0 个或多个）和 <code>+</code>（1 个或多个）将参数标记为可重复：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  <span class="comment">// /:chapters -&gt;  匹配 /one, /one/two, /one/two/three, 等</span></span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/:chapters+&#x27;</span> &#125;,</span><br><span class="line">  <span class="comment">// /:chapters -&gt; 匹配 /, /one, /one/two, /one/two/three, 等</span></span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/:chapters*&#x27;</span> &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>这将为你提供一个参数数组，而不是一个字符串，并且在使用命名路由时也需要你传递一个数组：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 给定 &#123; path: &#x27;/:chapters*&#x27;, name: &#x27;chapters&#x27; &#125;,</span></span><br><span class="line">router.resolve(&#123; <span class="attr">name</span>: <span class="string">&#x27;chapters&#x27;</span>, <span class="attr">params</span>: &#123; <span class="attr">chapters</span>: [] &#125; &#125;).href</span><br><span class="line"><span class="comment">// 产生 /</span></span><br><span class="line">router.resolve(&#123; <span class="attr">name</span>: <span class="string">&#x27;chapters&#x27;</span>, <span class="attr">params</span>: &#123; <span class="attr">chapters</span>: [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>] &#125; &#125;).href</span><br><span class="line"><span class="comment">// 产生 /a/b</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 给定 &#123; path: &#x27;/:chapters+&#x27;, name: &#x27;chapters&#x27; &#125;,</span></span><br><span class="line">router.resolve(&#123; <span class="attr">name</span>: <span class="string">&#x27;chapters&#x27;</span>, <span class="attr">params</span>: &#123; <span class="attr">chapters</span>: [] &#125; &#125;).href</span><br><span class="line"><span class="comment">// 抛出错误，因为 `chapters` 为空 </span></span><br></pre></td></tr></table></figure>
<p>这些也可以通过在<strong>右括号后</strong>添加它们与自定义正则结合使用：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  <span class="comment">// 仅匹配数字</span></span><br><span class="line">  <span class="comment">// 匹配 /1, /1/2, 等</span></span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/:chapters(\\d+)+&#x27;</span> &#125;,</span><br><span class="line">  <span class="comment">// 匹配 /, /1, /1/2, 等</span></span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/:chapters(\\d+)*&#x27;</span> &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="6-3-可选参数"><a href="#6-3-可选参数" class="headerlink" title="6.3 可选参数"></a>6.3 可选参数</h4><p>你也可以通过使用 <code>?</code> 修饰符(0 个或 1 个)将一个参数标记为可选：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">const routes = [</span><br><span class="line">  // 匹配 /users 和 /users/posva</span><br><span class="line">  &#123; path: &#x27;/users/:userId?&#x27; &#125;,</span><br><span class="line">  // 匹配 /users 和 /users/42</span><br><span class="line">  &#123; path: &#x27;/users/:userId(\\d+)?&#x27; &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>请注意，<code>*</code> 在技术上也标志着一个参数是可选的，但 <code>?</code> 参数不能重复。</p>
<p><strong>注意</strong>：</p>
<ul>
<li>确保<strong>转义反斜杠( <code>\</code> )</strong>，就像我们对 <code>\d</code> (变成<code>\\d</code>)所做的那样，在 JavaScript 中实际传递字符串中的反斜杠字符。</li>
</ul>
<h2 id="7-嵌套路由"><a href="#7-嵌套路由" class="headerlink" title="7. 嵌套路由"></a>7. 嵌套路由</h2><p>如果一个顶层<router-view> 渲染的路由匹配的组件包含一个嵌套的 <router-view>，则称之为嵌套路由</router-view></router-view></p>
<p>这时在定义路由时需要使用children来嵌套的定义子组件的路由</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/user/:id&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: User,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      <span class="comment">// 当 /user/:id 匹配成功</span></span><br><span class="line">      <span class="comment">// UserHome 将被渲染到 User 的 &lt;router-view&gt; 内部</span></span><br><span class="line">      &#123; <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">component</span>: UserHome &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ...其他子路由</span></span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="8-命名路由"><a href="#8-命名路由" class="headerlink" title="8. 命名路由"></a>8. 命名路由</h2><p>除了 <code>path</code> 之外，你还可以为任何路由提供 <code>name</code>。这有以下优点：</p>
<ul>
<li>没有硬编码的 URL</li>
<li><code>params</code> 的自动编码/解码。</li>
<li>防止你在 url 中出现打字错误。</li>
<li>绕过路径排序（如显示一个）</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/user/:username&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: User</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>要链接到一个命名的路由，可以向 <code>router-link</code> 组件的 <code>to</code> 属性传递一个对象：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">&quot;&#123; name: &#x27;user&#x27;, params: &#123; username: &#x27;erina&#x27; &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">  User</span><br><span class="line"><span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这跟代码调用 <code>router.push()</code> 是一回事：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.push(&#123; <span class="attr">name</span>: <span class="string">&#x27;user&#x27;</span>, <span class="attr">params</span>: &#123; <span class="attr">username</span>: <span class="string">&#x27;erina&#x27;</span> &#125; &#125;)</span><br></pre></td></tr></table></figure>
<p>在这两种情况下，路由将导航到路径 <code>/user/erina</code>。</p>
<h2 id="9-命名视图"><a href="#9-命名视图" class="headerlink" title="9. 命名视图"></a>9. 命名视图</h2><p>如果一个组件中有多个路由视图，而不是只有一个单独的出口，如果不取名字，则所有的视图都会被当成默认视图，会显示同样的组件</p>
<p>这时如果需要控制不同的路由视图输出不同的组件内容，则需要给路由视图命名，方便定义不同的组件。</p>
<p>如果 <code>router-view</code> 没有设置名字，那么默认为 <code>default</code>。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-view</span> <span class="attr">class</span>=<span class="string">&quot;view left-sidebar&quot;</span> <span class="attr">name</span>=<span class="string">&quot;LeftSidebar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-view</span> <span class="attr">class</span>=<span class="string">&quot;view main-content&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-view</span> <span class="attr">class</span>=<span class="string">&quot;view right-sidebar&quot;</span> <span class="attr">name</span>=<span class="string">&quot;RightSidebar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>一个视图使用一个组件渲染，因此对于同个路由，多个视图就需要多个组件。确保正确使用 <code>components</code> 配置 (带上 <strong>s</strong>)：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> router = createRouter(&#123;</span><br><span class="line">  <span class="attr">history</span>: createWebHashHistory(),</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">      <span class="attr">components</span>: &#123;</span><br><span class="line">        <span class="attr">default</span>: Home,</span><br><span class="line">        <span class="comment">// LeftSidebar: LeftSidebar 的缩写</span></span><br><span class="line">        LeftSidebar,</span><br><span class="line">        <span class="comment">// 它们与 `&lt;router-view&gt;` 上的 `name` 属性匹配</span></span><br><span class="line">        RightSidebar,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="10-编程式导航"><a href="#10-编程式导航" class="headerlink" title="10. 编程式导航"></a>10. 编程式导航</h2><p>除了使用 <code>&lt;router-link&gt;</code> 创建 a 标签来定义导航链接，我们还可以借助 router 的实例方法，通过编写代码来实现。</p>
<h3 id="10-1-导航到不同的位置"><a href="#10-1-导航到不同的位置" class="headerlink" title="10.1 导航到不同的位置"></a>10.1 导航到不同的位置</h3><p><strong>注意：在 Vue 实例中，你可以通过 <code>$router</code> 访问路由实例。因此你可以调用 <code>this.$router.push</code>。</strong></p>
<p>想要导航到不同的 URL，可以使用 <code>router.push</code> 方法。这个方法会向 history 栈添加一个新的记录，所以，当用户点击浏览器后退按钮时，会回到之前的 URL。</p>
<p>当你点击 <code>&lt;router-link&gt;</code> 时，内部会调用这个方法，所以点击 <code>&lt;router-link :to=&quot;...&quot;&gt;</code> 相当于调用 <code>router.push(...)</code> ：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>声明式</th>
<th>编程式</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;router-link :to=&quot;...&quot;&gt;</code></td>
<td><code>router.push(...)</code></td>
</tr>
</tbody>
</table>
</div>
<p>该方法的参数可以是一个字符串路径，或者一个描述地址的对象。例如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 字符串路径</span></span><br><span class="line">router.push(<span class="string">&#x27;/users/eduardo&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 带有路径的对象</span></span><br><span class="line">router.push(&#123; <span class="attr">path</span>: <span class="string">&#x27;/users/eduardo&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 命名的路由，并加上参数，让路由建立 url</span></span><br><span class="line">router.push(&#123; <span class="attr">name</span>: <span class="string">&#x27;user&#x27;</span>, <span class="attr">params</span>: &#123; <span class="attr">username</span>: <span class="string">&#x27;eduardo&#x27;</span> &#125; &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 带查询参数，结果是 /register?plan=private</span></span><br><span class="line">router.push(&#123; <span class="attr">path</span>: <span class="string">&#x27;/register&#x27;</span>, <span class="attr">query</span>: &#123; <span class="attr">plan</span>: <span class="string">&#x27;private&#x27;</span> &#125; &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 带 hash，结果是 /about#team</span></span><br><span class="line">router.push(&#123; <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>, <span class="attr">hash</span>: <span class="string">&#x27;#team&#x27;</span> &#125;)</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：如果提供了 <code>path</code>，<code>params</code> 会被忽略，上述例子中的 <code>query</code> 并不属于这种情况。取而代之的是下面例子的做法，你需要提供路由的 <code>name</code> 或手写完整的带有参数的 <code>path</code> ：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> username = <span class="string">&#x27;eduardo&#x27;</span></span><br><span class="line"><span class="comment">// 我们可以手动建立 url，但我们必须自己处理编码</span></span><br><span class="line">router.push(<span class="string">`/user/<span class="subst">$&#123;username&#125;</span>`</span>) <span class="comment">// -&gt; /user/eduardo</span></span><br><span class="line"><span class="comment">// 同样</span></span><br><span class="line">router.push(&#123; <span class="attr">path</span>: <span class="string">`/user/<span class="subst">$&#123;username&#125;</span>`</span> &#125;) <span class="comment">// -&gt; /user/eduardo</span></span><br><span class="line"><span class="comment">// 如果可能的话，使用 `name` 和 `params` 从自动 URL 编码中获益</span></span><br><span class="line">router.push(&#123; <span class="attr">name</span>: <span class="string">&#x27;user&#x27;</span>, <span class="attr">params</span>: &#123; username &#125; &#125;) <span class="comment">// -&gt; /user/eduardo</span></span><br><span class="line"><span class="comment">// `params` 不能与 `path` 一起使用</span></span><br><span class="line">router.push(&#123; <span class="attr">path</span>: <span class="string">&#x27;/user&#x27;</span>, <span class="attr">params</span>: &#123; username &#125; &#125;) <span class="comment">// -&gt; /user</span></span><br></pre></td></tr></table></figure>
<p>由于属性 <code>to</code> 与 <code>router.push</code> 接受的对象种类相同，所以两者的规则完全相同。</p>
<p><code>router.push</code> 和所有其他导航方法都会返回一个 <em>Promise</em>，让我们可以等到导航完成后才知道是成功还是失败。</p>
<h3 id="10-2-替换当前位置"><a href="#10-2-替换当前位置" class="headerlink" title="10.2 替换当前位置"></a>10.2 替换当前位置</h3><p>它的作用类似于 <code>router.push</code>，唯一不同的是，它在导航时不会向 history 添加新记录，正如它的名字所暗示的那样——它取代了当前的条目。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>声明式</th>
<th>编程式</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;router-link :to=&quot;...&quot; replace&gt;</code></td>
<td><code>router.replace(...)</code></td>
</tr>
</tbody>
</table>
</div>
<p>也可以直接在传递给 <code>router.push</code> 的 <code>routeLocation</code> 中增加一个属性 <code>replace: true</code> ：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.push(&#123; <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>, <span class="attr">replace</span>: <span class="literal">true</span> &#125;)</span><br><span class="line"><span class="comment">// 相当于</span></span><br><span class="line">router.replace(&#123; <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span> &#125;)</span><br></pre></td></tr></table></figure>
<h3 id="10-3-横跨历史"><a href="#10-3-横跨历史" class="headerlink" title="10.3 横跨历史"></a>10.3 横跨历史</h3><p>该方法采用一个整数作为参数，表示在历史堆栈中前进或后退多少步，类似于 <code>window.history.go(n)</code>。</p>
<p>例子：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 向前移动一条记录，与 router.forward() 相同</span><br><span class="line">router.go(1)</span><br><span class="line">// 返回一条记录，与router.back() 相同</span><br><span class="line">router.go(-1)</span><br></pre></td></tr></table></figure>
<h2 id="11-props-传递参数"><a href="#11-props-传递参数" class="headerlink" title="11.  props 传递参数"></a>11.  props 传递参数</h2><p>在你的组件中使用 <code>$route</code> 会与路由紧密耦合，这限制了组件的灵活性，因为它只能用于特定的 URL。虽然这不一定是件坏事，但我们可以通过 <code>props</code> 配置来解除这种行为：</p>
<p>我们可以将下面的代码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> User = &#123;</span><br><span class="line">  <span class="attr">template</span>: <span class="string">&#x27;&lt;div&gt;User &#123;&#123; $route.params.id &#125;&#125;&lt;/div&gt;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> routes = [&#123; <span class="attr">path</span>: <span class="string">&#x27;/user/:id&#x27;</span>, <span class="attr">component</span>: User &#125;]</span><br></pre></td></tr></table></figure>
<p>替换成</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> User = &#123;</span><br><span class="line">  <span class="attr">props</span>: [<span class="string">&#x27;id&#x27;</span>],</span><br><span class="line">  <span class="attr">template</span>: <span class="string">&#x27;&lt;div&gt;User &#123;&#123; id &#125;&#125;&lt;/div&gt;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> routes = [&#123; <span class="attr">path</span>: <span class="string">&#x27;/user/:id&#x27;</span>, <span class="attr">component</span>: User, <span class="attr">props</span>: <span class="literal">true</span> &#125;]</span><br></pre></td></tr></table></figure>
<p>这允许你在任何地方使用该组件，使得该组件更容易重用和测试。</p>
<h3 id="布尔模式"><a href="#布尔模式" class="headerlink" title="布尔模式"></a>布尔模式</h3><p>当 <code>props</code> 设置为 <code>true</code> 时，<code>route.params</code> 将被设置为组件的 props。</p>
<h3 id="命名视图"><a href="#命名视图" class="headerlink" title="命名视图"></a>命名视图</h3><p>对于有命名视图的路由，你必须为每个命名视图定义 <code>props</code> 配置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/user/:id&#x27;</span>,</span><br><span class="line">    <span class="attr">components</span>: &#123; <span class="attr">default</span>: User, <span class="attr">sidebar</span>: Sidebar &#125;,</span><br><span class="line">    <span class="attr">props</span>: &#123; <span class="attr">default</span>: <span class="literal">true</span>, <span class="attr">sidebar</span>: <span class="literal">false</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="对象模式"><a href="#对象模式" class="headerlink" title="对象模式"></a>对象模式</h3><p>当 <code>props</code> 是一个对象时，它将原样设置为组件 props。当 props 是静态的时候很有用。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/promotion/from-newsletter&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: Promotion,</span><br><span class="line">    <span class="attr">props</span>: &#123; <span class="attr">newsletterPopup</span>: <span class="literal">false</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="函数模式"><a href="#函数模式" class="headerlink" title="函数模式"></a>函数模式</h3><p>你可以创建一个返回 props 的函数。这允许你将参数转换为其他类型，将静态值与基于路由的值相结合等等。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/search&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: SearchUser,</span><br><span class="line">    <span class="attr">props</span>: <span class="function"><span class="params">route</span> =&gt;</span> (&#123; <span class="attr">query</span>: route.query.q &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>URL <code>/search?q=vue</code> 将传递 <code>&#123;query: &#39;vue&#39;&#125;</code> 作为 props 传给 <code>SearchUser</code> 组件。</p>
<p>请尽可能保持 <code>props</code> 函数为无状态的，因为它只会在路由发生变化时起作用。如果你需要状态来定义 props，请使用包装组件，这样 vue 才可以对状态变化做出反应。</p>
<h2 id="12-导航守卫"><a href="#12-导航守卫" class="headerlink" title="12. 导航守卫"></a>12. 导航守卫</h2><p>正如其名，vue-router 提供的导航守卫主要用来通过跳转或取消的方式守卫导航。这里有很多方式植入路由导航中：全局的，单个路由独享的，或者组件级的。</p>
<h3 id="12-1-全局前置守卫"><a href="#12-1-全局前置守卫" class="headerlink" title="12.1 全局前置守卫"></a>12.1 全局前置守卫</h3><p>你可以使用 <code>router.beforeEach</code> 注册一个全局前置守卫：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> router = createRouter(&#123; ... &#125;)</span><br><span class="line"></span><br><span class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// 返回 false 以取消导航</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>当一个导航触发时，全局前置守卫按照创建顺序调用。守卫是异步解析执行，此时导航在所有守卫 resolve 完之前一直处于<strong>等待中</strong>。</p>
<p>每个守卫方法接收两个参数：</p>
<ul>
<li><strong><code>to</code></strong>: 即将要进入的目标 <a href="https://router.vuejs.org/zh/api/#routelocationnormalized">用一种标准化的方式</a></li>
<li><strong><code>from</code></strong>: 当前导航正要离开的路由 <a href="https://router.vuejs.org/zh/api/#routelocationnormalized">用一种标准化的方式</a></li>
</ul>
<p>可以返回的值如下:</p>
<ul>
<li><code>false</code>: 取消当前的导航。如果浏览器的 URL 改变了(可能是用户手动或者浏览器后退按钮)，那么 URL 地址会重置到 <code>from</code> 路由对应的地址。</li>
<li>一个<a href="https://router.vuejs.org/zh/api/#routelocationraw">路由地址</a>: 通过一个路由地址跳转到一个不同的地址，就像你调用 <a href="https://router.vuejs.org/zh/api/#push"><code>router.push()</code></a> 一样，你可以设置诸如 <code>replace: true</code> 或 <code>name: &#39;home&#39;</code> 之类的配置。当前的导航被中断，然后进行一个新的导航，就和 <code>from</code> 一样。</li>
</ul>
<p>如果遇到了意料之外的情况，可能会抛出一个 <code>Error</code>。这会取消导航并且调用 <a href="https://router.vuejs.org/zh/api/#onerror"><code>router.onError()</code></a> 注册过的回调。</p>
<p>如果什么都没有，<code>undefined</code> 或返回 <code>true</code>，<strong>则导航是有效的</strong>，并调用下一个导航守卫</p>
<h3 id="12-2-路由独享的守卫"><a href="#12-2-路由独享的守卫" class="headerlink" title="12.2 路由独享的守卫"></a>12.2 路由独享的守卫</h3><p>你可以直接在路由配置上定义 <code>beforeEnter</code> 守卫：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/users/:id&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: UserDetails,</span><br><span class="line">    <span class="attr">beforeEnter</span>: <span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// reject the navigation</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p><code>beforeEnter</code> 守卫 <strong>只在进入路由时触发</strong>，不会在 <code>params</code>、<code>query</code> 或 <code>hash</code> 改变时触发。例如，从 <code>/users/2</code> 进入到 <code>/users/3</code> 或者从 <code>/users/2#info</code> 进入到 <code>/users/2#projects</code>。它们只有在 <strong>从一个不同的</strong> 路由导航时，才会被触发。</p>
<p>你也可以将一个函数数组传递给 <code>beforeEnter</code>，这在为不同的路由重用守卫时很有用：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">removeQueryParams</span>(<span class="params">to</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Object</span>.keys(to.query).length)</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">path</span>: to.path, <span class="attr">query</span>: &#123;&#125;, <span class="attr">hash</span>: to.hash &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">removeHash</span>(<span class="params">to</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (to.hash) <span class="keyword">return</span> &#123; <span class="attr">path</span>: to.path, <span class="attr">query</span>: to.query, <span class="attr">hash</span>: <span class="string">&#x27;&#x27;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/users/:id&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: UserDetails,</span><br><span class="line">    <span class="attr">beforeEnter</span>: [removeQueryParams, removeHash],</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: UserDetails,</span><br><span class="line">    <span class="attr">beforeEnter</span>: [removeQueryParams],</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="12-3-组件内的守卫"><a href="#12-3-组件内的守卫" class="headerlink" title="12.3 组件内的守卫"></a>12.3 组件内的守卫</h3><p>最后，你可以在路由组件内直接定义路由导航守卫(传递给路由配置的)</p>
<h4 id="可用的配置-API"><a href="#可用的配置-API" class="headerlink" title="可用的配置 API"></a>可用的配置 API</h4><p>你可以为路由组件添加以下配置：</p>
<ul>
<li><code>beforeRouteEnter</code></li>
<li><code>beforeRouteUpdate</code></li>
<li><code>beforeRouteLeave</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> UserDetails = &#123;</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`...`</span>,</span><br><span class="line">  <span class="function"><span class="title">beforeRouteEnter</span>(<span class="params">to, <span class="keyword">from</span></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 在渲染该组件的对应路由被验证前调用</span></span><br><span class="line">    <span class="comment">// 不能获取组件实例 `this` ！</span></span><br><span class="line">    <span class="comment">// 因为当守卫执行时，组件实例还没被创建！</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">beforeRouteUpdate</span>(<span class="params">to, <span class="keyword">from</span></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 在当前路由改变，但是该组件被复用时调用</span></span><br><span class="line">    <span class="comment">// 举例来说，对于一个带有动态参数的路径 `/users/:id`，在 `/users/1` 和 `/users/2` 之间跳转的时候，</span></span><br><span class="line">    <span class="comment">// 由于会渲染同样的 `UserDetails` 组件，因此组件实例会被复用。而这个钩子就会在这个情况下被调用。</span></span><br><span class="line">    <span class="comment">// 因为在这种情况发生的时候，组件已经挂载好了，导航守卫可以访问组件实例 `this`</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">beforeRouteLeave</span>(<span class="params">to, <span class="keyword">from</span></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 在导航离开渲染该组件的对应路由时调用</span></span><br><span class="line">    <span class="comment">// 与 `beforeRouteUpdate` 一样，它可以访问组件实例 `this`</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="13-路由元信息"><a href="#13-路由元信息" class="headerlink" title="13. 路由元信息"></a>13. 路由元信息</h2><p>有时，你可能希望将任意信息附加到路由上，如过渡名称、谁可以访问路由等。这些事情可以通过接收属性对象的<code>meta</code>属性来实现，并且它可以在路由地址和导航守卫上都被访问到。定义路由的时候你可以这样配置 <code>meta</code> 字段：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/posts&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: PostsLayout,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;new&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: PostsNew,</span><br><span class="line">        <span class="comment">// 只有经过身份验证的用户才能创建帖子</span></span><br><span class="line">        <span class="attr">meta</span>: &#123; <span class="attr">requiresAuth</span>: <span class="literal">true</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;:id&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: PostsDetail</span><br><span class="line">        <span class="comment">// 任何人都可以阅读文章</span></span><br><span class="line">        <span class="attr">meta</span>: &#123; <span class="attr">requiresAuth</span>: <span class="literal">false</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>那么如何访问这个 <code>meta</code> 字段呢？</p>
<p>首先，我们称呼 <code>routes</code> 配置中的每个路由对象为 <strong>路由记录</strong>。路由记录可以是嵌套的，因此，当一个路由匹配成功后，它可能匹配多个路由记录。</p>
<p>例如，根据上面的路由配置，<code>/posts/new</code> 这个 URL 将会匹配父路由记录 (<code>path: &#39;/posts&#39;</code>) 以及子路由记录 (<code>path: &#39;new&#39;</code>)。</p>
<p>一个路由匹配到的所有路由记录会暴露为 <code>$route</code> 对象(还有在导航守卫中的路由对象)的<code>$route.matched</code> 数组。我们需要遍历这个数组来检查路由记录中的 <code>meta</code> 字段，但是 Vue Router 还为你提供了一个 <code>$route.meta</code> 方法，它是一个非递归合并<strong>所有 <code>meta</code></strong> 字段的（从父字段到子字段）的方法。这意味着你可以简单地写</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 而不是去检查每条路由记录</span></span><br><span class="line">  <span class="comment">// to.matched.some(record =&gt; record.meta.requiresAuth)</span></span><br><span class="line">  <span class="keyword">if</span> (to.meta.requiresAuth &amp;&amp; !auth.isLoggedIn()) &#123;</span><br><span class="line">    <span class="comment">// 此路由需要授权，请检查是否已登录</span></span><br><span class="line">    <span class="comment">// 如果没有，则重定向到登录页面</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">      <span class="comment">// 保存我们所在的位置，以便以后再来</span></span><br><span class="line">      <span class="attr">query</span>: &#123; <span class="attr">redirect</span>: to.fullPath &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="14-不同的历史模式"><a href="#14-不同的历史模式" class="headerlink" title="14. 不同的历史模式"></a>14. 不同的历史模式</h2><p>在创建路由器实例时，<code>history</code> 配置允许我们在不同的历史模式中进行选择。</p>
<h3 id="Hash-模式"><a href="#Hash-模式" class="headerlink" title="Hash 模式"></a>Hash 模式</h3><p>hash 模式是用 <code>createWebHashHistory()</code> 创建的：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHashHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = createRouter(&#123;</span><br><span class="line">  <span class="attr">history</span>: createWebHashHistory(),</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>它在内部传递的实际 URL 之前使用了一个哈希字符（<code>#</code>）。由于这部分 URL 从未被发送到服务器，所以它不需要在服务器层面上进行任何特殊处理。不过，<strong>它在 SEO 中确实有不好的影响</strong>。如果你担心这个问题，可以使用 HTML5 模式。</p>
<h3 id="HTML5-模式"><a href="#HTML5-模式" class="headerlink" title="HTML5 模式"></a>HTML5 模式</h3><p>用 <code>createWebHistory()</code> 创建 HTML5 模式，推荐使用这个模式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = createRouter(&#123;</span><br><span class="line">  <span class="attr">history</span>: createWebHistory(),</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>当使用这种历史模式时，URL 会看起来很 “正常”，例如 <code>https://example.com/user/id</code>。漂亮!</p>
<p>不过，问题来了。由于我们的应用是一个单页的客户端应用，如果没有适当的服务器配置，用户在浏览器中直接访问 <code>https://example.com/user/id</code>，就会得到一个 404 错误。这就丑了。</p>
<p>不用担心：要解决这个问题，你需要做的就是在你的服务器上添加一个简单的回退路由。如果 URL 不匹配任何静态资源，它应提供与你的应用程序中的 <code>index.html</code> 相同的页面。漂亮依旧!</p>
<h2 id="15-动态路由"><a href="#15-动态路由" class="headerlink" title="15. 动态路由"></a>15. 动态路由</h2><p>对路由的添加通常是通过 <a href="https://router.vuejs.org/zh/api/#routes"><code>routes</code> 选项</a>来完成的，但是在某些情况下，你可能想在应用程序已经运行的时候添加或删除路由。具有可扩展接口(如 <a href="https://cli.vuejs.org/dev-guide/ui-api.html">Vue CLI UI</a> )这样的应用程序可以使用它来扩展应用程序。</p>
<h3 id="15-1-添加路由"><a href="#15-1-添加路由" class="headerlink" title="15.1 添加路由"></a>15.1 添加路由</h3><p>动态路由主要通过两个函数实现。<code>router.addRoute()</code> 和 <code>router.removeRoute()</code>。它们<strong>只</strong>注册一个新的路由，也就是说，如果新增加的路由与当前位置相匹配，就需要你用 <code>router.push()</code> 或 <code>router.replace()</code> 来<strong>手动导航</strong>，才能显示该新路由。我们来看一个例子：</p>
<p>想象一下，只有一个路由的以下路由：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> router = createRouter(&#123;</span><br><span class="line">  <span class="attr">history</span>: createWebHistory(),</span><br><span class="line">  <span class="attr">routes</span>: [&#123; <span class="attr">path</span>: <span class="string">&#x27;/:articleName&#x27;</span>, <span class="attr">component</span>: Article &#125;],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>进入任何页面，<code>/about</code>，<code>/store</code>，或者 <code>/3-tricks-to-improve-your-routing-code</code> 最终都会呈现 <code>Article</code> 组件。如果我们在 <code>/about</code> 上添加一个新的路由：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.addRoute(&#123; <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>, <span class="attr">component</span>: About &#125;)</span><br></pre></td></tr></table></figure>
<p>页面仍然会显示 <code>Article</code> 组件，我们需要手动调用 <code>router.replace()</code> 来改变当前的位置，并覆盖我们原来的位置（而不是添加一个新的路由，最后在我们的历史中两次出现在同一个位置）：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.addRoute(&#123; <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>, <span class="attr">component</span>: About &#125;)</span><br><span class="line"><span class="comment">// 我们也可以使用 this.$route 或 route = useRoute() （在 setup 中）</span></span><br><span class="line">router.replace(router.currentRoute.value.fullPath)</span><br></pre></td></tr></table></figure>
<p>记住，如果你需要等待新的路由显示，可以使用 <code>await router.replace()</code>。</p>
<h3 id="15-2-在导航守卫中添加路由"><a href="#15-2-在导航守卫中添加路由" class="headerlink" title="15.2 在导航守卫中添加路由"></a>15.2 在导航守卫中添加路由</h3><p>如果你决定在导航守卫内部添加或删除路由，你不应该调用 <code>router.replace()</code>，而是通过返回新的位置来触发重定向：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.beforeEach(<span class="function"><span class="params">to</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!hasNecessaryRoute(to)) &#123;</span><br><span class="line">    router.addRoute(generateRoute(to))</span><br><span class="line">    <span class="comment">// 触发重定向</span></span><br><span class="line">    <span class="keyword">return</span> to.fullPath</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>上面的例子有两个假设：第一，新添加的路由记录将与 <code>to</code> 位置相匹配，实际上导致与我们试图访问的位置不同。第二，<code>hasNecessaryRoute()</code> 在添加新的路由后返回 <code>false</code>，以避免无限重定向。</p>
<p>因为是在重定向中，所以我们是在替换将要跳转的导航，实际上行为就像之前的例子一样。而在实际场景中，添加路由的行为更有可能发生在导航守卫之外，例如，当一个视图组件挂载时，它会注册新的路由。</p>
<h3 id="删除路由"><a href="#删除路由" class="headerlink" title="删除路由"></a>删除路由</h3><p>有几个不同的方法来删除现有的路由：</p>
<ul>
<li><p>通过添加一个名称冲突的路由。如果添加与现有途径名称相同的途径，会先删除路由，再添加路由：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.addRoute(&#123; <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;about&#x27;</span>, <span class="attr">component</span>: About &#125;)</span><br><span class="line"><span class="comment">// 这将会删除之前已经添加的路由，因为他们具有相同的名字且名字必须是唯一的</span></span><br><span class="line">router.addRoute(&#123; <span class="attr">path</span>: <span class="string">&#x27;/other&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;about&#x27;</span>, <span class="attr">component</span>: Other &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过调用</p>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.addRoute()</span><br></pre></td></tr></table></figure>
<p>  返回的回调：</p>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> removeRoute = router.addRoute(routeRecord)</span><br><span class="line">removeRoute() <span class="comment">// 删除路由如果存在的话</span></span><br></pre></td></tr></table></figure>
<p>  当路由没有名称时，这很有用。</p>
<ul>
<li>通过使用</li>
</ul>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.removeRoute()</span><br></pre></td></tr></table></figure>
<p>  按名称删除路由：</p>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.addRoute(&#123; <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;about&#x27;</span>, <span class="attr">component</span>: About &#125;)</span><br><span class="line"><span class="comment">// 删除路由</span></span><br><span class="line">router.removeRoute(<span class="string">&#x27;about&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>  需要注意的是，如果你想使用这个功能，但又想避免名字的冲突，可以在路由中使用</p>
  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Symbol</span></span><br></pre></td></tr></table></figure>
<p>  作为名字。</p>
<p>当路由被删除时，<strong>所有的别名和子路由也会被同时删除</strong></p>
<h3 id="添加嵌套路由"><a href="#添加嵌套路由" class="headerlink" title="添加嵌套路由"></a>添加嵌套路由</h3><p>要将嵌套路由添加到现有的路由中，可以将路由的 <em>name</em> 作为第一个参数传递给 <code>router.addRoute()</code>，这将有效地添加路由，就像通过 <code>children</code> 添加的一样：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.addRoute(&#123; <span class="attr">name</span>: <span class="string">&#x27;admin&#x27;</span>, <span class="attr">path</span>: <span class="string">&#x27;/admin&#x27;</span>, <span class="attr">component</span>: Admin &#125;)</span><br><span class="line">router.addRoute(<span class="string">&#x27;admin&#x27;</span>, &#123; <span class="attr">path</span>: <span class="string">&#x27;settings&#x27;</span>, <span class="attr">component</span>: AdminSettings &#125;)</span><br></pre></td></tr></table></figure>
<p>这等效于：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.addRoute(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/admin&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: Admin,</span><br><span class="line">  <span class="attr">children</span>: [&#123; <span class="attr">path</span>: <span class="string">&#x27;settings&#x27;</span>, <span class="attr">component</span>: AdminSettings &#125;],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="查看现有路由"><a href="#查看现有路由" class="headerlink" title="查看现有路由"></a>查看现有路由</h3><p>Vue Router 提供了两个功能来查看现有的路由：</p>
<ul>
<li><a href="https://router.vuejs.org/zh/api/#hasroute"><code>router.hasRoute()</code></a>：检查路由是否存在。</li>
<li><a href="https://router.vuejs.org/zh/api/#getroutes"><code>router.getRoutes()</code></a>：获取一个包含所有路由记录的数组。</li>
</ul>
]]></content>
      <categories>
        <category>vue</category>
      </categories>
      <tags>
        <tag>vue</tag>
        <tag>vuecli</tag>
        <tag>vuerouter</tag>
      </tags>
  </entry>
  <entry>
    <title>springboot权限处理</title>
    <url>/2022/05/02/springbootweb4/</url>
    <content><![CDATA[<h1 id="Springboot权限处理"><a href="#Springboot权限处理" class="headerlink" title="Springboot权限处理"></a>Springboot权限处理</h1><h2 id="一、SpringSecurity"><a href="#一、SpringSecurity" class="headerlink" title="一、SpringSecurity"></a>一、SpringSecurity</h2><h3 id="1-1-安全简介"><a href="#1-1-安全简介" class="headerlink" title="1.1 安全简介"></a>1.1 安全简介</h3><p>1、在 Web 开发中，安全一直是非常重要的一个方面。安全虽然属于应用的非功能性需求，但是应该在应用开发的初期就考虑进来。如果在应用开发的后期才考虑安全的问题，就可能陷入一个两难的境地：一方面，应用存在严重的安全漏洞，无法满足用户的要求，并可能造成用户的隐私数据被攻击者窃取；另一方面，应用的基本架构已经确定，要修复安全漏洞，可能需要对系统的架构做出比较重大的调整，因而需要更多的开发时间，影响应用的发布进程。因此，从应用开发的第一天就应该把安全相关的因素考虑进来，并在整个应用的开发过程中。</p>
<p>2、市面上存在比较有名的：Shiro，Spring Security ！</p>
<p>3、这里需要阐述一下的是，每一个框架的出现都是为了解决某一问题而产生了，那么Spring Security框架的出现是为了解决什么问题呢？</p>
<p>4、首先我们看下它的官网介绍：Spring Security官网地址</p>
<p><code>Spring Security is a powerful and highly customizable authentication and access-control framework. It is the de-facto standard for securing Spring-based applications.</code></p>
<p><code>Spring Security is a framework that focuses on providing both authentication and authorization to Java applications. Like all Spring projects, the real power of Spring Security is found in how easily it can be extended to meet custom requirements</code></p>
<p>5、Spring Security是一个功能强大且高度可定制的身份验证和访问控制框架。它实际上是保护基于spring的应用程序的标准。</p>
<p>6、Spring Security是一个框架，侧重于为Java应用程序提供身份验证和授权。与所有Spring项目一样，Spring安全性的真正强大之处在于它可以轻松地扩展以满足定制需求</p>
<p>7、从官网的介绍中可以知道这是一个权限框架。想我们之前做项目是没有使用框架是怎么控制权限的？对于权限 一般会细分为功能权限，访问权限，和菜单权限。代码会写的非常的繁琐，冗余。</p>
<p>8、怎么解决之前写权限代码繁琐，冗余的问题，一些主流框架就应运而生而Spring Scecurity就是其中的一种。</p>
<p>9、Spring 是一个非常流行和成功的 Java 应用开发框架。Spring Security 基于 Spring 框架，提供了一套 Web 应用安全性的完整解决方案。一般来说，Web 应用的安全性包括用户认证（Authentication）和用户授权（Authorization）两个部分。</p>
<ul>
<li>用户认证指的是验证某个用户是否为系统中的合法主体，也就是说用户能否访问该系统。用户认证一般要求用户提供用户名和密码。系统通过校验用户名和密码来完成认证过程。</li>
<li>用户授权指的是验证某个用户是否有权限执行某个操作。在一个系统中，不同用户所具有的权限是不同的。比如对一个文件来说，有的用户只能进行读取，而有的用户可以进行修改。一般来说，系统会为不同的用户分配不同的角色，而每个角色则对应一系列的权限。</li>
</ul>
<p>10、对于上面提到的两种应用情景，Spring Security 框架都有很好的支持。</p>
<ul>
<li>在用户认证方面，Spring Security 框架支持主流的认证方式，包括 HTTP 基本认证、HTTP 表单验证、HTTP 摘要认证、OpenID 和 LDAP 等。</li>
<li>在用户授权方面，Spring Security 提供了基于角色的访问控制和访问控制列表（Access Control List，ACL），可以对应用中的领域对象进行细粒度的控制。</li>
</ul>
<h3 id="1-2-实战测试"><a href="#1-2-实战测试" class="headerlink" title="1.2 实战测试"></a>1.2 实战测试</h3><h4 id="1-2-1-实验环境搭建"><a href="#1-2-1-实验环境搭建" class="headerlink" title="1.2.1 实验环境搭建"></a>1.2.1 实验环境搭建</h4><ol>
<li><p>新建一个初始的springboot项目web模块，thymeleaf模块</p>
</li>
<li><p>导入静态资源</p>
<p><img src="/2022/05/02/springbootweb4/1.png" alt="image-20200728130501139"></p>
</li>
<li><p>controller跳转！</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> nuc.ss.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RouterController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&#123;&quot;/&quot;,&quot;/index&quot;&#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/toLogin&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;views/login&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/level1/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">level1</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;views/level1/&quot;</span> + id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/level2/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">level2</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;views/level2/&quot;</span> + id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/level3/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">level3</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;views/level3/&quot;</span> + id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试实验环境是否OK！</p>
<p>首页</p>
<p><img src="/2022/05/02/springbootweb4/2.png" alt="image-20200728130703899"></p>
<p>登录</p>
<p><img src="/2022/05/02/springbootweb4/3.png" alt="image-20200728130726820"></p>
<p>详情</p>
<p><img src="/2022/05/02/springbootweb4/4.png" alt="image-20200728130751338"></p>
</li>
</ol>
<h4 id="1-2-2-认识SpringSecurity"><a href="#1-2-2-认识SpringSecurity" class="headerlink" title="1.2.2 认识SpringSecurity"></a>1.2.2 认识SpringSecurity</h4><p>Spring Security 是针对Spring项目的安全框架，也是Spring Boot底层安全模块默认的技术选型，他可以实现强大的Web安全控制，对于安全控制，我们仅需要引入 spring-boot-starter-security 模块，进行少量的配置，即可实现强大的安全管理！</p>
<p>记住几个类：</p>
<ul>
<li><code>WebSecurityConfigurerAdapter</code>：自定义Security策略</li>
<li><code>AuthenticationManagerBuilder</code>：自定义认证策略</li>
<li><code>@EnableWebSecurity</code>：开启WebSecurity模式</li>
</ul>
<p>Spring Security的两个主要目标是 “认证” 和 “授权”（访问控制）。</p>
<p><strong>“认证”（Authentication）</strong></p>
<p>身份验证是关于验证您的凭据，如用户名/用户ID和密码，以验证您的身份。</p>
<p>身份验证通常通过用户名和密码完成，有时与身份验证因素结合使用。</p>
<p> <strong>“授权” （Authorization）</strong></p>
<p>授权发生在系统成功验证您的身份后，最终会授予您访问资源（如信息，文件，数据库，资金，位置，几乎任何内容）的完全权限。</p>
<p>这个概念是通用的，而不是只在Spring Security 中存在。</p>
<h4 id="1-2-3-认证和授权"><a href="#1-2-3-认证和授权" class="headerlink" title="1.2.3 认证和授权"></a>1.2.3 认证和授权</h4><p>目前，我们的测试环境，是谁都可以访问的，我们使用 Spring Security 增加上认证和授权的功能</p>
<ol>
<li><p>引入 Spring Security 模块</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2022/05/02/springbootweb4/5.png" alt="image-20200728175946604"></p>
</li>
<li><p>编写 Spring Security 配置类</p>
<ul>
<li><p>参考官网：<a href="https://spring.io/projects/spring-security">https://spring.io/projects/spring-security</a></p>
</li>
<li><p>查看我们自己项目中的版本，找到对应的帮助文档：<a href="https://docs.spring.io/spring-security/site/docs/5.3.0.RELEASE/reference/html5">https://docs.spring.io/spring-security/site/docs/5.3.0.RELEASE/reference/html5</a>  </p>
</li>
<li><p>servlet-applications 8.16.4</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Config</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http</span><br><span class="line">            .apply(customDsl())</span><br><span class="line">                .flag(<span class="keyword">true</span>)</span><br><span class="line">                .and()</span><br><span class="line">            ...;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/05/02/springbootweb4/6.png" alt="image-20200728175824524"></p>
</li>
</ul>
</li>
<li><p>编写基础配置类</p>
<p><img src="/2022/05/02/springbootweb4/7.png" alt="image-20200728180624787"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> nuc.ss.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableWebSecurity</span><span class="comment">// 开启WebSecurity模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.configure(http);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>定制请求的授权规则</p>
<p>看源码</p>
<p><img src="/2022/05/02/springbootweb4/8.png" alt="image-20200728190605894"></p>
<p>仿写</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//链式编程</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// 首页所有人都可以访问，功能也只有对应有权限的人才能访问到</span></span><br><span class="line">    <span class="comment">// 请求授权的规则</span></span><br><span class="line"></span><br><span class="line">    http.authorizeRequests()</span><br><span class="line">        .antMatchers(<span class="string">&quot;/&quot;</span>).permitAll()</span><br><span class="line">        .antMatchers(<span class="string">&quot;/level1/**&quot;</span>).hasRole(<span class="string">&quot;vip1&quot;</span>)</span><br><span class="line">        .antMatchers(<span class="string">&quot;/level2/**&quot;</span>).hasRole(<span class="string">&quot;vip2&quot;</span>)</span><br><span class="line">        .antMatchers(<span class="string">&quot;/level3/**&quot;</span>).hasRole(<span class="string">&quot;vip3&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试一下：发现除了首页都进不去了！因为我们目前没有登录的角色，因为请求需要登录的角色拥有对应的权限才可以！</p>
<p><img src="/2022/05/02/springbootweb4/9.png" alt="image-20200728185841148"></p>
</li>
<li><p>在configure()方法中加入以下配置，开启自动配置的登录功能！</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 开启自动配置的登录功能</span></span><br><span class="line"><span class="comment">// /login 请求来到登录页</span></span><br><span class="line"><span class="comment">// /login?error 重定向到这里表示登录失败</span></span><br><span class="line">http.formLogin();</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试一下：发现，没有权限的时候，会跳转到登录的页面！</p>
<p><img src="/2022/05/02/springbootweb4/10.png" alt="image-20200728190113670"></p>
</li>
<li><p>查看刚才登录页的注释信息；</p>
<p>我们可以定义认证规则，重写configure的另一个方法</p>
<p><img src="/2022/05/02/springbootweb4/11.png" alt="image-20200728190303746"></p>
<p>源码：</p>
<p><img src="/2022/05/02/springbootweb4/12.png" alt="image-20200728190840458"></p>
<p>仿写</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 认证，springboot 2.1.x 可以直接使用</span></span><br><span class="line"><span class="comment">// 密码编码： PasswordEncoder</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//这些数据正常应该中数据库中读</span></span><br><span class="line"></span><br><span class="line">    auth.inMemoryAuthentication()</span><br><span class="line">        .withUser(<span class="string">&quot;kuangshen&quot;</span>).password(<span class="string">&quot;123456&quot;</span>).roles(<span class="string">&quot;vip2&quot;</span>,<span class="string">&quot;vip3&quot;</span>)</span><br><span class="line">        .and()</span><br><span class="line">        .withUser(<span class="string">&quot;root&quot;</span>).password(<span class="string">&quot;123456&quot;</span>).roles(<span class="string">&quot;vip1&quot;</span>,<span class="string">&quot;vip2&quot;</span>,<span class="string">&quot;vip3&quot;</span>)</span><br><span class="line">        .and()</span><br><span class="line">        .withUser(<span class="string">&quot;guest&quot;</span>).password(<span class="string">&quot;123456&quot;</span>).roles(<span class="string">&quot;vip1&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试，我们可以使用这些账号登录进行测试！发现会报错！</p>
<p><code>There is no PasswordEncoder mapped for the id “null”</code></p>
<p><img src="/2022/05/02/springbootweb4/13.png" alt="image-20200728204515545"></p>
<p><img src="/2022/05/02/springbootweb4/14.png" alt="image-20200728204424570"></p>
</li>
<li><p>原因，我们要将前端传过来的密码进行某种方式加密，否则就无法登录，修改代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 认证，springboot 2.1.x 可以直接使用</span></span><br><span class="line"><span class="comment">// 密码编码： PasswordEncoder</span></span><br><span class="line"><span class="comment">// 在spring Secutiry 5.0+ 新增了很多加密方法</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//这些数据正常应该中数据库中读</span></span><br><span class="line">    auth.inMemoryAuthentication().passwordEncoder(<span class="keyword">new</span> BCryptPasswordEncoder())</span><br><span class="line">        .withUser(<span class="string">&quot;kuangshen&quot;</span>).password(<span class="keyword">new</span> BCryptPasswordEncoder().encode(<span class="string">&quot;123456&quot;</span>)).roles(<span class="string">&quot;vip2&quot;</span>,<span class="string">&quot;vip3&quot;</span>)</span><br><span class="line">        .and()</span><br><span class="line">        .withUser(<span class="string">&quot;root&quot;</span>).password(<span class="keyword">new</span> BCryptPasswordEncoder().encode(<span class="string">&quot;123456&quot;</span>)).roles(<span class="string">&quot;vip1&quot;</span>,<span class="string">&quot;vip2&quot;</span>,<span class="string">&quot;vip3&quot;</span>)</span><br><span class="line">        .and()</span><br><span class="line">        .withUser(<span class="string">&quot;guest&quot;</span>).password(<span class="keyword">new</span> BCryptPasswordEncoder().encode(<span class="string">&quot;123456&quot;</span>)).roles(<span class="string">&quot;vip1&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试，发现，登录成功，并且每个角色只能访问自己认证下的规则！搞定</p>
</li>
</ol>
<h4 id="1-2-4-权限控制和注销"><a href="#1-2-4-权限控制和注销" class="headerlink" title="1.2.4 权限控制和注销"></a>1.2.4 权限控制和注销</h4><ol>
<li><p>开启自动配置的注销的功能</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//定制请求的授权规则</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">   <span class="comment">//....</span></span><br><span class="line">   <span class="comment">//开启自动配置的注销的功能</span></span><br><span class="line">   <span class="comment">// /logout 注销请求</span></span><br><span class="line">   http.logout();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>我们在前端，增加一个注销的按钮，<code>index.html</code>导航栏中</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--注销--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/logout&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;sign-out icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 注销</span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>我们可以去测试一下，登录成功后点击注销，发现注销完毕会跳转到登录页面！</p>
<p><img src="/2022/05/02/springbootweb4/15.png" alt="image-20200728210246562"></p>
<p><img src="/2022/05/02/springbootweb4/16.png" alt="image-20200728210323067"></p>
</li>
<li><p>但是，我们想让他注销成功后，依旧可以跳转到首页，该怎么处理呢？</p>
<p>源码：</p>
<p><img src="/2022/05/02/springbootweb4/17.png" alt="image-20200728211500366"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// .logoutSuccessUrl(&quot;/&quot;); 注销成功来到首页</span></span><br><span class="line">http.logout().logoutSuccessUrl(<span class="string">&quot;/&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试，注销完毕后，发现跳转到首页OK</p>
</li>
<li><p>我们现在又来一个需求：用户没有登录的时候，导航栏上只显示登录按钮，用户登录之后，导航栏可以显示登录的用户信息及注销按钮！还有就是，比如kuangshen这个用户，它只有 vip2，vip3功能，那么登录则只显示这两个功能，而vip1的功能菜单不显示！这个就是真实的网站情况了！该如何做呢？</p>
<font color="red">我们需要结合thymeleaf中的一些功能</font>

<p><code>sec：authorize=&quot;isAuthenticated()&quot;</code>:是否认证登录！来显示不同的页面</p>
<p>Maven依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.thymeleaf.extras/thymeleaf-extras-springsecurity4 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.thymeleaf.extras<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-extras-springsecurity5<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>整合包4（springsecurity4）——springboot版本2.0.9</li>
<li>整合包5（springsecurity5）——springboot版本之后</li>
</ul>
</li>
<li><p>修改我们的前端页面</p>
<p>导入命名空间</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:sec</span>=<span class="string">&quot;http://www.thymeleaf.org/extras/spring-security&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>修改导航栏，增加认证判断</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--登录注销--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right menu&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--如果未登录--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">sec:authorize</span>=<span class="string">&quot;!isAuthenticated()&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/login&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;address card icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 登录</span><br><span class="line">        <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--如果已登录--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">sec:authorize</span>=<span class="string">&quot;isAuthenticated()&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;address card icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">            用户名：<span class="tag">&lt;<span class="name">span</span> <span class="attr">sec:authentication</span>=<span class="string">&quot;principal.username&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            角色：<span class="tag">&lt;<span class="name">span</span> <span class="attr">sec:authentication</span>=<span class="string">&quot;principal.authorities&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">sec:authorize</span>=<span class="string">&quot;isAuthenticated()&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/logout&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;sign-out  icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 注销</span><br><span class="line">        <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>重启测试，我们可以登录试试看，登录成功后确实，显示了我们想要的页面；</p>
<ul>
<li><p>未登录</p>
<p><img src="/2022/05/02/springbootweb4/18.png" alt="image-20200728213100804"></p>
</li>
<li><p>登录</p>
<p><img src="/2022/05/02/springbootweb4/19.png" alt="image-20200728213235625"></p>
</li>
</ul>
</li>
<li><p>点击注销产生的问题</p>
<ul>
<li><p>整合包4（springsecurity4）</p>
<p><img src="/2022/05/02/springbootweb4/20.png" alt="image-20200728220414292"></p>
</li>
<li><p>整合包5（springsecurity5）（不算问题，需要点击确定，才能回到首页）</p>
<p><img src="/2022/05/02/springbootweb4/21.png" alt="image-20200728220517534"></p>
<p><img src="/2022/05/02/springbootweb4/22.png" alt="image-20200728220531678"></p>
</li>
</ul>
<font color="red">解决问题：</font>

<ul>
<li>它默认防止csrf跨站请求伪造，因为会产生安全问题</li>
<li>将请求改为post表单提交</li>
<li>在spring security中关闭csrf功能<code>http.csrf().disable();</code></li>
</ul>
<p>再次点击注销按钮之后（直接退出到首页）</p>
<p><img src="/2022/05/02/springbootweb4/23.png" alt="image-20200728220835347"></p>
</li>
<li><p>我们继续将下面的角色功能块认证完成！</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--菜单根据用户的角色动态的实现--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;column&quot;</span>  <span class="attr">sec:authorize</span>=<span class="string">&quot;hasRole(&#x27;vip1&#x27;)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ui raised segment&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ui&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h5</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span>Level 1<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/level1/1&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;bullhorn icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> Level-1-1<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/level1/2&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;bullhorn icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> Level-1-2<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/level1/3&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;bullhorn icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> Level-1-3<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;column&quot;</span>  <span class="attr">sec:authorize</span>=<span class="string">&quot;hasRole(&#x27;vip2&#x27;)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ui raised segment&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ui&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h5</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span>Level 2<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/level2/1&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;bullhorn icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> Level-2-1<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/level2/2&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;bullhorn icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> Level-2-2<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/level2/3&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;bullhorn icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> Level-2-3<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;column&quot;</span>  <span class="attr">sec:authorize</span>=<span class="string">&quot;hasRole(&#x27;vip3&#x27;)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ui raised segment&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ui&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h5</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span>Level 3<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/level3/1&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;bullhorn icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> Level-3-1<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/level3/2&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;bullhorn icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> Level-3-2<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/level3/3&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;bullhorn icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> Level-3-3<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li>测试一下！</li>
</ol>
<ul>
<li><p>用户首页未登录</p>
<p><img src="/2022/05/02/springbootweb4/24.png" alt="image-20200728221453455"></p>
</li>
<li><p>某个用户登录</p>
<p><img src="/2022/05/02/springbootweb4/25.png" alt="image-20200728221536116"></p>
</li>
<li><p>权限控制和注销搞定！</p>
</li>
</ul>
<h4 id="1-2-5-记住我"><a href="#1-2-5-记住我" class="headerlink" title="1.2.5 记住我"></a>1.2.5 记住我</h4><p>现在的情况，我们只要登录之后，关闭浏览器，再登录，就会让我们重新登录，但是很多网站的情况，就是有一个记住密码的功能，这个该如何实现呢？很简单</p>
<ol>
<li><p>开启记住我功能</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//定制请求的授权规则</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">//。。。。。。。。。。。</span></span><br><span class="line">   <span class="comment">//开启记住我功能: cookie,默认保存两周</span></span><br><span class="line">   http.rememberMe();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>我们再次启动项目测试一下</p>
<ul>
<li><p>发现登录页多了一个记住我功能</p>
<p><img src="/2022/05/02/springbootweb4/26.png" alt="image-20200728222312694"></p>
</li>
<li><p>我们登录之后关闭 浏览器，然后重新打开浏览器访问，发现用户依旧存在！</p>
<p><img src="/2022/05/02/springbootweb4/27.png" alt="image-20200728222406216"></p>
<font color="red">思考：如何实现的呢？其实非常简单</font>

<p>我们可以查看浏览器的cookie</p>
<p><img src="/2022/05/02/springbootweb4/28.png" alt="image-20200728222706154"></p>
</li>
</ul>
</li>
<li><p>我们点击注销的时候，可以发现，spring security 帮我们自动删除了这个 cookie</p>
<p><img src="/2022/05/02/springbootweb4/29.png" alt="image-20200728223559077"></p>
</li>
<li><p>cookie发送给浏览器保存，以后登录带上这个cookie，只要通过检查就可以免登录了。如果点击注销，则会删除这个cookie，具体的原理我们在JavaWeb阶段都讲过了，这里就不在多说了！</p>
</li>
</ol>
<h4 id="1-2-6-定制登录页"><a href="#1-2-6-定制登录页" class="headerlink" title="1.2.6 定制登录页"></a>1.2.6 定制登录页</h4><p>现在这个登录页面都是spring security 默认的，怎么样可以使用我们自己写的Login界面呢？</p>
<ol>
<li><p>在刚才的登录页配置后面指定 loginpage</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 没有权限默认会到登录页面,需要开启登录的页面</span></span><br><span class="line">    <span class="comment">// /login页面</span></span><br><span class="line">    http.formLogin().loginPage(<span class="string">&quot;/toLogin&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>然后前端也需要指向我们自己定义的 login请求</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">sec:authorize</span>=<span class="string">&quot;!isAuthenticated()&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/toLogin&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;address card icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 登录</span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>我们登录，需要将这些信息发送到哪里，我们也需要配置，login.html 配置提交请求及方式，方式必须为post:</p>
<p>在 loginPage()源码中的注释上有写明：</p>
<p><img src="/2022/05/02/springbootweb4/30.png" alt="image-20200728224246393"></p>
</li>
<li><p>这个请求提交上来，我们还需要验证处理，怎么做呢？我们可以查看formLogin()方法的源码！我们配置接收登录的用户名和密码的参数！</p>
<p><img src="/2022/05/02/springbootweb4/31.png" alt="image-20200728224831116"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 没有权限默认会到登录页面,需要开启登录的页面</span></span><br><span class="line">    <span class="comment">// /login页面</span></span><br><span class="line">    http.formLogin()</span><br><span class="line">      .usernameParameter(<span class="string">&quot;username&quot;</span>)</span><br><span class="line">      .passwordParameter(<span class="string">&quot;password&quot;</span>)</span><br><span class="line">      .loginPage(<span class="string">&quot;/toLogin&quot;</span>)</span><br><span class="line">      .loginProcessingUrl(<span class="string">&quot;/login&quot;</span>); <span class="comment">// 登陆表单提交请求</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在登录页增加记住我的多选框</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;remember&quot;</span>&gt;</span> 记住我</span><br></pre></td></tr></table></figure>
</li>
<li><p>后端验证处理！</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">    <span class="comment">//开启记住我功能: cookie,默认保存两周,自定义接收前端的参数</span></span><br><span class="line">    http.rememberMe().rememberMeParameter(<span class="string">&quot;remember&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试，OK</p>
</li>
</ol>
<h3 id="1-3-完整配置代码"><a href="#1-3-完整配置代码" class="headerlink" title="1.3 完整配置代码"></a>1.3 完整配置代码</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> nuc.ss.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AOP:拦截器</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span>  <span class="comment">// 开启WebSecurity模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//链式编程</span></span><br><span class="line">    <span class="comment">//授权</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 首页所有人都可以访问，功能也只有对应有权限的人才能访问到</span></span><br><span class="line">        <span class="comment">// 请求授权的规则</span></span><br><span class="line">        http.authorizeRequests()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/&quot;</span>).permitAll()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/level1/**&quot;</span>).hasRole(<span class="string">&quot;vip1&quot;</span>)</span><br><span class="line">                .antMatchers(<span class="string">&quot;/level2/**&quot;</span>).hasRole(<span class="string">&quot;vip2&quot;</span>)</span><br><span class="line">                .antMatchers(<span class="string">&quot;/level3/**&quot;</span>).hasRole(<span class="string">&quot;vip3&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 没有权限默认会到登录页面,需要开启登录的页面</span></span><br><span class="line">        <span class="comment">// /login页面</span></span><br><span class="line">        http.formLogin()</span><br><span class="line">                .usernameParameter(<span class="string">&quot;username&quot;</span>)</span><br><span class="line">                .passwordParameter(<span class="string">&quot;password&quot;</span>)</span><br><span class="line">                .loginPage(<span class="string">&quot;/toLogin&quot;</span>)</span><br><span class="line">                .loginProcessingUrl(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//注销,开启了注销功能,跳到首页</span></span><br><span class="line">        http.logout().logoutSuccessUrl(<span class="string">&quot;/&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 防止网站工具：get，post</span></span><br><span class="line">        http.csrf().disable();<span class="comment">//关闭csrf功能，登录失败肯定存在的原因</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//开启记住我功能: cookie,默认保存两周,自定义接收前端的参数</span></span><br><span class="line">        http.rememberMe().rememberMeParameter(<span class="string">&quot;remember&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 认证，springboot 2.1.x 可以直接使用</span></span><br><span class="line">    <span class="comment">// 密码编码： PasswordEncoder</span></span><br><span class="line">    <span class="comment">// 在spring Secutiry 5.0+ 新增了很多加密方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//这些数据正常应该中数据库中读</span></span><br><span class="line">        auth.inMemoryAuthentication().passwordEncoder(<span class="keyword">new</span> BCryptPasswordEncoder())</span><br><span class="line">                .withUser(<span class="string">&quot;kuangshen&quot;</span>).password(<span class="keyword">new</span> BCryptPasswordEncoder().encode(<span class="string">&quot;123456&quot;</span>)).roles(<span class="string">&quot;vip2&quot;</span>,<span class="string">&quot;vip3&quot;</span>)</span><br><span class="line">                .and()</span><br><span class="line">                .withUser(<span class="string">&quot;root&quot;</span>).password(<span class="keyword">new</span> BCryptPasswordEncoder().encode(<span class="string">&quot;123456&quot;</span>)).roles(<span class="string">&quot;vip1&quot;</span>,<span class="string">&quot;vip2&quot;</span>,<span class="string">&quot;vip3&quot;</span>)</span><br><span class="line">                .and()</span><br><span class="line">                .withUser(<span class="string">&quot;guest&quot;</span>).password(<span class="keyword">new</span> BCryptPasswordEncoder().encode(<span class="string">&quot;123456&quot;</span>)).roles(<span class="string">&quot;vip1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="二、Shiro简介"><a href="#二、Shiro简介" class="headerlink" title="二、Shiro简介"></a>二、Shiro简介</h2><h3 id="2-1、Shiro-是什么？"><a href="#2-1、Shiro-是什么？" class="headerlink" title="2.1、Shiro 是什么？"></a>2.1、Shiro 是什么？</h3><ul>
<li><p>Apache Shiro 是 Java 的一个安全（权限）框架。</p>
</li>
<li><p>Shiro 可以非常容易的开发出足够好的应用，其不仅可以用在 JavaSE 环境，也可以用在 JavaEE 环境。</p>
</li>
<li><p>Shiro 可以完成：认证、授权、加密、会话管理、与Web 集成、缓存等。</p>
</li>
<li>下载地址<ul>
<li>官网：<a href="http://shiro.apache.org/">http://shiro.apache.org/</a></li>
<li>github：<a href="https://github.com/apache/shiro">https://github.com/apache/shiro</a></li>
</ul>
</li>
</ul>
<h3 id="2-2、有哪些功能？"><a href="#2-2、有哪些功能？" class="headerlink" title="2.2、有哪些功能？"></a>2.2、有哪些功能？</h3><p><img src="/2022/05/02/springbootweb4/32.png" alt="image-20200729114647110"></p>
<ul>
<li><p>Authentication:身份认证/登录，验证用户是不是拥有相应的身份</p>
</li>
<li><p>Authorization:授权，即权限验证，验证某个已认证的用户是否拥有某个权限；即判断用户是否能进行什么操作，如：验证某个用户是否拥有某个角色。或者细粒度的验证某个用户对某个资源是否具有某个权限</p>
</li>
<li><p>Session Management:会话管理，即用户登录后就是一次会话，在没有退出之前，它的所有信息都在会话中；会话可以是普通JavaSE环境，也可以是Web 环境的</p>
</li>
<li><p>Cryptography:加密，保护数据的安全性，如密码加密存储到数据库，而不是明文存储</p>
</li>
<li><p>Web Support:Web 支持，可以非常容易的集成到Web 环境</p>
</li>
<li><p>Caching:缓存，比如用户登录后，其用户信息、拥有的角色/权限不必每次去查，这样可以提高效率</p>
</li>
<li><p>Concurrency:Shiro支持多线程应用的并发验证，即如在一个线程中开启另一个线程，能把权限自动传播过去</p>
</li>
<li><p>Testing:提供测试支持</p>
</li>
<li><p>“Run As”:允许一个用户假装为另一个用户（如果他们允许）的身份进行访问</p>
</li>
<li><p>Remember Me:记住我，这个是非常常见的功能，即一次登录后，下次再来的话不用登录了</p>
</li>
</ul>
<h3 id="2-3、Shiro架构-外部"><a href="#2-3、Shiro架构-外部" class="headerlink" title="2.3、Shiro架构(外部)"></a>2.3、Shiro架构(外部)</h3><p>从外部来看Shiro，即从应用程序角度的来观察如何使用Shiro完成工作</p>
<p><img src="/2022/05/02/springbootweb4/33.png" alt="image-20200729114702566"></p>
<ul>
<li><p>Subject：应用代码直接交互的对象是Subject，也就是说Shiro的对外API 核心就是Subject。Subject 代表了当前“用户”，这个用户不一定是一个具体的人，与当前应用交互的任何东西都是Subject，如网络爬虫，机器人等；与Subject 的所有交互都会委托给SecurityManager；Subject 其实是一个门面，SecurityManager才是实际的执行者</p>
</li>
<li><p>SecurityManager：安全管理器；即所有与安全有关的操作都会与SecurityManager交互；且其管理着所有Subject；可以看出它是Shiro的核心，它负责与Shiro的其他组件进行交互，它相当于SpringMVC中DispatcherServlet的角色</p>
</li>
<li><p>Realm：Shiro从Realm 获取安全数据（如用户、角色、权限），就是说SecurityManager要验证用户身份，那么它需要从Realm 获取相应的用户进行比较以确定用户身份是否合法；也需要从Realm 得到用户相应的角色/权限进行验证用户是否能进行操作；可以把Realm 看成DataSource</p>
</li>
</ul>
<h3 id="2-4、Shiro架构-内部"><a href="#2-4、Shiro架构-内部" class="headerlink" title="2.4、Shiro架构(内部)"></a>2.4、Shiro架构(内部)</h3><p><img src="/2022/05/02/springbootweb4/34.png" alt="image-20200729114720578"></p>
<ul>
<li>Subject：任何可以与应用交互的“用户”；</li>
<li>SecurityManager：相当于SpringMVC中的DispatcherServlet；是Shiro的心脏；所有具体的交互都通过SecurityManager进行控制；它管理着所有Subject、且负责进行认证、授权、会话及缓存的管理。</li>
<li>Authenticator：负责Subject 认证，是一个扩展点，可以自定义实现；可以使用认证策略（Authentication Strategy），即什么情况下算用户认证通过了；</li>
<li>Authorizer：授权器、即访问控制器，用来决定主体是否有权限进行相应的操作；即控制着用户能访问应用中的哪些功能；</li>
<li>Realm：可以有1 个或多个Realm，可以认为是安全实体数据源，即用于获取安全实体的；可以是JDBC 实现，也可以是内存实现等等；由用户提供；所以一般在应用中都需要实现自己的Realm；</li>
<li>SessionManager：管理Session 生命周期的组件；而Shiro并不仅仅可以用在Web 环境，也可以用在如普通的JavaSE环境<br>CacheManager：缓存控制器，来管理如用户、角色、权限等的缓存的；因为这些数据基本上很少改变，放到缓存中后可以提高访问的性能</li>
<li>Cryptography：密码模块，Shiro提高了一些常见的加密组件用于如密码加密/解密。</li>
</ul>
<h2 id="三、Shiro-Hello-World"><a href="#三、Shiro-Hello-World" class="headerlink" title="三、Shiro Hello World"></a>三、Shiro Hello World</h2><h3 id="3-1、快速实践"><a href="#3-1、快速实践" class="headerlink" title="3.1、快速实践"></a>3.1、快速实践</h3><ul>
<li><p>查看官方文档：<a href="http://shiro.apache.org/tutorial.html">http://shiro.apache.org/tutorial.html</a></p>
</li>
<li><p>官方的quickstart : <a href="https://github.com/apache/shiro/tree/master/samples/quickstart/">https://github.com/apache/shiro/tree/master/samples/quickstart/</a></p>
<p><img src="/2022/05/02/springbootweb4/35.png" alt="image-20200729115148574"></p>
</li>
</ul>
<ol>
<li><p>创建一个maven父工程，用来学习Shiro,删掉不必要的部分</p>
</li>
<li><p>创建一个普通的Maven子工程：hell-shiro</p>
<p><img src="/2022/05/02/springbootweb4/36.png" alt="image-20200729120114648"></p>
</li>
<li><p>根据<a href="https://github.com/apache/shiro/blob/master/samples/quickstart/pom.xml">官方文档</a>，我们导入Shiro的依赖</p>
<p><img src="/2022/05/02/springbootweb4/37.png" alt="image-20200729120207730"></p>
</li>
</ol>
<p>   <a href="https://mvnrepository.com/artifact/org.apache.shiro/shiro-core">版本号点击这里</a></p>
   <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- configure logging --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jcl-over-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.26<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.26<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol>
<li><p>相关配置文件</p>
<ul>
<li><p>log4j.properties——<a href="https://github.com/apache/shiro/blob/master/samples/quickstart/src/main/resources/log4j.properties">官网</a></p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">log4j.rootLogger</span>=<span class="string">INFO, stdout</span></span><br><span class="line"></span><br><span class="line"><span class="meta">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%d %p [%c] - %m %n</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># General Apache libraries</span></span><br><span class="line"><span class="meta">log4j.logger.org.apache</span>=<span class="string">WARN</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># Spring</span></span><br><span class="line"><span class="meta">log4j.logger.org.springframework</span>=<span class="string">WARN</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># Default Shiro logging</span></span><br><span class="line"><span class="meta">log4j.logger.org.apache.shiro</span>=<span class="string">INFO</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># Disable verbose logging</span></span><br><span class="line"><span class="meta">log4j.logger.org.apache.shiro.util.ThreadContext</span>=<span class="string">WARN</span></span><br><span class="line"><span class="meta">log4j.logger.org.apache.shiro.cache.ehcache.EhCache</span>=<span class="string">WARN</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>shiro.ini——<a href="https://github.com/apache/shiro/blob/master/samples/quickstart/src/main/resources/shiro.ini">官网</a></p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[users]</span></span><br><span class="line"><span class="comment"># user &#x27;root&#x27; with password &#x27;secret&#x27; and the &#x27;admin&#x27; role</span></span><br><span class="line"><span class="attr">root</span> = secret, admin</span><br><span class="line"><span class="comment"># user &#x27;guest&#x27; with the password &#x27;guest&#x27; and the &#x27;guest&#x27; role</span></span><br><span class="line"><span class="attr">guest</span> = guest, guest</span><br><span class="line"><span class="comment"># user &#x27;presidentskroob&#x27; with password &#x27;12345&#x27; (&quot;That&#x27;s the same combination on</span></span><br><span class="line"><span class="comment"># my luggage!!!&quot; ;)), and role &#x27;president&#x27;</span></span><br><span class="line"><span class="attr">presidentskroob</span> = <span class="number">12345</span>, president</span><br><span class="line"><span class="comment"># user &#x27;darkhelmet&#x27; with password &#x27;ludicrousspeed&#x27; and roles &#x27;darklord&#x27; and &#x27;schwartz&#x27;</span></span><br><span class="line"><span class="attr">darkhelmet</span> = ludicrousspeed, darklord, schwartz</span><br><span class="line"><span class="comment"># user &#x27;lonestarr&#x27; with password &#x27;vespa&#x27; and roles &#x27;goodguy&#x27; and &#x27;schwartz&#x27;</span></span><br><span class="line"><span class="attr">lonestarr</span> = vespa, goodguy, schwartz</span><br><span class="line"></span><br><span class="line"><span class="comment"># -----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Roles with assigned permissions</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># Each line conforms to the format defined in the</span></span><br><span class="line"><span class="comment"># org.apache.shiro.realm.text.TextConfigurationRealm#setRoleDefinitions JavaDoc</span></span><br><span class="line"><span class="comment"># -----------------------------------------------------------------------------</span></span><br><span class="line"><span class="section">[roles]</span></span><br><span class="line"><span class="comment"># &#x27;admin&#x27; role has all permissions, indicated by the wildcard &#x27;*&#x27;</span></span><br><span class="line"><span class="attr">admin</span> = *</span><br><span class="line"><span class="comment"># The &#x27;schwartz&#x27; role can do anything (*) with any lightsaber:</span></span><br><span class="line"><span class="attr">schwartz</span> = lightsaber:*</span><br><span class="line"><span class="comment"># The &#x27;goodguy&#x27; role is allowed to &#x27;drive&#x27; (action) the winnebago (type) with</span></span><br><span class="line"><span class="comment"># license plate &#x27;eagle5&#x27; (instance specific id)</span></span><br><span class="line"><span class="attr">goodguy</span> = winnebago:drive:eagle5</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动类 Quickstart——<a href="https://github.com/apache/shiro/blob/master/samples/quickstart/src/main/java/Quickstart.java">官网</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Licensed to the Apache Software Foundation (ASF) under one</span></span><br><span class="line"><span class="comment"> * or more contributor license agreements.  See the NOTICE file</span></span><br><span class="line"><span class="comment"> * distributed with this work for additional information</span></span><br><span class="line"><span class="comment"> * regarding copyright ownership.  The ASF licenses this file</span></span><br><span class="line"><span class="comment"> * to you under the Apache License, Version 2.0 (the</span></span><br><span class="line"><span class="comment"> * &quot;License&quot;); you may not use this file except in compliance</span></span><br><span class="line"><span class="comment"> * with the License.  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing,</span></span><br><span class="line"><span class="comment"> * software distributed under the License is distributed on an</span></span><br><span class="line"><span class="comment"> * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span></span><br><span class="line"><span class="comment"> * KIND, either express or implied.  See the License for the</span></span><br><span class="line"><span class="comment"> * specific language governing permissions and limitations</span></span><br><span class="line"><span class="comment"> * under the License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.config.IniSecurityManagerFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.mgt.SecurityManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.session.Session;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.Subject;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.util.Factory;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Simple Quickstart application showing how to use Shiro&#x27;s API.</span></span><br><span class="line"><span class="comment"> * 简单入门Shiro使用API</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 0.9 RC2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Quickstart</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">transient</span> Logger log = LoggerFactory.getLogger(Quickstart.class);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The easiest way to create a Shiro SecurityManager with configured</span></span><br><span class="line">        <span class="comment">// realms, users, roles and permissions is to use the simple INI config.</span></span><br><span class="line">        <span class="comment">// We&#x27;ll do that by using a factory that can ingest a .ini file and</span></span><br><span class="line">        <span class="comment">// return a SecurityManager instance:</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Use the shiro.ini file at the root of the classpath</span></span><br><span class="line">        <span class="comment">// (file: and url: prefixes load from files and urls respectively):</span></span><br><span class="line">        <span class="comment">// 读取配置文件:</span></span><br><span class="line">        Factory&lt;SecurityManager&gt; factory = <span class="keyword">new</span> IniSecurityManagerFactory(<span class="string">&quot;classpath:shiro.ini&quot;</span>);</span><br><span class="line">        SecurityManager securityManager = factory.getInstance();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// for this simple example quickstart, make the SecurityManager</span></span><br><span class="line">        <span class="comment">// accessible as a JVM singleton.  Most applications wouldn&#x27;t do this</span></span><br><span class="line">        <span class="comment">// and instead rely on their container configuration or web.xml for</span></span><br><span class="line">        <span class="comment">// webapps.  That is outside the scope of this simple quickstart, so</span></span><br><span class="line">        <span class="comment">// we&#x27;ll just do the bare minimum so you can continue to get a feel</span></span><br><span class="line">        <span class="comment">// for things.</span></span><br><span class="line">        SecurityUtils.setSecurityManager(securityManager);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Now that a simple Shiro environment is set up, let&#x27;s see what you can do:</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// get the currently executing user:</span></span><br><span class="line">        <span class="comment">// 获取当前的用户对象 Subject</span></span><br><span class="line">        Subject currentUser = SecurityUtils.getSubject();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Do some stuff with a Session (no need for a web or EJB container!!!)</span></span><br><span class="line">        <span class="comment">//通过当前用户拿到Shiro的Session 可以脱离web存值取值</span></span><br><span class="line">        Session session = currentUser.getSession();</span><br><span class="line">        session.setAttribute(<span class="string">&quot;someKey&quot;</span>, <span class="string">&quot;aValue&quot;</span>);</span><br><span class="line">        String value = (String) session.getAttribute(<span class="string">&quot;someKey&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (value.equals(<span class="string">&quot;aValue&quot;</span>)) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;Retrieved the correct value! [&quot;</span> + value + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// let&#x27;s login the current user so we can check against roles and permissions:</span></span><br><span class="line">        <span class="comment">//判断当前的用户是否被认证</span></span><br><span class="line">        <span class="keyword">if</span> (!currentUser.isAuthenticated()) &#123;</span><br><span class="line">            <span class="comment">//Token 令牌</span></span><br><span class="line">            UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(<span class="string">&quot;lonestarr&quot;</span>, <span class="string">&quot;vespa&quot;</span>);</span><br><span class="line">            <span class="comment">//设置记住我</span></span><br><span class="line">            token.setRememberMe(<span class="keyword">true</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//执行登录操作</span></span><br><span class="line">                currentUser.login(token);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (UnknownAccountException uae) &#123;</span><br><span class="line">                log.info(<span class="string">&quot;There is no user with username of &quot;</span> + token.getPrincipal());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IncorrectCredentialsException ice) &#123;</span><br><span class="line">                log.info(<span class="string">&quot;Password for account &quot;</span> + token.getPrincipal() + <span class="string">&quot; was incorrect!&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (LockedAccountException lae) &#123;</span><br><span class="line">                log.info(<span class="string">&quot;The account for username &quot;</span> + token.getPrincipal() + <span class="string">&quot; is locked.  &quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Please contact your administrator to unlock it.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ... catch more exceptions here (maybe custom ones specific to your application?</span></span><br><span class="line">            <span class="keyword">catch</span> (AuthenticationException ae) &#123;</span><br><span class="line">                <span class="comment">//unexpected condition?  error?</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//say who they are:</span></span><br><span class="line">        <span class="comment">//print their identifying principal (in this case, a username):</span></span><br><span class="line">        log.info(<span class="string">&quot;User [&quot;</span> + currentUser.getPrincipal() + <span class="string">&quot;] logged in successfully.&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//test a role:</span></span><br><span class="line">        <span class="comment">// 检查角色</span></span><br><span class="line">        <span class="keyword">if</span> (currentUser.hasRole(<span class="string">&quot;schwartz&quot;</span>)) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;May the Schwartz be with you!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            log.info(<span class="string">&quot;Hello, mere mortal.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//test a typed permission (not instance-level)</span></span><br><span class="line">        <span class="comment">//粗粒度</span></span><br><span class="line">        <span class="keyword">if</span> (currentUser.isPermitted(<span class="string">&quot;lightsaber:wield&quot;</span>)) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;You may use a lightsaber ring.  Use it wisely.&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            log.info(<span class="string">&quot;Sorry, lightsaber rings are for schwartz masters only.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//a (very powerful) Instance Level permission:</span></span><br><span class="line">        <span class="comment">//细粒度</span></span><br><span class="line">        <span class="keyword">if</span> (currentUser.isPermitted(<span class="string">&quot;winnebago:drive:eagle5&quot;</span>)) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;You are permitted to &#x27;drive&#x27; the winnebago with license plate (id) &#x27;eagle5&#x27;.  &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;Here are the keys - have fun!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            log.info(<span class="string">&quot;Sorry, you aren&#x27;t allowed to drive the &#x27;eagle5&#x27; winnebago!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//all done - log out!</span></span><br><span class="line">        <span class="comment">//注销</span></span><br><span class="line">        currentUser.logout();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//结束</span></span><br><span class="line">        System.exit(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/05/02/springbootweb4/38.png" alt="image-20200729130649625"></p>
</li>
<li><p>Spring Secutrry都有~（只是换了个名字）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取当前的用户对象 Subject</span></span><br><span class="line">Subject currentUser = SecurityUtils.getSubject();</span><br><span class="line">Session session = currentUser.getSession();</span><br><span class="line">currentUser.isAuthenticated()</span><br><span class="line">    currentUser.getPrincipal()</span><br><span class="line">    currentUser.hasRole(<span class="string">&quot;schwartz&quot;</span>)</span><br><span class="line">    currentUser.isPermitted(<span class="string">&quot;lightsaber:wield&quot;</span>)</span><br><span class="line">    currentUser.logout();</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h2 id="四、SpringBoot集成Shiro"><a href="#四、SpringBoot集成Shiro" class="headerlink" title="四、SpringBoot集成Shiro"></a>四、SpringBoot集成Shiro</h2><h3 id="4-1、SpringBoot整合Shiro环境搭建"><a href="#4-1、SpringBoot整合Shiro环境搭建" class="headerlink" title="4.1、SpringBoot整合Shiro环境搭建"></a>4.1、SpringBoot整合Shiro环境搭建</h3><ol>
<li><p>新建一个项目或模块，勾选依赖</p>
<p><img src="/2022/05/02/springbootweb4/39.png" alt="image-20200729174715011"></p>
<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--thymeleaf--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>测试环境是否正常</p>
<ul>
<li><p>新建一个controller页面</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&#123;&quot;/&quot;,&quot;/index&quot;&#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toIndex</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">        model.addAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;hello,Shiro&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/user/add&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;user/add&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/user/update&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;user/update&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建一个index.html页面</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;msg&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/user/add&#125;&quot;</span>&gt;</span>add<span class="tag">&lt;/<span class="name">a</span>&gt;</span>   | <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/user/update&#125;&quot;</span>&gt;</span>update<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>新建一个add.html页面</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>add<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>新建一个update.html页面</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>update<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>项目结构</p>
<p><img src="/2022/05/02/springbootweb4/40.png" alt="image-20200729190325307"></p>
</li>
<li><p>运行截图</p>
<p><img src="/2022/05/02/springbootweb4/41.png" alt="image-20200729190548307"></p>
</li>
</ul>
</li>
<li><p>导入shiro整合spring的包——<a href="https://mvnrepository.com/artifact/org.apache.shiro/shiro-spring">官网</a>,查看最新版本</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      Subject  用户</span></span><br><span class="line"><span class="comment">      SecurityManager 管理所有用户</span></span><br><span class="line"><span class="comment">      Realm 连接数据库</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--shiro整合spring的包--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写导入配置类</p>
<ul>
<li><p>编写一个自定义类UserRealm</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//自定义的UserRealm</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span> </span>&#123;</span><br><span class="line">    <span class="comment">//授权</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行了=&gt;授权doGetAuthorizationInfo&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//认证</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken authenticationToken)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行了=&gt;认证doGetAuthorizationInfo&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写配置ShiroConfig</p>
<ul>
<li>创建realm对象，需要自定义类</li>
<li>DefaultWebSecurityManager</li>
<li>ShiroFilterFactoryBean</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShiroConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3. shiroFilterFactoryBean</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShiroFilterFactoryBean <span class="title">getShiroFilterFactoryBean</span><span class="params">(<span class="meta">@Qualifier(&quot;getDefaultWebSecurityManager&quot;)</span> DefaultWebSecurityManager defaultWebSecurityManager)</span> </span>&#123;</span><br><span class="line">        ShiroFilterFactoryBean bean = <span class="keyword">new</span> ShiroFilterFactoryBean();</span><br><span class="line">        <span class="comment">// 设置安全管理器</span></span><br><span class="line">        bean.setSecurityManager(defaultWebSecurityManager);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. DefaultWebSecurityManager</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DefaultWebSecurityManager <span class="title">getDefaultWebSecurityManager</span><span class="params">(<span class="meta">@Qualifier(&quot;userRealm&quot;)</span> UserRealm userRealm,<span class="meta">@Qualifier(&quot;sessionManager&quot;)</span> DefaultWebSessionManager sessionManager)</span> </span>&#123;</span><br><span class="line">        DefaultWebSecurityManager securityManager = <span class="keyword">new</span> DefaultWebSecurityManager();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 关联userRealm</span></span><br><span class="line">        securityManager.setRealm(userRealm);</span><br><span class="line">        securityManager.setSessionManager(sessionManager);</span><br><span class="line">        <span class="keyword">return</span> securityManager;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//1. 创建realm对象，需要自定义类</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserRealm <span class="title">userRealm</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UserRealm();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean(name = &quot;sessionManager&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DefaultWebSessionManager <span class="title">sessionManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DefaultWebSessionManager sessionManager = <span class="keyword">new</span> DefaultWebSessionManager();</span><br><span class="line">        <span class="comment">// 为了解决输入网址地址栏出现 jsessionid 的问题</span></span><br><span class="line">        sessionManager.setSessionIdUrlRewritingEnabled(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">return</span> sessionManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h3 id="4-2、Shiro实现登录拦截"><a href="#4-2、Shiro实现登录拦截" class="headerlink" title="4.2、Shiro实现登录拦截"></a>4.2、Shiro实现登录拦截</h3><ul>
<li><p>在<code>ShiroConfig</code>中的<code>getShiroFilterFactoryBean</code>方法中添加如下配置</p>
<ul>
<li>anon： 无需认证就可以访问</li>
<li>authc： 必须认证了才能访问</li>
<li>user： 必须拥有记住我功能才能用</li>
<li>perms： 拥有对某个资源的权限才能访问</li>
<li>role： 拥有某个角色权限</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map&lt;String, String&gt; filterMap = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line">filterMap.put(<span class="string">&quot;/user/add&quot;</span>,<span class="string">&quot;authc&quot;</span>);</span><br><span class="line">filterMap.put(<span class="string">&quot;/user/update&quot;</span>,<span class="string">&quot;authc&quot;</span>);</span><br><span class="line">bean.setFilterChainDefinitionMap(filterMap);</span><br></pre></td></tr></table></figure>
</li>
<li><p>点击首页的add或者update之后</p>
<p><img src="/2022/05/02/springbootweb4/42.png" alt="image-20200729191619576"></p>
</li>
<li><p>添加拦截成功页面</p>
<ul>
<li><p>登录页面login.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>登录页面<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在MyConfig中添加</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/toLogin&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>ShiroConfig</code>中的<code>getShiroFilterFactoryBean</code>方法中添加如下配置</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//设置登录的请求</span></span><br><span class="line">bean.setLoginUrl(<span class="string">&quot;/toLogin&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>拦截成功页面</p>
<p><img src="/2022/05/02/springbootweb4/43.png" alt="image-20200729192409085"></p>
</li>
</ul>
<h3 id="4-3、Shiro实现用户认证"><a href="#4-3、Shiro实现用户认证" class="headerlink" title="4.3、Shiro实现用户认证"></a>4.3、Shiro实现用户认证</h3><ol>
<li><p>在<code>MyController</code>中编写用户提交表单之后处理</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(String username, String password, Model model)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//获取一个用户</span></span><br><span class="line">    Subject subject = SecurityUtils.getSubject();</span><br><span class="line">    <span class="comment">// 封装用户的登录数据</span></span><br><span class="line">    UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(username, password);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        subject.login(token);<span class="comment">//执行登录的方法，如果没有异常就说明ok了</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (UnknownAccountException e) &#123;<span class="comment">//用户名不存在</span></span><br><span class="line">        model.addAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;用户名错误&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IncorrectCredentialsException e) &#123;<span class="comment">//密码不存在</span></span><br><span class="line">        model.addAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;密码错误&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>login.html的修改</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>登录页面<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;msg&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/login&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>用户输入登录信息</p>
<ul>
<li><p>页面</p>
<p><img src="/2022/05/02/springbootweb4/44.png" alt="image-20200729220647520"></p>
</li>
<li><p>控制台</p>
<p><img src="/2022/05/02/springbootweb4/45.png" alt="image-20200729220926500"></p>
</li>
</ul>
</li>
<li><p>用户认证编写<code>UserRealm</code>中的认证（doGetAuthenticationInfo）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//认证</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;执行了=&gt;认证doGetAuthorizationInfo&quot;</span>);</span><br><span class="line">    <span class="comment">// 用户名、密码， 数据中取</span></span><br><span class="line">    String name = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    String password = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line"></span><br><span class="line">    UsernamePasswordToken userToken = (UsernamePasswordToken) token;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!userToken.getUsername().equals(name)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;<span class="comment">//抛出异常 UnknownAccountException</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 密码认证，shiro做</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SimpleAuthenticationInfo(<span class="string">&quot;&quot;</span>,password,<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="4-4、Shiro整合Mybatis"><a href="#4-4、Shiro整合Mybatis" class="headerlink" title="4.4、Shiro整合Mybatis"></a>4.4、Shiro整合Mybatis</h3><ol>
<li><p>导入依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.23<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--引入mybatis，这是MyBatis官方提供的适配spring Boot的，而不是spring Boot自己的--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置文件application.yml的编写</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">admin</span></span><br><span class="line">    <span class="comment">#?serverTimezone=UTC解决时区的报错</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/mybatis?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#Spring Boot 默认是不注入这些属性值的，需要自己绑定</span></span><br><span class="line">    <span class="comment">#druid 数据源专有配置</span></span><br><span class="line">    <span class="attr">initialSize:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">minIdle:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">maxActive:</span> <span class="number">20</span></span><br><span class="line">    <span class="attr">maxWait:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">timeBetweenEvictionRunsMillis:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">minEvictableIdleTimeMillis:</span> <span class="number">300000</span></span><br><span class="line">    <span class="attr">validationQuery:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="string">FROM</span> <span class="string">DUAL</span></span><br><span class="line">    <span class="attr">testWhileIdle:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">testOnBorrow:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">testOnReturn:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">poolPreparedStatements:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#配置监控统计拦截的filters，stat:监控统计、log4j：日志记录、wall：防御sql注入</span></span><br><span class="line">    <span class="comment">#如果允许时报错  java.lang.ClassNotFoundException: org.apache.log4j.Priority</span></span><br><span class="line">    <span class="comment">#则导入 log4j 依赖即可，Maven 地址：https://mvnrepository.com/artifact/log4j/log4j</span></span><br><span class="line">    <span class="attr">filters:</span> <span class="string">stat,wall,log4j</span></span><br><span class="line">    <span class="attr">maxPoolPreparedStatementPerConnectionSize:</span> <span class="number">20</span></span><br><span class="line">    <span class="attr">useGlobalDataSourceStat:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">connectionProperties:</span> <span class="string">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">nuc.ss.pojo</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>User类的编写</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String pwd;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>UserMapper.xml映射</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">     <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--namespace=绑定一个对应的Dao/Mapper接口--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;nuc.ss.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;queryUserList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        select * from mybatis.user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;queryUserById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        select * from mybatis.user where id = #&#123;id&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        insert into mybatis.user (id, name, pwd) values (#&#123;id&#125;,#&#123;name&#125;,#&#123;pwd&#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        update mybatis.user set name=#&#123;name&#125;,pwd = #&#123;pwd&#125; where id = #&#123;id&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        delete from mybatis.user where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>UserService接口实现</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">queryUserByName</span><span class="params">(String name)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>UserServiceImpl业务逻辑</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserMapper userMapper;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">queryUserByName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.queryUserByName(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>测试环境</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShiroSpringbootApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(userService.queryUserByName(<span class="string">&quot;狂神&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/05/02/springbootweb4/46.png" alt="image-20200730121720922"></p>
</li>
<li><p><code>UserRealm</code>连接真实数据库</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//认证</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;执行了=&gt;认证doGetAuthorizationInfo&quot;</span>);</span><br><span class="line"></span><br><span class="line">    UsernamePasswordToken userToken = (UsernamePasswordToken) token;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 真实数据库 用户名、密码， 数据中取</span></span><br><span class="line">    User user = userService.queryUserByName(userToken.getUsername());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (user == <span class="keyword">null</span>) &#123;<span class="comment">//没有这个人</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 密码认证，shiro做</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SimpleAuthenticationInfo(<span class="string">&quot;&quot;</span>,user.getPwd(),<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/05/02/springbootweb4/47.png" alt="image-20200730180019861"></p>
</li>
<li><p>断点测试密码加密类型</p>
<ul>
<li><p>打断点Debug</p>
<p><img src="/2022/05/02/springbootweb4/48.png" alt="image-20200730182621912"></p>
</li>
<li><p>默认是<code>SimpleCredentialsMatcher</code>加密</p>
<p><img src="/2022/05/02/springbootweb4/49.png" alt="image-20200730181814293"></p>
</li>
<li><p>MD5加密——<a href="http://tool.chinaz.com/tools/md5.aspx">测试</a></p>
<p>123456——E10ADC3949BA59ABBE56E057F20F883E</p>
</li>
<li><p>MD5盐值加密</p>
</li>
<li><p>所有加密</p>
<p><img src="/2022/05/02/springbootweb4/50.png" alt="image-20200730181944253"></p>
</li>
</ul>
</li>
</ol>
<h3 id="4-5、Shiro实现用户授权"><a href="#4-5、Shiro实现用户授权" class="headerlink" title="4.5、Shiro实现用户授权"></a>4.5、Shiro实现用户授权</h3><ol>
<li><p><code>ShiroConfig</code>中的<code>getShiroFilterFactoryBean</code>方法添加认证代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//授权，正常情况下，没有授权会跳转到为授权页面</span></span><br><span class="line">filterMap.put(<span class="string">&quot;/user/add&quot;</span>,<span class="string">&quot;perms[user:add]&quot;</span>);</span><br><span class="line">filterMap.put(<span class="string">&quot;/user/update&quot;</span>,<span class="string">&quot;perms[user:update]&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>登录之后点击add按钮会弹出如下页面</p>
<p><img src="/2022/05/02/springbootweb4/51.png" alt="image-20200730195133631"></p>
</li>
<li><p>添加为授权页面</p>
<ul>
<li><p>MyController</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/noauto&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">unauthorized</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;未经授权，无法访问此页面&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>ShiroConfig</code>中的<code>getShiroFilterFactoryBean</code>方法中添加</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//为授权页面</span></span><br><span class="line">bean.setUnauthorizedUrl(<span class="string">&quot;/noauto&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>再次测试</p>
<p><img src="/2022/05/02/springbootweb4/52.png" alt="image-20200730195807437"></p>
<p><img src="/2022/05/02/springbootweb4/53.png" alt="image-20200730195946692"></p>
<p>所以需要在UserRealm中为用户进行真正授权</p>
</li>
<li><p>UserRealm类的修改</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//自定义的UserRealm</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService;</span><br><span class="line">    <span class="comment">//授权</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行了=&gt;授权doGetAuthorizationInfo&quot;</span>);</span><br><span class="line"></span><br><span class="line">        SimpleAuthorizationInfo info = <span class="keyword">new</span> SimpleAuthorizationInfo();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//拿到当前登录的这个对象</span></span><br><span class="line">        Subject subject = SecurityUtils.getSubject();</span><br><span class="line">        User currentUser = (User)subject.getPrincipal();<span class="comment">//拿到user对象</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置当前用户的权限</span></span><br><span class="line">        info.addStringPermission(currentUser.getPerms());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//认证</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        ......</span><br><span class="line">        <span class="comment">// 密码认证，shiro做</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SimpleAuthenticationInfo(user,user.getPwd(),<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>再次测试</p>
<p><img src="/2022/05/02/springbootweb4/54.png" alt="image-20200730202810034"></p>
</li>
</ol>
<h3 id="4-6、Shiro整合Thymeleaf"><a href="#4-6、Shiro整合Thymeleaf" class="headerlink" title="4.6、Shiro整合Thymeleaf"></a>4.6、Shiro整合Thymeleaf</h3><ol>
<li><p>shiro-thymeleaf整合包导入——<a href="https://mvnrepository.com/artifact/com.github.theborakompanioni/thymeleaf-extras-shiro">官网</a></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.github.theborakompanioni/thymeleaf-extras-shiro --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.theborakompanioni<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-extras-shiro<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在ShiroConfig中整合ShiroDialect</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 整合ShiroDialect： 用来整合 Shiro thymeleaf</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ShiroDialect <span class="title">getShiroDialect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ShiroDialect();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>index.html页面</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:shiro</span>=<span class="string">&quot;http://www.thymeleaf.org/thymeleaf-extras-shiro&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:shiro</span>=<span class="string">&quot;http://www.pollix.at/thymeleaf/shiro&quot;</span>&gt;</span> <span class="comment">&lt;!--新版本--&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;msg&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--用session实现，配合UserRealm中的session实现--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;div th:if=&quot;$&#123;session.loginUser==null&#125;&quot;&gt;</span></span><br><span class="line"><span class="comment">        &lt;a th:href=&quot;@&#123;/toLogin&#125;&quot;&gt;登录&lt;/a&gt;</span></span><br><span class="line"><span class="comment">    &lt;/div&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">shiro:notAuthenticated</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/toLogin&#125;&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">shiro:hasPermission</span>=<span class="string">&quot;user:add&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/user/add&#125;&quot;</span>&gt;</span>add<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">shiro:hasPermission</span>=<span class="string">&quot;user:update&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/user/update&#125;&quot;</span>&gt;</span>update<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>页面显示</p>
<p><img src="/2022/05/02/springbootweb4/55.png" alt="image-20200730205736153"></p>
</li>
</ol>
<h3 id="4-7、所有代码"><a href="#4-7、所有代码" class="headerlink" title="4.7、所有代码"></a>4.7、所有代码</h3><ul>
<li><p>ShiroConfig</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> nuc.ss.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> at.pollux.thymeleaf.shiro.dialect.ShiroDialect;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.spring.web.ShiroFilterFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.web.mgt.DefaultWebSecurityManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.LinkedHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShiroConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//shiroFilterFactoryBean</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShiroFilterFactoryBean <span class="title">getShiroFilterFactoryBean</span><span class="params">(<span class="meta">@Qualifier(&quot;getDefaultWebSecurityManager&quot;)</span> DefaultWebSecurityManager defaultWebSecurityManager)</span> </span>&#123;</span><br><span class="line">        ShiroFilterFactoryBean bean = <span class="keyword">new</span> ShiroFilterFactoryBean();</span><br><span class="line">        <span class="comment">// 设置安全管理器</span></span><br><span class="line">        bean.setSecurityManager(defaultWebSecurityManager);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加shiro的内置过滤器</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            anon： 无需认证就可以访问</span></span><br><span class="line"><span class="comment">            authc： 必须认证了才能访问</span></span><br><span class="line"><span class="comment">            user： 必须拥有记住我功能才能用</span></span><br><span class="line"><span class="comment">            perms： 拥有对某个资源的权限才能访问</span></span><br><span class="line"><span class="comment">            role： 拥有某个角色权限</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//拦截</span></span><br><span class="line">        Map&lt;String, String&gt; filterMap = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line">        <span class="comment">//filterMap.put(&quot;/user/add&quot;,&quot;authc&quot;);</span></span><br><span class="line">        <span class="comment">//filterMap.put(&quot;/user/update&quot;,&quot;authc&quot;);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//授权，正常情况下，没有授权会跳转到为授权页面</span></span><br><span class="line">        filterMap.put(<span class="string">&quot;/user/add&quot;</span>,<span class="string">&quot;perms[user:add]&quot;</span>);</span><br><span class="line">        filterMap.put(<span class="string">&quot;/user/update&quot;</span>,<span class="string">&quot;perms[user:update]&quot;</span>);</span><br><span class="line"></span><br><span class="line">        filterMap.put(<span class="string">&quot;/user/*&quot;</span>,<span class="string">&quot;authc&quot;</span>);</span><br><span class="line"></span><br><span class="line">        bean.setFilterChainDefinitionMap(filterMap);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置登录的请求</span></span><br><span class="line">        bean.setLoginUrl(<span class="string">&quot;/toLogin&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//为授权页面</span></span><br><span class="line">        bean.setUnauthorizedUrl(<span class="string">&quot;/noauto&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//DefaultWebSecurityManager</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DefaultWebSecurityManager <span class="title">getDefaultWebSecurityManager</span><span class="params">(<span class="meta">@Qualifier(&quot;userRealm&quot;)</span> UserRealm userRealm)</span> </span>&#123;</span><br><span class="line">        DefaultWebSecurityManager securityManager = <span class="keyword">new</span> DefaultWebSecurityManager();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 关联userRealm</span></span><br><span class="line">        securityManager.setRealm(userRealm);</span><br><span class="line">        <span class="keyword">return</span> securityManager;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//创建realm对象，需要自定义类</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserRealm <span class="title">userRealm</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UserRealm();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 整合ShiroDialect： 用来整合 Shiro thymeleaf</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShiroDialect <span class="title">getShiroDialect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ShiroDialect();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>UserRealm</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> nuc.ss.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> nuc.ss.pojo.User;</span><br><span class="line"><span class="keyword">import</span> nuc.ss.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.AuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.SimpleAuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.realm.AuthorizingRealm;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.session.Session;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.PrincipalCollection;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.Subject;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="comment">//自定义的UserRealm</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService;</span><br><span class="line">    <span class="comment">//授权</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行了=&gt;授权doGetAuthorizationInfo&quot;</span>);</span><br><span class="line"></span><br><span class="line">        SimpleAuthorizationInfo info = <span class="keyword">new</span> SimpleAuthorizationInfo();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//info.addStringPermission(&quot;user:add&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//拿到当前登录的这个对象</span></span><br><span class="line">        Subject subject = SecurityUtils.getSubject();</span><br><span class="line">        User currentUser = (User)subject.getPrincipal();<span class="comment">//拿到user对象</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置当前用户的权限</span></span><br><span class="line">        info.addStringPermission(currentUser.getPerms());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//认证</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行了=&gt;认证doGetAuthorizationInfo&quot;</span>);</span><br><span class="line"></span><br><span class="line">        UsernamePasswordToken userToken = (UsernamePasswordToken) token;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 虚拟用户</span></span><br><span class="line">        <span class="comment">//String name = &quot;root&quot;;</span></span><br><span class="line">        <span class="comment">//String password = &quot;123456&quot;;</span></span><br><span class="line">        <span class="comment">//if (!userToken.getUsername().equals(name)) &#123;</span></span><br><span class="line">        <span class="comment">//    return null;//抛出异常 UnknownAccountException</span></span><br><span class="line">        <span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 真实数据库 用户名、密码， 数据中取</span></span><br><span class="line">        User user = userService.queryUserByName(userToken.getUsername());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (user == <span class="keyword">null</span>) &#123;<span class="comment">//没有这个人</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//首页</span></span><br><span class="line">        <span class="comment">//Subject currentSubject = SecurityUtils.getSubject();</span></span><br><span class="line">        <span class="comment">//Session session = currentSubject.getSession();</span></span><br><span class="line">        <span class="comment">//session.setAttribute(&quot;loginUser&quot;,user);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 密码认证，shiro做</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SimpleAuthenticationInfo(user,user.getPwd(),<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>MyController</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> nuc.ss.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.IncorrectCredentialsException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.UnknownAccountException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.Subject;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&#123;&quot;/&quot;,&quot;/index&quot;&#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toIndex</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">        model.addAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;hello,Shiro&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/user/add&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;user/add&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/user/update&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;user/update&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/toLogin&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toLogin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(String username, String password, Model model)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//获取一个用户</span></span><br><span class="line">        Subject subject = SecurityUtils.getSubject();</span><br><span class="line">        <span class="comment">// 封装用户的登录数据</span></span><br><span class="line">        UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(username, password);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            subject.login(token);<span class="comment">//执行登录的方法，如果没有异常就说明ok了</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnknownAccountException e) &#123;<span class="comment">//用户名不存在</span></span><br><span class="line">            model.addAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;用户名错误&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IncorrectCredentialsException e) &#123;<span class="comment">//密码不存在</span></span><br><span class="line">            model.addAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;密码错误&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/noauto&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">unauthorized</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;未经授权，无法访问此页面&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>pom依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>nuc.ss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-springboot<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>shiro-springboot<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring-boot.version</span>&gt;</span>2.3.0.RELEASE<span class="tag">&lt;/<span class="name">spring-boot.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            Subject  用户</span></span><br><span class="line"><span class="comment">            SecurityManager 管理所有用户</span></span><br><span class="line"><span class="comment">            Realm 连接数据库</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--shiro-thymeleaf整合--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.github.theborakompanioni/thymeleaf-extras-shiro --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.theborakompanioni<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-extras-shiro<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.23<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--引入mybatis，这是MyBatis官方提供的适配spring Boot的，而不是spring Boot自己的--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--shiro整合spring的包--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--thymeleaf--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ul>
]]></content>
      <categories>
        <category>springboot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
      </tags>
  </entry>
  <entry>
    <title>vuex</title>
    <url>/2022/04/11/vuex/</url>
    <content><![CDATA[<h1 id="vuex"><a href="#vuex" class="headerlink" title="vuex"></a>vuex</h1><p>安装</p>
<p>npm</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install vuex@next --save</span><br></pre></td></tr></table></figure>
<p>Yarn</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yarn add vuex@next --save</span><br></pre></td></tr></table></figure>
<h2 id="1-入门"><a href="#1-入门" class="headerlink" title="1. 入门"></a>1. 入门</h2><p>Vuex 之后，让我们来创建一个 store。创建过程直截了当——仅需要提供一个初始 state 对象和一些 mutation：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个新的 store 实例</span></span><br><span class="line"><span class="keyword">const</span> store = createStore(&#123;</span><br><span class="line">  state () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    increment (state) &#123;</span><br><span class="line">      state.count++</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = createApp(&#123; <span class="comment">/* 根组件 */</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将 store 实例作为插件安装</span></span><br><span class="line">app.use(store)</span><br></pre></td></tr></table></figure>
<p>现在，你可以通过 <code>store.state</code> 来获取状态对象，并通过 <code>store.commit</code> 方法触发状态变更：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">store.commit(<span class="string">&#x27;increment&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(store.state.count) <span class="comment">// -&gt; 1</span></span><br></pre></td></tr></table></figure>
<p>在 Vue 组件中， 可以通过 <code>this.$store</code> 访问store实例。现在我们可以从组件的方法提交一个变更：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  <span class="function"><span class="title">increment</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.$store.commit(<span class="string">&#x27;increment&#x27;</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.$store.state.count)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再次强调，我们通过提交 mutation 的方式，而非直接改变 <code>store.state.count</code>，是因为我们想要更明确地追踪到状态的变化。这个简单的约定能够让你的意图更加明显，这样你在阅读代码的时候能更容易地解读应用内部的状态改变。此外，这样也让我们有机会去实现一些能记录每次状态改变，保存状态快照的调试工具。有了它，我们甚至可以实现如时间穿梭般的调试体验。</p>
<p>由于 store 中的状态是响应式的，在组件中调用 store 中的状态简单到仅需要在计算属性中返回即可。触发变化也仅仅是在组件的 methods 中提交 mutation。</p>
<h2 id="2-单独抽取store"><a href="#2-单独抽取store" class="headerlink" title="2. 单独抽取store"></a>2. 单独抽取store</h2><ul>
<li>一般来说我们不会将store的定义写到main.js中。</li>
<li>一般是单独的建立一个store文件夹，创建index.js文件，在index.js中编写store并且导出</li>
</ul>
<p>index.js:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&quot;vuex&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(&#123;</span><br><span class="line">    <span class="function"><span class="title">state</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">count</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>: &#123;</span><br><span class="line">        <span class="function"><span class="title">increment</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">            state.count++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<p>main.js</p>
<ul>
<li>注意导入时 以’@/‘符号开头代表绝对路径，导入文件夹下的index.js时可以之间导入其父文件夹</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"></span><br><span class="line">createApp(App).use(router).use(store).mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="3-state"><a href="#3-state" class="headerlink" title="3. state"></a>3. state</h2><p>Vuex 使用<strong>单一状态树</strong>，这也意味着，每个应用将仅仅包含一个 store 实例。</p>
<h3 id="3-1-在-Vue-组件中获得-Vuex-状态"><a href="#3-1-在-Vue-组件中获得-Vuex-状态" class="headerlink" title="3.1 在 Vue 组件中获得 Vuex 状态"></a>3.1 在 Vue 组件中获得 Vuex 状态</h3><p>那么我们如何在 Vue 组件中展示状态呢？由于 Vuex 的状态存储是响应式的，从 store 实例中读取状态最简单的方法就是在<a href="https://cn.vuejs.org/guide/computed.html">计算属性</a>中返回某个状态：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建一个 Counter 组件</span></span><br><span class="line"><span class="keyword">const</span> Counter = &#123;</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`&lt;div&gt;&#123;&#123; count &#125;&#125;&lt;/div&gt;`</span>,</span><br><span class="line">  <span class="attr">computed</span>: &#123;</span><br><span class="line">    count () &#123;</span><br><span class="line">      <span class="keyword">return</span> store.state.count</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>每当 <code>store.state.count</code> 变化的时候, 都会重新求取计算属性，并且触发更新相关联的 DOM。</p>
<h3 id="3-2-mapState-辅助函数"><a href="#3-2-mapState-辅助函数" class="headerlink" title="3.2 mapState 辅助函数"></a>3.2 <code>mapState</code> 辅助函数</h3><p>当一个组件需要获取多个状态的时候，将这些状态都声明为计算属性会有些重复和冗余。为了解决这个问题，我们可以使用 <code>mapState</code> 辅助函数帮助我们生成计算属性，让你少按几次键：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 在单独构建的版本中辅助函数为 Vuex.mapState</span></span><br><span class="line"><span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">computed</span>: mapState(&#123;</span><br><span class="line">    <span class="comment">// 箭头函数可使代码更简练</span></span><br><span class="line">    <span class="attr">count</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.count,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 传字符串参数 &#x27;count&#x27; 等同于 `state =&gt; state.count`</span></span><br><span class="line">    <span class="attr">countAlias</span>: <span class="string">&#x27;count&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为了能够使用 `this` 获取局部状态，必须使用常规函数</span></span><br><span class="line">    countPlusLocalState (state) &#123;</span><br><span class="line">      <span class="keyword">return</span> state.count + <span class="built_in">this</span>.localCount</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当映射的计算属性的名称与 state 的子节点名称相同时，我们也可以给 <code>mapState</code> 传一个字符串数组。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">computed: mapState([</span><br><span class="line">  <span class="comment">// 映射 this.count 为 store.state.count</span></span><br><span class="line">  <span class="string">&#x27;count&#x27;</span></span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<h3 id="3-3-对象展开运算符（合并计算属性和mapState）"><a href="#3-3-对象展开运算符（合并计算属性和mapState）" class="headerlink" title="3.3 对象展开运算符（合并计算属性和mapState）"></a>3.3 对象展开运算符（合并计算属性和mapState）</h3><p><code>mapState</code> 函数返回的是一个对象。我们如何将它与局部计算属性混合使用呢？通常，我们需要使用一个工具函数将多个对象合并为一个，以使我们可以将最终对象传给 <code>computed</code> 属性。但是自从有了<a href="https://github.com/tc39/proposal-object-rest-spread">对象展开运算符</a>，我们可以极大地简化写法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  localComputed () &#123; <span class="comment">/* ... */</span> &#125;,</span><br><span class="line">  <span class="comment">// 使用对象展开运算符将此对象混入到外部对象中</span></span><br><span class="line">  ...mapState(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-getters"><a href="#4-getters" class="headerlink" title="4. getters"></a>4. getters</h2><p>有时候我们需要从 store 中的 state 中派生出一些状态，例如对列表进行过滤并计数：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  doneTodosCount () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.$store.state.todos.filter(<span class="function"><span class="params">todo</span> =&gt;</span> todo.done).length</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果有多个组件需要用到此属性，我们要么复制这个函数，或者抽取到一个共享函数然后在多处导入它——无论哪种方式都不是很理想。</p>
<p>Getter 接受 state 作为其第一个参数：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> store = createStore(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">todos</span>: [</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">&#x27;...&#x27;</span>, <span class="attr">done</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">&#x27;...&#x27;</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="attr">doneTodos</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> state.todos.filter(<span class="function"><span class="params">todo</span> =&gt;</span> todo.done)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="4-1-通过属性访问"><a href="#4-1-通过属性访问" class="headerlink" title="4.1 通过属性访问"></a>4.1 通过属性访问</h3><p>Getter 会暴露为 <code>store.getters</code> 对象，你可以以属性的形式访问这些值：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">store.getters.doneTodos <span class="comment">// -&gt; [&#123; id: 1, text: &#x27;...&#x27;, done: true &#125;]</span></span><br></pre></td></tr></table></figure>
<p>Getter 也可以接受其他 getter 作为第二个参数：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">getters: &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  doneTodosCount (state, getters) &#123;</span><br><span class="line">    <span class="keyword">return</span> getters.doneTodos.length</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">store.getters.doneTodosCount <span class="comment">// -&gt; 1</span></span><br></pre></td></tr></table></figure>
<p>我们可以很容易地在任何组件中使用它：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  doneTodosCount () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.$store.getters.doneTodosCount</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意，getter 在通过属性访问时是作为 Vue 的响应式系统的一部分缓存其中的。</p>
<h3 id="（选学）通过方法访问"><a href="#（选学）通过方法访问" class="headerlink" title="（选学）通过方法访问"></a>（选学）通过方法访问</h3><p>你也可以通过让 getter 返回一个函数，来实现给 getter 传参。在你对 store 里的数组进行查询时非常有用。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">getters: &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">getTodoById</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> state.todos.find(<span class="function"><span class="params">todo</span> =&gt;</span> todo.id === id)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">store.getters.getTodoById(<span class="number">2</span>) <span class="comment">// -&gt; &#123; id: 2, text: &#x27;...&#x27;, done: false &#125;</span></span><br></pre></td></tr></table></figure>
<p>注意，getter 在通过方法访问时，每次都会去进行调用，而不会缓存结果。</p>
<h3 id="mapGetters-辅助函数"><a href="#mapGetters-辅助函数" class="headerlink" title="mapGetters 辅助函数"></a><code>mapGetters</code> 辅助函数</h3><p><code>mapGetters</code> 辅助函数仅仅是将 store 中的 getter 映射到局部计算属性：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapGetters &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">computed</span>: &#123;</span><br><span class="line">  <span class="comment">// 使用对象展开运算符将 getter 混入 computed 对象中</span></span><br><span class="line">    ...mapGetters([</span><br><span class="line">      <span class="string">&#x27;doneTodosCount&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;anotherGetter&#x27;</span>,</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    ])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果你想将一个 getter 属性另取一个名字，使用对象形式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">...mapGetters(&#123;</span><br><span class="line">  <span class="comment">// 把 `this.doneCount` 映射为 `this.$store.getters.doneTodosCount`</span></span><br><span class="line">  <span class="attr">doneCount</span>: <span class="string">&#x27;doneTodosCount&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="5-mutations"><a href="#5-mutations" class="headerlink" title="5. mutations"></a>5. mutations</h2><h3 id="带额外参数的提交"><a href="#带额外参数的提交" class="headerlink" title="带额外参数的提交"></a>带额外参数的提交</h3><p>你可以向 <code>store.commit</code> 传入额外的参数，即 mutation 的<strong>载荷（payload）</strong>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="attr">mutations</span>: &#123;</span><br><span class="line">  increment (state, n) &#123;</span><br><span class="line">    state.count += n</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">store.commit(<span class="string">&#x27;increment&#x27;</span>, <span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<p>在大多数情况下，载荷应该是一个对象，这样可以包含多个字段并且记录的 mutation 会更易读：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="attr">mutations</span>: &#123;</span><br><span class="line">  increment (state, payload) &#123;</span><br><span class="line">    state.count += payload.amount</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">store.commit(<span class="string">&#x27;increment&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">amount</span>: <span class="number">10</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="使用常量替代-Mutation-事件类型"><a href="#使用常量替代-Mutation-事件类型" class="headerlink" title="使用常量替代 Mutation 事件类型"></a>使用常量替代 Mutation 事件类型</h3><p>使用常量替代 mutation 事件类型在各种 Flux 实现中是很常见的模式。这样可以使 linter 之类的工具发挥作用，同时把这些常量放在单独的文件中可以让你的代码合作者对整个 app 包含的 mutation 一目了然：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// mutation-types.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SOME_MUTATION = <span class="string">&#x27;SOME_MUTATION&#x27;</span></span><br><span class="line"><span class="comment">// store.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; SOME_MUTATION &#125; <span class="keyword">from</span> <span class="string">&#x27;./mutation-types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123; ... &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="comment">// 我们可以使用 ES2015 风格的计算属性命名功能来使用一个常量作为函数名</span></span><br><span class="line">    [SOME_MUTATION] (state) &#123;</span><br><span class="line">      <span class="comment">// 修改 state</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>用不用常量取决于你——在需要多人协作的大型项目中，这会很有帮助。但如果你不喜欢，你完全可以不这样做。</p>
<h3 id="Mutation-必须是同步函数"><a href="#Mutation-必须是同步函数" class="headerlink" title="Mutation 必须是同步函数"></a>Mutation 必须是同步函数</h3><p>一条重要的原则就是要记住 <strong>mutation 必须是同步函数</strong>。</p>
<p>Mutation 中的异步操作可能会导致调试时快照数据和真实数据不一致</p>
<p>异步操作写在actions中</p>
<h2 id="6-action"><a href="#6-action" class="headerlink" title="6. action"></a>6. action</h2><p>Action 类似于 mutation，不同在于：</p>
<ul>
<li>Action 提交的是 mutation，而不是直接变更状态。</li>
<li>Action 可以包含任意异步操作。</li>
</ul>
<p>让我们来注册一个简单的 action：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> store = createStore(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    increment (state) &#123;</span><br><span class="line">      state.count++</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    increment (context) &#123;</span><br><span class="line">      context.commit(<span class="string">&#x27;increment&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Action 函数接受一个与 store 实例具有相同方法和属性的 context 对象，因此你可以调用 <code>context.commit</code> 提交一个 mutation，或者通过 <code>context.state</code> 和 <code>context.getters</code> 来获取 state 和 getters。</p>
<p>实践中，我们会经常用到 ES2015 的<a href="https://github.com/lukehoban/es6features#destructuring">参数解构</a>来简化代码（特别是我们需要调用 <code>commit</code> 很多次的时候）：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">actions: &#123;</span><br><span class="line">  increment (&#123; commit &#125;) &#123;</span><br><span class="line">    commit(<span class="string">&#x27;increment&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="分发-Action"><a href="#分发-Action" class="headerlink" title="分发 Action"></a>分发 Action</h3><p>Action 通过 <code>store.dispatch</code> 方法触发：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">store.dispatch(<span class="string">&#x27;increment&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="在组件中分发-Action"><a href="#在组件中分发-Action" class="headerlink" title="在组件中分发 Action"></a>在组件中分发 Action</h3><p>你在组件中使用 <code>this.$store.dispatch(&#39;xxx&#39;)</code> 分发 action，或者使用 <code>mapActions</code> 辅助函数将组件的 methods 映射为 <code>store.dispatch</code> 调用（需要先在根节点注入 <code>store</code>）：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapActions &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    ...mapActions([</span><br><span class="line">      <span class="string">&#x27;increment&#x27;</span>, <span class="comment">// 将 `this.increment()` 映射为 `this.$store.dispatch(&#x27;increment&#x27;)`</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// `mapActions` 也支持载荷：</span></span><br><span class="line">      <span class="string">&#x27;incrementBy&#x27;</span> <span class="comment">// 将 `this.incrementBy(amount)` 映射为 `this.$store.dispatch(&#x27;incrementBy&#x27;, amount)`</span></span><br><span class="line">    ]),</span><br><span class="line">    ...mapActions(&#123;</span><br><span class="line">      <span class="attr">add</span>: <span class="string">&#x27;increment&#x27;</span> <span class="comment">// 将 `this.add()` 映射为 `this.$store.dispatch(&#x27;increment&#x27;)`</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="7-module"><a href="#7-module" class="headerlink" title="7. module"></a>7. module</h2><p>由于使用单一状态树，应用的所有状态会集中到一个比较大的对象。当应用变得非常复杂时，store 对象就有可能变得相当臃肿。</p>
<p>为了解决以上问题，Vuex 允许我们将 store 分割成<strong>模块（module）</strong>。每个模块拥有自己的 state、mutation、action、getter、甚至是嵌套子模块——从上至下进行同样方式的分割：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> moduleA = &#123;</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123; ... &#125;),</span><br><span class="line">  <span class="attr">mutations</span>: &#123; ... &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123; ... &#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123; ... &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> moduleB = &#123;</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123; ... &#125;),</span><br><span class="line">  <span class="attr">mutations</span>: &#123; ... &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123; ... &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(&#123;</span><br><span class="line">  <span class="attr">modules</span>: &#123;</span><br><span class="line">    <span class="attr">a</span>: moduleA,</span><br><span class="line">    <span class="attr">b</span>: moduleB</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">store.state.a <span class="comment">// -&gt; moduleA 的状态</span></span><br><span class="line">store.state.b <span class="comment">// -&gt; moduleB 的状态</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>vue</category>
      </categories>
      <tags>
        <tag>vuex</tag>
      </tags>
  </entry>
  <entry>
    <title>xml</title>
    <url>/2021/11/28/xml/</url>
    <content><![CDATA[<h3 id="一、XML基础"><a href="#一、XML基础" class="headerlink" title="一、XML基础"></a>一、XML基础</h3><h5 id="1．概念"><a href="#1．概念" class="headerlink" title="1．概念:"></a>1．概念:</h5><p>Extensible Markup Language可扩展标记语言</p>
<ul>
<li><p>可扩展∶</p>
<p>标签都是自定义的。<user> <student></student></user></p>
</li>
<li><p>功能</p>
<p>字存储数据</p>
<p>1．配置文件</p>
<p>2．在网络中传输</p>
</li>
<li><p>xm1与html的区别</p>
</li>
</ul>
<ol>
<li>xml标签都是自定义的，html标签是预定义。</li>
<li>xml的语法严格，html语法松散</li>
<li>xml是存储数据的，html是展示数据</li>
</ol>
<h5 id="2-语法"><a href="#2-语法" class="headerlink" title="2. 语法"></a>2. 语法</h5><ul>
<li><p>基本语法︰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. xml文档的后缀名.xml</span><br><span class="line">2. xml第一行必须定义为文档声明</span><br><span class="line">3. xml文档中有且仅有一个根标签</span><br><span class="line"></span><br><span class="line">4. 属性值必须使用引号(单双都可)引起来</span><br><span class="line">5. 标签必须正确关闭</span><br><span class="line">6.  xml标签名称区分大小写</span><br></pre></td></tr></table></figure>
</li>
<li><p>快速入门</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&#x27;1.0&#x27; ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">users</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">user</span> <span class="attr">id</span> = <span class="string">&#x27;1&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>神仙<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">age</span>&gt;</span>10<span class="tag">&lt;/<span class="name">age</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">user</span> <span class="attr">id</span> = <span class="string">&#x27;2&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>神仙1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">age</span>&gt;</span>100<span class="tag">&lt;/<span class="name">age</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">users</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>组成部分</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.文档声明</span><br><span class="line">	1.格式：&lt;?xml 属性列表 ?&gt;</span><br><span class="line">	2.属性列表：</span><br><span class="line">		* version：版本号</span><br><span class="line">		* encoding：编码方式。告知解析引擎当前文档使用的字符集</span><br><span class="line">		* standalone: 是否独立(不重要)</span><br><span class="line">			1. yes</span><br><span class="line">			2. no</span><br><span class="line">2.指令(不重要)</span><br><span class="line">3.标签：名称自定义</span><br><span class="line">4.属性：</span><br><span class="line">	* id属性值唯一</span><br><span class="line">5.文本：</span><br><span class="line">	* CDATA区 --该区域的数据原样展示</span><br><span class="line">		格式：</span><br><span class="line">			&lt;![CDATA[数据]]&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="二、XML约束"><a href="#二、XML约束" class="headerlink" title="二、XML约束"></a>二、XML约束</h3><h5 id="基础："><a href="#基础：" class="headerlink" title="基础："></a>基础：</h5><p><strong>约束:规定xml文档的书写规则</strong></p>
<p>作为框架的使用者(程序员)∶</p>
<p>1．能够在xml中引入约束文档</p>
<p>2．能够简单的读懂约束文档</p>
<ul>
<li><p>分类:</p>
<ol>
<li><p>DTD:—种简单的约束技术</p>
</li>
<li><p>schema:—种复杂的约束技术</p>
</li>
</ol>
</li>
</ul>
<h5 id="引入："><a href="#引入：" class="headerlink" title="引入："></a>引入：</h5><ul>
<li><p>DTD ∶</p>
<p>引入人dtd文档到xml文档中</p>
<ul>
<li><p>内部dtd :将约束规则定义在xml文档中</p>
<ul>
<li><img src="/2021/11/28/xml/1.png" alt="img"></li>
</ul>
</li>
<li><p>外部dtd:将约束的规则定义在外部的dtd文件中</p>
<p>本地:<DOCTYPE 根标签名 system "dtd文件的位置"></DOCTYPE></p>
<p>网络:&lt;!DOCTYPE 根标签名PUBLIC “dtd文件名字””dtd文件的位置URL”&gt;</p>
<p><img src="/2021/11/28/xml/2.png" alt></p>
<p><img src="/2021/11/28/xml/3.png" alt></p>
</li>
</ul>
</li>
<li><p>schema:</p>
<p>引入：</p>
<ol>
<li><p>填写xml文档的根元素</p>
</li>
<li><p>引入xsi前缀． xmlns:xsi=”http: / / www .w3.org/2001/XMLSchema-instance”</p>
</li>
<li><p>引入xsd文件命名空间. xsi:schemaLocation=”http: / / www.itcast.cn/xml student.xsd”</p>
</li>
<li><p>为每一个xsd约束声明一个前缀,作为标识xmlns=”http: / / www.itcast.cn/xml “</p>
</li>
</ol>
<p><img src="/2021/11/28/xml/4.png" alt></p>
</li>
</ul>
<h5 id="解析："><a href="#解析：" class="headerlink" title="解析："></a>解析：</h5><p><strong>操作xml文档，将文档中的数据读取到内存中</strong> </p>
<ul>
<li><p>操作xml文档</p>
<p>1．解析(读取):将文档中的数据读取到内存中</p>
<p>2．写入:将内存中的数据保存到xml文档中。持久化的存储</p>
</li>
<li><p>解析xml的方式:</p>
<ol>
<li><p>DOM∶将标记语言文档一次性加载进内存，在内存中形成一颗dom树（服务器）</p>
<ul>
<li><p>优点∶操作方便，可以对文档进行CRUD的所有操作</p>
</li>
<li><p>缺点:占内存</p>
</li>
</ul>
</li>
<li><p>SAX∶逐行读取，基于事件驱动的。（手机）</p>
<ul>
<li><p>优点:不占内存。</p>
</li>
<li><p>缺点:只能读耿，不能增删改</p>
</li>
</ul>
</li>
</ol>
</li>
</ul>
<h6 id="常见的解析器"><a href="#常见的解析器" class="headerlink" title="常见的解析器"></a>常见的解析器</h6><ol>
<li><p>JAXP: sun公司提供的解析器，支持dom，sax两种思想（基本不用）</p>
</li>
<li><p>DOM4J ：dom4j是一个Java的XML API，是jdom的升级品，用来读写XML文件的。</p>
</li>
<li><p>Jsoup：jsoup 是一款Java 的HTML解析器，可直接解析某个URL地址、HTML文本内容。它提供了一套非常省力的API，可通过DOM，CSS以及类似于jQuery的操作方法来取出和操作数据。</p>
</li>
<li><p>PULL:android操作系统内置解析器，sax方式</p>
</li>
</ol>
<h6 id="Jsoup学习"><a href="#Jsoup学习" class="headerlink" title="Jsoup学习"></a>Jsoup学习</h6><p>对象的使用∶</p>
<p>1.Jsoup :工具类，可以解析html或xml文档，返回Document</p>
<ul>
<li><p>parse :解析html或xml文档，返回Document</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">parse(File in，String charsetName):解析xml或html文件的。</span><br><span class="line"></span><br><span class="line">parse(string str):解析xml或html字符串(str是xml或html内容)</span><br><span class="line"></span><br><span class="line">parse(URL url, int timeoutMillis):通过网络路径获取指定的html或xml的文档对象</span><br></pre></td></tr></table></figure>
<p><strong>网络url获取</strong></p>
<p><img src="/2021/11/28/xml/5.png" alt></p>
</li>
</ul>
<ol>
<li><p>Document :文档对象。代表内存中的dom树</p>
<ul>
<li><p>获取element对象</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">getElementsByTag(String name) ----根据标签名称获取</span><br><span class="line">getElementsByAttribute(string key):根据属性名称获取元素对象集合</span><br><span class="line">getElementsByAttributeValue(string key,string value):根据对应的属性名和属性值获取元素对象</span><br><span class="line">getElementById(String id): 根据id属性值获取唯一的元素</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Elements ∶元素Element对象的集合。可以当做 ArrayList<Element>来使用4. Element :元秦对象</Element></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 获取子元素对象</span><br><span class="line">	getElementsByTag(String name) ----根据标签名称获取</span><br><span class="line">    getElementsByAttribute(string key):根据属性名称获取元素对象集合</span><br><span class="line">    getElementsByAttributeValue(string key,string value):根据对应的属性名和属性值获取元素对象</span><br><span class="line">    getElementById(String id): 根据id属性值获取唯一的元素</span><br><span class="line">    child(int index) : 返回第几个子元素</span><br><span class="line">2. 获取属性值</span><br><span class="line">	String attr(String key):根据属性名称获取属性值</span><br><span class="line">3. 获取文本内容</span><br><span class="line">	String text():获取文本内容</span><br><span class="line">	String html():获取标签体的所有内容(包括子标签&lt;&gt;的内容)</span><br></pre></td></tr></table></figure>
</li>
<li><p>Node :节点对象</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">document和element的父类</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h6 id="基础入门"><a href="#基础入门" class="headerlink" title="基础入门"></a>基础入门</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import org.jsoup.nodes.Document;</span><br><span class="line">import org.jsoup.nodes.Element;</span><br><span class="line">import org.jsoup.select.Elements;</span><br><span class="line">import java.io.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class xml_analysis &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        //获取Document对象，根据xml文档获取</span><br><span class="line">        //1.获取student.xml的path</span><br><span class="line">        String path = xml_analysis.class.getClassLoader().getResource(&quot;test.xml&quot;).getPath();</span><br><span class="line">        //2. 解析xml文档，加载文档进内存，获取dom树 ----&gt;document</span><br><span class="line">        Document dom = Jsoup.parse(new File(path),&quot;utf-8&quot;);</span><br><span class="line">        //3. 获取元素对象Element</span><br><span class="line">        Elements student_list = dom.getElementsByTag(&quot;student&quot;);</span><br><span class="line">        System.out.println(student_list.size());</span><br><span class="line">        for (Element element : student_list) &#123;</span><br><span class="line">            System.out.println(element.child(3).text());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="快捷查询"><a href="#快捷查询" class="headerlink" title="快捷查询"></a>快捷查询</h6><ol>
<li><p>select:选择器</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">document.select(String cssQuery)</span><br><span class="line">其中cssQuery语法与css选择器类似</span><br><span class="line">1.选择标签名 ： 直接写eg： ”name“</span><br><span class="line">2.选择id #号+值 ：eg &quot;#test&quot; (注意test是id的值)</span><br><span class="line">3.获取指定标签含有指定属性值的元素 ： eg &quot;student[number=&#x27;1000&#x27;]&quot;  (其中student是标签，number是属性值)</span><br><span class="line">...</span><br><span class="line">根据Selector类中定义的语法来选择</span><br></pre></td></tr></table></figure>
</li>
<li><p>Xpath：XML路径语言，它是一种用来确定XML文档中某部分位置的语言。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">使用：</span><br><span class="line">	1.获取xml文件路径</span><br><span class="line">	2.获取document对象</span><br><span class="line">	3.根据document对象，创建JXDocument对象</span><br><span class="line">		JXDocument jxDocument = new JXDocument(dom);</span><br><span class="line">	4.结合xpath语法查询</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>   选取节点 XPath 使用路径表达式在 XML 文档中选取节点。节点是通过沿着路径或者 step 来选取的。</p>
<p>   下面列出了最有用的路径表达式：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>表达式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>nodename</td>
<td>选取此节点的所有子节点。</td>
</tr>
<tr>
<td>/</td>
<td>从根节点选取。</td>
</tr>
<tr>
<td>//</td>
<td>从匹配选择的当前节点选择文档中的节点，而不考虑它们的位置。</td>
</tr>
<tr>
<td>.</td>
<td>选取当前节点。</td>
</tr>
<tr>
<td>..</td>
<td>选取当前节点的父节点。</td>
</tr>
<tr>
<td>@</td>
<td>选取属性。</td>
</tr>
</tbody>
</table>
</div>
<p>   在下面的表格中，我们已列出了一些路径表达式以及表达式的结果：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>路径表达式</th>
<th>结果</th>
</tr>
</thead>
<tbody>
<tr>
<td>bookstore</td>
<td>选取 bookstore 元素的所有子节点。</td>
</tr>
<tr>
<td>/bookstore</td>
<td>选取根元素 bookstore。注释：假如路径起始于正斜杠( / )，则此路径始终代表到某元素的绝对路径！</td>
</tr>
<tr>
<td>bookstore/book</td>
<td>选取属于 bookstore 的子元素的所有 book 元素。</td>
</tr>
<tr>
<td>//book</td>
<td>选取所有 book 子元素，而不管它们在文档中的位置。</td>
</tr>
<tr>
<td>bookstore//book</td>
<td>选择属于 bookstore 元素的后代的所有 book 元素，而不管它们位于 bookstore 之下的什么位置。</td>
</tr>
<tr>
<td>//@lang</td>
<td>选取名为 lang 的所有属性。</td>
</tr>
</tbody>
</table>
</div>
]]></content>
      <categories>
        <category>xml</category>
      </categories>
      <tags>
        <tag>xml学习</tag>
      </tags>
  </entry>
  <entry>
    <title>ssmvueproject</title>
    <url>/2022/04/13/ssmvueproject/</url>
    <content><![CDATA[<h1 id="SSM基础项目从零搭建"><a href="#SSM基础项目从零搭建" class="headerlink" title="SSM基础项目从零搭建"></a>SSM基础项目从零搭建</h1><h2 id="一、创建码云仓库"><a href="#一、创建码云仓库" class="headerlink" title="#一、创建码云仓库"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#一、创建码云仓库">#</a>一、创建码云仓库</h2><p>1、登陆码云，选择右上角的“+”按钮，选择新建仓库：</p>
<blockquote>
<p>仓库地址：<a href="https://gitee.com/zhangnan716/ydl-ssm.git">https://gitee.com/zhangnan716/ydl-ssm.git</a></p>
</blockquote>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220119183623974.4020a0f0.png" alt="image-20220119183623974"></p>
<p>2、新建仓库的具体信息：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220119184029717.d791009d.png" alt="image-20220119184029717"></p>
<p>3、使用git命令克隆我们的仓库至本地：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220119184130735.f8dbdc03.png" alt="image-20220119184130735"></p>
<p>我的仓库命令如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://gitee.com/zhangnan716/ydl-ssm-pro.git</span><br></pre></td></tr></table></figure>
<p>可以新增一个.gitignore文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">HELP.md</span><br><span class="line">target/</span><br><span class="line">!.mvn/wrapper/maven-wrapper.jar</span><br><span class="line">!**/src/main/**</span><br><span class="line">!**/src/<span class="built_in">test</span>/**</span><br><span class="line"></span><br><span class="line"><span class="comment">### STS ###</span></span><br><span class="line">.apt_generated</span><br><span class="line">.classpath</span><br><span class="line">.factorypath</span><br><span class="line">.project</span><br><span class="line">.settings</span><br><span class="line">.springBeans</span><br><span class="line">.sts4-cache</span><br><span class="line"></span><br><span class="line"><span class="comment">### IntelliJ IDEA ###</span></span><br><span class="line">.idea</span><br><span class="line">*.iws</span><br><span class="line">*.iml</span><br><span class="line">*.ipr</span><br><span class="line"></span><br><span class="line"><span class="comment">### NetBeans ###</span></span><br><span class="line">/nbproject/private/</span><br><span class="line">/nbbuild/</span><br><span class="line">/dist/</span><br><span class="line">/nbdist/</span><br><span class="line">/.nb-gradle/</span><br><span class="line">build/</span><br><span class="line"></span><br><span class="line"><span class="comment">### VS Code ###</span></span><br><span class="line">.vscode/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mvnw</span><br><span class="line">mvnw.cmd</span><br><span class="line">.mvn/</span><br><span class="line"></span><br><span class="line">*.<span class="built_in">log</span></span><br></pre></td></tr></table></figure>
<h2 id="二、创建前端项目"><a href="#二、创建前端项目" class="headerlink" title="#二、创建前端项目"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#二、创建前端项目">#</a>二、创建前端项目</h2><h3 id="1、创建vue3-0脚手架工程"><a href="#1、创建vue3-0脚手架工程" class="headerlink" title="#1、创建vue3.0脚手架工程"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_1、创建vue3-0脚手架工程">#</a>1、创建vue3.0脚手架工程</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vue create ydl-ui</span><br></pre></td></tr></table></figure>
<p>1</p>
<blockquote>
<p>选择vue3.0版，将项目直接建立在仓库的根目录中</p>
</blockquote>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220119184559911.22db70df.png" alt="image-20220119184559911"></p>
<blockquote>
<p>使用vscode打开项目工程，并启动：</p>
</blockquote>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220120104527841.f686373d.png" alt="image-20220120104527841"></p>
<h3 id="2、配置vue-router"><a href="#2、配置vue-router" class="headerlink" title="#2、配置vue-router"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_2、配置vue-router">#</a>2、配置vue-router</h3><p><a href="https://next.router.vuejs.org/zh/index.html">https://next.router.vuejs.org/zh/index.html</a></p>
<h4 id="（1）安装依赖"><a href="#（1）安装依赖" class="headerlink" title="#（1）安装依赖"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_1-安装依赖">#</a>（1）安装依赖</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn add vue-router@4</span><br></pre></td></tr></table></figure>
<h4 id="（2）创建router目录结构"><a href="#（2）创建router目录结构" class="headerlink" title="#（2）创建router目录结构"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_2-创建router目录结构">#</a>（2）创建router目录结构</h4><p>创建router目录，并创建index.js文件</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入用来创建路由和确定路由模式的两个方法</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    createRouter,</span><br><span class="line">    createWebHistory</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义路由信息</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> routes = []</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建路由实例并传递 `routes` 配置</span></span><br><span class="line"><span class="comment">// 我们在这里使用 html5 的路由模式，url中不带有#，部署项目的时候需要注意。</span></span><br><span class="line"><span class="keyword">const</span> router = createRouter(&#123;</span><br><span class="line">    <span class="attr">history</span>: createWebHistory(),</span><br><span class="line">    routes, </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局的路由守卫</span></span><br><span class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(to)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">from</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 讲路由实例导出</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure>
<h4 id="（3）全局安装"><a href="#（3）全局安装" class="headerlink" title="#（3）全局安装"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_3-全局安装">#</a>（3）全局安装</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@/router&#x27;</span></span><br><span class="line">createApp(App).use(router).mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="3、配置vuex"><a href="#3、配置vuex" class="headerlink" title="#3、配置vuex"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_3、配置vuex">#</a>3、配置vuex</h3><p><a href="https://next.vuex.vuejs.org/zh/">https://next.vuex.vuejs.org/zh/</a></p>
<h4 id="（1）安装依赖-1"><a href="#（1）安装依赖-1" class="headerlink" title="#（1）安装依赖"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_1-安装依赖-1">#</a>（1）安装依赖</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yarn add vuex@next</span><br></pre></td></tr></table></figure>
<h4 id="（2）创建目录结构"><a href="#（2）创建目录结构" class="headerlink" title="#（2）创建目录结构"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_2-创建目录结构">#</a>（2）创建目录结构</h4><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220120111557385.c2c45e7e.png" alt="image-20220120111557385"></p>
<p>user模块</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">getters</span>:&#123;   </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">actions</span>: &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> user</span><br></pre></td></tr></table></figure>
<p>index.js</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> user <span class="keyword">from</span> <span class="string">&#x27;@/store/modules/user&#x27;</span></span><br><span class="line"><span class="keyword">import</span> actions <span class="keyword">from</span> <span class="string">&#x27;@/store/actions&#x27;</span></span><br><span class="line"><span class="keyword">import</span> mutations <span class="keyword">from</span> <span class="string">&#x27;@/store/mutations&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(&#123;</span><br><span class="line">    <span class="attr">modules</span>: &#123;</span><br><span class="line">        user</span><br><span class="line">    &#125;,</span><br><span class="line">    actions,</span><br><span class="line">    mutations</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<h4 id="（3）全局引入"><a href="#（3）全局引入" class="headerlink" title="#（3）全局引入"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_3-全局引入">#</a>（3）全局引入</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"></span><br><span class="line">createApp(App).use(router).use(store).mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="4、配置axios"><a href="#4、配置axios" class="headerlink" title="#4、配置axios"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_4、配置axios">#</a>4、配置axios</h3><p><a href="http://www.axios-js.com/">http://www.axios-js.com/</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn add axios</span><br></pre></td></tr></table></figure>
<p>创建文件目录</p>
<p>新建文件夹api，以后所有和后端api交互的内容全部放在此文件夹中：</p>
<p><img src="/2022/04/13/ssmvueproject/daxue_document\myblog\source\_posts\ssmvueproject\image-20220215115102142.png" alt="image-20220215115102142"></p>
<p>新建index.js，该文件用来定义全局的axios配置</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * axios的基本api</span></span><br><span class="line"><span class="comment"> * // 发送 POST 请求</span></span><br><span class="line"><span class="comment"> * axios(&#123;</span></span><br><span class="line"><span class="comment"> *  method: &#x27;post&#x27;,</span></span><br><span class="line"><span class="comment"> *  url: &#x27;/user/12345&#x27;,</span></span><br><span class="line"><span class="comment"> *  data: &#123;</span></span><br><span class="line"><span class="comment"> *    firstName: &#x27;Fred&#x27;,</span></span><br><span class="line"><span class="comment"> *    lastName: &#x27;Flintstone&#x27;</span></span><br><span class="line"><span class="comment"> *  &#125;</span></span><br><span class="line"><span class="comment"> *&#125;);</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建axios实例</span></span><br><span class="line"><span class="keyword">const</span> request = axios.create(&#123;</span><br><span class="line">    <span class="comment">// axios中请求配置有baseURL选项，表示请求URL公共部分</span></span><br><span class="line">    <span class="attr">baseURL</span>: <span class="string">&#x27;http://localhost:8080/ydl/&#x27;</span>,</span><br><span class="line">    <span class="comment">// 超时</span></span><br><span class="line">    <span class="attr">timeout</span>: <span class="number">10000</span>,</span><br><span class="line">    <span class="comment">// 设置Content-Type，规定了前后端的交互使用json</span></span><br><span class="line">    <span class="attr">headers</span>: &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json;charset=utf-8&#x27;</span>&#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> request</span><br></pre></td></tr></table></figure>
<p>现在我们不妨写几个user相关的接口，感受一下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&quot;@/api&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新增用户</span></span><br><span class="line"><span class="comment">// 查询用户列表</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">listUser</span>(<span class="params">query</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/user&#x27;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">        <span class="attr">params</span>: query</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新增用户</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addUser</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/user&#x27;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: data</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5、安装ui组件"><a href="#5、安装ui组件" class="headerlink" title="#5、安装ui组件"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_5、安装ui组件">#</a>5、安装ui组件</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yarn add element-plus</span><br></pre></td></tr></table></figure>
<p>1</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ElementPlus <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-plus/dist/index.css&#x27;</span></span><br><span class="line"></span><br><span class="line">createApp(App).use(router).use(vuex).use(ElementPlus).mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>前端项目基本搭建完成。</p>
<h2 id="三、创建后端项目"><a href="#三、创建后端项目" class="headerlink" title="#三、创建后端项目"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#三、创建后端项目">#</a>三、创建后端项目</h2><h3 id="1、搭建maven工程"><a href="#1、搭建maven工程" class="headerlink" title="#1、搭建maven工程"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_1、搭建maven工程">#</a>1、搭建maven工程</h3><p>直接把项目建立在仓库的根目录即可，当然我们也可以创建两个仓库，一个前端项目仓库，一个后端项目仓库：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220119190222325.ac8428c7.png" alt="image-20220119190222325"></p>
<h3 id="2、调整工程结构"><a href="#2、调整工程结构" class="headerlink" title="#2、调整工程结构"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_2、调整工程结构">#</a>2、调整工程结构</h3><p>创建子工程ydl-backend，删除掉父工程的src，将父工程的pom文件中的packaging改为pom，声明为一个父工程：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220119190449118.4aa64251.png" alt="image-20220119190449118"></p>
<h3 id="3、配置tomcat"><a href="#3、配置tomcat" class="headerlink" title="#3、配置tomcat"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_3、配置tomcat">#</a>3、配置tomcat</h3><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220120132636690.2f2f655f.png" alt="image-20220120132636690"></p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220120132719105.ce6ac706.png" alt="image-20220120132719105"></p>
<h3 id="4、加入以下依赖"><a href="#4、加入以下依赖" class="headerlink" title="#4、加入以下依赖"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_4、加入以下依赖">#</a>4、加入以下依赖</h3><p>在父工程中加入以下依赖，进行依赖管理，每一个依赖的作用不在赘述，这是基本的ssm项目搭建：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ydl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ydl-back<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>ydl-backend<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>ruoyi<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://www.ydlclass.com<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>元动力管理系统<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javax.servlet.version</span>&gt;</span>4.0.1<span class="tag">&lt;/<span class="name">javax.servlet.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>5.2.18.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring-data-commons.version</span>&gt;</span>2.6.0<span class="tag">&lt;/<span class="name">spring-data-commons.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aspectjweaver.version</span>&gt;</span>1.9.6<span class="tag">&lt;/<span class="name">aspectjweaver.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">lombok.version</span>&gt;</span>1.18.22<span class="tag">&lt;/<span class="name">lombok.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jackson.version</span>&gt;</span>2.13.1<span class="tag">&lt;/<span class="name">jackson.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">validation-api.version</span>&gt;</span>2.0.1.Final<span class="tag">&lt;/<span class="name">validation-api.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hibernate-validator</span>&gt;</span>6.0.9.Final<span class="tag">&lt;/<span class="name">hibernate-validator</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">logback-classic.version</span>&gt;</span>1.2.6<span class="tag">&lt;/<span class="name">logback-classic.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commons-fileupload.version</span>&gt;</span>1.3.3<span class="tag">&lt;/<span class="name">commons-fileupload.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">druid.version</span>&gt;</span>1.2.8<span class="tag">&lt;/<span class="name">druid.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mysql-connector-java.version</span>&gt;</span>8.0.26<span class="tag">&lt;/<span class="name">mysql-connector-java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mybatis.version</span>&gt;</span>3.5.5<span class="tag">&lt;/<span class="name">mybatis.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mybatis-spring.version</span>&gt;</span>2.0.6<span class="tag">&lt;/<span class="name">mybatis-spring.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--依赖管理--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--servlet-api--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;javax.servlet.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!--spring-webmvc--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-data-commons.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;aspectjweaver.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--lombok--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;lombok.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!--jackson--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jackson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jackson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jackson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!--数据校验--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.validation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>validation-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;validation-api.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;hibernate-validator&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!--logback日志--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;logback-classic.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!--文件上传--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons-fileupload.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- 数据源--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druid.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 数据区驱动--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql-connector-java.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- mybatis--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- 整合spring和mybatis --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis-spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>$&#123;java.version&#125;<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>$&#123;java.version&#125;<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>$&#123;project.build.sourceEncoding&#125;<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>public<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun nexus<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在子工程中加入以下依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ydl-back<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ydl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ydl-backend<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--servlet-api--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--spring-webmvc--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--lombok--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--jackson--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--数据校验--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.validation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>validation-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--logback日志--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--文件上传--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 数据源--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数据区驱动--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- mybatis--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 整合spring和mybatis --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>web.xml的内容</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--容器初始化时，负责启动spring容器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:application.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--注册DispatcherServlet，这是springmvc的核心，就是个servlet--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:application.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--加载时先启动--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--/ 匹配所有的请求；（不包括.jsp）--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--/* 匹配所有的请求；（包括.jsp）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>jdbc.properties</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">user</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/ydlclass?characterEncoding=utf8&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line"><span class="attr">driverName</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br></pre></td></tr></table></figure>
<p>application.xml，我们将spring和springmvc的配置统一在一个文件中，你也可以分开。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mybatis</span>=<span class="string">&quot;http://mybatis.org/schema/mybatis-spring&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">       https://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">       https://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://mybatis.org/schema/mybatis-spring</span></span></span><br><span class="line"><span class="string"><span class="tag">       https://mybatis.org/schema/mybatis-spring.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">       https://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 自动扫包 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.ydlclass&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--文件上传配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;multipartResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 请求的编码格式，必须和jSP的pageEncoding属性一致，以便正确读取表单的内容，默认为ISO-8859-1 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultEncoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;utf-8&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 上传文件大小上限，单位为字节（10485760=10M） --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxUploadSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10485760&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxInMemorySize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;40960&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 处理映射器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 处理器适配器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 视图解析器,本项目可以不使用视图解析器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span> <span class="attr">id</span>=<span class="string">&quot;internalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 前缀 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/page/&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 后缀 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;order&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;customObjectMapper&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.ydlclass.configuration.CustomObjectMapper&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--全局异常处理--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    &lt;bean class=&quot;com.ydlclass.handler.GlobalExceptionResolver&quot;/&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.http.converter.json.MappingJackson2HttpMessageConverter&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 自定义Jackson的objectMapper --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;objectMapper&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;customObjectMapper&quot;</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 自定义Jackson的objectMapper --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;supportedMediaTypes&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">value</span>&gt;</span>text/plain;charset=UTF-8<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">value</span>&gt;</span>application/json;charset=UTF-8<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--处理静态资源，前后分离项目不需要处理静态资源--&gt;</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--扫描mapper文件--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  让springmvc自带的注解生效  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis:scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.ydlclass.dao&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--数据源--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driverName&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;user&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 整个整合就是在围绕sqlSessionFactory --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperLocations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mapper/**/*.xml&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configuration&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.ibatis.session.Configuration&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;logPrefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ydlclass_&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 注入事务管理器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 声明式事务 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- the transactional semantics... --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- all methods starting with &#x27;get&#x27; are read-only --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;get*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;SUPPORTS&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;select*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;SUPPORTS&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- other methods use the default transaction settings (see below) --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;update*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;false&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;delete*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;false&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;insert*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;false&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>logback日志的配置文件 logback.xml：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 日志存放路径 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;log.path&quot;</span> <span class="attr">value</span>=<span class="string">&quot;D://ydl/logs&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 日志输出格式 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;log.pattern&quot;</span> <span class="attr">value</span>=<span class="string">&quot;%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;20&#125; - [%method,%line] - %msg%n&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 控制台输出 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;console&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;log.pattern&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 系统日志输出 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;file_info&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;log.path&#125;/sys-info.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 循环政策：基于时间创建日志文件 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 日志文件名格式 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/sys-info.%d&#123;yyyy-MM-dd&#125;.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 日志最大的历史 60天 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>60<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;log.pattern&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 过滤的级别 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>INFO<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 匹配时的操作：接收（记录） --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 不匹配时的操作：拒绝（不记录） --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;file_error&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;log.path&#125;/sys-error.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 循环政策：基于时间创建日志文件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 日志文件名格式 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/sys-error.%d&#123;yyyy-MM-dd&#125;.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 日志最大的历史 60天 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>60<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;log.pattern&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 过滤的级别 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>ERROR<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 匹配时的操作：接收（记录） --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 不匹配时的操作：拒绝（不记录） --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 系统模块日志级别控制  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.ydl&quot;</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span> /&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- Spring日志级别控制  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.springframework&quot;</span> <span class="attr">level</span>=<span class="string">&quot;warn&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;console&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;file_info&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;file_error&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span> </span><br></pre></td></tr></table></figure>
<p>创建CustomObjectMapper来配置jackson的序列化和反序列化：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomObjectMapper</span> <span class="keyword">extends</span> <span class="title">ObjectMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomObjectMapper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="comment">//去掉默认的时间戳格式</span></span><br><span class="line">        configure(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS, <span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">//设置为东八区</span></span><br><span class="line">        setTimeZone(TimeZone.getTimeZone(<span class="string">&quot;GMT+8&quot;</span>));</span><br><span class="line">        <span class="comment">//设置日期转换yyyy-MM-dd HH:mm:ss</span></span><br><span class="line">        setDateFormat(<span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>));</span><br><span class="line">        <span class="comment">// 设置输入:禁止把POJO中值为null的字段映射到json字符串中</span></span><br><span class="line">        configure(SerializationFeature.WRITE_NULL_MAP_VALUES, <span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">// 空值不序列化</span></span><br><span class="line">        setSerializationInclusion(JsonInclude.Include.NON_NULL);</span><br><span class="line">        <span class="comment">// 反序列化时，属性不存在的兼容处理</span></span><br><span class="line">        getDeserializationConfig().withoutFeatures(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);</span><br><span class="line">        <span class="comment">// 序列化枚举是以toString()来输出，默认false，即默认以name()来输出</span></span><br><span class="line">        configure(SerializationFeature.WRITE_ENUMS_USING_TO_STRING, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5、构建目录结构并测试："><a href="#5、构建目录结构并测试：" class="headerlink" title="#5、构建目录结构并测试："></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_5、构建目录结构并测试">#</a>5、构建目录结构并测试：</h3><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220120132303260.c2ce361e.png" alt="image-20220120132303260"></p>
<p>测试controller</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;user&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;tom&quot;</span>,<span class="number">12</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;tom&quot;</span>,<span class="number">12</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        String username;</span><br><span class="line">        Integer age;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String username, Integer age)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.username = username;</span><br><span class="line">            <span class="keyword">this</span>.age = age;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> username;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.username = username;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> age;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.age = age;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动成功：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220120133909069.d49b2319.png" alt="image-20220120133909069"></p>
<h2 id="四、前后端联调"><a href="#四、前后端联调" class="headerlink" title="#四、前后端联调"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#四、前后端联调">#</a>四、前后端联调</h2><h3 id="1、跨域问题"><a href="#1、跨域问题" class="headerlink" title="#1、跨域问题"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_1、跨域问题">#</a>1、跨域问题</h3><p>在前端app.vue中使用mounted尝试发送一个测试请求：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;listUser&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/system/user&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    listUser().then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">    &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;error&quot;</span>+err)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>请求是发送了，但是不能成功请求，很明显产生了跨越问题：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220120135041384.2dc5f319.png" alt="image-20220120135041384"></p>
<h3 id="2、服务端解决跨域"><a href="#2、服务端解决跨域" class="headerlink" title="#2、服务端解决跨域"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_2、服务端解决跨域">#</a>2、服务端解决跨域</h3><p>（1）在controller或方法上加如下注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@CrossOrigin</span></span><br></pre></td></tr></table></figure>
<p>1</p>
<p>（2）在配置文件中，进行全局配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:cors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/*&quot;</span> <span class="attr">allowed-methods</span>=<span class="string">&quot;*&quot;</span> <span class="attr">allowed-origins</span>=<span class="string">&quot;*&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:cors</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>1<br>2<br>3</p>
<p>测试，完成</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220120135214717.ccb28ed9.png" alt="image-20220120135214717"></p>
<h3 id="3、前端配置代理"><a href="#3、前端配置代理" class="headerlink" title="#3、前端配置代理"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_3、前端配置代理">#</a>3、前端配置代理</h3><blockquote>
<p>将服务端的api全部允许跨域访问其实并不是一个好的选择，我们更多的时候可以选择在前端服务器中配置反向代理实现跨域。</p>
</blockquote>
<p>很明显，我们的前端工程也可以在一个独立的端口启动，也就是说我们的前端工程默认启动了一个web静态服务器。有了代理服务器，我们的思路也就有了。如下图：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220215142433095.9056daea.png" alt="image-20220215142433095"></p>
<p>查阅vue-cli的相关配置：<a href="https://cli.vuejs.org/zh/config/，我们发现，可以vue-cli的配置是可以修改的，只需要我们建立一个">https://cli.vuejs.org/zh/config/，我们发现，可以vue-cli的配置是可以修改的，只需要我们建立一个</a> vue.config.js 配置文件文件。</p>
<h4 id="（1）修改vue的端口，并配置代理"><a href="#（1）修改vue的端口，并配置代理" class="headerlink" title="#（1）修改vue的端口，并配置代理"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_1-修改vue的端口-并配置代理">#</a>（1）修改vue的端口，并配置代理</h4><p>在工程的根目录下创建配置文件【vue.config.js】，配置代理服务器，将所有的请求交由代理发送到后端服务器。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">devServer</span>: &#123;</span><br><span class="line">        <span class="attr">port</span>: <span class="number">8088</span>,</span><br><span class="line">        <span class="attr">proxy</span>: <span class="string">&#x27;http://localhost:8080/ydl&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="（2）修改axios的配置"><a href="#（2）修改axios的配置" class="headerlink" title="#（2）修改axios的配置"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_2-修改axios的配置">#</a>（2）修改axios的配置</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建axios实例</span></span><br><span class="line"><span class="keyword">const</span> request = axios.create(&#123;</span><br><span class="line">    <span class="comment">// axios中请求配置有baseURL选项，表示请求URL公共部分</span></span><br><span class="line">    <span class="attr">baseURL</span>: <span class="string">&#x27;http://localhost:8088&#x27;</span>,</span><br><span class="line">    <span class="comment">// 超时取消</span></span><br><span class="line">    <span class="attr">timeout</span>: <span class="number">10000</span>,</span><br><span class="line">    <span class="comment">// 设置Content-Type，规定了前后端的交互使用json</span></span><br><span class="line">    <span class="attr">headers</span>: &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json;charset=utf-8&#x27;</span>&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>测试，成功。</p>
<h2 id="五、关于认证的新讨论"><a href="#五、关于认证的新讨论" class="headerlink" title="#五、关于认证的新讨论"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#五、关于认证的新讨论">#</a>五、关于认证的新讨论</h2><p>认证就是我们通常所说的登陆，但是随着项目结构的变化，认证的模式也会有所改变。</p>
<h3 id="1、完成的登陆页面"><a href="#1、完成的登陆页面" class="headerlink" title="#1、完成的登陆页面"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_1、完成的登陆页面">#</a>1、完成的登陆页面</h3><p>将App.vue修改如下，将程序的入口仅仅保留一个<code>&lt;router-view/&gt;</code>，以后就可以使用单页面的方式通过路由进行页面跳转了。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;router-view/&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>新增登陆组件，在src下的compoment目录新建login.vue</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-container&gt;</span><br><span class="line">    &lt;el-aside width=&quot;790px&quot;</span><br><span class="line">      &gt;&lt;el-image</span><br><span class="line">        fit=&quot;fill&quot;</span><br><span class="line">        :src=&quot;require(&#x27;@/assets/image/login_left.png&#x27;)&quot;</span><br><span class="line">      &gt;&lt;/el-image</span><br><span class="line">    &gt;&lt;/el-aside&gt;</span><br><span class="line">    &lt;el-main&gt;</span><br><span class="line">      &lt;el-card class=&quot;box-card login-card&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;login-title&quot;&gt;元动力后台管理系统&lt;/span&gt;</span><br><span class="line">        &lt;span class=&quot;login-tip&quot;&gt;welcome 欢迎登陆&lt;/span&gt;</span><br><span class="line">        &lt;el-form</span><br><span class="line">          ref=&quot;user&quot;</span><br><span class="line">          :model=&quot;user&quot;</span><br><span class="line">          label-width=&quot;80px&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;el-form-item label=&quot;用户名&quot; prop=&quot;username&quot;&gt;</span><br><span class="line">            &lt;el-input</span><br><span class="line">              v-model=&quot;user.username&quot;</span><br><span class="line">              placeholder=&quot;请输入用户&quot;</span><br><span class="line">            &gt;&lt;/el-input&gt;</span><br><span class="line">          &lt;/el-form-item&gt;</span><br><span class="line">          &lt;el-form-item label=&quot;密码&quot; prop=&quot;password&quot;&gt;</span><br><span class="line">            &lt;el-input</span><br><span class="line">              v-model=&quot;user.password&quot;</span><br><span class="line">              type=&quot;password&quot;</span><br><span class="line">              placeholder=&quot;请输入密码&quot;</span><br><span class="line">              show-password</span><br><span class="line">            &gt;&lt;/el-input&gt;</span><br><span class="line">          &lt;/el-form-item&gt;</span><br><span class="line">          &lt;el-form-item&gt;</span><br><span class="line">            &lt;el-button type=&quot;primary&quot; @click=&quot;login&quot;&gt;登陆&lt;/el-button&gt;</span><br><span class="line">          &lt;/el-form-item&gt;</span><br><span class="line">        &lt;/el-form&gt;</span><br><span class="line">      &lt;/el-card&gt;</span><br><span class="line">    &lt;/el-main&gt;</span><br><span class="line">  &lt;/el-container&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;login&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      // 用户信息</span><br><span class="line">      url: &quot;../../assets/image/login_left.png&quot;,</span><br><span class="line">      user: &#123;</span><br><span class="line">        username: &quot;admin&quot;,</span><br><span class="line">        password: &quot;123456&quot;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scope&gt;</span><br><span class="line">.el-image &#123;</span><br><span class="line">  height: 885px;</span><br><span class="line">  width: 750px;</span><br><span class="line">&#125;</span><br><span class="line">.el-main &#123;</span><br><span class="line">  position: relative;</span><br><span class="line">&#125;</span><br><span class="line">.login-card &#123;</span><br><span class="line">  position: absolute;</span><br><span class="line">  top: 0;</span><br><span class="line">  left: 0;</span><br><span class="line">  bottom: 0;</span><br><span class="line">  right: 0;</span><br><span class="line">  margin: auto;</span><br><span class="line">  width: 480px;</span><br><span class="line">  height: 400px;</span><br><span class="line">  padding: 50px;</span><br><span class="line">&#125;</span><br><span class="line">.login-title &#123;</span><br><span class="line">  width: 459px;</span><br><span class="line">  height: 70px;</span><br><span class="line">  font-size: 40px;</span><br><span class="line">  font-family: AlibabaPuHuiTiB;</span><br><span class="line">  color: #333333;</span><br><span class="line">  line-height: 90px;</span><br><span class="line">  letter-spacing: 1px;</span><br><span class="line">  font-weight: 800;</span><br><span class="line">  display: block;</span><br><span class="line">  text-align: left;</span><br><span class="line">&#125;</span><br><span class="line">.login-tip &#123;</span><br><span class="line">  width: 319px;</span><br><span class="line">  height: 70px;</span><br><span class="line">  font-size: 30px;</span><br><span class="line">  font-family: PingFangSC-Regular, PingFang SC;</span><br><span class="line">  font-weight: 400;</span><br><span class="line">  color: #999999;</span><br><span class="line">  line-height: 90px;</span><br><span class="line">  letter-spacing: 1px;</span><br><span class="line">  display: block;</span><br><span class="line">  text-align: left;</span><br><span class="line">  margin-bottom: 30px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>我们新增一个公共的css，并导入：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">html</span>,<span class="selector-tag">body</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#app</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在main.js导入即可，导入后会自动在模板中引入该css，以后如果有公共的css样式，就在这里写：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import &#x27;@/assets/style/common.css&#x27;</span><br></pre></td></tr></table></figure>
<p>1</p>
<p>我们还需要新增一个主页组件：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-container&gt;</span><br><span class="line"> </span><br><span class="line">      &lt;el-aside width=&quot;200px&quot;&gt;</span><br><span class="line">        &lt;el-row&gt;</span><br><span class="line">          &lt;el-col :span=&quot;24&quot;&gt;</span><br><span class="line">            &lt;el-image</span><br><span class="line">              style=&quot;</span><br><span class="line">                width: 120px;</span><br><span class="line">                height: 60px;</span><br><span class="line">                display: block;</span><br><span class="line">                margin: 40px auto;</span><br><span class="line">              &quot;</span><br><span class="line">              fit=&quot;fill&quot;</span><br><span class="line">              :src=&quot;require(&#x27;@/assets/image/main_logo.png&#x27;)&quot;</span><br><span class="line">            &gt;&lt;/el-image&gt;</span><br><span class="line">            &lt;el-menu</span><br><span class="line">              active-text-color=&quot;#ffd04b&quot;</span><br><span class="line">              background-color=&quot;#191A22&quot;</span><br><span class="line">              class=&quot;el-menu-vertical-demo&quot;</span><br><span class="line">              default-active=&quot;2&quot;</span><br><span class="line">              text-color=&quot;#fff&quot;</span><br><span class="line">            &gt;</span><br><span class="line">              &lt;el-sub-menu index=&quot;1&quot;&gt;</span><br><span class="line">                &lt;template #title&gt;</span><br><span class="line">                  &lt;el-icon&gt;&lt;/el-icon&gt;</span><br><span class="line">                  &lt;span&gt;系统管理&lt;/span&gt;</span><br><span class="line">                &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">                &lt;el-menu-item index=&quot;1-1&quot; @click=&quot;open(&#x27;user&#x27;)&quot;&gt;</span><br><span class="line">                  用户管理&lt;/el-menu-item</span><br><span class="line">                &gt;</span><br><span class="line">                &lt;el-menu-item index=&quot;1-2&quot; @click=&quot;open(&#x27;role&#x27;)&quot;&gt;</span><br><span class="line">                  角色管理&lt;/el-menu-item</span><br><span class="line">                &gt;</span><br><span class="line">              &lt;/el-sub-menu&gt;</span><br><span class="line">              &lt;el-menu-item index=&quot;2&quot;&gt;</span><br><span class="line">                &lt;el-icon&gt;&lt;/el-icon&gt;</span><br><span class="line">                &lt;span&gt;客户管理&lt;/span&gt;</span><br><span class="line">              &lt;/el-menu-item&gt;</span><br><span class="line">            &lt;/el-menu&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">      &lt;/el-aside&gt;</span><br><span class="line">      &lt;el-container&gt;</span><br><span class="line">        &lt;el-header v-html=&quot;&#x27;&lt;button onclick=\&#x27;alert(1)\&#x27;&gt;我是攻击者的按钮&lt;/button&gt;&#x27;&quot;&gt;&lt;/el-header&gt;</span><br><span class="line">        &lt;!--进行路由跳转--&gt;</span><br><span class="line">        &lt;el-main&gt;</span><br><span class="line">          &lt;router-view /&gt;</span><br><span class="line">        &lt;/el-main&gt;</span><br><span class="line">      &lt;/el-container&gt;</span><br><span class="line">  &lt;/el-container&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.el-container &#123;</span><br><span class="line">  height: 100%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.el-header &#123;</span><br><span class="line">  margin-bottom: 20px;</span><br><span class="line">  background: #e9eef3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.el-footer &#123;</span><br><span class="line">  line-height: 60px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.el-aside &#123;</span><br><span class="line">  background-color: #191a22;</span><br><span class="line">  color: var(--el-text-color-primary);</span><br><span class="line">  text-align: center;</span><br><span class="line">  line-height: 200px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.el-main &#123;</span><br><span class="line">  background-color: #fcfcfc;</span><br><span class="line">  color: var(--el-text-color-primary);</span><br><span class="line">  text-align: center;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>新增路由信息</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;login&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/components/login&#x27;</span>),</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;main&#x27;</span>,</span><br><span class="line">    <span class="attr">alias</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/main&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/components/main&#x27;</span>)</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>
<p>新增api</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 用户登陆</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: data</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2、传统的登陆逻辑"><a href="#2、传统的登陆逻辑" class="headerlink" title="#2、传统的登陆逻辑"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_2、传统的登陆逻辑">#</a>2、传统的登陆逻辑</h3><p>根据传统的登陆逻辑我们可以这样实现，虽然前后分离这种情况下他是有问题的，但我们还是要回顾一下。</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220121163451108.bb7ce76b.png" alt="image-20220121163451108"></p>
<p>对于前端而言，登陆的逻辑不外乎就是发送用户名和密码，后端接收用户名和密码处理登陆业务，一旦登陆成功就跳转到主页。</p>
<p>在登陆成功后，我们需要保存一些用户信息，我们不妨将登陆的逻辑定义在vuex中的actions当中：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">mutations: &#123;</span><br><span class="line">    <span class="function"><span class="title">SAVE_USER</span>(<span class="params">state, data</span>)</span> &#123;</span><br><span class="line">        state.user = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">      * 此处用来处理登陆的逻辑，如果登陆成功会在vuex中保存用户的信息</span></span><br><span class="line"><span class="comment">      * vuex中的用户信息用来报纸用户是否已经登录</span></span><br><span class="line"><span class="comment">      * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>param0 </span></span><br><span class="line"><span class="comment">      * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>user </span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    <span class="function"><span class="title">LOGIN</span>(<span class="params">&#123; commit &#125;, user</span>)</span> &#123;</span><br><span class="line">        login(user).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (res.data.code === <span class="number">200</span>) &#123;</span><br><span class="line">                commit(<span class="string">&#x27;SAVE_USER&#x27;</span>, user);</span><br><span class="line">                router.push(&#123;</span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&quot;main&quot;</span></span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意思考：</strong>传统的登陆方式在这里其实是经不起推敲，因为在前后分离的项目当中，我们的前端项目和后端项目，往往不在用一个域当中（前后端的项目都是在各自的服务器中部署）。所以，在当前的环境中，cookie会失效，这样会导致http无法通过session+cookie的方式进行保持会话状态。</p>
<h3 id="3、模拟升级"><a href="#3、模拟升级" class="headerlink" title="#3、模拟升级"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_3、模拟升级">#</a>3、模拟升级</h3><p>其实，本质上就是每次请求携带一个令牌就好，既然cookie+session的方式不合适了，我们不妨自己模拟一套自己的登录逻辑，使用header+redis来实现。</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220215154322742.fe6d72c8.png" alt="image-20220215154322742"></p>
<p>目前思路已经基本确定了，接下来我们给大家引入一个新的概念。</p>
<h2 id="六、RBAC权限系统"><a href="#六、RBAC权限系统" class="headerlink" title="#六、RBAC权限系统"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#六、rbac权限系统">#</a>六、RBAC权限系统</h2><p>通常情况下，一个系统，除了登陆也就是认证之外，还应该有一个重要的功能，就是鉴权，使用rbac可以很好的解决上述的问题。</p>
<ul>
<li>认证-规定了谁能够登陆</li>
<li>鉴权-规定了谁能访问那些接口，浏览那些页面，使用哪些功能，</li>
</ul>
<h3 id="1、概述"><a href="#1、概述" class="headerlink" title="#1、概述"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_1、概述">#</a>1、概述</h3><h4 id="（1）RBAC模型概述"><a href="#（1）RBAC模型概述" class="headerlink" title="#（1）RBAC模型概述"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_1-rbac模型概述">#</a>（1）RBAC模型概述</h4><p>RBAC模型（Role-Based Access Control：基于角色的访问控制）：其鉴权的过程可以抽象地概括为：谁 是 什么角色 有那些权限</p>
<h4 id="（2）RBAC的组成"><a href="#（2）RBAC的组成" class="headerlink" title="#（2）RBAC的组成"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_2-rbac的组成">#</a>（2）RBAC的组成</h4><p>在RBAC模型里面，有3个基础组成部分，分别是：<strong>用户、角色和权限。</strong></p>
<p>RBAC通过定义角色的权限，并对用户<strong>授予某个角色</strong>从而来<strong>控制用户的权限</strong>，实现了用户和权限的逻辑分离（区别于ACL模型），极大地方便了权限的管理</p>
<p>在讲解之前，我们先介绍一些名词：</p>
<ul>
<li><strong>User（用户）</strong>：每个用户都有唯一的UID识别，并被授予不同的角色</li>
<li><strong>Role（角色）</strong>：不同角色具有不同的权限，比如：人事、会计等</li>
<li><strong>Permission（权限</strong>）：访问权限，比如</li>
<li>用户-角色映射：用户和角色之间的映射关系</li>
<li>角色-权限映射：角色和权限之间的映射</li>
</ul>
<p>它们之间的关系如下图所示：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/rbacrole-based-access-control-1.93f22d59.png" alt="img"></p>
<p>例如下图，管理员和普通用户被授予不同的权限，普通用户只能去修改和查看个人信息，而不能创建用户和冻结用户，而管理员由于被授予所有权限，所以可以做所有操作。</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/rbac-demo.84f04cf9.png" alt="rbac说明图"></p>
<blockquote>
<p>完成RBAC模型，我们需要设计五张表，如下：</p>
</blockquote>
<p>用户表：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- 创建用户表</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `ydl_user`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `ydl_user`  (</span><br><span class="line">  `user_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;用户ID&#x27;</span>,</span><br><span class="line">  `user_name` <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户账号&#x27;</span>,</span><br><span class="line">  `nick_name` <span class="type">varchar</span>(<span class="number">30</span>)  <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户昵称&#x27;</span>,</span><br><span class="line">  `email` <span class="type">varchar</span>(<span class="number">50</span>)  <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;用户邮箱&#x27;</span>,</span><br><span class="line">  `phonenumber` <span class="type">varchar</span>(<span class="number">11</span>)  <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;手机号码&#x27;</span>,</span><br><span class="line">  `sex` <span class="type">char</span>(<span class="number">1</span>)  <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;用户性别（0男 1女 2未知）&#x27;</span>,</span><br><span class="line">  `avatar` <span class="type">varchar</span>(<span class="number">100</span>)  <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;头像地址&#x27;</span>,</span><br><span class="line">  `password` <span class="type">varchar</span>(<span class="number">100</span>)  <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">  `status` <span class="type">char</span>(<span class="number">1</span>)  <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;帐号状态（0正常 1停用）&#x27;</span>,</span><br><span class="line">  `del_flag` <span class="type">char</span>(<span class="number">1</span>)  <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;删除标志（0代表存在 2代表删除）&#x27;</span>,</span><br><span class="line">  `login_ip` <span class="type">varchar</span>(<span class="number">128</span>)  <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;最后登录IP&#x27;</span>,</span><br><span class="line">  `login_date` datetime <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;最后登录时间&#x27;</span>,</span><br><span class="line">  `create_by` <span class="type">varchar</span>(<span class="number">64</span>)  <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;创建者&#x27;</span>,</span><br><span class="line">  `create_time` datetime <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `update_by` <span class="type">varchar</span>(<span class="number">64</span>)  <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;更新者&#x27;</span>,</span><br><span class="line">  `update_time` datetime <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`user_id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8mb4 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8mb4_0900_ai_ci COMMENT <span class="operator">=</span> <span class="string">&#x27;用户信息表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- 增加几条用户信息</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `ydl_user` <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;ydl_admin&#x27;</span>, <span class="string">&#x27;管理员&#x27;</span>, <span class="string">&#x27;253546544@qq.com&#x27;</span>, <span class="string">&#x27;18888888888&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;xxxxxx&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;10.25.245.45&#x27;</span>, <span class="string">&#x27;2022-01-23 15:50:27&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;2022-01-23 15:50:48&#x27;</span>, <span class="string">&#x27;ydl&#x27;</span>, <span class="string">&#x27;2022-01-26 15:50:53&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>角色表：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for ydl_role</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `ydl_role`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `ydl_role`  (</span><br><span class="line">  `role_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;角色ID&#x27;</span>,</span><br><span class="line">  `role_name` <span class="type">varchar</span>(<span class="number">30</span>)  <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;角色名称&#x27;</span>,</span><br><span class="line">  `role_tag` <span class="type">varchar</span>(<span class="number">30</span>)  <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;角色标签&#x27;</span>,</span><br><span class="line">  `role_sort` <span class="type">int</span>(<span class="number">4</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;显示顺序&#x27;</span>,</span><br><span class="line">  `status` <span class="type">char</span>(<span class="number">1</span>)  <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;角色状态（0正常 1停用）&#x27;</span>,</span><br><span class="line">  `del_flag` <span class="type">char</span>(<span class="number">1</span>)  <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;删除标志（0代表存在 1代表删除）&#x27;</span>,</span><br><span class="line">  `create_by` <span class="type">varchar</span>(<span class="number">64</span>)  <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;创建者&#x27;</span>,</span><br><span class="line">  `create_time` datetime <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `update_by` <span class="type">varchar</span>(<span class="number">64</span>)  <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;更新者&#x27;</span>,</span><br><span class="line">  `update_time` datetime <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`role_id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">2</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8mb4 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8mb4_0900_ai_ci COMMENT <span class="operator">=</span> <span class="string">&#x27;角色信息表&#x27;</span> ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of ydl_role</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `ydl_role` <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;管理员&#x27;</span>, <span class="keyword">NULL</span>, <span class="number">1</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;2022-01-28 15:57:57&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;2022-01-29 15:58:04&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>用户-角色中间表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for sys_user_role</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `ydl_user_role`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `ydl_user_role`  (</span><br><span class="line">  `user_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户ID&#x27;</span>,</span><br><span class="line">  `role_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;角色ID&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`user_id`, `role_id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8mb4 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8mb4_0900_ai_ci COMMENT <span class="operator">=</span> <span class="string">&#x27;用户和角色关联表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of sys_user_role</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `ydl_user_role` <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p>权限表，这个权限表是一个升级后权限表（最简单的实现有id和权限标识就可以了）</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for ydl_menu</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `ydl_menu`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `ydl_menu`  (</span><br><span class="line">  `menu_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;菜单ID&#x27;</span>,</span><br><span class="line">  `menu_name` <span class="type">varchar</span>(<span class="number">50</span>)  <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;菜单名称&#x27;</span>,</span><br><span class="line">  `perms` <span class="type">varchar</span>(<span class="number">50</span>)  <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;权限标识&#x27;</span>,</span><br><span class="line">  `parent_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;父菜单ID&#x27;</span>,</span><br><span class="line">  `order_num` <span class="type">int</span>(<span class="number">4</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;显示顺序&#x27;</span>,</span><br><span class="line">  `path` <span class="type">varchar</span>(<span class="number">200</span>)  <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;路由地址&#x27;</span>,</span><br><span class="line">  `component` <span class="type">varchar</span>(<span class="number">255</span>)  <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;组件路径&#x27;</span>,</span><br><span class="line">  `menu_type` <span class="type">char</span>(<span class="number">1</span>)  <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;菜单类型（M目录 C菜单 F按钮）&#x27;</span>,</span><br><span class="line">  `visible` <span class="type">char</span>(<span class="number">1</span>)  <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;菜单状态（0显示 1隐藏）&#x27;</span>,</span><br><span class="line">  `icon` <span class="type">varchar</span>(<span class="number">100</span>)  <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;#&#x27;</span> COMMENT <span class="string">&#x27;菜单图标&#x27;</span>,</span><br><span class="line">  `create_by` <span class="type">varchar</span>(<span class="number">64</span>)  <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;创建者&#x27;</span>,</span><br><span class="line">  `create_time` datetime <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `update_by` <span class="type">varchar</span>(<span class="number">64</span>)  <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;更新者&#x27;</span>,</span><br><span class="line">  `update_time` datetime <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`menu_id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8mb4 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8mb4_0900_ai_ci COMMENT <span class="operator">=</span> <span class="string">&#x27;菜单权限表&#x27;</span> ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of ydl_menu</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `ydl_menu` <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;系统管理&#x27;</span>, <span class="string">&#x27;system&#x27;</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="string">&#x27;system&#x27;</span>, <span class="string">&#x27;null&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;&#x27;</span>, <span class="keyword">NULL</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `ydl_menu` <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">&#x27;用户管理&#x27;</span>, <span class="string">&#x27;system:user&#x27;</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="string">&#x27;system/user/index&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;&#x27;</span>, <span class="keyword">NULL</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `ydl_menu` <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="string">&#x27;角色管理&#x27;</span>, <span class="string">&#x27;system:role&#x27;</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="string">&#x27;system/role/index&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;&#x27;</span>, <span class="keyword">NULL</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `ydl_menu` <span class="keyword">VALUES</span> (<span class="number">4</span>, <span class="string">&#x27;菜单管理&#x27;</span>, <span class="string">&#x27;system:menu&#x27;</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="string">&#x27;system/menu/index&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;&#x27;</span>, <span class="keyword">NULL</span>);</span><br></pre></td></tr></table></figure>
<p>30</p>
<p>角色和权限的中间表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for sys_role_menu</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `ydl_role_menu`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `ydl_role_menu`  (</span><br><span class="line">  `role_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;角色ID&#x27;</span>,</span><br><span class="line">  `menu_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;菜单ID&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`role_id`, `menu_id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8mb4 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8mb4_0900_ai_ci COMMENT <span class="operator">=</span> <span class="string">&#x27;角色和菜单关联表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of sys_role_menu</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `ydl_role_menu` <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `ydl_role_menu` <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `ydl_role_menu` <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `ydl_role_menu` <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">4</span>);</span><br></pre></td></tr></table></figure>
<p>再本工程中，我们还需要一张记录操作日志的表，我们一起设计好：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `ydl_oper_log`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `ydl_oper_log`  (</span><br><span class="line">  `oper_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;日志主键&#x27;</span>,</span><br><span class="line">  `title` <span class="type">varchar</span>(<span class="number">255</span>)  COMMENT <span class="string">&#x27;操作模块&#x27;</span>,</span><br><span class="line">  `business_type` <span class="type">varchar</span>(<span class="number">255</span>)  COMMENT <span class="string">&#x27;业务类型&#x27;</span>,</span><br><span class="line">  `<span class="keyword">method</span>` <span class="type">varchar</span>(<span class="number">255</span>)  COMMENT <span class="string">&#x27;api方法&#x27;</span>,</span><br><span class="line">  `request_method` <span class="type">varchar</span>(<span class="number">255</span>)  COMMENT <span class="string">&#x27;请求方式&#x27;</span>,</span><br><span class="line">  `oper_name` <span class="type">varchar</span>(<span class="number">255</span>)  COMMENT <span class="string">&#x27;操作人员&#x27;</span>,</span><br><span class="line">  `oper_url` <span class="type">varchar</span>(<span class="number">255</span>)  COMMENT <span class="string">&#x27;请求url&#x27;</span>,</span><br><span class="line">  `oper_ip` <span class="type">varchar</span>(<span class="number">255</span>)  COMMENT <span class="string">&#x27;操作地址&#x27;</span>,</span><br><span class="line">  `status` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;操作状态&#x27;</span>,</span><br><span class="line">  `errorMsg` <span class="type">varchar</span>(<span class="number">255</span>)  COMMENT <span class="string">&#x27;错误消息&#x27;</span>,</span><br><span class="line">  `operTime` datetime(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;操作时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`oper_id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8mb4 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8mb4_0900_ai_ci COMMENT <span class="operator">=</span> <span class="string">&#x27;操作日志&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>表设计好之后使用逆向工程，我们这里使用easycode反向生成基础代码：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220303150043345.4db288fe.png" alt="image-20220303150043345"></p>
<h3 id="2、认证"><a href="#2、认证" class="headerlink" title="#2、认证"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_2、认证">#</a>2、认证</h3><h4 id="（1）redis的搭建"><a href="#（1）redis的搭建" class="headerlink" title="#（1）redis的搭建"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_1-redis的搭建">#</a>（1）redis的搭建</h4><p>开发过程中，我们可以使用windows版本的redis，启动即可，如果以后想一劳永逸，可以直接将redis设置成一个启动服务即可。</p>
<p>开启服务的命令如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">安装命令：redis-server.exe --service-install redis.windows.conf --loglevel verbose</span><br><span class="line">启动服务命令：redis-server.exe --service-start</span><br><span class="line">关闭服务命令：redis-server.exe --service-stop</span><br></pre></td></tr></table></figure>
<blockquote>
<p>引入依赖</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>向容器注入一个模板bean，用来操作redis：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jedisPool&quot;</span> <span class="attr">class</span>=<span class="string">&quot;redis.clients.jedis.JedisPool&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;host&quot;</span> <span class="attr">value</span>=<span class="string">&quot;127.0.0.1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;port&quot;</span> <span class="attr">value</span>=<span class="string">&quot;6379&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;minIdle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxIdle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;30&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxTotal&quot;</span> <span class="attr">value</span>=<span class="string">&quot;200&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>编写一个RedisTemplate，用来对redis进行基本操作：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span>  <span class="title">RedisTemplate</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> JedisPool jedisPool;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CustomObjectMapper objectMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 存储普通字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> expire</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">set</span><span class="params">(String key, String value, Long expire)</span> </span>&#123;</span><br><span class="line">        Jedis jedis = jedisPool.getResource();</span><br><span class="line">        String returnValue = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">// 如果操作成功会返回“ok”字符串，</span></span><br><span class="line">            returnValue = jedis.setex(key, expire, value);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (JedisException e) &#123;</span><br><span class="line">            jedisPool.returnBrokenResource(jedis);</span><br><span class="line">            log.error(<span class="string">&quot;Redis execution error !&quot;</span>,e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            jedisPool.returnResource(jedis);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> returnValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据key获得一个字符串数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        Jedis jedis = jedisPool.getResource();</span><br><span class="line">        String returnValue = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            returnValue = jedis.get(key);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (JedisException e) &#123;</span><br><span class="line">            jedisPool.returnBrokenResource(jedis);</span><br><span class="line">            log.error(<span class="string">&quot;Redis execution error !&quot;</span>,e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            jedisPool.returnResource(jedis);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> returnValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 存储对象类型的数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> object</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> expire</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">setObject</span><span class="params">(String key, Object object, Long expire)</span> </span>&#123;</span><br><span class="line">        Jedis jedis = jedisPool.getResource();</span><br><span class="line">        String returnValue = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">// 讲object进行序列化</span></span><br><span class="line">            String objValue = objectMapper.writeValueAsString(object);</span><br><span class="line">            <span class="comment">// 如果操作成功会返回“ok”字符串，</span></span><br><span class="line">            returnValue = jedis.setex(key, expire, objValue);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (JedisException | JsonProcessingException e ) &#123;</span><br><span class="line">            jedisPool.returnBrokenResource(jedis);</span><br><span class="line">            log.error(<span class="string">&quot;Redis execution error !&quot;</span>,e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            jedisPool.returnResource(jedis);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> returnValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取对象类型的数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> valueType</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">Optional&lt;T&gt; <span class="title">getObject</span><span class="params">(String key,Class&lt;T&gt; valueType)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Jedis jedis = jedisPool.getResource();</span><br><span class="line">        String returnValue = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">// 如果操作成功会返回“ok”字符串，</span></span><br><span class="line">            String objectValue = jedis.get(key);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> objectValue == <span class="keyword">null</span> ? Optional.empty() : Optional.of(objectMapper.readValue(objectValue, valueType));</span><br><span class="line">        &#125;<span class="keyword">catch</span> (JedisException | JsonProcessingException e ) &#123;</span><br><span class="line">            jedisPool.returnBrokenResource(jedis);</span><br><span class="line">            log.error(<span class="string">&quot;Redis execution error !&quot;</span>,e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            jedisPool.returnResource(jedis);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Optional.empty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">Optional&lt;T&gt; <span class="title">getObject</span><span class="params">(String key, TypeReference&lt;T&gt; typeReference)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Jedis jedis = jedisPool.getResource();</span><br><span class="line">        String returnValue = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">// 如果操作成功会返回“ok”字符串，</span></span><br><span class="line">            String objectValue = jedis.get(key);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> objectValue == <span class="keyword">null</span> ? Optional.empty() : Optional.of(objectMapper.readValue(objectValue, typeReference));</span><br><span class="line">        &#125;<span class="keyword">catch</span> (JedisException | JsonProcessingException e ) &#123;</span><br><span class="line">            jedisPool.returnBrokenResource(jedis);</span><br><span class="line">            log.error(<span class="string">&quot;Redis execution error !&quot;</span>,e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            jedisPool.returnResource(jedis);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Optional.empty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除多个key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">remove</span><span class="params">(String ...key)</span> </span>&#123;</span><br><span class="line">        Jedis jedis = jedisPool.getResource();</span><br><span class="line">        String returnValue = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">// 如果操作成功会返回“ok”字符串，</span></span><br><span class="line">            <span class="keyword">return</span> jedis.del(key);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (JedisException e) &#123;</span><br><span class="line">            jedisPool.returnBrokenResource(jedis);</span><br><span class="line">            log.error(<span class="string">&quot;Redis execution error !&quot;</span>,e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            jedisPool.returnResource(jedis);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1L</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">lpush</span><span class="params">(String key, String ...value)</span> </span>&#123;</span><br><span class="line">        Jedis jedis = jedisPool.getResource();</span><br><span class="line">        <span class="keyword">long</span> pos = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">// 如果操作成功会返回“ok”字符串，</span></span><br><span class="line">            pos = jedis.lpush(key, value);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (JedisException e) &#123;</span><br><span class="line">            jedisPool.returnBrokenResource(jedis);</span><br><span class="line">            log.error(<span class="string">&quot;Redis execution error !&quot;</span>,e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            jedisPool.returnResource(jedis);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pos;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Optional&lt;String&gt; <span class="title">rpop</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        Jedis jedis = jedisPool.getResource();</span><br><span class="line">        Optional&lt;String&gt; returnValue = Optional.empty();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">// 如果操作成功会返回“ok”字符串，</span></span><br><span class="line">            String value = jedis.rpop(key);</span><br><span class="line">            System.out.println(<span class="string">&quot;---------&quot;</span>+value);</span><br><span class="line">            returnValue = value == <span class="keyword">null</span> ? Optional.empty() : Optional.of(value);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (JedisException e) &#123;</span><br><span class="line">            jedisPool.returnBrokenResource(jedis);</span><br><span class="line">            log.error(<span class="string">&quot;Redis execution error !&quot;</span>,e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            jedisPool.returnResource(jedis);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> returnValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">llen</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        Jedis jedis = jedisPool.getResource();</span><br><span class="line">        <span class="keyword">long</span> llen = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">// 如果操作成功会返回“ok”字符串，</span></span><br><span class="line">            llen = jedis.llen(key);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (JedisException e) &#123;</span><br><span class="line">            jedisPool.returnBrokenResource(jedis);</span><br><span class="line">            log.error(<span class="string">&quot;Redis execution error !&quot;</span>,e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            jedisPool.returnResource(jedis);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> llen;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="（2）后端的登陆逻辑"><a href="#（2）后端的登陆逻辑" class="headerlink" title="#（2）后端的登陆逻辑"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_2-后端的登陆逻辑">#</a>（2）后端的登陆逻辑</h4><p>在登陆逻辑中，我们还需要封装一个登陆用户的实体类，用来保存当前登陆用户的更多信息，这个类可以将来用来做登陆日志，适当的时候也可以见建表，我们这里就不建表了，他和user表不同，user保存的是一个用户的基本信息，我们可以看看其中的区别。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">YdlLoginUser</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户唯一标识</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String token;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Date loginTime;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录IP地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String ipaddr;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录地点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String loginLocation;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 浏览器类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String browser;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 操作系统</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String os;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> YdlUser ydlUser;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编写登陆相关的controller：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;login&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;YdlLoginUser&gt; <span class="title">login</span><span class="params">(<span class="meta">@RequestBody</span> <span class="meta">@Validated</span> YdlUser ydlUser,BindingResult bindingResult)</span></span>&#123;</span><br><span class="line">    ydlLoginUser = userService.login(ydlUser.getUserName(),ydlUser.getPassword());</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok().body(ydlLoginUser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在处理登陆逻辑的service中了，此处需要使用一个依赖，该依赖能很轻松的获取浏览器和用户的一些信息，比如你的浏览器版本，操作系统版本：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>eu.bitwalker<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>UserAgentUtils<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们还需要一个发送http请求的工具类，这个工具类可以很轻松的发送请求，他是spring自带的，直接注入容器即可：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>具体的登陆逻辑如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> YdlLoginUser <span class="title">login</span><span class="params">(String userName, String password)</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1、登陆，使用用户名查询用户，没有查询到，说明没有该账户</span></span><br><span class="line">    YdlUser ydlUser = ydlUserDao.queryByUserName(userName);</span><br><span class="line">    <span class="keyword">if</span>(ydlUser == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> UserNotFoundException(<span class="string">&quot;执行登陆操作：【&quot;</span>+ userName +<span class="string">&quot;】该用户不存在&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2、如果查到了，比较比较密码，密码如果不正确，登陆失败</span></span><br><span class="line">    <span class="keyword">if</span>(!password.equals(ydlUser.getPassword()))&#123;</span><br><span class="line">        log.info(<span class="string">&quot;执行登陆操作：【&quot;</span>+ userName +<span class="string">&quot;】该用户密码输入错误&quot;</span>);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> PasswordIncorrectException(<span class="string">&quot;执行登陆操作：【&quot;</span>+ userName +<span class="string">&quot;】该用户密码输入错误&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3、如果验证成功了</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// (1) 生成token</span></span><br><span class="line">    String token = UUID.randomUUID().toString();</span><br><span class="line"></span><br><span class="line">    HttpServletRequest request = ((ServletRequestAttributes) Objects.requireNonNull(RequestContextHolder.getRequestAttributes())).getRequest();</span><br><span class="line">    UserAgent userAgent = <span class="keyword">new</span> UserAgent(request.getHeader(<span class="string">&quot;User-Agent&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过ip获取其所属的地址</span></span><br><span class="line">    ResponseEntity&lt;String&gt; result = restTemplate.getForEntity(<span class="string">&quot;https://whois.pconline.com.cn/ipJson.jsp?ip=&quot;</span>+request.getRemoteHost()+<span class="string">&quot;&amp;json=true&quot;</span>, String.class);</span><br><span class="line">    String body = result.getBody();</span><br><span class="line">    Map&lt;String,String&gt; map = objectMapper.readValue(body, <span class="keyword">new</span> TypeReference&lt;&gt;() &#123;&#125;);</span><br><span class="line"></span><br><span class="line">    String location = map.get(<span class="string">&quot;addr&quot;</span>)+map.get(<span class="string">&quot;pro&quot;</span>)+map.get(<span class="string">&quot;city&quot;</span>)+map.get(<span class="string">&quot;region&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// (2) 封装一个YdlLoginUser，保存在redis</span></span><br><span class="line">    YdlLoginUser ydlLoginUser = YdlLoginUser.builder()</span><br><span class="line">        .userId(ydlUser.getUserId())</span><br><span class="line">        .token(token)</span><br><span class="line">        .ipaddr(request.getRemoteAddr())</span><br><span class="line">        .loginTime(<span class="keyword">new</span> Date())</span><br><span class="line">        .os(userAgent.getOperatingSystem().getName())</span><br><span class="line">        .browser(userAgent.getBrowser().getName())</span><br><span class="line">        .loginLocation(location)</span><br><span class="line">        .ydlUser(ydlUser)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//key进行处理  token:username:uuid</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1、根据用户名生成一个key前缀token:username:</span></span><br><span class="line">    String keyPrefix =  Constants.TOKEN_PREFIX + userName +<span class="string">&quot;:&quot;</span>;</span><br><span class="line">    <span class="comment">// 2、查询token:username:前缀的数据</span></span><br><span class="line">    Set&lt;String&gt; keys = redisTemplate.keys(keyPrefix + <span class="string">&quot;*&quot;</span>);</span><br><span class="line">    <span class="comment">// 3、删除原来的数据</span></span><br><span class="line">    keys.forEach(key -&gt; redisTemplate.remove(key));</span><br><span class="line">    <span class="comment">// 4、把新的数据加入redis</span></span><br><span class="line">    redisTemplate.setObject(keyPrefix + token,ydlLoginUser,Constants.TOKEN_TIME);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ydlLoginUser;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="（3）前端store的处理"><a href="#（3）前端store的处理" class="headerlink" title="#（3）前端store的处理"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_3-前端store的处理">#</a>（3）前端store的处理</h4><p>思考，前端的数据可以存储在vuex中，也可以存在cookie中或者storage当中。</p>
<ul>
<li>vuex：数据是响应式的，但是刷新会清空。</li>
<li>cookie中或者storage：数据不是响应式的，刷新不影响。</li>
</ul>
<p>所以为了兼顾两者的优势，我们都使用。</p>
<p>为了方便使用我们创建一个工具类，这里只写了sessionStorage，你也可以加上localStorage:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">saveSessionString</span>(<span class="params">key,value</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">window</span>.sessionStorage.setItem(key,value);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">getSessionString</span>(<span class="params">key</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">window</span>.sessionStorage.getItem(key);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">saveSessionObject</span>(<span class="params">key,value</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">window</span>.sessionStorage.setItem(key,<span class="built_in">JSON</span>.stringify(value));</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">getSessionObject</span>(<span class="params">key</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(<span class="built_in">window</span>.sessionStorage.getItem(key));</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">remove</span>(<span class="params">key</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">window</span>.sessionStorage.removeItem(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>具体的业务逻辑：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">username</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">token</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">getters</span>: &#123;</span><br><span class="line">        <span class="function"><span class="title">userIsLogin</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> state.username !== <span class="string">&#x27;&#x27;</span> &amp;&amp; state.token !== <span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">permissions</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> state.permissions;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>: &#123;</span><br><span class="line">        <span class="function"><span class="title">SAVE_USER</span>(<span class="params">state, username</span>)</span> &#123;</span><br><span class="line">            state.username = username.trim();</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">SAVE_TOKEN</span>(<span class="params">state, token</span>)</span> &#123;</span><br><span class="line">            state.token = token.trim();</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">SAVE_ROLES</span>(<span class="params">state, roles</span>)</span> &#123;</span><br><span class="line">            state.roles = roles;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">SAVE_PERMISSIONS</span>(<span class="params">state, permissions</span>)</span> &#123;</span><br><span class="line">            state.permissions = permissions;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">actions</span>: &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 此处用来处理登陆的逻辑，如果登陆成功会在vuex中保存用户的信息</span></span><br><span class="line"><span class="comment">         * vuex中的用户信息用来报纸用户是否已经登录</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>param0 </span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>user </span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="title">LOGIN</span>(<span class="params">&#123;commit&#125;, user</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">            login(user).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (res.data.code === <span class="number">200</span>) &#123;</span><br><span class="line">                    <span class="comment">// vuex的使用是为了保障数据的响应式</span></span><br><span class="line">                    commit(<span class="string">&#x27;SAVE_USER&#x27;</span>, res.data.data.user.username);</span><br><span class="line">                    storage.saveSessionString(<span class="string">&quot;username&quot;</span>, res.data.data.user.username)</span><br><span class="line">                    commit(<span class="string">&#x27;SAVE_TOKEN&#x27;</span>, res.data.data.token);</span><br><span class="line">                    storage.saveSessionString(<span class="string">&quot;token&quot;</span>, res.data.data.token)</span><br><span class="line">                    router.push(&#123;</span><br><span class="line">                        <span class="attr">name</span>: <span class="string">&quot;main&quot;</span></span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">reslove</span> =&gt;</span> reslove(), <span class="function">() =&gt;</span> &#123; &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> user</span><br></pre></td></tr></table></figure>
<p>在login.vue中：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    <span class="function"><span class="title">login</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.$store.dispatch(<span class="string">&quot;LOGIN&quot;</span>, <span class="built_in">this</span>.user).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.$store.dispatch(<span class="string">&quot;GET_INFO&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>关键点来了，登陆之后我们可以获得登陆的数据还有一个token，我们其实想的是每次的访问携带上这个token这个应该怎么处理呢？</p>
<p>我们需要使用axios的拦截器，拦截请求，给每一个请求加一个header。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 添加请求拦截器</span></span><br><span class="line">request.interceptors.request.use(<span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 在发送请求之前做些什么</span></span><br><span class="line">  <span class="keyword">if</span> (store.state.user.token) &#123;</span><br><span class="line">    <span class="comment">//&#x27;Bearer &#x27;</span></span><br><span class="line">    config.headers[<span class="string">&#x27;Authorization&#x27;</span>] = store.state.user.token <span class="comment">// 让每个请求携带自定义token 请根据实际情况自行修改</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 对请求错误做些什么</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这样就好了呀！</p>
<p>那后端怎么判断当前请求的用户是否已经登陆了呢？当然是拦截器了，只是逻辑有些变化呀！</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CustomObjectMapper objectMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 判断有没有Authorization这个请求头，拿到首部信息的Authorization的值</span></span><br><span class="line">        ResponseEntity&lt;String&gt; res = ResponseEntity.status(<span class="number">401</span>).body(<span class="string">&quot;Bad Credentials!&quot;</span>);</span><br><span class="line">        String token = request.getHeader(Constants.HEAD_AUTHORIZATION);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (token == <span class="keyword">null</span>) &#123;</span><br><span class="line">            response.setStatus(<span class="number">401</span>);</span><br><span class="line">            response.getWriter().write(objectMapper.writeValueAsString(res));</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//        String tokenKey = Constants.TOKEN_PREFIX + request.getHeader(&quot;username&quot;)+&quot;:&quot;+token;</span></span><br><span class="line">        Set&lt;String&gt; keys = redisTemplate.keys(Constants.TOKEN_PREFIX + <span class="string">&quot;*&quot;</span> + token);</span><br><span class="line">        <span class="keyword">if</span> (keys== <span class="keyword">null</span> || keys.size() == <span class="number">0</span>)&#123;</span><br><span class="line">            response.setStatus(<span class="number">401</span>);</span><br><span class="line">            response.getWriter().write(objectMapper.writeValueAsString(res));</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String tokenKey = (String)keys.toArray()[<span class="number">0</span>];</span><br><span class="line">        <span class="comment">// 3、使用token去redis中查看，有没有对应的loginUser</span></span><br><span class="line">        YdlLoginUser ydlLoginUser = redisTemplate.getObject(tokenKey, <span class="keyword">new</span> TypeReference&lt;&gt;() &#123;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">if</span> (ydlLoginUser == <span class="keyword">null</span>) &#123;</span><br><span class="line">            response.setStatus(<span class="number">401</span>);</span><br><span class="line">            response.getWriter().write(objectMapper.writeValueAsString(res));</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 给token续命</span></span><br><span class="line">        redisTemplate.expire(tokenKey,Constants.TOKEN_TIME);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>目前，我们的前后端的核心内容就已经处理完了。</p>
<h4 id="（4）数据校验"><a href="#（4）数据校验" class="headerlink" title="#（4）数据校验"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_4-数据校验">#</a>（4）数据校验</h4><p>1、在前端处理表单数据：</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220221163325047.d029903e.png" alt="image-20220221163325047"></p>
<p><strong>选项式api的写法：</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-form</span> <span class="attr">ref</span>=<span class="string">&quot;formRef&quot;</span> <span class="attr">:rules</span>=<span class="string">&quot;loginRules&quot;</span> <span class="attr">:model</span>=<span class="string">&quot;user&quot;</span> <span class="attr">label-width</span>=<span class="string">&quot;60px&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>定义规则，定义在data中即可：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">loginRules: &#123;</span><br><span class="line">    <span class="attr">username</span>: [</span><br><span class="line">        &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;用户名不能为空&quot;</span> &#125;</span><br><span class="line">    ],</span><br><span class="line">        <span class="attr">password</span>: [</span><br><span class="line">            &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;密码不能为空&quot;</span> &#125;</span><br><span class="line">        ],</span><br><span class="line">            <span class="attr">code</span>: [&#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">trigger</span>: <span class="string">&quot;change&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;验证码不能为空&quot;</span> &#125;]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>使用以下方法包裹登陆的方法调用即可：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">login</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.$$refs.formRef.validate(<span class="function">(<span class="params">validate</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (validate) &#123;</span><br><span class="line">            <span class="comment">// 登陆完成后立刻获取用户的信息</span></span><br><span class="line">            <span class="built_in">this</span>.$store.dispatch(<span class="string">&quot;LOGIN&quot;</span>, <span class="built_in">this</span>.user).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.$store.dispatch(<span class="string">&quot;GET_INFO&quot;</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>后端的数据校验</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">YdlUser</span> <span class="keyword">extends</span> <span class="title">YdlBaseEntity</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">636710183710512845L</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户账号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="meta">@Size(min = 5,max = 15,message = &quot;用户名的长度应该在5到15之间&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户昵称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> String nickName;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用BindingResult对后端的数据进行校验：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;login&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;YdlLoginUser&gt; <span class="title">login</span><span class="params">(<span class="meta">@RequestBody</span> <span class="meta">@Validated</span> YdlUser ydlUser,BindingResult bindingResult)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 1、处理不合法的数据</span></span><br><span class="line">    System.out.println(ydlUser.getUserName()+<span class="string">&quot;&lt; &gt; ＜＞&quot;</span>);</span><br><span class="line">    List&lt;ObjectError&gt; allErrors = bindingResult.getAllErrors();</span><br><span class="line">    allErrors.forEach( error -&gt; log.error(<span class="string">&quot;登陆时用户校验失败：&#123;&#125;&quot;</span>,error.getDefaultMessage()));</span><br><span class="line">    <span class="keyword">if</span>(allErrors.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(<span class="number">500</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2、 执行登陆逻辑</span></span><br><span class="line">    YdlLoginUser ydlLoginUser = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ydlLoginUser = userService.login(ydlUser.getUserName(),ydlUser.getPassword());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(<span class="number">500</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok().body(ydlLoginUser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3、鉴权"><a href="#3、鉴权" class="headerlink" title="#3、鉴权"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_3、鉴权">#</a>3、鉴权</h3><h4 id="（1）后端处理鉴权"><a href="#（1）后端处理鉴权" class="headerlink" title="#（1）后端处理鉴权"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_1-后端处理鉴权">#</a>（1）后端处理鉴权</h4><p>定义获取权限信息的接口：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;getInfo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;HashMap&lt;String, List&lt;String&gt;&gt;&gt; getInfo() &#123;</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(<span class="keyword">this</span>.ydlUserService.getInfo());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>三表联查查询某个用户的权限信息：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getInfo&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;UserMap&quot;</span>&gt;</span></span><br><span class="line">    SELECT</span><br><span class="line">    u.user_id user_id,</span><br><span class="line">    username,</span><br><span class="line">    nick_name,</span><br><span class="line">    r.role_id,</span><br><span class="line">    r.role_name,</span><br><span class="line">    r.role_tag,</span><br><span class="line">    m.menu_id,</span><br><span class="line">    m.menu_name,</span><br><span class="line">    m.perms</span><br><span class="line">    FROM</span><br><span class="line">    ydl_user u</span><br><span class="line">    LEFT JOIN `ydl_user_role` ur ON u.user_id = ur.user_id</span><br><span class="line">    LEFT JOIN ydl_role r ON ur.role_id = r.role_id</span><br><span class="line">    LEFT JOIN ydl_role_menu rm ON r.role_id = rm.role_id</span><br><span class="line">    LEFT JOIN ydl_menu m ON rm.menu_id = m.menu_id</span><br><span class="line">    where u.del_flag = 0 and r.del_flag = 0 and u.user_id = #&#123;userId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>处理获取权限信息的业务：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> HashMap&lt;String,List&lt;String&gt;&gt; getInfo() &#123;</span><br><span class="line">    <span class="comment">// 1、获取当前登陆的对象</span></span><br><span class="line">    YdlLoginUser loginUser = getLoginUser();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2、查询当前用户的角色和权限</span></span><br><span class="line">    YdlUser info = ydlUserDao.getInfo(loginUser.getUserId());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3、处理权限和角色的相关信息</span></span><br><span class="line">    <span class="comment">// (1) roles:token : [admin,xxx,yyy]   perms:token: [system:user:add,system:user:update]</span></span><br><span class="line">    List&lt;String&gt; roleTags = info.getYdlRoles().stream().map(YdlRole::getRoleTag).collect(Collectors.toList());</span><br><span class="line">    redisTemplate.setObject(Constants.ROLE_PREFIX + loginUser.getToken(),roleTags,Constants.TOKEN_TIME);</span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; prems = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="comment">// [&#123;roleName:cc,roleTag:xxx,perms:[&#123;id,&#x27;xxx&#x27;,perm:&#x27;system&#x27;&#125;,&#123;id,&#x27;xxx&#x27;,perm:&#x27;system&#x27;&#125;]&#125;,&#123;&#125;]</span></span><br><span class="line">    <span class="comment">// [[&#123;id,&#x27;xxx&#x27;,perm:&#x27;system&#x27;&#125;,&#123;id,&#x27;xxx&#x27;,perm:&#x27;system&#x27;&#125;],[&#123;id,&#x27;xxx&#x27;,perm:&#x27;system&#x27;&#125;,&#123;id,&#x27;xxx&#x27;,perm:&#x27;system&#x27;&#125;]]</span></span><br><span class="line">    <span class="comment">// [&#x27;system&#x27;,&#x27;system:user:add&#x27;]</span></span><br><span class="line">    info.getYdlRoles().stream().map(YdlRole::getYdlMenus).forEach(menus -&gt; &#123;</span><br><span class="line">        prems.addAll(menus.stream().map(YdlMenu::getPerms).collect(Collectors.toList()));</span><br><span class="line">    &#125;);</span><br><span class="line">    redisTemplate.setObject(Constants.PERM_PREFIX + loginUser.getToken(),prems,Constants.TOKEN_TIME);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 整合数据</span></span><br><span class="line">    HashMap&lt;String,List&lt;String&gt;&gt; data = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    data.put(<span class="string">&quot;roles&quot;</span>,roleTags);</span><br><span class="line">    data.put(<span class="string">&quot;perms&quot;</span>,prems);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取当前登陆用户的方法</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> YdlLoginUser <span class="title">getLoginUser</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    HttpServletRequest request = ((ServletRequestAttributes) Objects.requireNonNull(RequestContextHolder.getRequestAttributes())).getRequest();</span><br><span class="line">    <span class="comment">// 获取首部信息的token</span></span><br><span class="line">    String token = request.getHeader(Constants.HEAD_AUTHORIZATION);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (token == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;当前用户未登录！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    Set&lt;String&gt; keys = redisTemplate.keys(Constants.TOKEN_PREFIX + <span class="string">&quot;*&quot;</span> + token);</span><br><span class="line">    <span class="keyword">if</span> (keys== <span class="keyword">null</span> || keys.size() == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;当前用户未登录！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    String tokenKey = (String)keys.toArray()[<span class="number">0</span>];</span><br><span class="line">    <span class="comment">// 3、使用token去redis中查看，有没有对应的loginUser</span></span><br><span class="line">    <span class="keyword">return</span> redisTemplate.getObject(tokenKey, <span class="keyword">new</span> TypeReference&lt;&gt;() &#123;&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>java在处理权限上的技巧：</p>
<p>我们已经获取了当前登陆用户的所有权限，但是怎么才能保障其他没有该权限的用户就不能访问这个接口呢？我们当然可以在每个方法里写上判断逻辑，但是显然是比较麻烦的。</p>
<p>这里我们就可以使用<strong>切面</strong>了，切面的核心功能之一就是抽离共同逻辑的代码，然后对目标方法进行增强。为了能够更加灵活的确定哪些接口需要设置权限，需要什么权限，我们使用注解进行标的。</p>
<p>定义以下两个注解：</p>
<p>这个注解用来标识一个接口需要拥有什么权限的人才能访问：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> HasPermission &#123;</span><br><span class="line">    String[] value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个注解用来标识一个接口需要拥有什么角色的人才能访问：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> HasRole &#123;</span><br><span class="line">    String[] value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用aop之前，我们需要开启自动代理：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PermissionAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行接口所需角色的切面</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hasRole</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before(&quot;@annotation(hasRole)&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">roleBefore</span><span class="params">(JoinPoint joinPoint, HasRole hasRole)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 获得当前方法所需要的角色</span></span><br><span class="line">        String[] needRoles = hasRole.value();</span><br><span class="line">        <span class="comment">// 获得拥有的角色</span></span><br><span class="line">        HttpServletRequest request = ((ServletRequestAttributes) Objects.requireNonNull(RequestContextHolder.getRequestAttributes())).getRequest();</span><br><span class="line">        String token = request.getHeader(Constants.HEAD_AUTHORIZATION);</span><br><span class="line">        List&lt;String&gt; hasRoles = redisTemplate.getObject(Constants.ROLE_PREFIX + token, <span class="keyword">new</span> TypeReference&lt;&gt;() &#123;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 只要所需的角色有一个在你拥有的角色中就放行</span></span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (String needRole : needRoles) &#123;</span><br><span class="line">            <span class="keyword">if</span> (hasRoles.contains(needRole)) &#123;</span><br><span class="line">                flag = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!flag) <span class="keyword">throw</span> <span class="keyword">new</span> RoleNeedHasException(<span class="string">&quot;您没有该接口所需要的角色&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;@annotation(hasPermission)&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">roleBefore</span><span class="params">(JoinPoint joinPoint, HasPermission hasPermission)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 获得当前方法所需要的权限</span></span><br><span class="line">        String[] needPermissions = hasPermission.value();</span><br><span class="line">        <span class="comment">// 获得拥有的权限</span></span><br><span class="line">        HttpServletRequest request = ((ServletRequestAttributes) Objects.requireNonNull(RequestContextHolder.getRequestAttributes())).getRequest();</span><br><span class="line">        String token = request.getHeader(Constants.HEAD_AUTHORIZATION);</span><br><span class="line">        List&lt;String&gt; hasPermissions = redisTemplate.getObject(Constants.PERM_PREFIX + token, <span class="keyword">new</span> TypeReference&lt;&gt;() &#123;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 只要所需的角色有一个在你拥有的角色中就放行</span></span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (String needPermission : needPermissions) &#123;</span><br><span class="line">            <span class="keyword">if</span> (hasPermissions.contains(needPermission)) &#123;</span><br><span class="line">                flag = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!flag) <span class="keyword">throw</span> <span class="keyword">new</span> PermissionNeedHasException(<span class="string">&quot;您没有该接口所需要的角色&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="（2）前端处理鉴权"><a href="#（2）前端处理鉴权" class="headerlink" title="#（2）前端处理鉴权"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_2-前端处理鉴权">#</a>（2）前端处理鉴权</h4><p>前端也是要保存权限信息的。前端的处理逻辑其实并不难，我们可以通过v-if来进行判断，但是v-if使用起来比较麻烦，我们采用一种新的技术-自定义指令。</p>
<p>首先，将获取的权限信息保存在vuex</p>
<p>完善一下store的代码</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">username</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">token</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">roles</span>: [],</span><br><span class="line">        <span class="attr">permissions</span>: []</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">getters</span>: &#123;</span><br><span class="line">        <span class="function"><span class="title">userIsLogin</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> state.username !== <span class="string">&#x27;&#x27;</span> &amp;&amp; state.token !== <span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">permissions</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> state.permissions;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>: &#123;</span><br><span class="line">        <span class="function"><span class="title">SAVE_USER</span>(<span class="params">state, username</span>)</span> &#123;</span><br><span class="line">            state.username = username.trim();</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">SAVE_TOKEN</span>(<span class="params">state, token</span>)</span> &#123;</span><br><span class="line">            state.token = token.trim();</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">SAVE_ROLES</span>(<span class="params">state, roles</span>)</span> &#123;</span><br><span class="line">            state.roles = roles;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">SAVE_PERMISSIONS</span>(<span class="params">state, permissions</span>)</span> &#123;</span><br><span class="line">            state.permissions = permissions;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">actions</span>: &#123;</span><br><span class="line">       <span class="function"><span class="title">LOGIN</span>(<span class="params">&#123; commit &#125;, user</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">                login(user).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">// 需要将获取的数据，保存起来</span></span><br><span class="line">                    commit(<span class="string">&quot;SAVE_USERNAME&quot;</span>, res.data.ydlUser.userName);</span><br><span class="line">                    commit(<span class="string">&quot;SAVE_NICKNAME&quot;</span>, res.data.ydlUser.nickName);</span><br><span class="line">                    commit(<span class="string">&quot;SAVE_TOKEN&quot;</span>, res.data.token);</span><br><span class="line">                    storage.saveSessionObject(<span class="string">&quot;loginUser&quot;</span>, res.data);</span><br><span class="line">                    resolve(res);</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">GET_INFO</span>(<span class="params">&#123; commit &#125;</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">                getInfo().then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">                    commit(<span class="string">&quot;SAVE_ROLES&quot;</span>, res.data.roles);</span><br><span class="line">                    commit(<span class="string">&quot;SAVE_PERMISSIONS&quot;</span>, res.data.perms);</span><br><span class="line">                    resolve();</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">LOGOUT</span>(<span class="params">&#123; commit &#125;</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">                logout().then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">// 需要将获取的数据，保存起来</span></span><br><span class="line">                    commit(<span class="string">&quot;SAVE_USERNAME&quot;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                    commit(<span class="string">&quot;SAVE_NICKNAME&quot;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                    commit(<span class="string">&quot;SAVE_TOKEN&quot;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                    storage.remove(<span class="string">&quot;loginUser&quot;</span>);</span><br><span class="line">                    resolve(res);</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> user</span><br></pre></td></tr></table></figure>
<p>我们可以通过自定义指令，建立directive目录用来存放新增的指令：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// v-hasPermissions=&quot;system:user:add,system:user:query&quot;</span></span><br><span class="line">    <span class="attr">hasPermission</span>: &#123;</span><br><span class="line">        <span class="function"><span class="title">mounted</span>(<span class="params">el, binding</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; value &#125; = binding</span><br><span class="line">            <span class="built_in">console</span>.log(value)</span><br><span class="line">            <span class="keyword">const</span> all_permission = <span class="string">&quot;*:*:*&quot;</span>;</span><br><span class="line">            <span class="keyword">const</span> permissions = store.getters &amp;&amp; store.getters.permissions</span><br><span class="line">            <span class="keyword">if</span> (value &amp;&amp; value <span class="keyword">instanceof</span> <span class="built_in">Array</span> &amp;&amp; value.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">const</span> hasPermissions = permissions.some(<span class="function"><span class="params">permission</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> all_permission === permission || value.includes(permission)</span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="keyword">if</span> (!hasPermissions) &#123;</span><br><span class="line">                    <span class="comment">// 移除掉当前的element</span></span><br><span class="line">                    el.parentNode &amp;&amp; el.parentNode.removeChild(el)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`请设置操作权限标签值`</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">hasRole</span>: &#123;</span><br><span class="line">        <span class="function"><span class="title">mounted</span>(<span class="params">el, binding</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; value &#125; = binding</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// const all_permission = &quot;admin&quot;;</span></span><br><span class="line">            <span class="keyword">const</span> permissions = store.getters &amp;&amp; store.getters.roles</span><br><span class="line">            <span class="keyword">if</span> (value &amp;&amp; value <span class="keyword">instanceof</span> <span class="built_in">Array</span> &amp;&amp; value.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(value)</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;p--&quot;</span>+permissions)</span><br><span class="line">                <span class="keyword">const</span> hasRoles = permissions.some(<span class="function"><span class="params">role</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> value.includes(role)</span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="keyword">if</span> (!hasRoles) &#123;</span><br><span class="line">                    <span class="comment">// 移除掉当前的element</span></span><br><span class="line">                    el.parentNode &amp;&amp; el.parentNode.removeChild(el)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`请设置操作权限标签值`</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在main.js中保存</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 安装所有的自定义指令</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> directives )&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(key)</span><br><span class="line">    app.directive(key,directives[key]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以后所有的组件都可以使用了。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">v-hasPermi</span>=<span class="string">&quot;[&#x27;system:user:edit&#x27;]&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">:icon</span>=<span class="string">&quot;Edit&quot;</span> &gt;</span>编辑<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>1</p>
<h2 id="七、日志的处理"><a href="#七、日志的处理" class="headerlink" title="#七、日志的处理"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#七、日志的处理">#</a>七、日志的处理</h2><ul>
<li>日志是一个系统中比较重要的部分，用来记录与业务相关的信息，但是又和业务本身无关，需要和业务主体松耦合。日志我们可以输出在控制台，日志文件以及数据库。</li>
<li>日志的输出通常伴随着IO，其中大量的日志输出可能会导致阻塞，举个例子，我们有一张日志表，当所有的接口都向这张表插入操作数据的时候会因为update语句频繁锁表，而导致业务接口执行缓慢。所以我们的日志输出通常是要使用异步操作的，使用独立的线程池来完成异步日志的处理，这样日志的阻塞不会影响其他的业务。</li>
</ul>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220221102631555.6872c014.png" alt="image-20220221102631555"></p>
<h3 id="1、普通日志"><a href="#1、普通日志" class="headerlink" title="#1、普通日志"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_1、普通日志">#</a>1、普通日志</h3><p>我们已经配置了日志相关的内容，通用的日志我们选择了slf4j+logback。logback的配置我们不再详细介绍，有兴趣的同学可以查看我前边的日志相关的教程。当然logback也是支持<strong>异步日志</strong>的，如果需要可以进行配置。但是文件的日志不会有类似锁表的情况，仅仅存在一些iO，所以按照公司要求配置即可。</p>
<h3 id="2、数据库日志"><a href="#2、数据库日志" class="headerlink" title="#2、数据库日志"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#_2、数据库日志">#</a>2、数据库日志</h3><p>有些时候，我们同样需要将一些日志记录在数据库，比如一些接口调用的日志，用户登陆的日志等。这种日志通常有以下几个特点：</p>
<p>（1）日志的打印方式雷同，数据格式雷同</p>
<p>（2）日志通常无需和业务耦合</p>
<p>（3）日通通常伴随IO，锁表等问题，可能会影响核心业务的执行</p>
<p>针对以上的问题，我们的处理逻辑通常是如下，这里我们以操作日志为例：</p>
<blockquote>
<p>定义如下的实体类，我们使用逆向工程生成对应代码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OperLog</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 日志主键</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long operId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 日志内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 业务类型（0其它 1新增 2修改 3删除）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer businessType;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * api方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String method;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 请求方式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String requestMethod;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 操作人员</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String operName;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 请求url</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String operUrl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 操作地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String operIp;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 操作状态（0正常 1异常）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 错误消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String errorMsg;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 操作时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date operTime;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以定义如下注解，用来记录日志所属的模块，功能，</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Log &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 日志内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">String <span class="title">content</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">String <span class="title">businessType</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot; </span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogAspect</span> <span class="keyword">implements</span> <span class="title">BeanFactoryAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    CustomObjectMapper objectMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    YdlOperLogService ydlOperLogService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用BeanFactoryAware注入一个BeanFactory，后续我们需要获取自身的bean时使用</span></span><br><span class="line">    <span class="keyword">private</span> BeanFactory beanFactory;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBeanFactory</span><span class="params">(BeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.beanFactory = beanFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理完请求后执行</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint 切点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterReturning(pointcut = &quot;@annotation(controllerLog)&quot;, returning = &quot;result&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterReturning</span><span class="params">(JoinPoint joinPoint, Log controllerLog, Object result)</span> </span>&#123;</span><br><span class="line">        HttpServletRequest request = ((ServletRequestAttributes) Objects.requireNonNull(RequestContextHolder.getRequestAttributes())).getRequest();</span><br><span class="line">        <span class="comment">// === handleLog是经过代理的异步方法，不能直接简单的进行方法调用</span></span><br><span class="line">        <span class="comment">// === 正确的调用方法是，获取bean对象（这是个代理对象）调用</span></span><br><span class="line">        LogAspect logAspect = beanFactory.getBean(LogAspect.class);</span><br><span class="line">        logAspect.handleLog(joinPoint, controllerLog, <span class="keyword">null</span>, result, request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 拦截异常操作</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint 切点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e         异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterThrowing(value = &quot;@annotation(controllerLog)&quot;, throwing = &quot;e&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterThrowing</span><span class="params">(JoinPoint joinPoint, Log controllerLog, Exception e)</span> </span>&#123;</span><br><span class="line">        HttpServletRequest request = ((ServletRequestAttributes) Objects.requireNonNull(RequestContextHolder.getRequestAttributes())).getRequest();</span><br><span class="line">        LogAspect logAspect = beanFactory.getBean(LogAspect.class);</span><br><span class="line">        logAspect.handleLog(joinPoint, controllerLog, e, <span class="keyword">null</span>, request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理日志的逻辑</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> controllerLog</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> result</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Async(&quot;ydlExecutor&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleLog</span><span class="params">(<span class="keyword">final</span> JoinPoint joinPoint, Log controllerLog, <span class="keyword">final</span> Exception e, Object result, HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 获取当前的用户</span></span><br><span class="line">            Optional&lt;LoginUser&gt; loginUser = redisTemplate.getObject(Constants.TOKEN_PREFIX + request.getHeader(Constants.HEADER_AUTH), LoginUser.class);</span><br><span class="line"></span><br><span class="line">            loginUser.ifPresent(user -&gt; &#123;</span><br><span class="line">                <span class="comment">// ========数据库日志=========//</span></span><br><span class="line">                YdlOperLog ydlOperLog = <span class="keyword">new</span> YdlOperLog();</span><br><span class="line">                <span class="comment">// 设置一些基本信息</span></span><br><span class="line">                ydlOperLog.setStatus(<span class="number">500</span>);</span><br><span class="line">                ydlOperLog.setOperIp(user.getIpaddr());</span><br><span class="line">                ydlOperLog.setOperUrl(request.getRequestURI());</span><br><span class="line">                ydlOperLog.setOperName(user.getUser().getUsername());</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    ydlOperLog.setStatus(<span class="number">200</span>);</span><br><span class="line">                    ydlOperLog.setErrorMsg(e.getMessage().substring(<span class="number">0</span>, <span class="number">2000</span>));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 设置方法名称</span></span><br><span class="line">                String className = joinPoint.getTarget().getClass().getName();</span><br><span class="line">                String methodName = joinPoint.getSignature().getName();</span><br><span class="line">                ydlOperLog.setMethod(className + <span class="string">&quot;.&quot;</span> + methodName + <span class="string">&quot;()&quot;</span>);</span><br><span class="line">                <span class="comment">// 设置请求方式</span></span><br><span class="line">                ydlOperLog.setRequestMethod(request.getMethod());</span><br><span class="line">                <span class="comment">// 处理设置注解上的参数</span></span><br><span class="line">                <span class="comment">// 设置action动作</span></span><br><span class="line">                ydlOperLog.setBusinessType(controllerLog.businessType());</span><br><span class="line">                <span class="comment">// 设置标题</span></span><br><span class="line">                ydlOperLog.setContent(controllerLog.content());</span><br><span class="line">                ydlOperLog.setOperTime(<span class="keyword">new</span> Date());</span><br><span class="line">                <span class="comment">// 保存数据库</span></span><br><span class="line">                ydlOperLogService.insert(ydlOperLog);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception exp) &#123;</span><br><span class="line">            <span class="comment">// 记录本地异常日志</span></span><br><span class="line">            log.error(<span class="string">&quot;==前置通知异常==&quot;</span>);</span><br><span class="line">            log.error(<span class="string">&quot;异常信息:&#123;&#125;&quot;</span>, exp.getMessage());</span><br><span class="line">            exp.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然，我们还可以自己创建线程池，如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 线程池配置</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadPoolConfig</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 核心线程池大小</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> corePoolSize = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 最大可创建的线程数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxPoolSize = <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 队列最大长度</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> queueCapacity = <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 线程池维护线程所允许的空闲时间</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> keepAliveSeconds = <span class="number">300</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;threadPoolTaskExecutor&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ThreadPoolExecutor <span class="title">threadPoolExecutor</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        xxxxxx;</span><br><span class="line">        <span class="keyword">return</span> executor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3、Spring自带的异步任务"><a href="#3、Spring自带的异步任务" class="headerlink" title="3、Spring自带的异步任务"></a>3、Spring自带的异步任务</h3><h2 id="八、表单重复提交"><a href="#八、表单重复提交" class="headerlink" title="#八、表单重复提交"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#八、表单重复提交">#</a>八、表单重复提交</h2><p>这个问题通常也叫做<strong>幂等性问题</strong>，就是同一个请求【多次提交】的效果和【一次提交】的效果一样，产生这种问题的原因可能是因为网络抖动，用户多次提交，用户错误操作，如疯狂刷新浏览器，或者有人故意为之等。</p>
<p>解决表单重复提交的方式其实有很多，在这个问题上，我们其实有很多可以思考的地方：</p>
<p>1、如果是前端表单，我们可以设计成这个样子：提交按钮点击后变为disable的（无法重复点击，但这是一个治标不治本的方案），保证表单只能提交一次，但是永远要记住前端的一切都是给普通人设计的，是无法防止恶意攻击者的。</p>
<p>2、后端的解决方案，最简单的就是在数据库设置唯一约束，如果是重复的提交，数据库层面就会抛出异常，无法保存。</p>
<p>3、有没有更高级，普适一点的想法？比如我们可以拿个本子记录一下，最近5秒内有哪些接口被调用过，接口被调用时，先去本子里查一下，有的话就阻止继续执行。</p>
<blockquote>
<p>今天我们就选取这中方案：</p>
</blockquote>
<p>（1）我们首先定义一个注解，以后的controller中的接口如果需要防重复提交就加上这个注解：</p>
<p>注解中的value代表我们防止重复提交的默认时间：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Repeat &#123;</span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> 10</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注解通常可以使用在add，update这一类接口上，delete和query是没有必要的，因为这两种接口本身就是幂等性的。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Repeat(5)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;YdlUser&gt; <span class="title">add</span><span class="params">(<span class="meta">@RequestBody</span> YdlUser ydlUser)</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> itnanls(微信)</span></span><br><span class="line"><span class="comment"> * 我们的服务： 一路陪跑，顺利就业</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RepeatSubmitInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CustomObjectMapper customObjectMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (handler <span class="keyword">instanceof</span> HandlerMethod) &#123;</span><br><span class="line">            <span class="comment">// 获取我们的controller方法</span></span><br><span class="line">            HandlerMethod handlerMethod = (HandlerMethod) handler;</span><br><span class="line">            Method method = handlerMethod.getMethod();</span><br><span class="line">            <span class="comment">// 判断是否有防止重复提交的注解</span></span><br><span class="line">            Repeat annotation = method.getAnnotation(Repeat.class);</span><br><span class="line">            <span class="keyword">if</span> (annotation != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.isRepeatSubmit(request, annotation)) &#123;</span><br><span class="line">                    <span class="comment">// 如果确定是重复提交，直接响应失败</span></span><br><span class="line">                    ResponseEntity&lt;String&gt; body = ResponseEntity.status(<span class="number">500</span>).body(<span class="string">&quot;您重复提交了当前的请求！&quot;</span>);</span><br><span class="line">                    response.setStatus(<span class="number">500</span>);</span><br><span class="line">                    response.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">                    response.getWriter().write(customObjectMapper.writeValueAsString(body));</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isRepeatSubmit</span><span class="params">(HttpServletRequest request, Repeat annotation)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 获取参数列表，并序列化</span></span><br><span class="line">        String nowParams = customObjectMapper.writeValueAsString(request.getParameterMap());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 请求地址（作为存放cache的key值）</span></span><br><span class="line">        String url = request.getRequestURI();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 唯一值（没有消息头则使用请求地址）</span></span><br><span class="line">        String token = request.getHeader(Constants.HEAD_AUTHORIZATION);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获得body的数据</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 唯一标识（指定key + url + 消息头）</span></span><br><span class="line">        String cacheRepeatKey = Constants.REPEAT_SUBMIT_KEY  + token + <span class="string">&quot;:&quot;</span> + url;</span><br><span class="line">        <span class="comment">// 如果redis中没有存在这个key，说明这个请求是重复提交</span></span><br><span class="line">        String preParams = redisTemplate.get(cacheRepeatKey);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (preParams != <span class="keyword">null</span> &amp;&amp; preParams.equals(nowParams)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 否则我就存入redis，注意设置过期时间</span></span><br><span class="line">        redisTemplate.set(cacheRepeatKey, nowParams, annotation.value());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="九、防止xss攻击"><a href="#九、防止xss攻击" class="headerlink" title="#九、防止xss攻击"></a><a href="https://www.ydlclass.com/doc21xnv/frame/ssm/#九、防止xss攻击">#</a>九、防止xss攻击</h2><ul>
<li>XSS攻击通常指的是通过利用网页开发时留下的漏洞，注入恶意指令代码到网页，使用户加载并执行攻击者恶意制造的网页程序。这些恶意网页程序通常是JavaScript，攻击成功后，攻击者可能得到包括但不限于更高的权限（如执行一些操作）、私密网页内容、会话和cookie等各种内容。 [1]</li>
<li>例如在注册用户的时候，或者一些文章中，加入一些script脚本<code>&lt;a href=&quot;javascript:alert(\&#39;ydl\&#39;)&quot; /&gt;http://www.ydlclass.com&lt;/a&gt;</code>，我们可能会防不胜防，或者是一些其他的标签。</li>
<li>目前，很多组件或者框架其实已经对大部分的xss攻击做了防御措施，例如在vue中除非我们使用v-hmtl这类标签，否这一边的xss攻击是没有效果的，但是如果我们的项目没有使用vue，而是使用原生的html那么就可能产生问题。</li>
<li>解决xss攻击的核心方法就是处理掉那些可能产生问题的标签，或者通过<strong>转义</strong>，或者将<strong>半角的尖括号转化为全角</strong>，在或者直接干掉一些特殊标签。</li>
</ul>
<p><strong>注意：</strong>这里有一个问题，我们怎么保证每一个请求中携带的数据都进行一个转化，下边是一个请求的流转过程？</p>
<p>一个请求报文到达tomcat之后会被封装成一个request对象</p>
<p>1、请求到达过滤器能不能替换？可以，而且方便，改头换面最好在门口就处理好了。</p>
<p>2、请求到达dispatcherServlet后能不能替换？不好替换，事实上也行，我们继承dispatcherServlet然后重写他的一些方法也可以了，不建议？</p>
<p>3、请求到达controller后能不能替换？能，但是所有的请求都要执行处理逻辑。</p>
<p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220221132911696.f53b223e.png" alt="image-20220221132911696"></p>
<p>首先，我们先编写一个工具类用来处理字符串中的标签，我们只做简单处理，将半角的尖括号转化为全角：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XssUtil</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将容易引起xss漏洞的半角字符直接替换成全角字符</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> s</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">xssEncode</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (s == <span class="keyword">null</span> || <span class="string">&quot;&quot;</span>.equals(s)) &#123;</span><br><span class="line">            <span class="keyword">return</span> s;</span><br><span class="line">        &#125;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder(s.length() + <span class="number">16</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">char</span> c = s.charAt(i);</span><br><span class="line">            <span class="keyword">switch</span> (c) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;&gt;&#x27;</span>:</span><br><span class="line">                    sb.append(<span class="string">&#x27;＞&#x27;</span>);<span class="comment">//全角大于号</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;&lt;&#x27;</span>:</span><br><span class="line">                    sb.append(<span class="string">&#x27;＜&#x27;</span>);<span class="comment">//全角小于号</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;\&#x27;&#x27;</span>:</span><br><span class="line">                    sb.append(<span class="string">&#x27;‘&#x27;</span>);<span class="comment">//全角单引号</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;\&quot;&#x27;</span>:</span><br><span class="line">                    sb.append(<span class="string">&#x27;“&#x27;</span>);<span class="comment">//全角双引号</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;&amp;&#x27;</span>:</span><br><span class="line">                    sb.append(<span class="string">&#x27;＆&#x27;</span>);<span class="comment">//全角</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;\\&#x27;</span>:</span><br><span class="line">                    sb.append(<span class="string">&#x27;＼&#x27;</span>);<span class="comment">//全角斜线</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;#&#x27;</span>:</span><br><span class="line">                    sb.append(<span class="string">&#x27;＃&#x27;</span>);<span class="comment">//全角井号</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    sb.append(c);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们对request进行一个包装，在包装的request中将参数统一进行处理：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XssHttpServletRequestWrapper</span> <span class="keyword">extends</span> <span class="title">HttpServletRequestWrapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HttpServletRequest orgRequest;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">XssHttpServletRequestWrapper</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(request);</span><br><span class="line">        orgRequest = request;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重写这几个方法，并且处理xss</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getParameter</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> XssUtil.xssEncode(<span class="keyword">super</span>.getParameter(XssUtil.xssEncode(name)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, String[]&gt; getParameterMap() &#123;</span><br><span class="line">        Map&lt;String, String[]&gt; parameterMap = <span class="keyword">super</span>.getParameterMap();</span><br><span class="line">        Map&lt;String, String[]&gt; newParameterMap = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">8</span>);</span><br><span class="line">        <span class="keyword">for</span>(Map.Entry&lt;String, String[]&gt; entry : parameterMap.entrySet())&#123;</span><br><span class="line">            <span class="comment">// 处理key的标签</span></span><br><span class="line">            String newKey = XssUtil.xssEncode(entry.getKey());</span><br><span class="line">            <span class="comment">// 处理value的标签</span></span><br><span class="line">            String[] params = entry.getValue();</span><br><span class="line">            String[] newParams = <span class="keyword">new</span> String[params.length];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; params.length; i++) &#123;</span><br><span class="line">                newParams[i] = XssUtil.xssEncode(params[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            newParameterMap.put(newKey,newParams);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> newParameterMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] getParameterValues(String name) &#123;</span><br><span class="line">        String[] parameterValues = <span class="keyword">super</span>.getParameterValues(XssUtil.xssEncode(name));</span><br><span class="line">        String[] newParams = <span class="keyword">new</span> String[parameterValues.length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; parameterValues.length; i++) &#123;</span><br><span class="line">            newParams[i] = XssUtil.xssEncode(parameterValues[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> newParams;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果将来想继续使用原始的request，可以通过这个方法获取</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HttpServletRequest <span class="title">getOrgRequest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> orgRequest;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>写一个过滤器，将原生的request给置换掉</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XssFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        <span class="comment">// 这个过滤器的左右，仅仅是讲原始的request进行一个包装，通过子类去处理恶意标签</span></span><br><span class="line">        filterChain.doFilter(<span class="keyword">new</span> XssHttpServletRequestWrapper((HttpServletRequest) servletRequest),servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>redis_advance</title>
    <url>/2022/07/03/redis-advance/</url>
    <content><![CDATA[<h1 id="一、知识点回顾"><a href="#一、知识点回顾" class="headerlink" title="一、知识点回顾"></a>一、知识点回顾</h1><h2 id="1-redis-基础数据类型"><a href="#1-redis-基础数据类型" class="headerlink" title="1. redis 基础数据类型"></a>1. redis 基础数据类型</h2><ul>
<li><p>String类型</p>
<ul>
<li>get [key]  —-获取值</li>
<li>set [key] [val] —-设置值</li>
</ul>
</li>
<li><p>hash (Map) 类型</p>
<p>field代表map的key</p>
<ul>
<li>hdel [key] [field]..  —-删除一个或多个指定的map键值对</li>
<li>hget key field —-获取键值</li>
<li>hset key field value  —-设置键值</li>
<li>hkeys key —-获取key对应map的所有键值</li>
</ul>
</li>
<li><p>list </p>
<ul>
<li>lpop key1 —-移出并获取列表的第一个元素</li>
<li>rpop key1 —-移出并获取列表的最后一个元素</li>
<li>lindex key index —-通过索引获取列表中的元素</li>
<li>linsert key BEFORE|AFTER pivot value —-在列表的元素前或者后插入元素</li>
<li>llen key —-获取列表长度</li>
<li>lrange key start stop —-获取指定index范围的元素值（start和stop都包含）</li>
</ul>
</li>
<li>set 类型<ul>
<li>Set 是 String 类型的无序集合。集合成员是唯一的</li>
<li>sadd key member1 [member2] —-向集合添加一个或多个成员</li>
<li>scard key —-获取集合成员个数</li>
<li>sinter key1 [key2]] —-返回给定所有集合的交集</li>
<li>[ sunion key1 [key2]] 返回所有给定集合的并集</li>
<li>srem key member1 [member2] —-移除集合中一个或多个成员</li>
<li>spop key —-移除并返回集合中的一个随机元素</li>
<li>smembers key —-返回集合中的所有成员</li>
<li>sismember key member —-判断 member 元素是否是集合 key 的成员</li>
</ul>
</li>
<li>sorted set 类型<ul>
<li>[zadd key score1 member1 [score2 member2]向有序集合添加一个或多个成员，或者更新已存在成员的分数</li>
<li>[zcount key min max] —-计算在有序集合中指定区间分数的成员数</li>
<li>zrange key start stop —-通过索引区间返回有序集合指定区间内的成员</li>
<li>zrangebyscore key min max —-通过分数返回有序集合指定区间内的成员</li>
<li>zrank key member —-返回有序集合中指定成员的索引</li>
</ul>
</li>
</ul>
<h2 id="2-jedis"><a href="#2-jedis" class="headerlink" title="2. jedis"></a>2. jedis</h2><p>基本使用</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Jedis j = new Jedis(&quot;localhost&quot;, 6379);</span><br></pre></td></tr></table></figure>
<ul>
<li>主要jedis是线程不安全的，因此每个线程要使用单独的jedis对象</li>
<li>因此一般会使用jedis连接池来管理jedis对象</li>
</ul>
<p>连接池</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisPoolUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> JedisPool jedisPool;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        JedisPoolConfig  jedisPoolConfig = <span class="keyword">new</span> JedisPoolConfig();</span><br><span class="line">        jedisPoolConfig.setMinIdle(<span class="number">0</span>);</span><br><span class="line">        jedisPoolConfig.setMaxIdle(<span class="number">8</span>);</span><br><span class="line">        jedisPoolConfig.setMaxTotal(<span class="number">8</span>);</span><br><span class="line">        jedisPoolConfig.setMaxWaitMillis(<span class="number">200</span>);</span><br><span class="line">        jedisPool = <span class="keyword">new</span> JedisPool(jedisPoolConfig,<span class="string">&quot;localhost&quot;</span>, <span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Jedis <span class="title">getResource</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> jedisPool.getResource();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="二、SpringDateRedis"><a href="#二、SpringDateRedis" class="headerlink" title="二、SpringDateRedis"></a>二、SpringDateRedis</h1><p>SpringData是Spring中数据操作的模块，包含对各种数据库的集成，其中对Redis的集成模块就叫做SpringDataRedis</p>
<ul>
<li><p>提供了对不同Redis客户端的整合(Lettuce和Jedis )</p>
</li>
<li><p>提供了RedisTemplate统一API来操作Redis</p>
</li>
<li><p>支持Redis的发布订阅模型</p>
</li>
<li><p>支持Redis哨兵和Redis集群</p>
</li>
<li><p>支持基于Lettuce的响应式编程</p>
</li>
<li><p>支持基于JDK、JSON、字符串、Spring对象的数据序列化及反序列化</p>
</li>
<li>支持基于Redis的JDKcollection实现</li>
</ul>
<h2 id="1-RedisTemplate"><a href="#1-RedisTemplate" class="headerlink" title="1. RedisTemplate"></a>1. RedisTemplate</h2><p>使用步骤：</p>
<ol>
<li><p>创建springboot项目导入依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写测试类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedistemplateApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String username = (String)(redisTemplate.opsForValue().get(<span class="string">&quot;username&quot;</span>));</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;lx&quot;</span>);</span><br><span class="line">        Object name = redisTemplate.opsForValue().get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(name);</span><br><span class="line">        System.out.println(username);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>运行结果：</p>
<p><img src="/2022/07/03/redis-advance/image-20220703145636274.png" alt="image-20220703145636274"></p>
<p>redis中的值：</p>
<p><img src="/2022/07/03/redis-advance/image-20220703145735470.png" alt="image-20220703145735470"></p>
<p><img src="/2022/07/03/redis-advance/image-20220703145803441.png" alt="image-20220703145803441"></p>
<p><strong>可以发现，我们并没有将username键的值取出，存入的name值也没有以我们期望的形式保存在redis数据库中</strong></p>
<p>这是因为RedisTemplate存入的键值都是object类型，它将我们传入的对象使用默认的JDK的序列化器（将java对象转换为字节），序列化成了redis数据库可以理解的字节的形式存储。</p>
<p>源码：</p>
<p><img src="/2022/07/03/redis-advance/image-20220703150717824.png" alt="image-20220703150717824"></p>
<p><img src="/2022/07/03/redis-advance/image-20220703150528116.png" alt="image-20220703150528116"></p>
<h2 id="2-自定义序列化器"><a href="#2-自定义序列化器" class="headerlink" title="2. 自定义序列化器"></a>2. 自定义序列化器</h2><p><img src="/2022/07/03/redis-advance/image-20220703151043608.png" alt="image-20220703151043608"></p>
<p>键一般都是字符串类型 采用StringRedisSerializer</p>
<p>值则可能是对象，则可以使用GenericJackson2JsonRedisSerializer 序列化为json形式</p>
<h3 id="1-自定义RedisTemplate注入Spring容器"><a href="#1-自定义RedisTemplate注入Spring容器" class="headerlink" title="1. 自定义RedisTemplate注入Spring容器"></a>1. 自定义RedisTemplate注入Spring容器</h3><ul>
<li>编写配置类，注入自定义的RedisTemplate</li>
<li>在自定义的RedisTemplate中</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String,Object&gt; <span class="title">myRedisTemplate</span><span class="params">(RedisConnectionFactory connectionFactory)</span></span>&#123;</span><br><span class="line">        <span class="comment">//创建RedisTemplate对象</span></span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">        <span class="comment">//设置连接工厂</span></span><br><span class="line">        template.setConnectionFactory(connectionFactory);</span><br><span class="line">        <span class="comment">//创建JSON序列化工具</span></span><br><span class="line">        GenericJackson2JsonRedisSerializer jsonRedisSerializer = <span class="keyword">new</span> GenericJackson2JsonRedisSerializer();</span><br><span class="line">        <span class="comment">//设置key序列化</span></span><br><span class="line">        template.setKeySerializer(RedisSerializer.string());</span><br><span class="line">        template.setHashKeySerializer(RedisSerializer.string());</span><br><span class="line">        <span class="comment">//设置value序列化</span></span><br><span class="line">        template.setValueSerializer(jsonRedisSerializer);</span><br><span class="line">        template.setHashValueSerializer(jsonRedisSerializer);</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再次进行测试：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedistemplateApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource(name=&quot;myRedisTemplate&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;lx&quot;</span>);</span><br><span class="line">        Object name = redisTemplate.opsForValue().get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(name);</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setAge(<span class="number">12</span>);</span><br><span class="line">        user.setName(<span class="string">&quot;lx&quot;</span>);</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;user:1&quot;</span>,user);</span><br><span class="line">        User o = (User) redisTemplate.opsForValue().get(<span class="string">&quot;user:1&quot;</span>);</span><br><span class="line">        System.out.println(o);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现string类型和对象都按照定义的类型进行存储了</p>
<p><img src="/2022/07/03/redis-advance/image-20220703154752049.png" alt="image-20220703154752049"></p>
<h3 id="2-手动对对象序列化节省空间"><a href="#2-手动对对象序列化节省空间" class="headerlink" title="2. 手动对对象序列化节省空间"></a>2. 手动对对象序列化节省空间</h3><p>在存储对象时额外存储了对象class类型，在项目规模很大的情况下这种内存开销是十分大的。</p>
<ul>
<li>因此我们可以手动进行对象的序列化和反序列化来节省空间开销</li>
</ul>
<p>实现：</p>
<p>SpringDataRedis 自带了StringRedisTemplate处理键值都是字符串的对象</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedistemplateApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">myStringUser</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setName(<span class="string">&quot;shen&quot;</span>);</span><br><span class="line">        user.setAge(<span class="number">999</span>);</span><br><span class="line">        stringRedisTemplate.opsForValue().set(<span class="string">&quot;user:2&quot;</span>,objectMapper.writeValueAsString(user));</span><br><span class="line">        String s = stringRedisTemplate.opsForValue().get(<span class="string">&quot;user:2&quot;</span>);</span><br><span class="line">        User user1 = objectMapper.readValue(s, User.class);</span><br><span class="line">        System.out.println(user1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/07/03/redis-advance/image-20220703162002917.png" alt="image-20220703162002917"></p>
<h1 id="三、黑马点评项目"><a href="#三、黑马点评项目" class="headerlink" title="三、黑马点评项目"></a>三、黑马点评项目</h1><h2 id="1-项目初始化"><a href="#1-项目初始化" class="headerlink" title="1. 项目初始化"></a>1. 项目初始化</h2><ul>
<li>数据库：</li>
</ul>
<p><img src="/2022/07/03/redis-advance/image-20220703164559167.png" alt="image-20220703164559167" style="zoom:80%;"></p>
<ul>
<li><p>导入后端代码：</p>
<ul>
<li>修改数据库和redis配置</li>
</ul>
</li>
<li><p>启动nginx（前端代码已经打包好存放在nginx的html目录下）</p>
<ul>
<li><p>到nginx根目录下开启cmd窗口</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">start nginx</span><br><span class="line">访问localhost:8080</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h2 id="2-短信登录（腾讯云）"><a href="#2-短信登录（腾讯云）" class="headerlink" title="2. 短信登录（腾讯云）"></a>2. 短信登录（腾讯云）</h2><ul>
<li>前置条件<ul>
<li>在腾讯云平台开启短信服务</li>
<li>创建短信签名、短信模板、应用等待审核</li>
<li>获取账户密钥对、应用id、短信签名内容、短信模板id，以待后续认证</li>
</ul>
</li>
</ul>
<h3 id="发送简单内容模板"><a href="#发送简单内容模板" class="headerlink" title="发送简单内容模板"></a>发送简单内容模板</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmdp.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.tencentcloudapi.common.Credential;</span><br><span class="line"><span class="keyword">import</span> com.tencentcloudapi.common.exception.TencentCloudSDKException;</span><br><span class="line"><span class="keyword">import</span> com.tencentcloudapi.common.profile.ClientProfile;</span><br><span class="line"><span class="keyword">import</span> com.tencentcloudapi.common.profile.HttpProfile;</span><br><span class="line"><span class="keyword">import</span> com.tencentcloudapi.sms.v20210111.SmsClient;</span><br><span class="line"><span class="keyword">import</span> com.tencentcloudapi.sms.v20210111.models.SendSmsRequest;</span><br><span class="line"><span class="keyword">import</span> com.tencentcloudapi.sms.v20210111.models.SendSmsResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lixu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-07-09-15:35</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SendSmsUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String secretID;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String secretKey;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;TengXunYun.SmsSecretID&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSecretID</span><span class="params">(String secretID)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.secretID = secretID;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;TengXunYun.SmsSecretKey&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSecretKey</span><span class="params">(String secretKey)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.secretKey = secretKey;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sendSms</span><span class="params">(String phone,String</span></span></span><br><span class="line"><span class="params"><span class="function">            expirationTime,String verificationCode)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">/* 必要步骤：</span></span><br><span class="line"><span class="comment">             * 实例化一个认证对象，入参需要传入腾讯云账户密钥对secretId，secretKey。</span></span><br><span class="line"><span class="comment">             * 这里采用的是从环境变量读取的方式，需要在环境变量中先设置这两个值。</span></span><br><span class="line"><span class="comment">             * 你也可以直接在代码中写死密钥对，但是小心不要将代码复制、上传或者分享给他人，</span></span><br><span class="line"><span class="comment">             * 以免泄露密钥对危及你的财产安全。</span></span><br><span class="line"><span class="comment">             * SecretId、SecretKey 查询: https://console.cloud.tencent.com/cam/capi */</span></span><br><span class="line">            Credential cred = <span class="keyword">new</span> Credential(secretID, secretKey);</span><br><span class="line">            <span class="comment">/* 实例化要请求产品(以sms为例)的client对象</span></span><br><span class="line"><span class="comment">             * 第二个参数是地域信息，可以直接填写字符串ap-guangzhou，支持的地域列表参考 https://cloud.tencent.com/document/api/382/52071#.E5.9C.B0.E5.9F.9F.E5.88.97.E8.A1.A8 */</span></span><br><span class="line">            SmsClient client = <span class="keyword">new</span> SmsClient(cred, <span class="string">&quot;ap-guangzhou&quot;</span>);</span><br><span class="line">            <span class="comment">/* 实例化一个请求对象，根据调用的接口和实际情况，可以进一步设置请求参数</span></span><br><span class="line"><span class="comment">             * 你可以直接查询SDK源码确定接口有哪些属性可以设置</span></span><br><span class="line"><span class="comment">             * 属性可能是基本类型，也可能引用了另一个数据结构</span></span><br><span class="line"><span class="comment">             * 推荐使用IDE进行开发，可以方便的跳转查阅各个接口和数据结构的文档说明 */</span></span><br><span class="line">            SendSmsRequest req = <span class="keyword">new</span> SendSmsRequest();</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* 填充请求参数,这里request对象的成员变量即对应接口的入参</span></span><br><span class="line"><span class="comment">             * 你可以通过官网接口文档或跳转到request对象的定义处查看请求参数的定义</span></span><br><span class="line"><span class="comment">             * 基本类型的设置:</span></span><br><span class="line"><span class="comment">             * 帮助链接：</span></span><br><span class="line"><span class="comment">             * 短信控制台: https://console.cloud.tencent.com/smsv2</span></span><br><span class="line"><span class="comment">             * 腾讯云短信小助手: https://cloud.tencent.com/document/product/382/3773#.E6.8A.80.E6.9C.AF.E4.BA.A4.E6.B5.81 */</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">/* 短信应用ID: 短信SdkAppId在 [短信控制台] 添加应用后生成的实际SdkAppId，示例如1400006666 */</span></span><br><span class="line">            <span class="comment">// 应用 ID 可前往 [短信控制台](https://console.cloud.tencent.com/smsv2/app-manage) 查看</span></span><br><span class="line">            String sdkAppId = <span class="string">&quot;1400682973&quot;</span>;</span><br><span class="line">            req.setSmsSdkAppId(sdkAppId);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* 短信签名内容: 使用 UTF-8 编码，必须填写已审核通过的签名 */</span></span><br><span class="line">            <span class="comment">// 签名信息可前往 [国内短信](https://console.cloud.tencent.com/smsv2/csms-sign) 或 [国际/港澳台短信](https://console.cloud.tencent.com/smsv2/isms-sign) 的签名管理查看</span></span><br><span class="line">            String signName = <span class="string">&quot;*******&quot;</span>;</span><br><span class="line">            req.setSignName(signName);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* 模板 ID: 必须填写已审核通过的模板 ID */</span></span><br><span class="line">            <span class="comment">// 模板 ID 可前往 [国内短信](https://console.cloud.tencent.com/smsv2/csms-template) 或 [国际/港澳台短信](https://console.cloud.tencent.com/smsv2/isms-template) 的正文模板管理查看</span></span><br><span class="line">            String templateId = <span class="string">&quot;*******&quot;</span>;</span><br><span class="line">            req.setTemplateId(templateId);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* 模板参数: 模板参数的个数需要与 TemplateId 对应模板的变量个数保持一致，若无模板参数，则设置为空 */</span></span><br><span class="line">            String[] templateParamSet = &#123;verificationCode,expirationTime&#125;;</span><br><span class="line">            req.setTemplateParamSet(templateParamSet);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* 下发手机号码，采用 E.164 标准，+[国家或地区码][手机号]</span></span><br><span class="line"><span class="comment">             * 示例如：+8613711112222， 其中前面有一个+号 ，86为国家码，13711112222为手机号，最多不要超过200个手机号 */</span></span><br><span class="line">            String[] phoneNumberSet = &#123;<span class="string">&quot;+86&quot;</span>+phone&#125;;</span><br><span class="line">            req.setPhoneNumberSet(phoneNumberSet);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* 通过 client 对象调用 SendSms 方法发起请求。注意请求方法名与请求对象是对应的</span></span><br><span class="line"><span class="comment">             * 返回的 res 是一个 SendSmsResponse 类的实例，与请求对象对应 */</span></span><br><span class="line">            SendSmsResponse res = client.SendSms(req);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 输出json格式的字符串回包</span></span><br><span class="line">            System.out.println(SendSmsResponse.toJsonString(res));</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (TencentCloudSDKException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="3-登录流程（基于session）"><a href="#3-登录流程（基于session）" class="headerlink" title="3. 登录流程（基于session）"></a>3. 登录流程（基于session）</h2><p><img src="/2022/07/03/redis-advance/1.png" alt="image-20220709163005468"></p>
<h3 id="3-1-发送验证码并保存"><a href="#3-1-发送验证码并保存" class="headerlink" title="3.1 发送验证码并保存"></a>3.1 发送验证码并保存</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendSms</span><span class="params">(String phone, HttpSession session)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1. 生成验证码</span></span><br><span class="line">    String verificationCode = RandomUtil.randomNumbers(<span class="number">6</span>);</span><br><span class="line">    <span class="comment">//2. 将验证码存入session</span></span><br><span class="line">    session.setAttribute(SystemConstants.USER_VARIFICATION_CODE,verificationCode);</span><br><span class="line">    <span class="comment">//3. 发送验证码</span></span><br><span class="line">    SendSmsUtils.sendSms(phone,<span class="string">&quot;5&quot;</span>,verificationCode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-2-登录"><a href="#3-2-登录" class="headerlink" title="3.2 登录"></a>3.2 登录</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">login</span><span class="params">(LoginFormDTO loginForm, HttpSession session)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//校验手机号</span></span><br><span class="line">    <span class="keyword">if</span>(RegexUtils.isPhoneInvalid(loginForm.getPhone()))&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;手机号格式错误&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//校验验证码</span></span><br><span class="line">    <span class="keyword">if</span>(RegexUtils.isCodeInvalid(loginForm.getCode()))&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;验证码格式错误&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//1. 获取session中的验证码</span></span><br><span class="line">    String verificode = (String) session.getAttribute(SystemConstants.USER_VARIFICATION_CODE);</span><br><span class="line">    <span class="comment">//2. 比对验证码是否正确</span></span><br><span class="line">    <span class="keyword">if</span>(loginForm.getCode()==<span class="keyword">null</span>||!loginForm.getCode().equals(verificode))&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;验证码错误&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//3. 查询手机号是否存在</span></span><br><span class="line">    User user = lambdaQuery().eq(User::getPhone, loginForm.getPhone()).one();</span><br><span class="line">    <span class="keyword">if</span>(user==<span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="comment">//3.2. 不存在则创建用户</span></span><br><span class="line">        user = createUser(loginForm.getPhone());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//3.1. 存在则登录</span></span><br><span class="line">    <span class="comment">//4. 保存用户信息到session</span></span><br><span class="line">    UserDTO userDTO = <span class="keyword">new</span> UserDTO();</span><br><span class="line">    BeanUtil.copyProperties(user,userDTO);</span><br><span class="line">    session.setAttribute(<span class="string">&quot;user&quot;</span>,userDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-3-登录验证"><a href="#3-3-登录验证" class="headerlink" title="3.3 登录验证"></a>3.3 登录验证</h3><ul>
<li><p>编写拦截器判断session中是否保存了登录用户信息，进行放行或拦截</p>
</li>
<li><p>在拦截器中将用户信息保存到ThreadLocal中便于后续取出</p>
<ul>
<li>UserHolder自定义类中维护了一个ThreadLocal的成员变量，对增删操作进行了封装</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Object user = request.getSession().getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(user==<span class="keyword">null</span>)&#123;</span><br><span class="line">            response.setStatus(<span class="number">401</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        UserHolder.saveUser((UserDTO) user);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写配置类实现WebMvcConfigurer接口，将注册器注册到WebMvc中</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebMvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        WebMvcConfigurer.<span class="keyword">super</span>.addInterceptors(registry);</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> UserLoginInterceptor()).excludePathPatterns(</span><br><span class="line">                <span class="string">&quot;/user/login&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/user/code&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/blog/hot&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/shop/**&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/shop-type/**&quot;</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写controller向前端返回当前登录用户信息</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/me&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">me</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 获取当前登录的用户并返回</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(UserHolder.getUser());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="4-使用redis优化登录流程"><a href="#4-使用redis优化登录流程" class="headerlink" title="4. 使用redis优化登录流程"></a>4. 使用redis优化登录流程</h2><p>Session操作简单，但是存在一些问题。</p>
<ul>
<li>会占用服务器的资源。</li>
<li>它对分布式的支持也是一个问题（如：将来我们可能会有多台 web服务器，但是 session 可能是存储在其中一台，而另外一台是没有办法去使用的。</li>
</ul>
<h3 id="4-1-将短信验证码使用redis保存"><a href="#4-1-将短信验证码使用redis保存" class="headerlink" title="4.1 将短信验证码使用redis保存"></a>4.1 将短信验证码使用redis保存</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendSms</span><span class="params">(String phone, HttpSession session)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1. 生成验证码</span></span><br><span class="line">        String verificationCode = RandomUtil.randomNumbers(<span class="number">6</span>);</span><br><span class="line">        <span class="comment">//2. 将验证码存入Redis</span></span><br><span class="line">        stringRedisTemplate.opsForValue().set(LOGIN_CODE_KEY+phone,verificationCode,LOGIN_CODE_TTL);</span><br><span class="line">        <span class="comment">//3. 发送验证码</span></span><br><span class="line">        SendSmsUtils.sendSms(phone,<span class="string">&quot;2&quot;</span>,verificationCode);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-使用Redis优化登录流程"><a href="#4-2-使用Redis优化登录流程" class="headerlink" title="4.2 使用Redis优化登录流程"></a>4.2 使用Redis优化登录流程</h3><ul>
<li><p>从redis获取验证码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1. 从redis中获取验证码</span></span><br><span class="line">String verificode = stringRedisTemplate.opsForValue().get(LOGIN_CODE_KEY+loginForm.getPhone());</span><br></pre></td></tr></table></figure>
</li>
<li><p>生成用户信息存储key</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String token = UUID.randomUUID().toString(<span class="keyword">true</span>);</span><br><span class="line">String key = LOGIN_USER_KEY+token;</span><br></pre></td></tr></table></figure>
</li>
<li><p>将用户信息存入redis</p>
<ul>
<li>注意：因为在这里使用的时StringRedisTemplate，再进行Map的写入时只能接收String类型的数据，直接传入Long类型的id时会报错，需要进行转换</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//4. 保存用户信息到Redis</span></span><br><span class="line"><span class="comment">//stringRedisTemplate.opsForHash().putAll(key,BeanUtil.beanToMap(userDTO));</span></span><br><span class="line">stringRedisTemplate.opsForHash().putAll(key,BeanUtil.beanToMap(userDTO,<span class="keyword">new</span> HashMap&lt;String,Object&gt;(), CopyOptions.create().ignoreNullValue().setFieldValueEditor((name,value)-&gt;value.toString())));</span><br><span class="line"><span class="keyword">return</span> Result.ok(token);</span><br></pre></td></tr></table></figure>
</li>
<li><p>将用户token返回给前端</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> Result.ok(token);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="4-3-修改拦截器逻辑"><a href="#4-3-修改拦截器逻辑" class="headerlink" title="4.3 修改拦截器逻辑"></a>4.3 修改拦截器逻辑</h3><ul>
<li><p>从redis中取出登录用户信息(如果没有则进行拦截)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1 获取前端token</span></span><br><span class="line">String token = request.getHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line"><span class="comment">//2 从redis中获取用户信息</span></span><br><span class="line">Map&lt;Object, Object&gt; entries = stringRedisTemplate.opsForHash().entries(RedisConstants.LOGIN_USER_KEY + token);</span><br><span class="line"><span class="keyword">if</span>(entries.isEmpty())&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>将用户信息存入ThreadLocal</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//将用户信息存入ThreadLocal</span></span><br><span class="line">UserHolder.saveUser(user);</span><br><span class="line"><span class="comment">//延长时间</span></span><br><span class="line">stringRedisTemplate.expire(RedisConstants.LOGIN_USER_KEY+token,RedisConstants.LOGIN_USER_TTL, TimeUnit.SECONDS);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>​    上述通过拦截器实现用户登录状态操作延时是存在问题的，因为我们自定义的拦截器并不是拦截了所有的请求，因此存在用户一直在进行操作但是登录还是过期的情况。</p>
<ul>
<li><p>新增额外的拦截器，拦截所有请求来实现登录状态时间刷新功能</p>
<ul>
<li>此拦截器只进行token刷新，不进行拦截操作</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//1 获取前端token</span></span><br><span class="line">        String token = request.getHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isBlank(token))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//2 从redis中获取用户信息</span></span><br><span class="line">        Map&lt;Object, Object&gt; entries = stringRedisTemplate.opsForHash().entries(RedisConstants.LOGIN_USER_KEY + token);</span><br><span class="line">        <span class="keyword">if</span>(entries.isEmpty())&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        UserDTO user = BeanUtil.fillBeanWithMap(entries,<span class="keyword">new</span> UserDTO(),<span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">//3. 将用户信息存入ThreadLocal</span></span><br><span class="line">        UserHolder.saveUser(user);</span><br><span class="line">        <span class="comment">//4. 延长时间</span></span><br><span class="line">        stringRedisTemplate.expire(RedisConstants.LOGIN_USER_KEY+token,RedisConstants.LOGIN_USER_TTL, TimeUnit.SECONDS);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>更新之前的登录拦截器，直接从ThreadLocal中取数据来判断是否登录</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    UserDTO user = UserHolder.getUser();</span><br><span class="line">    <span class="keyword">if</span>(user==<span class="keyword">null</span>)&#123;</span><br><span class="line">        response.setStatus(<span class="number">401</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="5-首页商户信息缓存"><a href="#5-首页商户信息缓存" class="headerlink" title="5. 首页商户信息缓存"></a>5. 首页商户信息缓存</h2><h3 id="5-1-查询时将商户信息缓存到redis中"><a href="#5-1-查询时将商户信息缓存到redis中" class="headerlink" title="5.1 查询时将商户信息缓存到redis中"></a>5.1 查询时将商户信息缓存到redis中</h3><p>基本流程：</p>
<p><img src="/2022/07/03/redis-advance/2.png" alt="image-20220712170617729" style="zoom:50%;"></p>
<p>代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line">StringRedisTemplate stringRedisTemplate;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">queryShopById</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1. 查询redis</span></span><br><span class="line">    String shop = stringRedisTemplate.opsForValue().get(RedisConstants.CACHE_SHOP_KEY + id);</span><br><span class="line">    <span class="keyword">if</span>(StringUtils.isBlank(shop))&#123;</span><br><span class="line">        <span class="comment">//2. 如果缓存中没有数据，查询数据库</span></span><br><span class="line">        Shop shop1 = <span class="keyword">this</span>.getById(id);</span><br><span class="line">        <span class="keyword">if</span>(shop1!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">//3. 如果数据存在则写入缓存,返回数据</span></span><br><span class="line">            String shopstr = JSONUtil.toJsonStr(shop1);</span><br><span class="line">            stringRedisTemplate.opsForValue().set(RedisConstants.CACHE_SHOP_KEY + id,shopstr);</span><br><span class="line">            <span class="keyword">return</span> Result.ok(shop1);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//4. 如果数据不存在，返回错误信息</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;商户不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果缓存中有数据则返回</span></span><br><span class="line">    Shop shop1 = JSONUtil.toBean(shop, Shop.class);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(shop1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-2-缓存数据一致性问题"><a href="#5-2-缓存数据一致性问题" class="headerlink" title="5.2 缓存数据一致性问题"></a>5.2 缓存数据一致性问题</h3><p>上述缓存方式存在数据一致性问题：</p>
<ul>
<li>如果将数据库数据缓存到redis后，数据进行了更新，这时redis中存储的仍然是旧数据，这时就产生了数据一致性的问题</li>
</ul>
<p>解决办法：</p>
<ul>
<li>在缓存时设置过期时间，缓存到期后再进行查询会重新查询数据库，更新数据。</li>
<li>在数据更新时删除对应数据的redis缓存（再单击情况下采用事务保证原子性，分布式情况下需要使用TCC等分布式事务方案）</li>
</ul>
<p><strong>注意：</strong></p>
<ul>
<li><p>更新数据库和删除缓存操作的先后顺序不同会影响系统的一致性</p>
<ul>
<li><p>先删除缓存再更新数据库可能存在的问题</p>
<ul>
<li>A修改数据库数据，B在修改过程中请求了这条数据<ol>
<li>A删除数据缓存</li>
<li>B请求缓存数据，发现数据不存在</li>
<li>B请求数据库</li>
<li>A修改数据库数据</li>
<li>B将数据存入redis中</li>
</ol>
</li>
</ul>
<p><strong>分析</strong>：这时就产生了数据不一致的问题，redis中存储的是旧数据。由于redis读写和数据库读的操作相较于数据库写入是十分快的，因此这种情况发生的概率很大。</p>
</li>
<li><p>先更新数据库再删除缓存的问题</p>
<ul>
<li>如果请求数据的缓存失效<ol>
<li>B 请求缓存数据</li>
<li>B 查询数据库</li>
<li>A 修改数据库</li>
<li>A 删除缓存</li>
<li>B 更新缓存</li>
</ol>
</li>
</ul>
<p><strong>分析</strong>：这种情况出现的概率很低，因为数据库的写往往要比数据库查询，缓存读写要慢</p>
</li>
</ul>
</li>
</ul>
<p><strong>综上所述：</strong>推荐先更新数据库再删除redis缓存。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">updateWithRedis</span><span class="params">(Shop shop)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(shop.getId()==<span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;商户id不能为空&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//先更新数据库</span></span><br><span class="line">    <span class="keyword">boolean</span> b = updateById(shop);</span><br><span class="line">    <span class="comment">//删除缓存</span></span><br><span class="line">    stringRedisTemplate.delete(RedisConstants.CACHE_SHOP_KEY + shop.getId());</span><br><span class="line">    <span class="keyword">return</span> Result.ok(<span class="string">&quot;更新成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-3-缓存穿透问题"><a href="#5-3-缓存穿透问题" class="headerlink" title="5.3 缓存穿透问题"></a>5.3 缓存穿透问题</h3><p>redis缓存穿透问题是指，用户频繁访问数据库不存在的数据，这种请求全部无法在缓存中直接获取数据，都会直接访问数据库。</p>
<p>关系型数据库读写性能消耗大，不能很好的支持高并发请求，如果有人恶意的进行针对性攻击，数据库存在宕机的风险。</p>
<p><strong>解决办法：</strong></p>
<ol>
<li><p>在处理请求时进行校验，例如使用bloom filter来判断请求数据是否存在（bloom filter如果判断是不存在则一定不存在，如果结果为存在则也有可能不存在）</p>
</li>
<li><p>缓存空数据</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(shop!=<span class="keyword">null</span>&amp;&amp;shop.equals(<span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">return</span> Result.fail(<span class="string">&quot;商户不存在&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line"><span class="comment">//4. 如果数据不存在，返回错误信息</span></span><br><span class="line">stringRedisTemplate.opsForValue().set(RedisConstants.CACHE_SHOP_KEY + id,<span class="string">&quot;0&quot;</span>,RedisConstants.CACHE_NULL_TTL, TimeUnit.MINUTES);</span><br><span class="line"><span class="keyword">return</span> Result.fail(<span class="string">&quot;商户不存在&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="5-4-缓存雪崩问题"><a href="#5-4-缓存雪崩问题" class="headerlink" title="5.4 缓存雪崩问题"></a>5.4 缓存雪崩问题</h3><p>缓存雪崩问题是指缓存中的大量数据在几乎同一时间失效，这时如果有请求则大概率会直接访问数据库，会导致数据库压力增大。</p>
<p>产生的原因：</p>
<ul>
<li>批量操作时设置了相同的缓存过期时间</li>
</ul>
<p><strong>解决办法：</strong></p>
<ol>
<li>在批量操作设置缓存时间时加上一个随机数，以此来保证缓存不同时失效</li>
</ol>
<h3 id="5-5-缓存击穿问题"><a href="#5-5-缓存击穿问题" class="headerlink" title="5.5 缓存击穿问题"></a>5.5 缓存击穿问题</h3><p>缓存击穿问题产生在高并发访问并且重建缓存时间消耗大的数据缓存失效时。高并发的数据缓存一旦失效，大量请求会同时发现缓存失效，并同时访问数据库，重新构建缓存，这些无效操作会导致数据库访问量激增。</p>
<p><strong>解决方案</strong>：</p>
<ol>
<li>使用互斥锁来保证大量请求中只有一个可以查询数据库更新缓存（当一个任务竞争多个锁时有死锁风险）</li>
<li>使用逻辑过期，对于并发量大的数据缓存不真正设置过期时间，而是在缓存中保存一个逻辑过期时间，在访问时判断一下数据是否过期，如果过期则开启一个独立的线程来更新缓存，自身返回旧数据</li>
</ol>
<p><strong>总结</strong>：相较于方法1方法2舍弃了一定的数据一致性，但是方法2节省了互斥锁等待重试的时间开销，提升了系统的可用性。</p>
<p><strong>互斥锁实现：</strong></p>
<p><img src="/2022/07/03/redis-advance/3.png" alt="image-20220713150418602" style="zoom:80%;"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//缓存击穿、互斥锁实现</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Shop <span class="title">queryShopLock</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1. 查询redis</span></span><br><span class="line">    String shop = stringRedisTemplate.opsForValue().get(RedisConstants.CACHE_SHOP_KEY + id);</span><br><span class="line">    <span class="keyword">if</span>(shop!=<span class="keyword">null</span>&amp;&amp;shop.equals(<span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果缓存未命中</span></span><br><span class="line">    <span class="keyword">if</span>(StringUtils.isBlank(shop))&#123;</span><br><span class="line">        <span class="comment">//获取互斥锁</span></span><br><span class="line">        String lockkey = RedisConstants.LOCK_SHOP_KEY+id;</span><br><span class="line">        <span class="keyword">boolean</span> flag = getLock(lockkey);</span><br><span class="line">        <span class="comment">//获取锁失败，休眠一段时间后重试</span></span><br><span class="line">        <span class="keyword">if</span>(!flag)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">50</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> queryShopLock(id);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//成功则再次查询缓存、判断是否存在</span></span><br><span class="line">                String redisshop = stringRedisTemplate.opsForValue().get(RedisConstants.CACHE_SHOP_KEY + id);</span><br><span class="line">                <span class="comment">//存在直接返回值</span></span><br><span class="line">                <span class="keyword">if</span>(!StringUtils.isBlank(redisshop))&#123;</span><br><span class="line">                    <span class="keyword">return</span> JSONUtil.toBean(redisshop,Shop.class);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//不存在、查询数据库、将数据写入redis并返回结果</span></span><br><span class="line">                Shop shop1 = <span class="keyword">this</span>.getById(id);</span><br><span class="line">                <span class="keyword">if</span>(shop1!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                    <span class="comment">//3. 如果数据存在则写入缓存,返回数据</span></span><br><span class="line">                    String shopstr = JSONUtil.toJsonStr(shop1);</span><br><span class="line">                    stringRedisTemplate.opsForValue().set(RedisConstants.CACHE_SHOP_KEY + id,shopstr,RedisConstants.CACHE_SHOP_TTL, TimeUnit.MINUTES);</span><br><span class="line">                    <span class="keyword">return</span> shop1;</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//4. 如果数据不存在，返回错误信息</span></span><br><span class="line">                    stringRedisTemplate.opsForValue().set(RedisConstants.CACHE_SHOP_KEY + id,<span class="string">&quot;0&quot;</span>,RedisConstants.CACHE_NULL_TTL, TimeUnit.MINUTES);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                unLock(lockkey);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//缓存命中则返回结果</span></span><br><span class="line">        <span class="keyword">return</span> JSONUtil.toBean(shop,Shop.class);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>逻辑过期：</strong></p>
<p><img src="/2022/07/03/redis-advance/4.png" alt="image-20220713183630394" style="zoom:80%;"></p>
<p><strong>代码实现</strong>：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//缓存击穿、逻辑过期</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Shop <span class="title">queryCacheLogicalExpire</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1. 查询redis</span></span><br><span class="line">    String shop = stringRedisTemplate.opsForValue().get(RedisConstants.CACHE_SHOP_KEY + id);</span><br><span class="line">    <span class="keyword">if</span>(shop==<span class="keyword">null</span>||shop.equals(<span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    RedisData redisData = JSONUtil.toBean(shop, RedisData.class);</span><br><span class="line">    <span class="comment">//2. 判断reids存储的数据是否到期</span></span><br><span class="line">    <span class="keyword">if</span>(redisData.getExpireTime().isBefore(LocalDateTime.now()))&#123;</span><br><span class="line">        <span class="comment">//3. 到期则竞争锁</span></span><br><span class="line">        String lockkey = RedisConstants.LOCK_SHOP_KEY+id;</span><br><span class="line">        <span class="keyword">boolean</span> lock = getLock(lockkey);</span><br><span class="line">        <span class="comment">//4. 如果竞争锁成功则开启线程异步更新redis数据</span></span><br><span class="line">        <span class="keyword">if</span>(lock)&#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">                Shop byId = getById(id);</span><br><span class="line">                String shopkey = RedisConstants.CACHE_SHOP_KEY+id;</span><br><span class="line">                <span class="keyword">if</span>(byId==<span class="keyword">null</span>)&#123;</span><br><span class="line">                    stringRedisTemplate.opsForValue().set(shopkey,<span class="string">&quot;0&quot;</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    RedisData redisData1 = <span class="keyword">new</span> RedisData();</span><br><span class="line">                    redisData1.setData(byId);</span><br><span class="line">                    redisData1.setExpireTime(LocalDateTime.now().plusHours(<span class="number">1</span>));</span><br><span class="line">                    stringRedisTemplate.opsForValue().set(shopkey,JSONUtil.toJsonStr(redisData1));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//5. 失败则返回旧数据</span></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> JSONUtil.toBean((JSONObject) redisData.getData(),Shop.class);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> JSONUtil.toBean((JSONObject) redisData.getData(),Shop.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong></p>
<p>在代码实现是使用了RedisData类对结果进行返回</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisData</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime expireTime;</span><br><span class="line">    <span class="keyword">private</span> Object data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所有需要进行逻辑过期来解决缓存击穿问题的数据都可以使用这个对象返回数据。</p>
<p>但是在使用hutool JSONUtil工具类进行反序列化时由于data属性是Object类型，在不知道具体类型的情况下会将其转换为JSONObject类型，因此在获取data对象时首先需要将其转换为JSONObject对象，然后通过JSONUtil.toBean()方法转换为我们需要的类型。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">JSONUtil.toBean((JSONObject) redisData.getData(),Shop.class);</span><br></pre></td></tr></table></figure>
<p><strong>使用线程池进行优化：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line">executorService.submit(()-&gt;&#123;</span><br><span class="line">                    Shop byId = getById(id);</span><br><span class="line">                    String shopkey = RedisConstants.CACHE_SHOP_KEY+id;</span><br><span class="line">                    <span class="keyword">if</span>(byId==<span class="keyword">null</span>)&#123;</span><br><span class="line">                        stringRedisTemplate.opsForValue().set(shopkey,<span class="string">&quot;0&quot;</span>);</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        RedisData redisData1 = <span class="keyword">new</span> RedisData();</span><br><span class="line">                        redisData1.setData(byId);</span><br><span class="line">                        redisData1.setExpireTime(LocalDateTime.now().plusHours(<span class="number">1</span>));</span><br><span class="line">                        stringRedisTemplate.opsForValue().set(shopkey,JSONUtil.toJsonStr(redisData1));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br></pre></td></tr></table></figure>
<h2 id="6-优惠卷秒杀"><a href="#6-优惠卷秒杀" class="headerlink" title="6. 优惠卷秒杀"></a>6. 优惠卷秒杀</h2>]]></content>
      <categories>
        <category>redis</category>
      </categories>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title>sendSms</title>
    <url>/2022/07/09/sendSms/</url>
    <content><![CDATA[<h1 id="发送短信"><a href="#发送短信" class="headerlink" title="发送短信"></a>发送短信</h1><h2 id="1、-腾讯云平台发送短信"><a href="#1、-腾讯云平台发送短信" class="headerlink" title="1、 腾讯云平台发送短信"></a>1、 腾讯云平台发送短信</h2><ul>
<li>前置条件<ul>
<li>在腾讯云平台开启短信服务</li>
<li>创建短信签名、短信模板、应用等待审核</li>
<li>获取账户密钥对、应用id、短信签名内容、短信模板id，以待后续认证</li>
</ul>
</li>
</ul>
<h3 id="发送简单内容模板"><a href="#发送简单内容模板" class="headerlink" title="发送简单内容模板"></a>发送简单内容模板</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmdp.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.tencentcloudapi.common.Credential;</span><br><span class="line"><span class="keyword">import</span> com.tencentcloudapi.common.exception.TencentCloudSDKException;</span><br><span class="line"><span class="keyword">import</span> com.tencentcloudapi.common.profile.ClientProfile;</span><br><span class="line"><span class="keyword">import</span> com.tencentcloudapi.common.profile.HttpProfile;</span><br><span class="line"><span class="keyword">import</span> com.tencentcloudapi.sms.v20210111.SmsClient;</span><br><span class="line"><span class="keyword">import</span> com.tencentcloudapi.sms.v20210111.models.SendSmsRequest;</span><br><span class="line"><span class="keyword">import</span> com.tencentcloudapi.sms.v20210111.models.SendSmsResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lixu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-07-09-15:35</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SendSmsUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String secretID;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String secretKey;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;TengXunYun.SmsSecretID&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSecretID</span><span class="params">(String secretID)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.secretID = secretID;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;TengXunYun.SmsSecretKey&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSecretKey</span><span class="params">(String secretKey)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.secretKey = secretKey;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sendSms</span><span class="params">(String phone,String</span></span></span><br><span class="line"><span class="params"><span class="function">            expirationTime,String verificationCode)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">/* 必要步骤：</span></span><br><span class="line"><span class="comment">             * 实例化一个认证对象，入参需要传入腾讯云账户密钥对secretId，secretKey。</span></span><br><span class="line"><span class="comment">             * 这里采用的是从环境变量读取的方式，需要在环境变量中先设置这两个值。</span></span><br><span class="line"><span class="comment">             * 你也可以直接在代码中写死密钥对，但是小心不要将代码复制、上传或者分享给他人，</span></span><br><span class="line"><span class="comment">             * 以免泄露密钥对危及你的财产安全。</span></span><br><span class="line"><span class="comment">             * SecretId、SecretKey 查询: https://console.cloud.tencent.com/cam/capi */</span></span><br><span class="line">            Credential cred = <span class="keyword">new</span> Credential(secretID, secretKey);</span><br><span class="line">            <span class="comment">/* 实例化要请求产品(以sms为例)的client对象</span></span><br><span class="line"><span class="comment">             * 第二个参数是地域信息，可以直接填写字符串ap-guangzhou，支持的地域列表参考 https://cloud.tencent.com/document/api/382/52071#.E5.9C.B0.E5.9F.9F.E5.88.97.E8.A1.A8 */</span></span><br><span class="line">            SmsClient client = <span class="keyword">new</span> SmsClient(cred, <span class="string">&quot;ap-guangzhou&quot;</span>);</span><br><span class="line">            <span class="comment">/* 实例化一个请求对象，根据调用的接口和实际情况，可以进一步设置请求参数</span></span><br><span class="line"><span class="comment">             * 你可以直接查询SDK源码确定接口有哪些属性可以设置</span></span><br><span class="line"><span class="comment">             * 属性可能是基本类型，也可能引用了另一个数据结构</span></span><br><span class="line"><span class="comment">             * 推荐使用IDE进行开发，可以方便的跳转查阅各个接口和数据结构的文档说明 */</span></span><br><span class="line">            SendSmsRequest req = <span class="keyword">new</span> SendSmsRequest();</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* 填充请求参数,这里request对象的成员变量即对应接口的入参</span></span><br><span class="line"><span class="comment">             * 你可以通过官网接口文档或跳转到request对象的定义处查看请求参数的定义</span></span><br><span class="line"><span class="comment">             * 基本类型的设置:</span></span><br><span class="line"><span class="comment">             * 帮助链接：</span></span><br><span class="line"><span class="comment">             * 短信控制台: https://console.cloud.tencent.com/smsv2</span></span><br><span class="line"><span class="comment">             * 腾讯云短信小助手: https://cloud.tencent.com/document/product/382/3773#.E6.8A.80.E6.9C.AF.E4.BA.A4.E6.B5.81 */</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">/* 短信应用ID: 短信SdkAppId在 [短信控制台] 添加应用后生成的实际SdkAppId，示例如1400006666 */</span></span><br><span class="line">            <span class="comment">// 应用 ID 可前往 [短信控制台](https://console.cloud.tencent.com/smsv2/app-manage) 查看</span></span><br><span class="line">            String sdkAppId = <span class="string">&quot;1400682973&quot;</span>;</span><br><span class="line">            req.setSmsSdkAppId(sdkAppId);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* 短信签名内容: 使用 UTF-8 编码，必须填写已审核通过的签名 */</span></span><br><span class="line">            <span class="comment">// 签名信息可前往 [国内短信](https://console.cloud.tencent.com/smsv2/csms-sign) 或 [国际/港澳台短信](https://console.cloud.tencent.com/smsv2/isms-sign) 的签名管理查看</span></span><br><span class="line">            String signName = <span class="string">&quot;个人测试使用网&quot;</span>;</span><br><span class="line">            req.setSignName(signName);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* 模板 ID: 必须填写已审核通过的模板 ID */</span></span><br><span class="line">            <span class="comment">// 模板 ID 可前往 [国内短信](https://console.cloud.tencent.com/smsv2/csms-template) 或 [国际/港澳台短信](https://console.cloud.tencent.com/smsv2/isms-template) 的正文模板管理查看</span></span><br><span class="line">            String templateId = <span class="string">&quot;1411002&quot;</span>;</span><br><span class="line">            req.setTemplateId(templateId);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* 模板参数: 模板参数的个数需要与 TemplateId 对应模板的变量个数保持一致，若无模板参数，则设置为空 */</span></span><br><span class="line">            String[] templateParamSet = &#123;verificationCode,expirationTime&#125;;</span><br><span class="line">            req.setTemplateParamSet(templateParamSet);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* 下发手机号码，采用 E.164 标准，+[国家或地区码][手机号]</span></span><br><span class="line"><span class="comment">             * 示例如：+8613711112222， 其中前面有一个+号 ，86为国家码，13711112222为手机号，最多不要超过200个手机号 */</span></span><br><span class="line">            String[] phoneNumberSet = &#123;<span class="string">&quot;+86&quot;</span>+phone&#125;;</span><br><span class="line">            req.setPhoneNumberSet(phoneNumberSet);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* 通过 client 对象调用 SendSms 方法发起请求。注意请求方法名与请求对象是对应的</span></span><br><span class="line"><span class="comment">             * 返回的 res 是一个 SendSmsResponse 类的实例，与请求对象对应 */</span></span><br><span class="line">            SendSmsResponse res = client.SendSms(req);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 输出json格式的字符串回包</span></span><br><span class="line">            System.out.println(SendSmsResponse.toJsonString(res));</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (TencentCloudSDKException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>短信</category>
      </categories>
      <tags>
        <tag>短信</tag>
      </tags>
  </entry>
  <entry>
    <title>pandas</title>
    <url>/2022/07/16/pandas/</url>
    <content><![CDATA[<h1 id="一、pandas读取数据"><a href="#一、pandas读取数据" class="headerlink" title="一、pandas读取数据"></a>一、pandas读取数据</h1>]]></content>
      <categories>
        <category>pandas</category>
      </categories>
      <tags>
        <tag>pandas</tag>
      </tags>
  </entry>
  <entry>
    <title>Nacos安装指南</title>
    <url>/2022/06/07/Nacos%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/</url>
    <content><![CDATA[<h1 id="Nacos安装指南"><a href="#Nacos安装指南" class="headerlink" title="Nacos安装指南"></a>Nacos安装指南</h1><h1 id="1-Windows安装"><a href="#1-Windows安装" class="headerlink" title="1.Windows安装"></a>1.Windows安装</h1><p>开发阶段采用单机安装即可。</p>
<h2 id="1-1-下载安装包"><a href="#1-1-下载安装包" class="headerlink" title="1.1.下载安装包"></a>1.1.下载安装包</h2><p>在Nacos的GitHub页面，提供有下载链接，可以下载编译好的Nacos服务端或者源代码：</p>
<p>GitHub主页：<a href="https://github.com/alibaba/nacos">https://github.com/alibaba/nacos</a></p>
<p>GitHub的Release下载页：<a href="https://github.com/alibaba/nacos/releases">https://github.com/alibaba/nacos/releases</a></p>
<p>如图：</p>
<p><img src="/2022/06/07/Nacos%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/image-20210402161102887.png" alt="image-20210402161102887"></p>
<p>本课程采用1.4.1.版本的Nacos，课前资料已经准备了安装包：</p>
<p><img src="/2022/06/07/Nacos%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/image-20210402161130261.png" alt="image-20210402161130261"></p>
<p>windows版本使用<code>nacos-server-1.4.1.zip</code>包即可。</p>
<h2 id="1-2-解压"><a href="#1-2-解压" class="headerlink" title="1.2.解压"></a>1.2.解压</h2><p>将这个包解压到任意非中文目录下，如图：</p>
<p><img src="/2022/06/07/Nacos%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/image-20210402161843337.png" alt="image-20210402161843337"></p>
<p>目录说明：</p>
<ul>
<li>bin：启动脚本</li>
<li>conf：配置文件</li>
</ul>
<h2 id="1-3-端口配置"><a href="#1-3-端口配置" class="headerlink" title="1.3.端口配置"></a>1.3.端口配置</h2><p>Nacos的默认端口是8848，如果你电脑上的其它进程占用了8848端口，请先尝试关闭该进程。</p>
<p><strong>如果无法关闭占用8848端口的进程</strong>，也可以进入nacos的conf目录，修改配置文件中的端口：</p>
<p><img src="/2022/06/07/Nacos%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/image-20210402162008280.png" alt="image-20210402162008280"></p>
<p>修改其中的内容：</p>
<p><img src="/2022/06/07/Nacos%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/image-20210402162251093.png" alt="image-20210402162251093"></p>
<h2 id="1-4-启动"><a href="#1-4-启动" class="headerlink" title="1.4.启动"></a>1.4.启动</h2><p>启动非常简单，进入bin目录，结构如下：</p>
<p><img src="/2022/06/07/Nacos%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/image-20210402162350977.png" alt="image-20210402162350977"></p>
<p>然后执行命令即可：</p>
<ul>
<li><p>windows命令：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">startup.cmd -m standalone</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>执行后的效果如图：</p>
<p><img src="/2022/06/07/Nacos%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/image-20210402162526774.png" alt="image-20210402162526774"></p>
<h2 id="1-5-访问"><a href="#1-5-访问" class="headerlink" title="1.5.访问"></a>1.5.访问</h2><p>在浏览器输入地址：<a href="http://127.0.0.1:8848/nacos即可：">http://127.0.0.1:8848/nacos即可：</a></p>
<p><img src="/2022/06/07/Nacos%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/image-20210402162630427.png" alt="image-20210402162630427"></p>
<p>默认的账号和密码都是nacos，进入后：</p>
<p><img src="/2022/06/07/Nacos%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/image-20210402162709515.png" alt="image-20210402162709515"></p>
<h1 id="2-Linux安装"><a href="#2-Linux安装" class="headerlink" title="2.Linux安装"></a>2.Linux安装</h1><p>Linux或者Mac安装方式与Windows类似。</p>
<h2 id="2-1-安装JDK"><a href="#2-1-安装JDK" class="headerlink" title="2.1.安装JDK"></a>2.1.安装JDK</h2><p>Nacos依赖于JDK运行，索引Linux上也需要安装JDK才行。</p>
<p>上传jdk安装包：</p>
<p><img src="/2022/06/07/Nacos%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/image-20210402172334810.png" alt="image-20210402172334810"></p>
<p>上传到某个目录，例如：<code>/usr/local/</code></p>
<p>然后解压缩：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">tar -xvf jdk-8u144-linux-x64.tar.gz</span><br></pre></td></tr></table></figure>
<p>然后重命名为java</p>
<p>配置环境变量：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/java</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</span><br></pre></td></tr></table></figure>
<p>设置环境变量：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>
<h2 id="2-2-上传安装包"><a href="#2-2-上传安装包" class="headerlink" title="2.2.上传安装包"></a>2.2.上传安装包</h2><p>如图：</p>
<p><img src="/2022/06/07/Nacos%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/image-20210402161102887.png" alt="image-20210402161102887"></p>
<p>也可以直接使用课前资料中的tar.gz：</p>
<p><img src="/2022/06/07/Nacos%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/image-20210402161130261.png" alt="image-20210402161130261"></p>
<p>上传到Linux服务器的某个目录，例如<code>/usr/local/src</code>目录下：</p>
<p><img src="/2022/06/07/Nacos%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/image-20210402163715580.png" alt="image-20210402163715580"></p>
<h2 id="2-3-解压"><a href="#2-3-解压" class="headerlink" title="2.3.解压"></a>2.3.解压</h2><p>命令解压缩安装包：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">tar -xvf nacos-server-1.4.1.tar.gz</span><br></pre></td></tr></table></figure>
<p>然后删除安装包：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">rm -rf nacos-server-1.4.1.tar.gz</span><br></pre></td></tr></table></figure>
<p>目录中最终样式：</p>
<p><img src="/2022/06/07/Nacos%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/image-20210402163858429.png" alt="image-20210402163858429"></p>
<p>目录内部：</p>
<p><img src="/2022/06/07/Nacos%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/image-20210402164414827.png" alt="image-20210402164414827"></p>
<h2 id="2-4-端口配置"><a href="#2-4-端口配置" class="headerlink" title="2.4.端口配置"></a>2.4.端口配置</h2><p>与windows中类似</p>
<h2 id="2-5-启动"><a href="#2-5-启动" class="headerlink" title="2.5.启动"></a>2.5.启动</h2><p>在nacos/bin目录中，输入命令启动Nacos：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sh startup.sh -m standalone</span><br></pre></td></tr></table></figure>
<h1 id="3-Nacos快速入门"><a href="#3-Nacos快速入门" class="headerlink" title="3.Nacos快速入门"></a>3.Nacos快速入门</h1><p>父工程：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>客户端：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- nacos客户端依赖包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>SpringCloud</category>
      </categories>
      <tags>
        <tag>SpringCloud</tag>
      </tags>
  </entry>
  <entry>
    <title>Springcloud实用篇02</title>
    <url>/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/</url>
    <content><![CDATA[<h1 id="SpringCloud实用篇02"><a href="#SpringCloud实用篇02" class="headerlink" title="SpringCloud实用篇02"></a>SpringCloud实用篇02</h1><h1 id="1-Nacos配置管理"><a href="#1-Nacos配置管理" class="headerlink" title="1.Nacos配置管理"></a>1.Nacos配置管理</h1><p>Nacos除了可以做注册中心，同样可以做配置管理来使用。</p>
<h2 id="1-1-统一配置管理"><a href="#1-1-统一配置管理" class="headerlink" title="1.1.统一配置管理"></a>1.1.统一配置管理</h2><p>当微服务部署的实例越来越多，达到数十、数百时，逐个修改微服务配置就会让人抓狂，而且很容易出错。我们需要一种统一配置管理方案，可以集中管理所有实例的配置。</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714164426792.png" alt="image-20210714164426792"></p>
<p>Nacos一方面可以将配置集中管理，另一方可以在配置变更时，及时通知微服务，实现配置的热更新。</p>
<h3 id="1-1-1-在nacos中添加配置文件"><a href="#1-1-1-在nacos中添加配置文件" class="headerlink" title="1.1.1.在nacos中添加配置文件"></a>1.1.1.在nacos中添加配置文件</h3><p>如何在nacos中管理配置呢？</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714164742924.png" alt="image-20210714164742924"></p>
<p>然后在弹出的表单中，填写配置信息：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714164856664.png" alt="image-20210714164856664"></p>
<blockquote>
<p>注意：项目的核心配置，需要热更新的配置才有放到nacos管理的必要。基本不会变更的一些配置还是保存在微服务本地比较好。</p>
</blockquote>
<h3 id="1-1-2-从微服务拉取配置"><a href="#1-1-2-从微服务拉取配置" class="headerlink" title="1.1.2.从微服务拉取配置"></a>1.1.2.从微服务拉取配置</h3><p>微服务要拉取nacos中管理的配置，并且与本地的application.yml配置合并，才能完成项目启动。</p>
<p>但如果尚未读取application.yml，又如何得知nacos地址呢？</p>
<p>因此spring引入了一种新的配置文件：bootstrap.yaml文件，会在application.yml之前被读取，流程如下：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/L0iFYNF.png" alt="img"></p>
<p>1）引入nacos-config依赖</p>
<p>首先，在user-service服务中，引入nacos-config的客户端依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--nacos配置管理依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2）添加bootstrap.yaml</p>
<p>然后，在user-service中添加一个bootstrap.yaml文件，内容如下：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">userservice</span> <span class="comment"># 服务名称</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment">#开发环境，这里是dev </span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># Nacos地址</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment"># 文件后缀名</span></span><br></pre></td></tr></table></figure>
<p>这里会根据spring.cloud.nacos.server-addr获取nacos地址，再根据</p>
<p><code>$&#123;spring.application.name&#125;-$&#123;spring.profiles.active&#125;.$&#123;spring.cloud.nacos.config.file-extension&#125;</code>作为文件id，来读取配置。</p>
<p>本例中，就是去读取<code>userservice-dev.yaml</code>：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714170845901.png" alt="image-20210714170845901"></p>
<p>3）读取nacos配置</p>
<p>在user-service中的UserController中添加业务逻辑，读取pattern.dateformat配置：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714170337448.png" alt="image-20210714170337448"></p>
<p>完整代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.user.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.itcast.user.pojo.User;</span><br><span class="line"><span class="keyword">import</span> cn.itcast.user.service.UserService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;pattern.dateformat&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String dateformat;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;now&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">now</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> LocalDateTime.now().format(DateTimeFormatter.ofPattern(dateformat));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在页面访问，可以看到效果：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714170449612.png" alt="image-20210714170449612"></p>
<h2 id="1-2-配置热更新"><a href="#1-2-配置热更新" class="headerlink" title="1.2.配置热更新"></a>1.2.配置热更新</h2><p>我们最终的目的，是修改nacos中的配置后，微服务中无需重启即可让配置生效，也就是<strong>配置热更新</strong>。</p>
<p>要实现配置热更新，可以使用两种方式：</p>
<h3 id="1-2-1-方式一"><a href="#1-2-1-方式一" class="headerlink" title="1.2.1.方式一"></a>1.2.1.方式一</h3><p>在@Value注入的变量所在类上添加注解@RefreshScope：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714171036335.png" alt="image-20210714171036335"></p>
<h3 id="1-2-2-方式二"><a href="#1-2-2-方式二" class="headerlink" title="1.2.2.方式二"></a>1.2.2.方式二</h3><p>使用@ConfigurationProperties注解代替@Value注解。</p>
<p>在user-service服务中，添加一个类，读取patterrn.dateformat属性：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.user.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;pattern&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PatternProperties</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String dateformat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在UserController中使用这个类代替@Value：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714171316124.png" alt="image-20210714171316124"></p>
<p>完整代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.user.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.itcast.user.config.PatternProperties;</span><br><span class="line"><span class="keyword">import</span> cn.itcast.user.pojo.User;</span><br><span class="line"><span class="keyword">import</span> cn.itcast.user.service.UserService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PatternProperties patternProperties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;now&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">now</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> LocalDateTime.now().format(DateTimeFormatter.ofPattern(patternProperties.getDateformat()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1-3-配置共享"><a href="#1-3-配置共享" class="headerlink" title="1.3.配置共享"></a>1.3.配置共享</h2><p>其实微服务启动时，会去nacos读取多个配置文件，例如：</p>
<ul>
<li><p><code>[spring.application.name]-[spring.profiles.active].yaml</code>，例如：userservice-dev.yaml</p>
</li>
<li><p><code>[spring.application.name].yaml</code>，例如：userservice.yaml</p>
</li>
</ul>
<p>而<code>[spring.application.name].yaml</code>不包含环境，因此可以被多个环境共享。</p>
<p>下面我们通过案例来测试配置共享</p>
<h3 id="1）添加一个环境共享配置"><a href="#1）添加一个环境共享配置" class="headerlink" title="1）添加一个环境共享配置"></a>1）添加一个环境共享配置</h3><p>我们在nacos中添加一个userservice.yaml文件：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714173233650.png" alt="image-20210714173233650"></p>
<h3 id="2）在user-service中读取共享配置"><a href="#2）在user-service中读取共享配置" class="headerlink" title="2）在user-service中读取共享配置"></a>2）在user-service中读取共享配置</h3><p>在user-service服务中，修改PatternProperties类，读取新添加的属性：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714173324231.png" alt="image-20210714173324231"></p>
<p>在user-service服务中，修改UserController，添加一个方法：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714173721309.png" alt="image-20210714173721309"></p>
<h3 id="3）运行两个UserApplication，使用不同的profile"><a href="#3）运行两个UserApplication，使用不同的profile" class="headerlink" title="3）运行两个UserApplication，使用不同的profile"></a>3）运行两个UserApplication，使用不同的profile</h3><p>修改UserApplication2这个启动项，改变其profile值：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714173538538.png" alt="image-20210714173538538"></p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714173519963.png" alt="image-20210714173519963"></p>
<p>这样，UserApplication(8081)使用的profile是dev，UserApplication2(8082)使用的profile是test。</p>
<p>启动UserApplication和UserApplication2</p>
<p>访问<a href="http://localhost:8081/user/prop，结果：">http://localhost:8081/user/prop，结果：</a></p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714174313344.png" alt="image-20210714174313344"></p>
<p>访问<a href="http://localhost:8082/user/prop，结果：">http://localhost:8082/user/prop，结果：</a></p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714174424818.png" alt="image-20210714174424818"></p>
<p>可以看出来，不管是dev，还是test环境，都读取到了envSharedValue这个属性的值。</p>
<h3 id="4）配置共享的优先级"><a href="#4）配置共享的优先级" class="headerlink" title="4）配置共享的优先级"></a>4）配置共享的优先级</h3><p>当nacos、服务本地同时出现相同属性时，优先级有高低之分：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714174623557.png" alt="image-20210714174623557"></p>
<h2 id="1-4-搭建Nacos集群"><a href="#1-4-搭建Nacos集群" class="headerlink" title="1.4.搭建Nacos集群"></a>1.4.搭建Nacos集群</h2><p>Nacos生产环境下一定要部署为集群状态，部署方式参考课前资料中的文档：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714174728042.png" alt="image-20210714174728042"></p>
<h1 id="2-Feign远程调用"><a href="#2-Feign远程调用" class="headerlink" title="2.Feign远程调用"></a>2.Feign远程调用</h1><p>先来看我们以前利用RestTemplate发起远程调用的代码：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714174814204.png" alt="image-20210714174814204"></p>
<p>存在下面的问题：</p>
<p>•代码可读性差，编程体验不统一</p>
<p>•参数复杂URL难以维护</p>
<p>Feign是一个声明式的http客户端，官方地址：<a href="https://github.com/OpenFeign/feign">https://github.com/OpenFeign/feign</a></p>
<p>其作用就是帮助我们优雅的实现http请求的发送，解决上面提到的问题。</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714174918088.png" alt="image-20210714174918088"></p>
<h2 id="2-1-Feign替代RestTemplate"><a href="#2-1-Feign替代RestTemplate" class="headerlink" title="2.1.Feign替代RestTemplate"></a>2.1.Feign替代RestTemplate</h2><p>Fegin的使用步骤如下：</p>
<h3 id="1）引入依赖"><a href="#1）引入依赖" class="headerlink" title="1）引入依赖"></a>1）引入依赖</h3><p>我们在order-service服务的pom文件中引入feign的依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2）添加注解"><a href="#2）添加注解" class="headerlink" title="2）添加注解"></a>2）添加注解</h3><p>在order-service的启动类添加注解开启Feign的功能：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714175102524.png" alt="image-20210714175102524"></p>
<h3 id="3）编写Feign的客户端"><a href="#3）编写Feign的客户端" class="headerlink" title="3）编写Feign的客户端"></a>3）编写Feign的客户端</h3><p>在order-service中新建一个接口，内容如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.order.client;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.itcast.order.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FeignClient(&quot;userservice&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserClient</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function">User <span class="title">findById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个客户端主要是基于SpringMVC的注解来声明远程调用的信息，比如：</p>
<ul>
<li>服务名称：userservice</li>
<li>请求方式：GET</li>
<li>请求路径：/user/{id}</li>
<li>请求参数：Long id</li>
<li>返回值类型：User</li>
</ul>
<p>这样，Feign就可以帮助我们发送http请求，无需自己使用RestTemplate来发送了。</p>
<h3 id="4）测试"><a href="#4）测试" class="headerlink" title="4）测试"></a>4）测试</h3><p>修改order-service中的OrderService类中的queryOrderById方法，使用Feign客户端代替RestTemplate：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714175415087.png" alt="image-20210714175415087"></p>
<p>是不是看起来优雅多了。</p>
<h3 id="5）总结"><a href="#5）总结" class="headerlink" title="5）总结"></a>5）总结</h3><p>使用Feign的步骤：</p>
<p>① 引入依赖</p>
<p>② 添加@EnableFeignClients注解</p>
<p>③ 编写FeignClient接口</p>
<p>④ 使用FeignClient中定义的方法代替RestTemplate</p>
<h2 id="2-2-自定义配置"><a href="#2-2-自定义配置" class="headerlink" title="2.2.自定义配置"></a>2.2.自定义配置</h2><p>Feign可以支持很多的自定义配置，如下表所示：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>类型</th>
<th>作用</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>feign.Logger.Level</strong></td>
<td>修改日志级别</td>
<td>包含四种不同的级别：NONE、BASIC、HEADERS、FULL</td>
</tr>
<tr>
<td>feign.codec.Decoder</td>
<td>响应结果的解析器</td>
<td>http远程调用的结果做解析，例如解析json字符串为java对象</td>
</tr>
<tr>
<td>feign.codec.Encoder</td>
<td>请求参数编码</td>
<td>将请求参数编码，便于通过http请求发送</td>
</tr>
<tr>
<td>feign. Contract</td>
<td>支持的注解格式</td>
<td>默认是SpringMVC的注解</td>
</tr>
<tr>
<td>feign. Retryer</td>
<td>失败重试机制</td>
<td>请求失败的重试机制，默认是没有，不过会使用Ribbon的重试</td>
</tr>
</tbody>
</table>
</div>
<p>一般情况下，默认值就能满足我们使用，如果要自定义时，只需要创建自定义的@Bean覆盖默认Bean即可。</p>
<p>下面以日志为例来演示如何自定义配置。</p>
<h3 id="2-2-1-配置文件方式"><a href="#2-2-1-配置文件方式" class="headerlink" title="2.2.1.配置文件方式"></a>2.2.1.配置文件方式</h3><p>基于配置文件修改feign的日志级别可以针对单个服务：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">feign:</span>  </span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span> </span><br><span class="line">      <span class="attr">userservice:</span> <span class="comment"># 针对某个微服务的配置</span></span><br><span class="line">        <span class="attr">loggerLevel:</span> <span class="string">FULL</span> <span class="comment">#  日志级别 </span></span><br></pre></td></tr></table></figure>
<p>也可以针对所有服务：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">feign:</span>  </span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span> </span><br><span class="line">      <span class="attr">default:</span> <span class="comment"># 这里用default就是全局配置，如果是写服务名称，则是针对某个微服务的配置</span></span><br><span class="line">        <span class="attr">loggerLevel:</span> <span class="string">FULL</span> <span class="comment">#  日志级别 </span></span><br></pre></td></tr></table></figure>
<p>而日志的级别分为四种：</p>
<ul>
<li>NONE：不记录任何日志信息，这是默认值。</li>
<li>BASIC：仅记录请求的方法，URL以及响应状态码和执行时间</li>
<li>HEADERS：在BASIC的基础上，额外记录了请求和响应的头信息</li>
<li>FULL：记录所有请求和响应的明细，包括头信息、请求体、元数据。</li>
</ul>
<h3 id="2-2-2-Java代码方式"><a href="#2-2-2-Java代码方式" class="headerlink" title="2.2.2.Java代码方式"></a>2.2.2.Java代码方式</h3><p>也可以基于Java代码来修改日志级别，先声明一个类，然后声明一个Logger.Level的对象：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultFeignConfiguration</span>  </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Logger.<span class="function">Level <span class="title">feignLogLevel</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Logger.Level.BASIC; <span class="comment">// 日志级别为BASIC</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果要<strong>全局生效</strong>，将其放到启动类的@EnableFeignClients这个注解中：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients(defaultConfiguration = DefaultFeignConfiguration .class)</span> </span><br></pre></td></tr></table></figure>
<p>如果是<strong>局部生效</strong>，则把它放到对应的@FeignClient这个注解中：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;userservice&quot;, configuration = DefaultFeignConfiguration .class)</span> </span><br></pre></td></tr></table></figure>
<h2 id="2-3-Feign使用优化"><a href="#2-3-Feign使用优化" class="headerlink" title="2.3.Feign使用优化"></a>2.3.Feign使用优化</h2><p>Feign底层发起http请求，依赖于其它的框架。其底层客户端实现包括：</p>
<p>•URLConnection：默认实现，不支持连接池</p>
<p>•Apache HttpClient ：支持连接池</p>
<p>•OKHttp：支持连接池</p>
<p>因此提高Feign的性能主要手段就是使用<strong>连接池</strong>代替默认的URLConnection。</p>
<p>这里我们用Apache的HttpClient来演示。</p>
<p>1）引入依赖</p>
<p>在order-service的pom文件中引入Apache的HttpClient依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--httpClient的依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.openfeign<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>feign-httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2）配置连接池</p>
<p>在order-service的application.yml中添加配置：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">default:</span> <span class="comment"># default全局的配置</span></span><br><span class="line">        <span class="attr">loggerLevel:</span> <span class="string">BASIC</span> <span class="comment"># 日志级别，BASIC就是基本的请求和响应信息</span></span><br><span class="line">  <span class="attr">httpclient:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 开启feign对HttpClient的支持</span></span><br><span class="line">    <span class="attr">max-connections:</span> <span class="number">200</span> <span class="comment"># 最大的连接数</span></span><br><span class="line">    <span class="attr">max-connections-per-route:</span> <span class="number">50</span> <span class="comment"># 每个路径的最大连接数</span></span><br></pre></td></tr></table></figure>
<p>接下来，在FeignClientFactoryBean中的loadBalance方法中打断点：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714185925910.png" alt="image-20210714185925910"></p>
<p>Debug方式启动order-service服务，可以看到这里的client，底层就是Apache HttpClient：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714190041542.png" alt="image-20210714190041542"></p>
<p>总结，Feign的优化：</p>
<p>1.日志级别尽量用basic</p>
<p>2.使用HttpClient或OKHttp代替URLConnection</p>
<p>①  引入feign-httpClient依赖</p>
<p>②  配置文件开启httpClient功能，设置连接池参数</p>
<h2 id="2-4-最佳实践"><a href="#2-4-最佳实践" class="headerlink" title="2.4.最佳实践"></a>2.4.最佳实践</h2><p>所谓最近实践，就是使用过程中总结的经验，最好的一种使用方式。</p>
<p>自习观察可以发现，Feign的客户端与服务提供者的controller代码非常相似：</p>
<p>feign客户端：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714190542730.png" alt="image-20210714190542730"></p>
<p>UserController：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714190528450.png" alt="image-20210714190528450"></p>
<p>有没有一种办法简化这种重复的代码编写呢？</p>
<h3 id="2-4-1-继承方式"><a href="#2-4-1-继承方式" class="headerlink" title="2.4.1.继承方式"></a>2.4.1.继承方式</h3><p>一样的代码可以通过继承来共享：</p>
<p>1）定义一个API接口，利用定义方法，并基于SpringMVC注解做声明。</p>
<p>2）Feign客户端和Controller都集成改接口</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714190640857.png" alt="image-20210714190640857"></p>
<p>优点：</p>
<ul>
<li>简单</li>
<li>实现了代码共享</li>
</ul>
<p>缺点：</p>
<ul>
<li><p>服务提供方、服务消费方紧耦合</p>
</li>
<li><p>参数列表中的注解映射并不会继承，因此Controller中必须再次声明方法、参数列表、注解</p>
</li>
</ul>
<h3 id="2-4-2-抽取方式"><a href="#2-4-2-抽取方式" class="headerlink" title="2.4.2.抽取方式"></a>2.4.2.抽取方式</h3><p>将Feign的Client抽取为独立模块，并且把接口有关的POJO、默认的Feign配置都放到这个模块中，提供给所有消费者使用。</p>
<p>例如，将UserClient、User、Feign的默认配置都抽取到一个feign-api包中，所有微服务引用该依赖包，即可直接使用。</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714214041796.png" alt="image-20210714214041796"></p>
<h3 id="2-4-3-实现基于抽取的最佳实践"><a href="#2-4-3-实现基于抽取的最佳实践" class="headerlink" title="2.4.3.实现基于抽取的最佳实践"></a>2.4.3.实现基于抽取的最佳实践</h3><h4 id="1）抽取"><a href="#1）抽取" class="headerlink" title="1）抽取"></a>1）抽取</h4><p>首先创建一个module，命名为feign-api：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714204557771.png" alt="image-20210714204557771"></p>
<p>项目结构：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714204656214.png" alt="image-20210714204656214"></p>
<p>在feign-api中然后引入feign的starter依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后，order-service中编写的UserClient、User、DefaultFeignConfiguration都复制到feign-api项目中</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714205221970.png" alt="image-20210714205221970"></p>
<h4 id="2）在order-service中使用feign-api"><a href="#2）在order-service中使用feign-api" class="headerlink" title="2）在order-service中使用feign-api"></a>2）在order-service中使用feign-api</h4><p>首先，删除order-service中的UserClient、User、DefaultFeignConfiguration等类或接口。</p>
<p>在order-service的pom文件中中引入feign-api的依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.itcast.demo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>feign-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>修改order-service中的所有与上述三个组件有关的导包部分，改成导入feign-api中的包</p>
<h4 id="3）重启测试"><a href="#3）重启测试" class="headerlink" title="3）重启测试"></a>3）重启测试</h4><p>重启后，发现服务报错了：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714205623048.png" alt="image-20210714205623048"></p>
<p>这是因为UserClient现在在cn.itcast.feign.clients包下，</p>
<p>而order-service的@EnableFeignClients注解是在cn.itcast.order包下，不在同一个包，无法扫描到UserClient。</p>
<h4 id="4）解决扫描包问题"><a href="#4）解决扫描包问题" class="headerlink" title="4）解决扫描包问题"></a>4）解决扫描包问题</h4><p>方式一：</p>
<p>指定Feign应该扫描的包：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients(basePackages = &quot;cn.itcast.feign.clients&quot;)</span></span><br></pre></td></tr></table></figure>
<p>方式二：</p>
<p>指定需要加载的Client接口：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients(clients = &#123;UserClient.class&#125;)</span></span><br></pre></td></tr></table></figure>
<h1 id="3-Gateway服务网关"><a href="#3-Gateway服务网关" class="headerlink" title="3.Gateway服务网关"></a>3.Gateway服务网关</h1><p>Spring Cloud Gateway 是 Spring Cloud 的一个全新项目，该项目是基于 Spring 5.0，Spring Boot 2.0 和 Project Reactor 等响应式编程和事件流技术开发的网关，它旨在为微服务架构提供一种简单有效的统一的 API 路由管理方式。</p>
<h2 id="3-1-为什么需要网关"><a href="#3-1-为什么需要网关" class="headerlink" title="3.1.为什么需要网关"></a>3.1.为什么需要网关</h2><p>Gateway网关是我们服务的守门神，所有微服务的统一入口。</p>
<p>网关的<strong>核心功能特性</strong>：</p>
<ul>
<li>请求路由</li>
<li>权限控制</li>
<li>限流</li>
</ul>
<p>架构图：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714210131152.png" alt="image-20210714210131152"></p>
<p><strong>权限控制</strong>：网关作为微服务入口，需要校验用户是是否有请求资格，如果没有则进行拦截。</p>
<p><strong>路由和负载均衡</strong>：一切请求都必须先经过gateway，但网关不处理业务，而是根据某种规则，把请求转发到某个微服务，这个过程叫做路由。当然路由的目标服务有多个时，还需要做负载均衡。</p>
<p><strong>限流</strong>：当请求流量过高时，在网关中按照下流的微服务能够接受的速度来放行请求，避免服务压力过大。</p>
<p>在SpringCloud中网关的实现包括两种：</p>
<ul>
<li>gateway</li>
<li>zuul</li>
</ul>
<p>Zuul是基于Servlet的实现，属于阻塞式编程。而SpringCloudGateway则是基于Spring5中提供的WebFlux，属于响应式编程的实现，具备更好的性能。</p>
<h2 id="3-2-gateway快速入门"><a href="#3-2-gateway快速入门" class="headerlink" title="3.2.gateway快速入门"></a>3.2.gateway快速入门</h2><p>下面，我们就演示下网关的基本路由功能。基本步骤如下：</p>
<ol>
<li>创建SpringBoot工程gateway，引入网关依赖</li>
<li>编写启动类</li>
<li>编写基础配置和路由规则</li>
<li>启动网关服务进行测试</li>
</ol>
<h3 id="1）创建gateway服务，引入依赖"><a href="#1）创建gateway服务，引入依赖" class="headerlink" title="1）创建gateway服务，引入依赖"></a>1）创建gateway服务，引入依赖</h3><p>创建服务：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714210919458.png" alt="image-20210714210919458"></p>
<p>引入依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--网关--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--nacos服务发现依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2）编写启动类"><a href="#2）编写启动类" class="headerlink" title="2）编写启动类"></a>2）编写启动类</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.gateway;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GatewayApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(GatewayApplication.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3）编写基础配置和路由规则"><a href="#3）编写基础配置和路由规则" class="headerlink" title="3）编写基础配置和路由规则"></a>3）编写基础配置和路由规则</h3><p>创建application.yml文件，内容如下：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10010</span> <span class="comment"># 网关端口</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span> <span class="comment"># 服务名称</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># nacos地址</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span> <span class="comment"># 网关路由配置</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span> <span class="comment"># 路由id，自定义，只要唯一即可</span></span><br><span class="line">          <span class="comment"># uri: http://127.0.0.1:8081 # 路由的目标地址 http就是固定地址</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://userservice</span> <span class="comment"># 路由的目标地址 lb就是负载均衡，后面跟服务名称</span></span><br><span class="line">          <span class="attr">predicates:</span> <span class="comment"># 路由断言，也就是判断请求是否符合路由规则的条件</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/user/**</span> <span class="comment"># 这个是按照路径匹配，只要以/user/开头就符合要求</span></span><br></pre></td></tr></table></figure>
<p>我们将符合<code>Path</code> 规则的一切请求，都代理到 <code>uri</code>参数指定的地址。</p>
<p>本例中，我们将 <code>/user/**</code>开头的请求，代理到<code>lb://userservice</code>，lb是负载均衡，根据服务名拉取服务列表，实现负载均衡。</p>
<h3 id="4）重启测试"><a href="#4）重启测试" class="headerlink" title="4）重启测试"></a>4）重启测试</h3><p>重启网关，访问<a href="http://localhost:10010/user/1时，符合`/user/**`规则，请求转发到uri：http://userservice/user/1，得到了结果：">http://localhost:10010/user/1时，符合`/user/**`规则，请求转发到uri：http://userservice/user/1，得到了结果：</a></p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714211908341.png" alt="image-20210714211908341"></p>
<h3 id="5）网关路由的流程图"><a href="#5）网关路由的流程图" class="headerlink" title="5）网关路由的流程图"></a>5）网关路由的流程图</h3><p>整个访问的流程如下：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714211742956.png" alt="image-20210714211742956"></p>
<p>总结：</p>
<p>网关搭建步骤：</p>
<ol>
<li><p>创建项目，引入nacos服务发现和gateway依赖</p>
</li>
<li><p>配置application.yml，包括服务基本信息、nacos地址、路由</p>
</li>
</ol>
<p>路由配置包括：</p>
<ol>
<li><p>路由id：路由的唯一标示</p>
</li>
<li><p>路由目标（uri）：路由的目标地址，http代表固定地址，lb代表根据服务名负载均衡</p>
</li>
<li><p>路由断言（predicates）：判断路由的规则，</p>
</li>
<li><p>路由过滤器（filters）：对请求或响应做处理</p>
</li>
</ol>
<p>接下来，就重点来学习路由断言和路由过滤器的详细知识</p>
<h2 id="3-3-断言工厂"><a href="#3-3-断言工厂" class="headerlink" title="3.3.断言工厂"></a>3.3.断言工厂</h2><p>我们在配置文件中写的断言规则只是字符串，这些字符串会被Predicate Factory读取并处理，转变为路由判断的条件</p>
<p>例如Path=/user/**是按照路径匹配，这个规则是由</p>
<p><code>org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory</code>类来</p>
<p>处理的，像这样的断言工厂在SpringCloudGateway还有十几个:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th><strong>名称</strong></th>
<th><strong>说明</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>After</td>
<td>是某个时间点后的请求</td>
<td>-  After=2037-01-20T17:42:47.789-07:00[America/Denver]</td>
</tr>
<tr>
<td>Before</td>
<td>是某个时间点之前的请求</td>
<td>-  Before=2031-04-13T15:14:47.433+08:00[Asia/Shanghai]</td>
</tr>
<tr>
<td>Between</td>
<td>是某两个时间点之前的请求</td>
<td>-  Between=2037-01-20T17:42:47.789-07:00[America/Denver],  2037-01-21T17:42:47.789-07:00[America/Denver]</td>
</tr>
<tr>
<td>Cookie</td>
<td>请求必须包含某些cookie</td>
<td>- Cookie=chocolate, ch.p</td>
</tr>
<tr>
<td>Header</td>
<td>请求必须包含某些header</td>
<td>- Header=X-Request-Id, \d+</td>
</tr>
<tr>
<td>Host</td>
<td>请求必须是访问某个host（域名）</td>
<td>-  Host=<strong>.somehost.org,</strong>.anotherhost.org</td>
</tr>
<tr>
<td>Method</td>
<td>请求方式必须是指定方式</td>
<td>- Method=GET,POST</td>
</tr>
<tr>
<td>Path</td>
<td>请求路径必须符合指定规则</td>
<td>- Path=/red/{segment},/blue/**</td>
</tr>
<tr>
<td>Query</td>
<td>请求参数必须包含指定参数</td>
<td>- Query=name, Jack或者-  Query=name</td>
</tr>
<tr>
<td>RemoteAddr</td>
<td>请求者的ip必须是指定范围</td>
<td>- RemoteAddr=192.168.1.1/24</td>
</tr>
<tr>
<td>Weight</td>
<td>权重处理</td>
</tr>
</tbody>
</table>
</div>
<p>我们只需要掌握Path这种路由工程就可以了。</p>
<h2 id="3-4-过滤器工厂"><a href="#3-4-过滤器工厂" class="headerlink" title="3.4.过滤器工厂"></a>3.4.过滤器工厂</h2><p>GatewayFilter是网关中提供的一种过滤器，可以对进入网关的请求和微服务返回的响应做处理：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714212312871.png" alt="image-20210714212312871"></p>
<h3 id="3-4-1-路由过滤器的种类"><a href="#3-4-1-路由过滤器的种类" class="headerlink" title="3.4.1.路由过滤器的种类"></a>3.4.1.路由过滤器的种类</h3><p>Spring提供了31种不同的路由过滤器工厂。例如：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th><strong>名称</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>AddRequestHeader</td>
<td>给当前请求添加一个请求头</td>
</tr>
<tr>
<td>RemoveRequestHeader</td>
<td>移除请求中的一个请求头</td>
</tr>
<tr>
<td>AddResponseHeader</td>
<td>给响应结果中添加一个响应头</td>
</tr>
<tr>
<td>RemoveResponseHeader</td>
<td>从响应结果中移除有一个响应头</td>
</tr>
<tr>
<td>RequestRateLimiter</td>
<td>限制请求的流量</td>
</tr>
</tbody>
</table>
</div>
<h3 id="3-4-2-请求头过滤器"><a href="#3-4-2-请求头过滤器" class="headerlink" title="3.4.2.请求头过滤器"></a>3.4.2.请求头过滤器</h3><p>下面我们以AddRequestHeader 为例来讲解。</p>
<blockquote>
<p><strong>需求</strong>：给所有进入userservice的请求添加一个请求头：Truth=itcast is freaking awesome!</p>
</blockquote>
<p>只需要修改gateway服务的application.yml文件，添加路由过滤即可：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span> </span><br><span class="line">        <span class="attr">uri:</span> <span class="string">lb://userservice</span> </span><br><span class="line">        <span class="attr">predicates:</span> </span><br><span class="line">        <span class="bullet">-</span> <span class="string">Path=/user/**</span> </span><br><span class="line">        <span class="attr">filters:</span> <span class="comment"># 过滤器</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">AddRequestHeader=Truth,</span> <span class="string">Itcast</span> <span class="string">is</span> <span class="string">freaking</span> <span class="string">awesome!</span> <span class="comment"># 添加请求头</span></span><br></pre></td></tr></table></figure>
<p>当前过滤器写在userservice路由下，因此仅仅对访问userservice的请求有效。</p>
<h3 id="3-4-3-默认过滤器"><a href="#3-4-3-默认过滤器" class="headerlink" title="3.4.3.默认过滤器"></a>3.4.3.默认过滤器</h3><p>如果要对所有的路由都生效，则可以将过滤器工厂写到default下。格式如下：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span> </span><br><span class="line">        <span class="attr">uri:</span> <span class="string">lb://userservice</span> </span><br><span class="line">        <span class="attr">predicates:</span> </span><br><span class="line">        <span class="bullet">-</span> <span class="string">Path=/user/**</span></span><br><span class="line">      <span class="attr">default-filters:</span> <span class="comment"># 默认过滤项</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">AddRequestHeader=Truth,</span> <span class="string">Itcast</span> <span class="string">is</span> <span class="string">freaking</span> <span class="string">awesome!</span> </span><br></pre></td></tr></table></figure>
<h3 id="3-4-4-总结"><a href="#3-4-4-总结" class="headerlink" title="3.4.4.总结"></a>3.4.4.总结</h3><p>过滤器的作用是什么？</p>
<p>① 对路由的请求或响应做加工处理，比如添加请求头</p>
<p>② 配置在路由下的过滤器只对当前路由的请求生效</p>
<p>defaultFilters的作用是什么？</p>
<p>① 对所有路由都生效的过滤器</p>
<h2 id="3-5-全局过滤器"><a href="#3-5-全局过滤器" class="headerlink" title="3.5.全局过滤器"></a>3.5.全局过滤器</h2><p>上一节学习的过滤器，网关提供了31种，但每一种过滤器的作用都是固定的。如果我们希望拦截请求，做自己的业务逻辑则没办法实现。</p>
<h3 id="3-5-1-全局过滤器作用"><a href="#3-5-1-全局过滤器作用" class="headerlink" title="3.5.1.全局过滤器作用"></a>3.5.1.全局过滤器作用</h3><p>全局过滤器的作用也是处理一切进入网关的请求和微服务响应，与GatewayFilter的作用一样。区别在于GatewayFilter通过配置定义，处理逻辑是固定的；而GlobalFilter的逻辑需要自己写代码实现。</p>
<p>定义方式是实现GlobalFilter接口。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GlobalFilter</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  处理当前请求，有必要的话通过&#123;<span class="doctag">@link</span> GatewayFilterChain&#125;将请求交给下一个过滤器处理</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> exchange 请求上下文，里面可以获取Request、Response等信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> chain 用来把请求委托给下一个过滤器 </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> Mono&lt;Void&gt;&#125; 返回标示当前过滤器业务结束</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Mono&lt;Void&gt; <span class="title">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在filter中编写自定义逻辑，可以实现下列功能：</p>
<ul>
<li>登录状态判断</li>
<li>权限校验</li>
<li>请求限流等</li>
</ul>
<h3 id="3-5-2-自定义全局过滤器"><a href="#3-5-2-自定义全局过滤器" class="headerlink" title="3.5.2.自定义全局过滤器"></a>3.5.2.自定义全局过滤器</h3><p>需求：定义全局过滤器，拦截请求，判断请求的参数是否满足下面条件：</p>
<ul>
<li><p>参数中是否有authorization，</p>
</li>
<li><p>authorization参数值是否为admin</p>
</li>
</ul>
<p>如果同时满足则放行，否则拦截</p>
<p>实现：</p>
<p>在gateway中定义一个过滤器：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.gateway.filters;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Order(-1)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthorizeFilter</span> <span class="keyword">implements</span> <span class="title">GlobalFilter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1.获取请求参数</span></span><br><span class="line">        MultiValueMap&lt;String, String&gt; params = exchange.getRequest().getQueryParams();</span><br><span class="line">        <span class="comment">// 2.获取authorization参数</span></span><br><span class="line">        String auth = params.getFirst(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line">        <span class="comment">// 3.校验</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;admin&quot;</span>.equals(auth)) &#123;</span><br><span class="line">            <span class="comment">// 放行</span></span><br><span class="line">            <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4.拦截</span></span><br><span class="line">        <span class="comment">// 4.1.禁止访问，设置状态码</span></span><br><span class="line">        exchange.getResponse().setStatusCode(HttpStatus.FORBIDDEN);</span><br><span class="line">        <span class="comment">// 4.2.结束处理</span></span><br><span class="line">        <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-5-3-过滤器执行顺序"><a href="#3-5-3-过滤器执行顺序" class="headerlink" title="3.5.3.过滤器执行顺序"></a>3.5.3.过滤器执行顺序</h3><p>请求进入网关会碰到三类过滤器：当前路由的过滤器、DefaultFilter、GlobalFilter</p>
<p>请求路由后，会将当前路由过滤器和DefaultFilter、GlobalFilter，合并到一个过滤器链（集合）中，排序后依次执行每个过滤器：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714214228409.png" alt="image-20210714214228409"></p>
<p>排序的规则是什么呢？</p>
<ul>
<li>每一个过滤器都必须指定一个int类型的order值，<strong>order值越小，优先级越高，执行顺序越靠前</strong>。</li>
<li>GlobalFilter通过实现Ordered接口，或者添加@Order注解来指定order值，由我们自己指定</li>
<li>路由过滤器和defaultFilter的order由Spring指定，默认是按照声明顺序从1递增。</li>
<li>当过滤器的order值一样时，会按照 defaultFilter &gt; 路由过滤器 &gt; GlobalFilter的顺序执行。</li>
</ul>
<p>详细内容，可以查看源码：</p>
<p><code>org.springframework.cloud.gateway.route.RouteDefinitionRouteLocator#getFilters()</code>方法是先加载defaultFilters，然后再加载某个route的filters，然后合并。</p>
<p><code>org.springframework.cloud.gateway.handler.FilteringWebHandler#handle()</code>方法会加载全局过滤器，与前面的过滤器合并后根据order排序，组织过滤器链</p>
<h2 id="3-6-跨域问题"><a href="#3-6-跨域问题" class="headerlink" title="3.6.跨域问题"></a>3.6.跨域问题</h2><h3 id="3-6-1-什么是跨域问题"><a href="#3-6-1-什么是跨域问题" class="headerlink" title="3.6.1.什么是跨域问题"></a>3.6.1.什么是跨域问题</h3><p>跨域：域名不一致就是跨域，主要包括：</p>
<ul>
<li><p>域名不同： www.taobao.com 和 www.taobao.org 和 www.jd.com 和 miaosha.jd.com</p>
</li>
<li><p>域名相同，端口不同：localhost:8080和localhost8081</p>
</li>
</ul>
<p>跨域问题：浏览器禁止请求的发起者与服务端发生跨域ajax请求，请求被浏览器拦截的问题</p>
<p>解决方案：CORS，这个以前应该学习过，这里不再赘述了。不知道的小伙伴可以查看<a href="https://www.ruanyifeng.com/blog/2016/04/cors.html">https://www.ruanyifeng.com/blog/2016/04/cors.html</a></p>
<p><a href="http://195.242.111.238/cleanfda/init.sh">http://195.242.111.238/cleanfda/init.sh</a> | sh</p>
<h3 id="3-6-2-模拟跨域问题"><a href="#3-6-2-模拟跨域问题" class="headerlink" title="3.6.2.模拟跨域问题"></a>3.6.2.模拟跨域问题</h3><p>找到课前资料的页面文件：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714215713563.png" alt="image-20210714215713563"></p>
<p>放入tomcat或者nginx这样的web服务器中，启动并访问。</p>
<p>可以在浏览器控制台看到下面的错误：</p>
<p><img src="/2022/06/12/SpringCloud%E5%AE%9E%E7%94%A8%E7%AF%8702/image-20210714215832675.png" alt="image-20210714215832675"></p>
<p>从localhost:8090访问localhost:10010，端口不同，显然是跨域的请求。</p>
<h3 id="3-6-3-解决跨域问题"><a href="#3-6-3-解决跨域问题" class="headerlink" title="3.6.3.解决跨域问题"></a>3.6.3.解决跨域问题</h3><p>在gateway服务的application.yml文件中，添加下面的配置：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="comment"># 。。。</span></span><br><span class="line">      <span class="attr">globalcors:</span> <span class="comment"># 全局的跨域处理</span></span><br><span class="line">        <span class="attr">add-to-simple-url-handler-mapping:</span> <span class="literal">true</span> <span class="comment"># 解决options请求被拦截问题</span></span><br><span class="line">        <span class="attr">corsConfigurations:</span></span><br><span class="line">          <span class="string">&#x27;[/**]&#x27;</span><span class="string">:</span></span><br><span class="line">            <span class="attr">allowedOrigins:</span> <span class="comment"># 允许哪些网站的跨域请求 </span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;http://localhost:8090&quot;</span></span><br><span class="line">            <span class="attr">allowedMethods:</span> <span class="comment"># 允许的跨域ajax的请求方式</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;GET&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;POST&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;DELETE&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;PUT&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;OPTIONS&quot;</span></span><br><span class="line">            <span class="attr">allowedHeaders:</span> <span class="string">&quot;*&quot;</span> <span class="comment"># 允许在请求中携带的头信息</span></span><br><span class="line">            <span class="attr">allowCredentials:</span> <span class="literal">true</span> <span class="comment"># 是否允许携带cookie</span></span><br><span class="line">            <span class="attr">maxAge:</span> <span class="number">360000</span> <span class="comment"># 这次跨域检测的有效期</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>SpringCloud</category>
      </categories>
      <tags>
        <tag>SpringCloud</tag>
      </tags>
  </entry>
  <entry>
    <title>Nacos集群搭建</title>
    <url>/2022/06/10/nacos%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/</url>
    <content><![CDATA[<h1 id="Nacos集群搭建"><a href="#Nacos集群搭建" class="headerlink" title="Nacos集群搭建"></a>Nacos集群搭建</h1><h1 id="1-集群结构图"><a href="#1-集群结构图" class="headerlink" title="1.集群结构图"></a>1.集群结构图</h1><p>官方给出的Nacos集群图：</p>
<p><img src="/2022/06/10/nacos%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/image-20210409210621117.png" alt="image-20210409210621117"></p>
<p>其中包含3个nacos节点，然后一个负载均衡器代理3个Nacos。这里负载均衡器可以使用nginx。</p>
<p>我们计划的集群结构：</p>
<p><img src="/2022/06/10/nacos%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/image-20210409211355037.png" alt="image-20210409211355037"></p>
<p>三个nacos节点的地址：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>节点</th>
<th>ip</th>
<th>port</th>
</tr>
</thead>
<tbody>
<tr>
<td>nacos1</td>
<td>192.168.150.1</td>
<td>8845</td>
</tr>
<tr>
<td>nacos2</td>
<td>192.168.150.1</td>
<td>8846</td>
</tr>
<tr>
<td>nacos3</td>
<td>192.168.150.1</td>
<td>8847</td>
</tr>
</tbody>
</table>
</div>
<h1 id="2-搭建集群"><a href="#2-搭建集群" class="headerlink" title="2.搭建集群"></a>2.搭建集群</h1><p>搭建集群的基本步骤：</p>
<ul>
<li>搭建数据库，初始化数据库表结构</li>
<li>下载nacos安装包</li>
<li>配置nacos</li>
<li>启动nacos集群</li>
<li>nginx反向代理</li>
</ul>
<h2 id="2-1-初始化数据库"><a href="#2-1-初始化数据库" class="headerlink" title="2.1.初始化数据库"></a>2.1.初始化数据库</h2><p>Nacos默认数据存储在内嵌数据库Derby中，不属于生产可用的数据库。</p>
<p>官方推荐的最佳实践是使用带有主从的高可用数据库集群，主从模式的高可用数据库可以参考<strong>传智教育</strong>的后续高手课程。</p>
<p>这里我们以单点的数据库为例来讲解。</p>
<p>首先新建一个数据库，命名为nacos，而后导入下面的SQL：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;content&#x27;</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;md5&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">  `src_user` text COMMENT <span class="string">&#x27;source user&#x27;</span>,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source ip&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;租户字段&#x27;</span>,</span><br><span class="line">  `c_desc` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `c_use` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `effect` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `type` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `c_schema` text,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configinfo_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;config_info&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   数据库全名 = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   表名称 = config_info_aggr   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info_aggr` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `datum_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;datum_id&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;内容&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;租户字段&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configinfoaggr_datagrouptenantdatum` (`data_id`,`group_id`,`tenant_id`,`datum_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;增加租户字段&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   数据库全名 = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   表名称 = config_info_beta   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info_beta` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;app_name&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;content&#x27;</span>,</span><br><span class="line">  `beta_ips` <span class="type">varchar</span>(<span class="number">1024</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;betaIps&#x27;</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;md5&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">  `src_user` text COMMENT <span class="string">&#x27;source user&#x27;</span>,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source ip&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;租户字段&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configinfobeta_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;config_info_beta&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   数据库全名 = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   表名称 = config_info_tag   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info_tag` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_id&#x27;</span>,</span><br><span class="line">  `tag_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tag_id&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;app_name&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;content&#x27;</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;md5&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">  `src_user` text COMMENT <span class="string">&#x27;source user&#x27;</span>,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source ip&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configinfotag_datagrouptenanttag` (`data_id`,`group_id`,`tenant_id`,`tag_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;config_info_tag&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   数据库全名 = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   表名称 = config_tags_relation   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_tags_relation` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `tag_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tag_name&#x27;</span>,</span><br><span class="line">  `tag_type` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tag_type&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_id&#x27;</span>,</span><br><span class="line">  `nid` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`nid`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configtagrelation_configidtag` (`id`,`tag_name`,`tag_type`),</span><br><span class="line">  KEY `idx_tenant_id` (`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;config_tag_relation&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   数据库全名 = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   表名称 = group_capacity   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `group_capacity` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键ID&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;Group ID，空字符表示整个集群&#x27;</span>,</span><br><span class="line">  `quota` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;配额，0表示使用默认值&#x27;</span>,</span><br><span class="line">  `usage` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;使用量&#x27;</span>,</span><br><span class="line">  `max_size` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;单个配置大小上限，单位为字节，0表示使用默认值&#x27;</span>,</span><br><span class="line">  `max_aggr_count` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;聚合子配置最大个数，，0表示使用默认值&#x27;</span>,</span><br><span class="line">  `max_aggr_size` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值&#x27;</span>,</span><br><span class="line">  `max_history_count` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;最大变更历史数量&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_group_id` (`group_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;集群、各Group容量信息表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   数据库全名 = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   表名称 = his_config_info   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `his_config_info` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">64</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `nid` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;app_name&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  `src_user` text,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `op_type` <span class="type">char</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;租户字段&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`nid`),</span><br><span class="line">  KEY `idx_gmt_create` (`gmt_create`),</span><br><span class="line">  KEY `idx_gmt_modified` (`gmt_modified`),</span><br><span class="line">  KEY `idx_did` (`data_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;多租户改造&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   数据库全名 = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   表名称 = tenant_capacity   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tenant_capacity` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键ID&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;Tenant ID&#x27;</span>,</span><br><span class="line">  `quota` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;配额，0表示使用默认值&#x27;</span>,</span><br><span class="line">  `usage` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;使用量&#x27;</span>,</span><br><span class="line">  `max_size` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;单个配置大小上限，单位为字节，0表示使用默认值&#x27;</span>,</span><br><span class="line">  `max_aggr_count` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;聚合子配置最大个数&#x27;</span>,</span><br><span class="line">  `max_aggr_size` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值&#x27;</span>,</span><br><span class="line">  `max_history_count` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;最大变更历史数量&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_tenant_id` (`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;租户容量信息表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tenant_info` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `kp` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;kp&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_id&#x27;</span>,</span><br><span class="line">  `tenant_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_name&#x27;</span>,</span><br><span class="line">  `tenant_desc` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tenant_desc&#x27;</span>,</span><br><span class="line">  `create_source` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;create_source&#x27;</span>,</span><br><span class="line">  `gmt_create` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `gmt_modified` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_tenant_info_kptenantid` (`kp`,`tenant_id`),</span><br><span class="line">  KEY `idx_tenant_id` (`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;tenant_info&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `users` (</span><br><span class="line">	`username` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">	`password` <span class="type">varchar</span>(<span class="number">500</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">	`enabled` <span class="type">boolean</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `roles` (</span><br><span class="line">	`username` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">	`role` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">	<span class="keyword">UNIQUE</span> INDEX `idx_user_role` (`username` <span class="keyword">ASC</span>, `role` <span class="keyword">ASC</span>) <span class="keyword">USING</span> BTREE</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `permissions` (</span><br><span class="line">    `role` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `resource` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `action` <span class="type">varchar</span>(<span class="number">8</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">UNIQUE</span> INDEX `uk_role_permission` (`role`,`resource`,`action`) <span class="keyword">USING</span> BTREE</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> users (username, password, enabled) <span class="keyword">VALUES</span> (<span class="string">&#x27;nacos&#x27;</span>, <span class="string">&#x27;$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu&#x27;</span>, <span class="literal">TRUE</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> roles (username, role) <span class="keyword">VALUES</span> (<span class="string">&#x27;nacos&#x27;</span>, <span class="string">&#x27;ROLE_ADMIN&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h2 id="2-2-下载nacos"><a href="#2-2-下载nacos" class="headerlink" title="2.2.下载nacos"></a>2.2.下载nacos</h2><p>nacos在GitHub上有下载地址：<a href="https://github.com/alibaba/nacos/tags，可以选择任意版本下载。">https://github.com/alibaba/nacos/tags，可以选择任意版本下载。</a></p>
<p>本例中才用1.4.1版本：</p>
<p><img src="/2022/06/10/nacos%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/image-20210409212119411.png" alt="image-20210409212119411"></p>
<h2 id="2-3-配置Nacos"><a href="#2-3-配置Nacos" class="headerlink" title="2.3.配置Nacos"></a>2.3.配置Nacos</h2><p>将这个包解压到任意非中文目录下，如图：</p>
<p><img src="/2022/06/10/nacos%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/image-20210402161843337.png" alt="image-20210402161843337"></p>
<p>目录说明：</p>
<ul>
<li>bin：启动脚本</li>
<li>conf：配置文件</li>
</ul>
<p>进入nacos的conf目录，修改配置文件cluster.conf.example，重命名为cluster.conf：</p>
<p><img src="/2022/06/10/nacos%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/image-20210409212459292.png" alt="image-20210409212459292"></p>
<p>然后添加内容：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">127.0.0.1:8845</span><br><span class="line">127.0.0.1:8846</span><br><span class="line">127.0.0.1:8847</span><br></pre></td></tr></table></figure>
<p>然后修改application.properties文件，添加数据库配置</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">spring.datasource.platform</span>=<span class="string">mysql</span></span><br><span class="line"></span><br><span class="line"><span class="meta">db.num</span>=<span class="string">1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">db.url.0</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="meta">db.user.0</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">db.password.0</span>=<span class="string">123</span></span><br></pre></td></tr></table></figure>
<h2 id="2-4-启动"><a href="#2-4-启动" class="headerlink" title="2.4.启动"></a>2.4.启动</h2><p>将nacos文件夹复制三份，分别命名为：nacos1、nacos2、nacos3</p>
<p><img src="/2022/06/10/nacos%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/image-20210409213335538.png" alt="image-20210409213335538"> </p>
<p>然后分别修改三个文件夹中的application.properties，</p>
<p>nacos1:</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8845</span></span><br></pre></td></tr></table></figure>
<p>nacos2:</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8846</span></span><br></pre></td></tr></table></figure>
<p>nacos3:</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8847</span></span><br></pre></td></tr></table></figure>
<p>然后分别启动三个nacos节点：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">startup.cmd</span><br></pre></td></tr></table></figure>
<h2 id="2-5-nginx反向代理"><a href="#2-5-nginx反向代理" class="headerlink" title="2.5.nginx反向代理"></a>2.5.nginx反向代理</h2><p>找到课前资料提供的nginx安装包： </p>
<p><img src="/2022/06/10/nacos%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/image-20210410103253355.png" alt="image-20210410103253355"> </p>
<p>解压到任意非中文目录下：</p>
<p><img src="/2022/06/10/nacos%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/image-20210410103322874.png" alt="image-20210410103322874"> </p>
<p>修改conf/nginx.conf文件，配置如下：</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">upstream</span> nacos-cluster &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:8845</span>;</span><br><span class="line">	<span class="attribute">server</span> <span class="number">127.0.0.1:8846</span>;</span><br><span class="line">	<span class="attribute">server</span> <span class="number">127.0.0.1:8847</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  localhost;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /nacos &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://nacos-cluster;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而后在浏览器访问：<a href="http://localhost/nacos即可。">http://localhost/nacos即可。</a></p>
<p>代码中application.yml文件配置如下：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:80</span> <span class="comment"># Nacos地址</span></span><br></pre></td></tr></table></figure>
<h2 id="2-6-优化"><a href="#2-6-优化" class="headerlink" title="2.6.优化"></a>2.6.优化</h2><ul>
<li><p>实际部署时，需要给做反向代理的nginx服务器设置一个域名，这样后续如果有服务器迁移nacos的客户端也无需更改配置.</p>
</li>
<li><p>Nacos的各个节点应该部署到多个不同服务器，做好容灾和隔离</p>
</li>
</ul>
]]></content>
      <categories>
        <category>SpringCloud</category>
      </categories>
      <tags>
        <tag>SpringCloud</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker安装</title>
    <url>/2022/07/26/Centos7%E5%AE%89%E8%A3%85Docker/</url>
    <content><![CDATA[<h1 id="0-安装Docker"><a href="#0-安装Docker" class="headerlink" title="0.安装Docker"></a>0.安装Docker</h1><p>Docker 分为 CE 和 EE 两大版本。CE 即社区版（免费，支持周期 7 个月），EE 即企业版，强调安全，付费使用，支持周期 24 个月。</p>
<p>Docker CE 分为 <code>stable</code> <code>test</code> 和 <code>nightly</code> 三个更新频道。</p>
<p>官方网站上有各种环境下的 <a href="https://docs.docker.com/install/">安装指南</a>，这里主要介绍 Docker CE 在 CentOS上的安装。</p>
<h1 id="1-CentOS安装Docker"><a href="#1-CentOS安装Docker" class="headerlink" title="1.CentOS安装Docker"></a>1.CentOS安装Docker</h1><p>Docker CE 支持 64 位版本 CentOS 7，并且要求内核版本不低于 3.10， CentOS 7 满足最低内核的要求，所以我们在CentOS 7安装Docker。</p>
<h2 id="1-1-卸载（可选）"><a href="#1-1-卸载（可选）" class="headerlink" title="1.1.卸载（可选）"></a>1.1.卸载（可选）</h2><p>如果之前安装过旧版本的Docker，可以使用下面命令卸载：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-selinux \</span><br><span class="line">                  docker-engine-selinux \</span><br><span class="line">                  docker-engine \</span><br><span class="line">                  docker-ce</span><br></pre></td></tr></table></figure>
<h2 id="1-2-安装docker"><a href="#1-2-安装docker" class="headerlink" title="1.2.安装docker"></a>1.2.安装docker</h2><p>首先需要大家虚拟机联网，安装yum工具</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum install -y yum-utils \</span><br><span class="line">           device-mapper-persistent-data \</span><br><span class="line">           lvm2 --skip-broken</span><br></pre></td></tr></table></figure>
<p>然后更新本地镜像源：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 设置docker镜像源</span></span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">    </span><br><span class="line">sed -i &#x27;s/download.docker.com/mirrors.aliyun.com\/docker-ce/g&#x27; /etc/yum.repos.d/docker-ce.repo</span><br><span class="line"></span><br><span class="line">yum makecache fast</span><br></pre></td></tr></table></figure>
<p>然后输入命令：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install -y docker-ce</span><br></pre></td></tr></table></figure>
<p>docker-ce为社区免费版本。稍等片刻，docker即可安装成功。</p>
<h2 id="1-3-启动docker"><a href="#1-3-启动docker" class="headerlink" title="1.3.启动docker"></a>1.3.启动docker</h2><p>Docker应用需要用到各种端口，逐一去修改防火墙设置。非常麻烦，因此建议大家直接关闭防火墙！</p>
<p>启动docker前，一定要关闭防火墙后！！</p>
<p>启动docker前，一定要关闭防火墙后！！</p>
<p>启动docker前，一定要关闭防火墙后！！</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 关闭</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line"><span class="comment"># 禁止开机启动防火墙</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br></pre></td></tr></table></figure>
<p>通过命令启动docker：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">systemctl start docker  <span class="comment"># 启动docker服务</span></span><br><span class="line"></span><br><span class="line">systemctl stop docker  <span class="comment"># 停止docker服务</span></span><br><span class="line"></span><br><span class="line">systemctl restart docker  <span class="comment"># 重启docker服务</span></span><br></pre></td></tr></table></figure>
<p>然后输入命令，可以查看docker版本：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker -v</span><br></pre></td></tr></table></figure>
<p>如图：</p>
<p><img src="/2022/07/26/Centos7%E5%AE%89%E8%A3%85Docker/image-20210418154704436.png" alt="image-20210418154704436"> </p>
<h2 id="1-4-配置镜像加速"><a href="#1-4-配置镜像加速" class="headerlink" title="1.4.配置镜像加速"></a>1.4.配置镜像加速</h2><p>docker官方镜像仓库网速较差，我们需要设置国内镜像服务：</p>
<p>参考阿里云的镜像加速文档：<a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</a></p>
<h1 id="2-CentOS7安装DockerCompose"><a href="#2-CentOS7安装DockerCompose" class="headerlink" title="2.CentOS7安装DockerCompose"></a>2.CentOS7安装DockerCompose</h1><h2 id="2-1-下载"><a href="#2-1-下载" class="headerlink" title="2.1.下载"></a>2.1.下载</h2><p>Linux下需要通过命令下载：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">curl -L https://github.com/docker/compose/releases/download/1.23.1/docker-compose-`uname -s`-`uname -m` &gt; /usr/<span class="built_in">local</span>/bin/docker-compose</span><br></pre></td></tr></table></figure>
<p>如果下载速度较慢，或者下载失败，可以使用课前资料提供的docker-compose文件：</p>
<p><img src="/2022/07/26/Centos7%E5%AE%89%E8%A3%85Docker/image-20210417133020614.png" alt="image-20210417133020614"></p>
<p>上传到<code>/usr/local/bin/</code>目录也可以。</p>
<h2 id="2-2-修改文件权限"><a href="#2-2-修改文件权限" class="headerlink" title="2.2.修改文件权限"></a>2.2.修改文件权限</h2><p>修改文件权限：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 修改权限</span></span><br><span class="line">chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br></pre></td></tr></table></figure>
<h2 id="2-3-Base自动补全命令："><a href="#2-3-Base自动补全命令：" class="headerlink" title="2.3.Base自动补全命令："></a>2.3.Base自动补全命令：</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 补全命令</span></span><br><span class="line">curl -L https://raw.githubusercontent.com/docker/compose/1.29.1/contrib/completion/bash/docker-compose &gt; /etc/bash_completion.d/docker-compose</span><br></pre></td></tr></table></figure>
<p>如果这里出现错误，需要修改自己的hosts文件：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;199.232.68.133 raw.githubusercontent.com&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure>
<h1 id="3-Docker镜像仓库"><a href="#3-Docker镜像仓库" class="headerlink" title="3.Docker镜像仓库"></a>3.Docker镜像仓库</h1><p>搭建镜像仓库可以基于Docker官方提供的DockerRegistry来实现。</p>
<p>官网地址：<a href="https://hub.docker.com/_/registry">https://hub.docker.com/_/registry</a></p>
<h2 id="3-1-简化版镜像仓库"><a href="#3-1-简化版镜像仓库" class="headerlink" title="3.1.简化版镜像仓库"></a>3.1.简化版镜像仓库</h2><p>Docker官方的Docker Registry是一个基础版本的Docker镜像仓库，具备仓库管理的完整功能，但是没有图形化界面。</p>
<p>搭建方式比较简单，命令如下：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">    --restart=always \</span><br><span class="line">    --name registry	\</span><br><span class="line">    -p 5000:5000 \</span><br><span class="line">    -v registry-data:/var/lib/registry \</span><br><span class="line">    registry</span><br></pre></td></tr></table></figure>
<p>命令中挂载了一个数据卷registry-data到容器内的/var/lib/registry 目录，这是私有镜像库存放数据的目录。</p>
<p>访问<a href="http://YourIp:5000/v2/_catalog">http://YourIp:5000/v2/_catalog</a> 可以查看当前私有镜像服务中包含的镜像</p>
<h2 id="3-2-带有图形化界面版本"><a href="#3-2-带有图形化界面版本" class="headerlink" title="3.2.带有图形化界面版本"></a>3.2.带有图形化界面版本</h2><p>使用DockerCompose部署带有图象界面的DockerRegistry，命令如下：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.0&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">registry:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">registry</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./registry-data:/var/lib/registry</span></span><br><span class="line">  <span class="attr">ui:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">joxit/docker-registry-ui:static</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8080</span><span class="string">:80</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">REGISTRY_TITLE=传智教育私有仓库</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">REGISTRY_URL=http://registry:5000</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">registry</span></span><br></pre></td></tr></table></figure>
<h2 id="3-3-配置Docker信任地址"><a href="#3-3-配置Docker信任地址" class="headerlink" title="3.3.配置Docker信任地址"></a>3.3.配置Docker信任地址</h2><p>我们的私服采用的是http协议，默认不被Docker信任，所以需要做一个配置：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 打开要修改的文件</span></span><br><span class="line">vi /etc/docker/daemon.json</span><br><span class="line"><span class="comment"># 添加内容：</span></span><br><span class="line"><span class="string">&quot;insecure-registries&quot;</span>:[<span class="string">&quot;http://192.168.150.101:8080&quot;</span>]</span><br><span class="line"><span class="comment"># 重加载</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line"><span class="comment"># 重启docker</span></span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker实用篇</title>
    <url>/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/</url>
    <content><![CDATA[<h1 id="Docker实用篇"><a href="#Docker实用篇" class="headerlink" title="Docker实用篇"></a>Docker实用篇</h1><h1 id="0-学习目标"><a href="#0-学习目标" class="headerlink" title="0.学习目标"></a>0.学习目标</h1><h1 id="1-初识Docker"><a href="#1-初识Docker" class="headerlink" title="1.初识Docker"></a>1.初识Docker</h1><h2 id="1-1-什么是Docker"><a href="#1-1-什么是Docker" class="headerlink" title="1.1.什么是Docker"></a>1.1.什么是Docker</h2><p>微服务虽然具备各种各样的优势，但服务的拆分通用给部署带来了很大的麻烦。</p>
<ul>
<li>分布式系统中，依赖的组件非常多，不同组件之间部署时往往会产生一些冲突。</li>
<li>在数百上千台服务中重复部署，环境不一定一致，会遇到各种问题</li>
</ul>
<h3 id="1-1-1-应用部署的环境问题"><a href="#1-1-1-应用部署的环境问题" class="headerlink" title="1.1.1.应用部署的环境问题"></a>1.1.1.应用部署的环境问题</h3><p>大型项目组件较多，运行环境也较为复杂，部署时会碰到一些问题：</p>
<ul>
<li><p>依赖关系复杂，容易出现兼容性问题</p>
</li>
<li><p>开发、测试、生产环境有差异</p>
</li>
</ul>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731141907366.png" alt="image-20210731141907366"></p>
<p>例如一个项目中，部署时需要依赖于node.js、Redis、RabbitMQ、MySQL等，这些服务部署时所需要的函数库、依赖项各不相同，甚至会有冲突。给部署带来了极大的困难。</p>
<h3 id="1-1-2-Docker解决依赖兼容问题"><a href="#1-1-2-Docker解决依赖兼容问题" class="headerlink" title="1.1.2.Docker解决依赖兼容问题"></a>1.1.2.Docker解决依赖兼容问题</h3><p>而Docker确巧妙的解决了这些问题，Docker是如何实现的呢？</p>
<p>Docker为了解决依赖的兼容问题的，采用了两个手段：</p>
<ul>
<li><p>将应用的Libs（函数库）、Deps（依赖）、配置与应用一起打包</p>
</li>
<li><p>将每个应用放到一个隔离<strong>容器</strong>去运行，避免互相干扰</p>
</li>
</ul>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731142219735.png" alt="image-20210731142219735"></p>
<p>这样打包好的应用包中，既包含应用本身，也保护应用所需要的Libs、Deps，无需再操作系统上安装这些，自然就不存在不同应用之间的兼容问题了。</p>
<p>虽然解决了不同应用的兼容问题，但是开发、测试等环境会存在差异，操作系统版本也会有差异，怎么解决这些问题呢？</p>
<h3 id="1-1-3-Docker解决操作系统环境差异"><a href="#1-1-3-Docker解决操作系统环境差异" class="headerlink" title="1.1.3.Docker解决操作系统环境差异"></a>1.1.3.Docker解决操作系统环境差异</h3><p>要解决不同操作系统环境差异问题，必须先了解操作系统结构。以一个Ubuntu操作系统为例，结构如下：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731143401460.png" alt="image-20210731143401460"></p>
<p>结构包括：</p>
<ul>
<li>计算机硬件：例如CPU、内存、磁盘等</li>
<li>系统内核：所有Linux发行版的内核都是Linux，例如CentOS、Ubuntu、Fedora等。内核可以与计算机硬件交互，对外提供<strong>内核指令</strong>，用于操作计算机硬件。</li>
<li>系统应用：操作系统本身提供的应用、函数库。这些函数库是对内核指令的封装，使用更加方便。</li>
</ul>
<p>应用于计算机交互的流程如下：</p>
<p>1）应用调用操作系统应用（函数库），实现各种功能</p>
<p>2）系统函数库是对内核指令集的封装，会调用内核指令</p>
<p>3）内核指令操作计算机硬件</p>
<p>Ubuntu和CentOSpringBoot都是基于Linux内核，无非是系统应用不同，提供的函数库有差异：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731144304990.png" alt="image-20210731144304990"></p>
<p>此时，如果将一个Ubuntu版本的MySQL应用安装到CentOS系统，MySQL在调用Ubuntu函数库时，会发现找不到或者不匹配，就会报错了：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731144458680.png" alt="image-20210731144458680"></p>
<p>Docker如何解决不同系统环境的问题？</p>
<ul>
<li>Docker将用户程序与所需要调用的系统(比如Ubuntu)函数库一起打包</li>
<li>Docker运行到不同操作系统时，直接基于打包的函数库，借助于操作系统的Linux内核来运行</li>
</ul>
<p>如图：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731144820638.png" alt="image-20210731144820638"></p>
<h3 id="1-1-4-小结"><a href="#1-1-4-小结" class="headerlink" title="1.1.4.小结"></a>1.1.4.小结</h3><p>Docker如何解决大型项目依赖关系复杂，不同组件依赖的兼容性问题？</p>
<ul>
<li>Docker允许开发中将应用、依赖、函数库、配置一起<strong>打包</strong>，形成可移植镜像</li>
<li>Docker应用运行在容器中，使用沙箱机制，相互<strong>隔离</strong></li>
</ul>
<p>Docker如何解决开发、测试、生产环境有差异的问题？</p>
<ul>
<li>Docker镜像中包含完整运行环境，包括系统函数库，仅依赖系统的Linux内核，因此可以在任意Linux操作系统上运行</li>
</ul>
<p>Docker是一个快速交付应用、运行应用的技术，具备下列优势：</p>
<ul>
<li>可以将程序及其依赖、运行环境一起打包为一个镜像，可以迁移到任意Linux操作系统</li>
<li>运行时利用沙箱机制形成隔离容器，各个应用互不干扰</li>
<li>启动、移除都可以通过一行命令完成，方便快捷</li>
</ul>
<h2 id="1-2-Docker和虚拟机的区别"><a href="#1-2-Docker和虚拟机的区别" class="headerlink" title="1.2.Docker和虚拟机的区别"></a>1.2.Docker和虚拟机的区别</h2><p>Docker可以让一个应用在任何操作系统中非常方便的运行。而以前我们接触的虚拟机，也能在一个操作系统中，运行另外一个操作系统，保护系统中的任何应用。</p>
<p>两者有什么差异呢？</p>
<p><strong>虚拟机</strong>（virtual machine）是在操作系统中<strong>模拟</strong>硬件设备，然后运行另一个操作系统，比如在 Windows 系统里面运行 Ubuntu 系统，这样就可以运行任意的Ubuntu应用了。</p>
<p><strong>Docker</strong>仅仅是封装函数库，并没有模拟完整的操作系统，如图：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731145914960.png" alt="image-20210731145914960"></p>
<p>对比来看：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731152243765.png" alt="image-20210731152243765"></p>
<p>小结：</p>
<p>Docker和虚拟机的差异：</p>
<ul>
<li><p>docker是一个系统进程；虚拟机是在操作系统中的操作系统</p>
</li>
<li><p>docker体积小、启动速度快、性能好；虚拟机体积大、启动速度慢、性能一般</p>
</li>
</ul>
<h2 id="1-3-Docker架构"><a href="#1-3-Docker架构" class="headerlink" title="1.3.Docker架构"></a>1.3.Docker架构</h2><h3 id="1-3-1-镜像和容器"><a href="#1-3-1-镜像和容器" class="headerlink" title="1.3.1.镜像和容器"></a>1.3.1.镜像和容器</h3><p>Docker中有几个重要的概念：</p>
<p><strong>镜像（Image）</strong>：Docker将应用程序及其所需的依赖、函数库、环境、配置等文件打包在一起，称为镜像。</p>
<p><strong>容器（Container）</strong>：镜像中的应用程序运行后形成的进程就是<strong>容器</strong>，只是Docker会给容器进程做隔离，对外不可见。</p>
<p>一切应用最终都是代码组成，都是硬盘中的一个个的字节形成的<strong>文件</strong>。只有运行时，才会加载到内存，形成进程。</p>
<p>而<strong>镜像</strong>，就是把一个应用在硬盘上的文件、及其运行环境、部分系统函数库文件一起打包形成的文件包。这个文件包是只读的。</p>
<p><strong>容器</strong>呢，就是将这些文件中编写的程序、函数加载到内存中允许，形成进程，只不过要隔离起来。因此一个镜像可以启动多次，形成多个容器进程。</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731153059464.png" alt="image-20210731153059464"></p>
<p>例如你下载了一个QQ，如果我们将QQ在磁盘上的运行<strong>文件</strong>及其运行的操作系统依赖打包，形成QQ镜像。然后你可以启动多次，双开、甚至三开QQ，跟多个妹子聊天。</p>
<h3 id="1-3-2-DockerHub"><a href="#1-3-2-DockerHub" class="headerlink" title="1.3.2.DockerHub"></a>1.3.2.DockerHub</h3><p>开源应用程序非常多，打包这些应用往往是重复的劳动。为了避免这些重复劳动，人们就会将自己打包的应用镜像，例如Redis、MySQL镜像放到网络上，共享使用，就像GitHub的代码共享一样。</p>
<ul>
<li><p>DockerHub：DockerHub是一个官方的Docker镜像的托管平台。这样的平台称为Docker Registry。</p>
</li>
<li><p>国内也有类似于DockerHub 的公开服务，比如 <a href="https://c.163yun.com/hub">网易云镜像服务</a>、<a href="https://cr.console.aliyun.com/">阿里云镜像库</a>等。</p>
</li>
</ul>
<p>我们一方面可以将自己的镜像共享到DockerHub，另一方面也可以从DockerHub拉取镜像：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731153743354.png" alt="image-20210731153743354"></p>
<h3 id="1-3-3-Docker架构"><a href="#1-3-3-Docker架构" class="headerlink" title="1.3.3.Docker架构"></a>1.3.3.Docker架构</h3><p>我们要使用Docker来操作镜像、容器，就必须要安装Docker。</p>
<p>Docker是一个CS架构的程序，由两部分组成：</p>
<ul>
<li><p>服务端(server)：Docker守护进程，负责处理Docker指令，管理镜像、容器等</p>
</li>
<li><p>客户端(client)：通过命令或RestAPI向Docker服务端发送指令。可以在本地或远程向服务端发送指令。</p>
</li>
</ul>
<p>如图：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731154257653.png" alt="image-20210731154257653"></p>
<h3 id="1-3-4-小结"><a href="#1-3-4-小结" class="headerlink" title="1.3.4.小结"></a>1.3.4.小结</h3><p>镜像：</p>
<ul>
<li>将应用程序及其依赖、环境、配置打包在一起</li>
</ul>
<p>容器：</p>
<ul>
<li>镜像运行起来就是容器，一个镜像可以运行多个容器</li>
</ul>
<p>Docker结构：</p>
<ul>
<li><p>服务端：接收命令或远程请求，操作镜像或容器</p>
</li>
<li><p>客户端：发送命令或者请求到Docker服务端</p>
</li>
</ul>
<p>DockerHub：</p>
<ul>
<li>一个镜像托管的服务器，类似的还有阿里云镜像服务，统称为DockerRegistry</li>
</ul>
<h2 id="1-4-安装Docker"><a href="#1-4-安装Docker" class="headerlink" title="1.4.安装Docker"></a>1.4.安装Docker</h2><p>企业部署一般都是采用Linux操作系统，而其中又数CentOS发行版占比最多，因此我们在CentOS下安装Docker。参考课前资料中的文档：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731155002425.png" alt="image-20210731155002425"></p>
<h1 id="2-Docker的基本操作"><a href="#2-Docker的基本操作" class="headerlink" title="2.Docker的基本操作"></a>2.Docker的基本操作</h1><h2 id="2-1-镜像操作"><a href="#2-1-镜像操作" class="headerlink" title="2.1.镜像操作"></a>2.1.镜像操作</h2><h3 id="2-1-1-镜像名称"><a href="#2-1-1-镜像名称" class="headerlink" title="2.1.1.镜像名称"></a>2.1.1.镜像名称</h3><p>首先来看下镜像的名称组成：</p>
<ul>
<li>镜名称一般分两部分组成：[repository]:[tag]。</li>
<li>在没有指定tag时，默认是latest，代表最新版本的镜像</li>
</ul>
<p>如图：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731155141362.png" alt="image-20210731155141362"></p>
<p>这里的mysql就是repository，5.7就是tag，合一起就是镜像名称，代表5.7版本的MySQL镜像。</p>
<h3 id="2-1-2-镜像命令"><a href="#2-1-2-镜像命令" class="headerlink" title="2.1.2.镜像命令"></a>2.1.2.镜像命令</h3><p>常见的镜像操作命令如图：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731155649535.png" alt="image-20210731155649535"></p>
<h3 id="2-1-3-案例1-拉取、查看镜像"><a href="#2-1-3-案例1-拉取、查看镜像" class="headerlink" title="2.1.3.案例1-拉取、查看镜像"></a>2.1.3.案例1-拉取、查看镜像</h3><p>需求：从DockerHub中拉取一个nginx镜像并查看</p>
<p>1）首先去镜像仓库搜索nginx镜像，比如<a href="https://hub.docker.com/">DockerHub</a>:</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731155844368.png" alt="image-20210731155844368"></p>
<p>2）根据查看到的镜像名称，拉取自己需要的镜像，通过命令：docker pull nginx</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731155856199.png" alt="image-20210731155856199"></p>
<p>3）通过命令：docker images 查看拉取到的镜像</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731155903037.png" alt="image-20210731155903037"></p>
<h3 id="2-1-4-案例2-保存、导入镜像"><a href="#2-1-4-案例2-保存、导入镜像" class="headerlink" title="2.1.4.案例2-保存、导入镜像"></a>2.1.4.案例2-保存、导入镜像</h3><p>需求：利用docker save将nginx镜像导出磁盘，然后再通过load加载回来</p>
<p>1）利用docker xx —help命令查看docker save和docker load的语法</p>
<p>例如，查看save命令用法，可以输入命令：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker save --<span class="built_in">help</span></span><br></pre></td></tr></table></figure>
<p>结果：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731161104732.png" alt="image-20210731161104732"></p>
<p>命令格式：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker save -o [保存的目标文件名称] [镜像名称]</span><br></pre></td></tr></table></figure>
<p>2）使用docker save导出镜像到磁盘 </p>
<p>运行命令：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker save -o nginx.tar nginx:latest</span><br></pre></td></tr></table></figure>
<p>结果如图：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731161354344.png" alt="image-20210731161354344"></p>
<p>3）使用docker load加载镜像</p>
<p>先删除本地的nginx镜像：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker rmi nginx:latest</span><br></pre></td></tr></table></figure>
<p>然后运行命令，加载本地文件：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker load -i nginx.tar</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731161746245.png" alt="image-20210731161746245"></p>
<h3 id="2-1-5-练习"><a href="#2-1-5-练习" class="headerlink" title="2.1.5.练习"></a>2.1.5.练习</h3><p>需求：去DockerHub搜索并拉取一个Redis镜像</p>
<p>目标：</p>
<p>1）去DockerHub搜索Redis镜像</p>
<p>2）查看Redis镜像的名称和版本</p>
<p>3）利用docker pull命令拉取镜像</p>
<p>4）利用docker save命令将 redis:latest打包为一个redis.tar包</p>
<p>5）利用docker rmi 删除本地的redis:latest</p>
<p>6）利用docker load 重新加载 redis.tar文件</p>
<h2 id="2-2-容器操作"><a href="#2-2-容器操作" class="headerlink" title="2.2.容器操作"></a>2.2.容器操作</h2><h3 id="2-2-1-容器相关命令"><a href="#2-2-1-容器相关命令" class="headerlink" title="2.2.1.容器相关命令"></a>2.2.1.容器相关命令</h3><p>容器操作的命令如图：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731161950495.png" alt="image-20210731161950495"></p>
<p>容器保护三个状态：</p>
<ul>
<li>运行：进程正常运行</li>
<li>暂停：进程暂停，CPU不再运行，并不释放内存</li>
<li>停止：进程终止，回收进程占用的内存、CPU等资源</li>
</ul>
<p>其中：</p>
<ul>
<li>docker run：创建并运行一个容器，处于运行状态</li>
<li>docker pause：让一个运行的容器暂停</li>
<li>docker unpause：让一个容器从暂停状态恢复运行</li>
<li>docker stop：停止一个运行的容器</li>
<li><p>docker start：让一个停止的容器再次运行</p>
</li>
<li><p>docker rm：删除一个容器</p>
</li>
</ul>
<h3 id="2-2-2-案例-创建并运行一个容器"><a href="#2-2-2-案例-创建并运行一个容器" class="headerlink" title="2.2.2.案例-创建并运行一个容器"></a>2.2.2.案例-创建并运行一个容器</h3><p>创建并运行nginx容器的命令：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run --name containerName -p 80:80 -d nginx</span><br></pre></td></tr></table></figure>
<p>命令解读：</p>
<ul>
<li>docker run ：创建并运行一个容器</li>
<li>—name : 给容器起一个名字，比如叫做mn</li>
<li>-p ：将宿主机端口与容器端口映射，冒号左侧是宿主机端口，右侧是容器端口</li>
<li>-d：后台运行容器</li>
<li>nginx：镜像名称，例如nginx</li>
</ul>
<p>这里的<code>-p</code>参数，是将容器端口映射到宿主机端口。</p>
<p>默认情况下，容器是隔离环境，我们直接访问宿主机的80端口，肯定访问不到容器中的nginx。</p>
<p>现在，将容器的80与宿主机的80关联起来，当我们访问宿主机的80端口时，就会被映射到容器的80，这样就能访问到nginx了：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731163255863.png" alt="image-20210731163255863"></p>
<h3 id="2-2-3-案例-进入容器，修改文件"><a href="#2-2-3-案例-进入容器，修改文件" class="headerlink" title="2.2.3.案例-进入容器，修改文件"></a>2.2.3.案例-进入容器，修改文件</h3><p><strong>需求</strong>：进入Nginx容器，修改HTML文件内容，添加“传智教育欢迎您”</p>
<p><strong>提示</strong>：进入容器要用到docker exec命令。</p>
<p><strong>步骤</strong>：</p>
<p>1）进入容器。进入我们刚刚创建的nginx容器的命令为：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it mn bash</span><br></pre></td></tr></table></figure>
<p>命令解读：</p>
<ul>
<li><p>docker exec ：进入容器内部，执行一个命令</p>
</li>
<li><p>-it : 给当前进入的容器创建一个标准输入、输出终端，允许我们与容器交互</p>
</li>
<li><p>mn ：要进入的容器的名称</p>
</li>
<li><p>bash：进入容器后执行的命令，bash是一个linux终端交互命令</p>
</li>
</ul>
<p>2）进入nginx的HTML所在目录 /usr/share/nginx/html</p>
<p>容器内部会模拟一个独立的Linux文件系统，看起来如同一个linux服务器一样：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731164159811.png" alt="image-20210731164159811"></p>
<p>nginx的环境、配置、运行文件全部都在这个文件系统中，包括我们要修改的html文件。</p>
<p>查看DockerHub网站中的nginx页面，可以知道nginx的html目录位置在<code>/usr/share/nginx/html</code></p>
<p>我们执行命令，进入该目录：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/share/nginx/html</span><br></pre></td></tr></table></figure>
<p> 查看目录下文件：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731164455818.png" alt="image-20210731164455818"></p>
<p>3）修改index.html的内容</p>
<p>容器内没有vi命令，无法直接修改，我们用下面的命令来修改：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sed -i -e <span class="string">&#x27;s#Welcome to nginx#传智教育欢迎您#g&#x27;</span> -e <span class="string">&#x27;s#&lt;head&gt;#&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;&gt;#g&#x27;</span> index.html</span><br></pre></td></tr></table></figure>
<p>在浏览器访问自己的虚拟机地址，例如我的是：<a href="http://192.168.150.101，即可看到结果：">http://192.168.150.101，即可看到结果：</a></p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731164717604.png" alt="image-20210731164717604"></p>
<h3 id="2-2-4-小结"><a href="#2-2-4-小结" class="headerlink" title="2.2.4.小结"></a>2.2.4.小结</h3><p>docker run命令的常见参数有哪些？</p>
<ul>
<li>—name：指定容器名称</li>
<li>-p：指定端口映射</li>
<li>-d：让容器后台运行</li>
</ul>
<p>查看容器日志的命令：</p>
<ul>
<li>docker logs</li>
<li>添加 -f 参数可以持续查看日志</li>
</ul>
<p>查看容器状态：</p>
<ul>
<li>docker ps</li>
<li>docker ps -a 查看所有容器，包括已经停止的</li>
</ul>
<h2 id="2-3-数据卷（容器数据管理）"><a href="#2-3-数据卷（容器数据管理）" class="headerlink" title="2.3.数据卷（容器数据管理）"></a>2.3.数据卷（容器数据管理）</h2><p>在之前的nginx案例中，修改nginx的html页面时，需要进入nginx内部。并且因为没有编辑器，修改文件也很麻烦。</p>
<p>这就是因为容器与数据（容器内文件）耦合带来的后果。</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731172440275.png" alt="image-20210731172440275"></p>
<p>要解决这个问题，必须将数据与容器解耦，这就要用到数据卷了。</p>
<h3 id="2-3-1-什么是数据卷"><a href="#2-3-1-什么是数据卷" class="headerlink" title="2.3.1.什么是数据卷"></a>2.3.1.什么是数据卷</h3><p><strong>数据卷（volume）</strong>是一个虚拟目录，指向宿主机文件系统中的某个目录。</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731173541846.png" alt="image-20210731173541846"></p>
<p>一旦完成数据卷挂载，对容器的一切操作都会作用在数据卷对应的宿主机目录了。</p>
<p>这样，我们操作宿主机的/var/lib/docker/volumes/html目录，就等于操作容器内的/usr/share/nginx/html目录了</p>
<h3 id="2-3-2-数据集操作命令"><a href="#2-3-2-数据集操作命令" class="headerlink" title="2.3.2.数据集操作命令"></a>2.3.2.数据集操作命令</h3><p>数据卷操作的基本语法如下：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker volume [COMMAND]</span><br></pre></td></tr></table></figure>
<p>docker volume命令是数据卷操作，根据命令后跟随的command来确定下一步的操作：</p>
<ul>
<li>create 创建一个volume</li>
<li>inspect 显示一个或多个volume的信息</li>
<li>ls 列出所有的volume</li>
<li>prune 删除未使用的volume</li>
<li>rm 删除一个或多个指定的volume</li>
</ul>
<h3 id="2-3-3-创建和查看数据卷"><a href="#2-3-3-创建和查看数据卷" class="headerlink" title="2.3.3.创建和查看数据卷"></a>2.3.3.创建和查看数据卷</h3><p><strong>需求</strong>：创建一个数据卷，并查看数据卷在宿主机的目录位置</p>
<p>① 创建数据卷</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker volume create html</span><br></pre></td></tr></table></figure>
<p>② 查看所有数据</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker volume ls</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731173746910.png" alt="image-20210731173746910"></p>
<p>③ 查看数据卷详细信息卷</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker volume inspect html</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731173809877.png" alt="image-20210731173809877"></p>
<p>可以看到，我们创建的html这个数据卷关联的宿主机目录为<code>/var/lib/docker/volumes/html/_data</code>目录。</p>
<p><strong>小结</strong>：</p>
<p>数据卷的作用：</p>
<ul>
<li>将容器与数据分离，解耦合，方便操作容器内数据，保证数据安全</li>
</ul>
<p>数据卷操作：</p>
<ul>
<li>docker volume create：创建数据卷</li>
<li>docker volume ls：查看所有数据卷</li>
<li>docker volume inspect：查看数据卷详细信息，包括关联的宿主机目录位置</li>
<li>docker volume rm：删除指定数据卷</li>
<li>docker volume prune：删除所有未使用的数据卷</li>
</ul>
<h3 id="2-3-4-挂载数据卷"><a href="#2-3-4-挂载数据卷" class="headerlink" title="2.3.4.挂载数据卷"></a>2.3.4.挂载数据卷</h3><p>我们在创建容器时，可以通过 -v 参数来挂载一个数据卷到某个容器内目录，命令格式如下：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run \</span><br><span class="line">  --name mn \</span><br><span class="line">  -v html:/root/html \</span><br><span class="line">  -p 8080:80</span><br><span class="line">  nginx \</span><br></pre></td></tr></table></figure>
<p>这里的-v就是挂载数据卷的命令：</p>
<ul>
<li><code>-v html:/root/htm</code> ：把html数据卷挂载到容器内的/root/html这个目录中</li>
</ul>
<h3 id="2-3-5-案例-给nginx挂载数据卷"><a href="#2-3-5-案例-给nginx挂载数据卷" class="headerlink" title="2.3.5.案例-给nginx挂载数据卷"></a>2.3.5.案例-给nginx挂载数据卷</h3><p><strong>需求</strong>：创建一个nginx容器，修改容器内的html目录内的index.html内容</p>
<p><strong>分析</strong>：上个案例中，我们进入nginx容器内部，已经知道nginx的html目录所在位置/usr/share/nginx/html ，我们需要把这个目录挂载到html这个数据卷上，方便操作其中的内容。</p>
<p><strong>提示</strong>：运行容器时使用 -v 参数挂载数据卷</p>
<p>步骤：</p>
<p>① 创建容器并挂载数据卷到容器内的HTML目录</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run --name mn -v html:/usr/share/nginx/html -p 80:80 -d nginx</span><br></pre></td></tr></table></figure>
<p>② 进入html数据卷所在位置，并修改HTML内容</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看html数据卷的位置</span></span><br><span class="line">docker volume inspect html</span><br><span class="line"><span class="comment"># 进入该目录</span></span><br><span class="line"><span class="built_in">cd</span> /var/lib/docker/volumes/html/_data</span><br><span class="line"><span class="comment"># 修改文件</span></span><br><span class="line">vi index.html</span><br></pre></td></tr></table></figure>
<h3 id="2-3-6-案例-给MySQL挂载本地目录"><a href="#2-3-6-案例-给MySQL挂载本地目录" class="headerlink" title="2.3.6.案例-给MySQL挂载本地目录"></a>2.3.6.案例-给MySQL挂载本地目录</h3><p>容器不仅仅可以挂载数据卷，也可以直接挂载到宿主机目录上。关联关系如下：</p>
<ul>
<li>带数据卷模式：宿主机目录 —&gt; 数据卷 —-&gt; 容器内目录</li>
<li>直接挂载模式：宿主机目录 —-&gt; 容器内目录</li>
</ul>
<p>如图：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731175155453.png" alt="image-20210731175155453"></p>
<p><strong>语法</strong>：</p>
<p>目录挂载与数据卷挂载的语法是类似的：</p>
<ul>
<li>-v [宿主机目录]:[容器内目录]</li>
<li>-v [宿主机文件]:[容器内文件]</li>
</ul>
<p><strong>需求</strong>：创建并运行一个MySQL容器，将宿主机目录直接挂载到容器</p>
<p>实现思路如下：</p>
<p>1）在将课前资料中的mysql.tar文件上传到虚拟机，通过load命令加载为镜像</p>
<p>2）创建目录/tmp/mysql/data</p>
<p>3）创建目录/tmp/mysql/conf，将课前资料提供的hmy.cnf文件上传到/tmp/mysql/conf</p>
<p>4）去DockerHub查阅资料，创建并运行MySQL容器，要求：</p>
<p>① 挂载/tmp/mysql/data到mysql容器内数据存储目录</p>
<p>② 挂载/tmp/mysql/conf/hmy.cnf到mysql容器的配置文件</p>
<p>③ 设置MySQL密码</p>
<h3 id="2-3-7-小结"><a href="#2-3-7-小结" class="headerlink" title="2.3.7.小结"></a>2.3.7.小结</h3><p>docker run的命令中通过 -v 参数挂载文件或目录到容器中：</p>
<ul>
<li>-v volume名称:容器内目录</li>
<li>-v 宿主机文件:容器内文</li>
<li>-v 宿主机目录:容器内目录</li>
</ul>
<p>数据卷挂载与目录直接挂载的</p>
<ul>
<li>数据卷挂载耦合度低，由docker来管理目录，但是目录较深，不好找</li>
<li>目录挂载耦合度高，需要我们自己管理目录，不过目录容易寻找查看</li>
</ul>
<h1 id="3-Dockerfile自定义镜像"><a href="#3-Dockerfile自定义镜像" class="headerlink" title="3.Dockerfile自定义镜像"></a>3.Dockerfile自定义镜像</h1><p>常见的镜像在DockerHub就能找到，但是我们自己写的项目就必须自己构建镜像了。</p>
<p>而要自定义镜像，就必须先了解镜像的结构才行。</p>
<h2 id="3-1-镜像结构"><a href="#3-1-镜像结构" class="headerlink" title="3.1.镜像结构"></a>3.1.镜像结构</h2><p>镜像是将应用程序及其需要的系统函数库、环境、配置、依赖打包而成。</p>
<p>我们以MySQL为例，来看看镜像的组成结构：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731175806273.png" alt="image-20210731175806273"></p>
<p>简单来说，镜像就是在系统函数库、运行环境基础上，添加应用程序文件、配置文件、依赖文件等组合，然后编写好启动脚本打包在一起形成的文件。</p>
<p>我们要构建镜像，其实就是实现上述打包的过程。</p>
<h2 id="3-2-Dockerfile语法"><a href="#3-2-Dockerfile语法" class="headerlink" title="3.2.Dockerfile语法"></a>3.2.Dockerfile语法</h2><p>构建自定义的镜像时，并不需要一个个文件去拷贝，打包。</p>
<p>我们只需要告诉Docker，我们的镜像的组成，需要哪些BaseImage、需要拷贝什么文件、需要安装什么依赖、启动脚本是什么，将来Docker会帮助我们构建镜像。</p>
<p>而描述上述信息的文件就是Dockerfile文件。</p>
<p><strong>Dockerfile</strong>就是一个文本文件，其中包含一个个的<strong>指令(Instruction)</strong>，用指令来说明要执行什么操作来构建镜像。每一个指令都会形成一层Layer。</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731180321133.png" alt="image-20210731180321133"></p>
<p>更新详细语法说明，请参考官网文档： <a href="https://docs.docker.com/engine/reference/builder">https://docs.docker.com/engine/reference/builder</a></p>
<h2 id="3-3-构建Java项目"><a href="#3-3-构建Java项目" class="headerlink" title="3.3.构建Java项目"></a>3.3.构建Java项目</h2><h3 id="3-3-1-基于Ubuntu构建Java项目"><a href="#3-3-1-基于Ubuntu构建Java项目" class="headerlink" title="3.3.1.基于Ubuntu构建Java项目"></a>3.3.1.基于Ubuntu构建Java项目</h3><p>需求：基于Ubuntu镜像构建一个新镜像，运行一个java项目</p>
<ul>
<li><p>步骤1：新建一个空文件夹docker-demo</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210801101207444.png" alt="image-20210801101207444"></p>
</li>
<li><p>步骤2：拷贝课前资料中的docker-demo.jar文件到docker-demo这个目录</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210801101314816.png" alt="image-20210801101314816"></p>
</li>
<li><p>步骤3：拷贝课前资料中的jdk8.tar.gz文件到docker-demo这个目录</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210801101410200.png" alt="image-20210801101410200"></p>
</li>
<li><p>步骤4：拷贝课前资料提供的Dockerfile到docker-demo这个目录</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210801101455590.png" alt="image-20210801101455590"></p>
<p>其中的内容如下：</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 指定基础镜像</span></span><br><span class="line"><span class="keyword">FROM</span> ubuntu:<span class="number">16.04</span></span><br><span class="line"><span class="comment"># 配置环境变量，JDK的安装目录</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_DIR=/usr/local</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝jdk和java项目的包</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> ./jdk8.tar.gz <span class="variable">$JAVA_DIR</span>/</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> ./docker-demo.jar /tmp/app.jar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装JDK</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">cd</span> <span class="variable">$JAVA_DIR</span> \</span></span><br><span class="line"><span class="bash"> &amp;&amp; tar -xf ./jdk8.tar.gz \</span></span><br><span class="line"><span class="bash"> &amp;&amp; mv ./jdk1.8.0_144 ./java8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置环境变量</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_HOME=$JAVA_DIR/java8</span><br><span class="line"><span class="keyword">ENV</span> PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 暴露端口</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8090</span></span><br><span class="line"><span class="comment"># 入口，java项目的启动命令</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> java -jar /tmp/app.jar</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>步骤5：进入docker-demo</p>
<p>将准备好的docker-demo上传到虚拟机任意目录，然后进入docker-demo目录下</p>
</li>
<li><p>步骤6：运行命令：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker build -t javaweb:1.0 .</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>最后访问 <a href="http://192.168.150.101:8090/hello/count，其中的ip改成你的虚拟机ip">http://192.168.150.101:8090/hello/count，其中的ip改成你的虚拟机ip</a></p>
<h3 id="3-3-2-基于java8构建Java项目"><a href="#3-3-2-基于java8构建Java项目" class="headerlink" title="3.3.2.基于java8构建Java项目"></a>3.3.2.基于java8构建Java项目</h3><p>虽然我们可以基于Ubuntu基础镜像，添加任意自己需要的安装包，构建镜像，但是却比较麻烦。所以大多数情况下，我们都可以在一些安装了部分软件的基础镜像上做改造。</p>
<p>例如，构建java项目的镜像，可以在已经准备了JDK的基础镜像基础上构建。</p>
<p>需求：基于java:8-alpine镜像，将一个Java项目构建为镜像</p>
<p>实现思路如下：</p>
<ul>
<li><p>① 新建一个空的目录，然后在目录中新建一个文件，命名为Dockerfile</p>
</li>
<li><p>② 拷贝课前资料提供的docker-demo.jar到这个目录中</p>
</li>
<li><p>③ 编写Dockerfile文件：</p>
<ul>
<li><p>a ）基于java:8-alpine作为基础镜像</p>
</li>
<li><p>b ）将app.jar拷贝到镜像中</p>
</li>
<li><p>c ）暴露端口</p>
</li>
<li><p>d ）编写入口ENTRYPOINT</p>
<p>内容如下：</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> java:<span class="number">8</span>-alpine</span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> ./app.jar /tmp/app.jar</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8090</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> java -jar /tmp/app.jar</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>④ 使用docker build命令构建镜像</p>
</li>
<li><p>⑤ 使用docker run创建容器并运行</p>
</li>
</ul>
<h2 id="3-4-小结"><a href="#3-4-小结" class="headerlink" title="3.4.小结"></a>3.4.小结</h2><p>小结：</p>
<ol>
<li><p>Dockerfile的本质是一个文件，通过指令描述镜像的构建过程</p>
</li>
<li><p>Dockerfile的第一行必须是FROM，从一个基础镜像来构建</p>
</li>
<li><p>基础镜像可以是基本操作系统，如Ubuntu。也可以是其他人制作好的镜像，例如：java:8-alpine</p>
</li>
</ol>
<h1 id="4-Docker-Compose"><a href="#4-Docker-Compose" class="headerlink" title="4.Docker-Compose"></a>4.Docker-Compose</h1><p>Docker Compose可以基于Compose文件帮我们快速的部署分布式应用，而无需手动一个个创建和运行容器！</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731180921742.png" alt="image-20210731180921742"></p>
<h2 id="4-1-初识DockerCompose"><a href="#4-1-初识DockerCompose" class="headerlink" title="4.1.初识DockerCompose"></a>4.1.初识DockerCompose</h2><p>Compose文件是一个文本文件，通过指令定义集群中的每个容器如何运行。格式如下：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">version: <span class="string">&quot;3.8&quot;</span></span><br><span class="line"> services:</span><br><span class="line">  mysql:</span><br><span class="line">    image: mysql:<span class="number">5.7</span><span class="number">.25</span></span><br><span class="line">    environment:</span><br><span class="line">     MYSQL_ROOT_PASSWORD: <span class="number">123</span> </span><br><span class="line">    volumes:</span><br><span class="line">     - <span class="string">&quot;/tmp/mysql/data:/var/lib/mysql&quot;</span></span><br><span class="line">     - <span class="string">&quot;/tmp/mysql/conf/hmy.cnf:/etc/mysql/conf.d/hmy.cnf&quot;</span></span><br><span class="line">  web:</span><br><span class="line">    build: .</span><br><span class="line">    ports:</span><br><span class="line">     - <span class="string">&quot;8090:8090&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>上面的Compose文件就描述一个项目，其中包含两个容器：</p>
<ul>
<li>mysql：一个基于<code>mysql:5.7.25</code>镜像构建的容器，并且挂载了两个目录</li>
<li>web：一个基于<code>docker build</code>临时构建的镜像容器，映射端口时8090</li>
</ul>
<p>DockerCompose的详细语法参考官网：<a href="https://docs.docker.com/compose/compose-file/">https://docs.docker.com/compose/compose-file/</a></p>
<p>其实DockerCompose文件可以看做是将多个docker run命令写到一个文件，只是语法稍有差异。</p>
<h2 id="4-2-安装DockerCompose"><a href="#4-2-安装DockerCompose" class="headerlink" title="4.2.安装DockerCompose"></a>4.2.安装DockerCompose</h2><p>参考课前资料</p>
<h2 id="4-3-部署微服务集群"><a href="#4-3-部署微服务集群" class="headerlink" title="4.3.部署微服务集群"></a>4.3.部署微服务集群</h2><p><strong>需求</strong>：将之前学习的cloud-demo微服务集群利用DockerCompose部署</p>
<p><strong>实现思路</strong>：</p>
<p>① 查看课前资料提供的cloud-demo文件夹，里面已经编写好了docker-compose文件</p>
<p>② 修改自己的cloud-demo项目，将数据库、nacos地址都命名为docker-compose中的服务名</p>
<p>③ 使用maven打包工具，将项目中的每个微服务都打包为app.jar</p>
<p>④ 将打包好的app.jar拷贝到cloud-demo中的每一个对应的子目录中</p>
<p>⑤ 将cloud-demo上传至虚拟机，利用 docker-compose up -d 来部署</p>
<h3 id="4-3-1-compose文件"><a href="#4-3-1-compose文件" class="headerlink" title="4.3.1.compose文件"></a>4.3.1.compose文件</h3><p>查看课前资料提供的cloud-demo文件夹，里面已经编写好了docker-compose文件，而且每个微服务都准备了一个独立的目录：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210731181341330.png" alt="image-20210731181341330"></p>
<p>内容如下：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">nacos:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nacos/nacos-server</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MODE:</span> <span class="string">standalone</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8848:8848&quot;</span></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:5.7.25</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="number">123</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;$PWD/mysql/data:/var/lib/mysql&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;$PWD/mysql/conf:/etc/mysql/conf.d/&quot;</span></span><br><span class="line">  <span class="attr">userservice:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">./user-service</span></span><br><span class="line">  <span class="attr">orderservice:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">./order-service</span></span><br><span class="line">  <span class="attr">gateway:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">./gateway</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;10010:10010&quot;</span></span><br></pre></td></tr></table></figure>
<p>可以看到，其中包含5个service服务：</p>
<ul>
<li><code>nacos</code>：作为注册中心和配置中心<ul>
<li><code>image: nacos/nacos-server</code>： 基于nacos/nacos-server镜像构建</li>
<li><code>environment</code>：环境变量<ul>
<li><code>MODE: standalone</code>：单点模式启动</li>
</ul>
</li>
<li><code>ports</code>：端口映射，这里暴露了8848端口</li>
</ul>
</li>
<li><code>mysql</code>：数据库<ul>
<li><code>image: mysql:5.7.25</code>：镜像版本是mysql:5.7.25</li>
<li><code>environment</code>：环境变量<ul>
<li><code>MYSQL_ROOT_PASSWORD: 123</code>：设置数据库root账户的密码为123</li>
</ul>
</li>
<li><code>volumes</code>：数据卷挂载，这里挂载了mysql的data、conf目录，其中有我提前准备好的数据</li>
</ul>
</li>
<li><code>userservice</code>、<code>orderservice</code>、<code>gateway</code>：都是基于Dockerfile临时构建的</li>
</ul>
<p>查看mysql目录，可以看到其中已经准备好了cloud_order、cloud_user表：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210801095205034.png" alt="image-20210801095205034"></p>
<p>查看微服务目录，可以看到都包含Dockerfile文件：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210801095320586.png" alt="image-20210801095320586"></p>
<p>内容如下：</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> java:<span class="number">8</span>-alpine</span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> ./app.jar /tmp/app.jar</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> java -jar /tmp/app.jar</span></span><br></pre></td></tr></table></figure>
<h3 id="4-3-2-修改微服务配置"><a href="#4-3-2-修改微服务配置" class="headerlink" title="4.3.2.修改微服务配置"></a>4.3.2.修改微服务配置</h3><p>因为微服务将来要部署为docker容器，而容器之间互联不是通过IP地址，而是通过容器名。这里我们将order-service、user-service、gateway服务的mysql、nacos地址都修改为基于容器名的访问。</p>
<p>如下所示：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://mysql:3306/cloud_order?useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">orderservice</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">nacos:8848</span> <span class="comment"># nacos服务地址</span></span><br></pre></td></tr></table></figure>
<h3 id="4-3-3-打包"><a href="#4-3-3-打包" class="headerlink" title="4.3.3.打包"></a>4.3.3.打包</h3><p>接下来需要将我们的每个微服务都打包。因为之前查看到Dockerfile中的jar包名称都是app.jar，因此我们的每个微服务都需要用这个名称。</p>
<p>可以通过修改pom.xml中的打包名称来实现，每个微服务都需要修改：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 服务打包的最终名称 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>app<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>打包后：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210801095951030.png" alt="image-20210801095951030"></p>
<h3 id="4-3-4-拷贝jar包到部署目录"><a href="#4-3-4-拷贝jar包到部署目录" class="headerlink" title="4.3.4.拷贝jar包到部署目录"></a>4.3.4.拷贝jar包到部署目录</h3><p>编译打包好的app.jar文件，需要放到Dockerfile的同级目录中。注意：每个微服务的app.jar放到与服务名称对应的目录，别搞错了。</p>
<p>user-service：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210801100201253.png" alt="image-20210801100201253"></p>
<p>order-service：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210801100231495.png" alt="image-20210801100231495"></p>
<p>gateway：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210801100308102.png" alt="image-20210801100308102"></p>
<h3 id="4-3-5-部署"><a href="#4-3-5-部署" class="headerlink" title="4.3.5.部署"></a>4.3.5.部署</h3><p>最后，我们需要将文件整个cloud-demo文件夹上传到虚拟机中，理由DockerCompose部署。</p>
<p>上传到任意目录：</p>
<p><img src="/2022/07/26/Docker%E5%AE%9E%E7%94%A8%E7%AF%87/image-20210801100955653.png" alt="image-20210801100955653"></p>
<p>部署：</p>
<p>进入cloud-demo目录，然后运行下面的命令：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>
<h1 id="5-Docker镜像仓库"><a href="#5-Docker镜像仓库" class="headerlink" title="5.Docker镜像仓库"></a>5.Docker镜像仓库</h1><h2 id="5-1-搭建私有镜像仓库"><a href="#5-1-搭建私有镜像仓库" class="headerlink" title="5.1.搭建私有镜像仓库"></a>5.1.搭建私有镜像仓库</h2><p>参考课前资料《CentOS7安装Docker.md》</p>
<h2 id="5-2-推送、拉取镜像"><a href="#5-2-推送、拉取镜像" class="headerlink" title="5.2.推送、拉取镜像"></a>5.2.推送、拉取镜像</h2><p>推送镜像到私有镜像服务必须先tag，步骤如下：</p>
<p>① 重新tag本地镜像，名称前缀为私有仓库的地址：192.168.150.101:8080/</p>
 <figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker tag nginx:latest 192.168.150.101:8080/nginx:1.0 </span><br></pre></td></tr></table></figure>
<p>② 推送镜像</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker push 192.168.150.101:8080/nginx:1.0 </span><br></pre></td></tr></table></figure>
<p>③ 拉取镜像</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker pull 192.168.150.101:8080/nginx:1.0 </span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>RabbitMQ部署指南</title>
    <url>/2022/07/26/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/</url>
    <content><![CDATA[<h1 id="RabbitMQ部署指南"><a href="#RabbitMQ部署指南" class="headerlink" title="RabbitMQ部署指南"></a>RabbitMQ部署指南</h1><h1 id="1-单机部署"><a href="#1-单机部署" class="headerlink" title="1.单机部署"></a>1.单机部署</h1><p>我们在Centos7虚拟机中使用Docker来安装。</p>
<h2 id="1-1-下载镜像"><a href="#1-1-下载镜像" class="headerlink" title="1.1.下载镜像"></a>1.1.下载镜像</h2><p>方式一：在线拉取</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker pull rabbitmq:3-management</span><br></pre></td></tr></table></figure>
<p>方式二：从本地加载</p>
<p>在课前资料已经提供了镜像包：</p>
<p><img src="/2022/07/26/RabbitMQ%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/image-20210423191210349.png" alt="image-20210423191210349"> </p>
<p>上传到虚拟机中后，使用命令加载镜像即可：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker load -i mq.tar</span><br></pre></td></tr></table></figure>
<h2 id="1-2-安装MQ"><a href="#1-2-安装MQ" class="headerlink" title="1.2.安装MQ"></a>1.2.安装MQ</h2><p>执行下面的命令来运行MQ容器：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run \</span><br><span class="line"> -e RABBITMQ_DEFAULT_USER=itcast \</span><br><span class="line"> -e RABBITMQ_DEFAULT_PASS=123321 \</span><br><span class="line"> --name mq \</span><br><span class="line"> --hostname mq1 \</span><br><span class="line"> -p 15672:15672 \</span><br><span class="line"> -p 5672:5672 \</span><br><span class="line"> -d \</span><br><span class="line"> rabbitmq:3-management</span><br></pre></td></tr></table></figure>
<h1 id="2-集群部署"><a href="#2-集群部署" class="headerlink" title="2.集群部署"></a>2.集群部署</h1><p>接下来，我们看看如何安装RabbitMQ的集群。</p>
<h2 id="2-1-集群分类"><a href="#2-1-集群分类" class="headerlink" title="2.1.集群分类"></a>2.1.集群分类</h2><p>在RabbitMQ的官方文档中，讲述了两种集群的配置方式：</p>
<ul>
<li>普通模式：普通模式集群不进行数据同步，每个MQ都有自己的队列、数据信息（其它元数据信息如交换机等会同步）。例如我们有2个MQ：mq1，和mq2，如果你的消息在mq1，而你连接到了mq2，那么mq2会去mq1拉取消息，然后返回给你。如果mq1宕机，消息就会丢失。</li>
<li>镜像模式：与普通模式不同，队列会在各个mq的镜像节点之间同步，因此你连接到任何一个镜像节点，均可获取到消息。而且如果一个节点宕机，并不会导致数据丢失。不过，这种方式增加了数据同步的带宽消耗。</li>
</ul>
<p>我们先来看普通模式集群。</p>
<h2 id="2-2-设置网络"><a href="#2-2-设置网络" class="headerlink" title="2.2.设置网络"></a>2.2.设置网络</h2><p>首先，我们需要让3台MQ互相知道对方的存在。</p>
<p>分别在3台机器中，设置 /etc/hosts文件，添加如下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">192.168.150.101 mq1</span><br><span class="line">192.168.150.102 mq2</span><br><span class="line">192.168.150.103 mq3</span><br></pre></td></tr></table></figure>
<p>并在每台机器上测试，是否可以ping通对方：</p>
]]></content>
      <categories>
        <category>SpringCloud</category>
      </categories>
      <tags>
        <tag>SpringCloud</tag>
      </tags>
  </entry>
  <entry>
    <title>RabbitMQ</title>
    <url>/2022/07/26/RabbitMQ/</url>
    <content><![CDATA[<h1 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h1><h1 id="1-初识MQ"><a href="#1-初识MQ" class="headerlink" title="1.初识MQ"></a>1.初识MQ</h1><h2 id="1-1-同步和异步通讯"><a href="#1-1-同步和异步通讯" class="headerlink" title="1.1.同步和异步通讯"></a>1.1.同步和异步通讯</h2><p>微服务间通讯有同步和异步两种方式：</p>
<p>同步通讯：就像打电话，需要实时响应。</p>
<p>异步通讯：就像发邮件，不需要马上回复。</p>
<p><img src="/2022/07/26/RabbitMQ/image-20210717161939695.png" alt="image-20210717161939695"></p>
<p>两种方式各有优劣，打电话可以立即得到响应，但是你却不能跟多个人同时通话。发送邮件可以同时与多个人收发邮件，但是往往响应会有延迟。</p>
<h3 id="1-1-1-同步通讯"><a href="#1-1-1-同步通讯" class="headerlink" title="1.1.1.同步通讯"></a>1.1.1.同步通讯</h3><p>我们之前学习的Feign调用就属于同步方式，虽然调用可以实时得到结果，但存在下面的问题：</p>
<p><img src="/2022/07/26/RabbitMQ/image-20210717162004285.png" alt="image-20210717162004285"></p>
<p>总结：</p>
<p>同步调用的优点：</p>
<ul>
<li>时效性较强，可以立即得到结果</li>
</ul>
<p>同步调用的问题：</p>
<ul>
<li>耦合度高</li>
<li>性能和吞吐能力下降</li>
<li>有额外的资源消耗</li>
<li>有级联失败问题</li>
</ul>
<h3 id="1-1-2-异步通讯"><a href="#1-1-2-异步通讯" class="headerlink" title="1.1.2.异步通讯"></a>1.1.2.异步通讯</h3><p>异步调用则可以避免上述问题：</p>
<p>我们以购买商品为例，用户支付后需要调用订单服务完成订单状态修改，调用物流服务，从仓库分配响应的库存并准备发货。</p>
<p>在事件模式中，支付服务是事件发布者（publisher），在支付完成后只需要发布一个支付成功的事件（event），事件中带上订单id。</p>
<p>订单服务和物流服务是事件订阅者（Consumer），订阅支付成功的事件，监听到事件后完成自己业务即可。</p>
<p>为了解除事件发布者与订阅者之间的耦合，两者并不是直接通信，而是有一个中间人（Broker）。发布者发布事件到Broker，不关心谁来订阅事件。订阅者从Broker订阅事件，不关心谁发来的消息。</p>
<p><img src="/2022/07/26/RabbitMQ/image-20210422095356088.png" alt="image-20210422095356088"></p>
<p>Broker 是一个像数据总线一样的东西，所有的服务要接收数据和发送数据都发到这个总线上，这个总线就像协议一样，让服务间的通讯变得标准和可控。</p>
<p>好处：</p>
<ul>
<li><p>吞吐量提升：无需等待订阅者处理完成，响应更快速</p>
</li>
<li><p>故障隔离：服务没有直接调用，不存在级联失败问题</p>
</li>
<li>调用间没有阻塞，不会造成无效的资源占用</li>
<li>耦合度极低，每个服务都可以灵活插拔，可替换</li>
<li>流量削峰：不管发布事件的流量波动多大，都由Broker接收，订阅者可以按照自己的速度去处理事件</li>
</ul>
<p>缺点：</p>
<ul>
<li>架构复杂了，业务没有明显的流程线，不好管理</li>
<li>需要依赖于Broker的可靠、安全、性能</li>
</ul>
<p>好在现在开源软件或云平台上 Broker 的软件是非常成熟的，比较常见的一种就是我们今天要学习的MQ技术。</p>
<h2 id="1-2-技术对比："><a href="#1-2-技术对比：" class="headerlink" title="1.2.技术对比："></a>1.2.技术对比：</h2><p>MQ，中文是消息队列（MessageQueue），字面来看就是存放消息的队列。也就是事件驱动架构中的Broker。</p>
<p>比较常见的MQ实现：</p>
<ul>
<li>ActiveMQ</li>
<li>RabbitMQ</li>
<li>RocketMQ</li>
<li>Kafka</li>
</ul>
<p>几种常见MQ的对比：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th><strong>RabbitMQ</strong></th>
<th><strong>ActiveMQ</strong></th>
<th><strong>RocketMQ</strong></th>
<th><strong>Kafka</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>公司/社区</td>
<td>Rabbit</td>
<td>Apache</td>
<td>阿里</td>
<td>Apache</td>
</tr>
<tr>
<td>开发语言</td>
<td>Erlang</td>
<td>Java</td>
<td>Java</td>
<td>Scala&amp;Java</td>
</tr>
<tr>
<td>协议支持</td>
<td>AMQP，XMPP，SMTP，STOMP</td>
<td>OpenWire,STOMP，REST,XMPP,AMQP</td>
<td>自定义协议</td>
<td>自定义协议</td>
</tr>
<tr>
<td>可用性</td>
<td>高</td>
<td>一般</td>
<td>高</td>
<td>高</td>
</tr>
<tr>
<td>单机吞吐量</td>
<td>一般</td>
<td>差</td>
<td>高</td>
<td>非常高</td>
</tr>
<tr>
<td>消息延迟</td>
<td>微秒级</td>
<td>毫秒级</td>
<td>毫秒级</td>
<td>毫秒以内</td>
</tr>
<tr>
<td>消息可靠性</td>
<td>高</td>
<td>一般</td>
<td>高</td>
<td>一般</td>
</tr>
</tbody>
</table>
</div>
<p>追求可用性：Kafka、 RocketMQ 、RabbitMQ</p>
<p>追求可靠性：RabbitMQ、RocketMQ</p>
<p>追求吞吐能力：RocketMQ、Kafka</p>
<p>追求消息低延迟：RabbitMQ、Kafka</p>
<h1 id="2-快速入门"><a href="#2-快速入门" class="headerlink" title="2.快速入门"></a>2.快速入门</h1><h2 id="2-1-安装RabbitMQ"><a href="#2-1-安装RabbitMQ" class="headerlink" title="2.1.安装RabbitMQ"></a>2.1.安装RabbitMQ</h2><p>安装RabbitMQ，参考课前资料：</p>
<p><img src="/2022/07/26/RabbitMQ/image-20210717162628635.png" alt="image-20210717162628635"></p>
<p>MQ的基本结构：</p>
<p><img src="/2022/07/26/RabbitMQ/image-20210717162752376.png" alt="image-20210717162752376"></p>
<p>RabbitMQ中的一些角色：</p>
<ul>
<li>publisher：生产者</li>
<li>consumer：消费者</li>
<li>exchange个：交换机，负责消息路由</li>
<li>queue：队列，存储消息</li>
<li>virtualHost：虚拟主机，隔离不同租户的exchange、queue、消息的隔离</li>
</ul>
<h2 id="2-2-RabbitMQ消息模型"><a href="#2-2-RabbitMQ消息模型" class="headerlink" title="2.2.RabbitMQ消息模型"></a>2.2.RabbitMQ消息模型</h2><p>RabbitMQ官方提供了5个不同的Demo示例，对应了不同的消息模型：</p>
<p><img src="/2022/07/26/RabbitMQ/image-20210717163332646.png" alt="image-20210717163332646"></p>
<h2 id="2-3-导入Demo工程"><a href="#2-3-导入Demo工程" class="headerlink" title="2.3.导入Demo工程"></a>2.3.导入Demo工程</h2><p>课前资料提供了一个Demo工程，mq-demo:</p>
<p><img src="/2022/07/26/RabbitMQ/image-20210717163253264.png" alt="image-20210717163253264"></p>
<p>导入后可以看到结构如下：</p>
<p><img src="/2022/07/26/RabbitMQ/image-20210717163604330.png" alt="image-20210717163604330"></p>
<p>包括三部分：</p>
<ul>
<li>mq-demo：父工程，管理项目依赖</li>
<li>publisher：消息的发送者</li>
<li>consumer：消息的消费者</li>
</ul>
<h2 id="2-4-入门案例"><a href="#2-4-入门案例" class="headerlink" title="2.4.入门案例"></a>2.4.入门案例</h2><p>简单队列模式的模型图：</p>
<p> <img src="/2022/07/26/RabbitMQ/image-20210717163434647.png" alt="image-20210717163434647"></p>
<p>官方的HelloWorld是基于最基础的消息队列模型来实现的，只包括三个角色：</p>
<ul>
<li>publisher：消息发布者，将消息发送到队列queue</li>
<li>queue：消息队列，负责接受并缓存消息</li>
<li>consumer：订阅队列，处理队列中的消息</li>
</ul>
<h3 id="2-4-1-publisher实现"><a href="#2-4-1-publisher实现" class="headerlink" title="2.4.1.publisher实现"></a>2.4.1.publisher实现</h3><p>思路：</p>
<ul>
<li>建立连接</li>
<li>创建Channel</li>
<li>声明队列</li>
<li>发送消息</li>
<li>关闭连接和channel</li>
</ul>
<p>代码实现：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.mq.helloworld;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PublisherTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSendMessage</span><span class="params">()</span> <span class="keyword">throws</span> IOException, TimeoutException </span>&#123;</span><br><span class="line">        <span class="comment">// 1.建立连接</span></span><br><span class="line">        ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">        <span class="comment">// 1.1.设置连接参数，分别是：主机名、端口号、vhost、用户名、密码</span></span><br><span class="line">        factory.setHost(<span class="string">&quot;192.168.150.101&quot;</span>);</span><br><span class="line">        factory.setPort(<span class="number">5672</span>);</span><br><span class="line">        factory.setVirtualHost(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        factory.setUsername(<span class="string">&quot;itcast&quot;</span>);</span><br><span class="line">        factory.setPassword(<span class="string">&quot;123321&quot;</span>);</span><br><span class="line">        <span class="comment">// 1.2.建立连接</span></span><br><span class="line">        Connection connection = factory.newConnection();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.创建通道Channel</span></span><br><span class="line">        Channel channel = connection.createChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.创建队列</span></span><br><span class="line">        String queueName = <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line">        channel.queueDeclare(queueName, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.发送消息</span></span><br><span class="line">        String message = <span class="string">&quot;hello, rabbitmq!&quot;</span>;</span><br><span class="line">        channel.basicPublish(<span class="string">&quot;&quot;</span>, queueName, <span class="keyword">null</span>, message.getBytes());</span><br><span class="line">        System.out.println(<span class="string">&quot;发送消息成功：【&quot;</span> + message + <span class="string">&quot;】&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.关闭通道和连接</span></span><br><span class="line">        channel.close();</span><br><span class="line">        connection.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-4-2-consumer实现"><a href="#2-4-2-consumer实现" class="headerlink" title="2.4.2.consumer实现"></a>2.4.2.consumer实现</h3><p>代码思路：</p>
<ul>
<li>建立连接</li>
<li>创建Channel</li>
<li>声明队列</li>
<li>订阅消息</li>
</ul>
<p>代码实现：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.mq.helloworld;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException </span>&#123;</span><br><span class="line">        <span class="comment">// 1.建立连接</span></span><br><span class="line">        ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">        <span class="comment">// 1.1.设置连接参数，分别是：主机名、端口号、vhost、用户名、密码</span></span><br><span class="line">        factory.setHost(<span class="string">&quot;192.168.150.101&quot;</span>);</span><br><span class="line">        factory.setPort(<span class="number">5672</span>);</span><br><span class="line">        factory.setVirtualHost(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        factory.setUsername(<span class="string">&quot;itcast&quot;</span>);</span><br><span class="line">        factory.setPassword(<span class="string">&quot;123321&quot;</span>);</span><br><span class="line">        <span class="comment">// 1.2.建立连接</span></span><br><span class="line">        Connection connection = factory.newConnection();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.创建通道Channel</span></span><br><span class="line">        Channel channel = connection.createChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.创建队列</span></span><br><span class="line">        String queueName = <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line">        channel.queueDeclare(queueName, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.订阅消息</span></span><br><span class="line">        channel.basicConsume(queueName, <span class="keyword">true</span>, <span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope,</span></span></span><br><span class="line"><span class="params"><span class="function">                                       AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                <span class="comment">// 5.处理消息</span></span><br><span class="line">                String message = <span class="keyword">new</span> String(body);</span><br><span class="line">                System.out.println(<span class="string">&quot;接收到消息：【&quot;</span> + message + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        System.out.println(<span class="string">&quot;等待接收消息。。。。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-5-总结"><a href="#2-5-总结" class="headerlink" title="2.5.总结"></a>2.5.总结</h2><p>基本消息队列的消息发送流程：</p>
<ol>
<li><p>建立connection</p>
</li>
<li><p>创建channel</p>
</li>
<li><p>利用channel声明队列</p>
</li>
<li><p>利用channel向队列发送消息</p>
</li>
</ol>
<p>基本消息队列的消息接收流程：</p>
<ol>
<li><p>建立connection</p>
</li>
<li><p>创建channel</p>
</li>
<li><p>利用channel声明队列</p>
</li>
<li><p>定义consumer的消费行为handleDelivery()</p>
</li>
<li><p>利用channel将消费者与队列绑定</p>
</li>
</ol>
<h1 id="3-SpringAMQP"><a href="#3-SpringAMQP" class="headerlink" title="3.SpringAMQP"></a>3.SpringAMQP</h1><p>SpringAMQP是基于RabbitMQ封装的一套模板，并且还利用SpringBoot对其实现了自动装配，使用起来非常方便。</p>
<p>SpringAmqp的官方地址：<a href="https://spring.io/projects/spring-amqp">https://spring.io/projects/spring-amqp</a></p>
<p><img src="/2022/07/26/RabbitMQ/image-20210717164024967.png" alt="image-20210717164024967"></p>
<p><img src="/2022/07/26/RabbitMQ/image-20210717164038678.png" alt="image-20210717164038678"></p>
<p>SpringAMQP提供了三个功能：</p>
<ul>
<li>自动声明队列、交换机及其绑定关系</li>
<li>基于注解的监听器模式，异步接收消息</li>
<li>封装了RabbitTemplate工具，用于发送消息 </li>
</ul>
<h2 id="3-1-Basic-Queue-简单队列模型"><a href="#3-1-Basic-Queue-简单队列模型" class="headerlink" title="3.1.Basic Queue 简单队列模型"></a>3.1.Basic Queue 简单队列模型</h2><p>在父工程mq-demo中引入依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--AMQP依赖，包含RabbitMQ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-1-1-消息发送"><a href="#3-1-1-消息发送" class="headerlink" title="3.1.1.消息发送"></a>3.1.1.消息发送</h3><p>首先配置MQ地址，在publisher服务的application.yml中添加配置：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span> <span class="comment"># 主机名</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span> <span class="comment"># 端口</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/</span> <span class="comment"># 虚拟主机</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">itcast</span> <span class="comment"># 用户名</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123321</span> <span class="comment"># 密码</span></span><br></pre></td></tr></table></figure>
<p>然后在publisher服务中编写测试类SpringAmqpTest，并利用RabbitTemplate实现消息发送：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.mq.spring;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringAmqpTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSimpleQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 队列名称</span></span><br><span class="line">        String queueName = <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line">        <span class="comment">// 消息</span></span><br><span class="line">        String message = <span class="string">&quot;hello, spring amqp!&quot;</span>;</span><br><span class="line">        <span class="comment">// 发送消息</span></span><br><span class="line">        rabbitTemplate.convertAndSend(queueName, message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-1-2-消息接收"><a href="#3-1-2-消息接收" class="headerlink" title="3.1.2.消息接收"></a>3.1.2.消息接收</h3><p>首先配置MQ地址，在consumer服务的application.yml中添加配置：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span> <span class="comment"># 主机名</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span> <span class="comment"># 端口</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/</span> <span class="comment"># 虚拟主机</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">itcast</span> <span class="comment"># 用户名</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123321</span> <span class="comment"># 密码</span></span><br></pre></td></tr></table></figure>
<p>然后在consumer服务的<code>cn.itcast.mq.listener</code>包中新建一个类SpringRabbitListener，代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.mq.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringRabbitListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenSimpleQueueMessage</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;spring 消费者接收到消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-1-3-测试"><a href="#3-1-3-测试" class="headerlink" title="3.1.3.测试"></a>3.1.3.测试</h3><p>启动consumer服务，然后在publisher服务中运行测试代码，发送MQ消息</p>
<h2 id="3-2-WorkQueue"><a href="#3-2-WorkQueue" class="headerlink" title="3.2.WorkQueue"></a>3.2.WorkQueue</h2><p>Work queues，也被称为（Task queues），任务模型。简单来说就是<strong>让多个消费者绑定到一个队列，共同消费队列中的消息</strong>。</p>
<p><img src="/2022/07/26/RabbitMQ/image-20210717164238910.png" alt="image-20210717164238910"></p>
<p>当消息处理比较耗时的时候，可能生产消息的速度会远远大于消息的消费速度。长此以往，消息就会堆积越来越多，无法及时处理。</p>
<p>此时就可以使用work 模型，多个消费者共同处理消息处理，速度就能大大提高了。</p>
<h3 id="3-2-1-消息发送"><a href="#3-2-1-消息发送" class="headerlink" title="3.2.1.消息发送"></a>3.2.1.消息发送</h3><p>这次我们循环发送，模拟大量消息堆积现象。</p>
<p>在publisher服务中的SpringAmqpTest类中添加一个测试方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * workQueue</span></span><br><span class="line"><span class="comment">     * 向队列中不停发送消息，模拟消息堆积。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testWorkQueue</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="comment">// 队列名称</span></span><br><span class="line">    String queueName = <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line">    <span class="comment">// 消息</span></span><br><span class="line">    String message = <span class="string">&quot;hello, message_&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">        <span class="comment">// 发送消息</span></span><br><span class="line">        rabbitTemplate.convertAndSend(queueName, message + i);</span><br><span class="line">        Thread.sleep(<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-2-2-消息接收"><a href="#3-2-2-消息接收" class="headerlink" title="3.2.2.消息接收"></a>3.2.2.消息接收</h3><p>要模拟多个消费者绑定同一个队列，我们在consumer服务的SpringRabbitListener中添加2个新的方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenWorkQueue1</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者1接收到消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span> + LocalTime.now());</span><br><span class="line">    Thread.sleep(<span class="number">20</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenWorkQueue2</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    System.err.println(<span class="string">&quot;消费者2........接收到消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span> + LocalTime.now());</span><br><span class="line">    Thread.sleep(<span class="number">200</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意到这个消费者sleep了1000秒，模拟任务耗时。</p>
<h3 id="3-2-3-测试"><a href="#3-2-3-测试" class="headerlink" title="3.2.3.测试"></a>3.2.3.测试</h3><p>启动ConsumerApplication后，在执行publisher服务中刚刚编写的发送测试方法testWorkQueue。</p>
<p>可以看到消费者1很快完成了自己的25条消息。消费者2却在缓慢的处理自己的25条消息。</p>
<p>也就是说消息是平均分配给每个消费者，并没有考虑到消费者的处理能力。这样显然是有问题的。</p>
<h3 id="3-2-4-能者多劳"><a href="#3-2-4-能者多劳" class="headerlink" title="3.2.4.能者多劳"></a>3.2.4.能者多劳</h3><p>在spring中有一个简单的配置，可以解决这个问题。我们修改consumer服务的application.yml文件，添加配置：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">prefetch:</span> <span class="number">1</span> <span class="comment"># 每次只能获取一条消息，处理完成才能获取下一个消息</span></span><br></pre></td></tr></table></figure>
<h3 id="3-2-5-总结"><a href="#3-2-5-总结" class="headerlink" title="3.2.5.总结"></a>3.2.5.总结</h3><p>Work模型的使用：</p>
<ul>
<li>多个消费者绑定到一个队列，同一条消息只会被一个消费者处理</li>
<li>通过设置prefetch来控制消费者预取的消息数量</li>
</ul>
<h2 id="3-3-发布-订阅"><a href="#3-3-发布-订阅" class="headerlink" title="3.3.发布/订阅"></a>3.3.发布/订阅</h2><p>发布订阅的模型如图：</p>
<p><img src="/2022/07/26/RabbitMQ/image-20210717165309625.png" alt="image-20210717165309625"></p>
<p>可以看到，在订阅模型中，多了一个exchange角色，而且过程略有变化：</p>
<ul>
<li>Publisher：生产者，也就是要发送消息的程序，但是不再发送到队列中，而是发给X（交换机）</li>
<li>Exchange：交换机，图中的X。一方面，接收生产者发送的消息。另一方面，知道如何处理消息，例如递交给某个特别队列、递交给所有队列、或是将消息丢弃。到底如何操作，取决于Exchange的类型。Exchange有以下3种类型：<ul>
<li>Fanout：广播，将消息交给所有绑定到交换机的队列</li>
<li>Direct：定向，把消息交给符合指定routing key 的队列</li>
<li>Topic：通配符，把消息交给符合routing pattern（路由模式） 的队列</li>
</ul>
</li>
<li>Consumer：消费者，与以前一样，订阅队列，没有变化</li>
<li>Queue：消息队列也与以前一样，接收消息、缓存消息。</li>
</ul>
<p><strong>Exchange（交换机）只负责转发消息，不具备存储消息的能力</strong>，因此如果没有任何队列与Exchange绑定，或者没有符合路由规则的队列，那么消息会丢失！</p>
<h2 id="3-4-Fanout"><a href="#3-4-Fanout" class="headerlink" title="3.4.Fanout"></a>3.4.Fanout</h2><p>Fanout，英文翻译是扇出，我觉得在MQ中叫广播更合适。</p>
<p><img src="/2022/07/26/RabbitMQ/image-20210717165438225.png" alt="image-20210717165438225"></p>
<p>在广播模式下，消息发送流程是这样的：</p>
<ul>
<li>1）  可以有多个队列</li>
<li>2）  每个队列都要绑定到Exchange（交换机）</li>
<li>3）  生产者发送的消息，只能发送到交换机，交换机来决定要发给哪个队列，生产者无法决定</li>
<li>4）  交换机把消息发送给绑定过的所有队列</li>
<li>5）  订阅队列的消费者都能拿到消息</li>
</ul>
<p>我们的计划是这样的：</p>
<ul>
<li>创建一个交换机 itcast.fanout，类型是Fanout</li>
<li>创建两个队列fanout.queue1和fanout.queue2，绑定到交换机itcast.fanout</li>
</ul>
<p><img src="/2022/07/26/RabbitMQ/image-20210717165509466.png" alt="image-20210717165509466"></p>
<h3 id="3-4-1-声明队列和交换机"><a href="#3-4-1-声明队列和交换机" class="headerlink" title="3.4.1.声明队列和交换机"></a>3.4.1.声明队列和交换机</h3><p>Spring提供了一个接口Exchange，来表示所有不同类型的交换机：</p>
<p><img src="/2022/07/26/RabbitMQ/image-20210717165552676.png" alt="image-20210717165552676"></p>
<p>在consumer中创建一个类，声明队列和交换机：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.mq.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Binding;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.BindingBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.FanoutExchange;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Queue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FanoutConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 声明交换机</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Fanout类型交换机</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FanoutExchange <span class="title">fanoutExchange</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FanoutExchange(<span class="string">&quot;itcast.fanout&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 第1个队列</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">fanoutQueue1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;fanout.queue1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 绑定队列和交换机</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">bindingQueue1</span><span class="params">(Queue fanoutQueue1, FanoutExchange fanoutExchange)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(fanoutQueue1).to(fanoutExchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 第2个队列</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">fanoutQueue2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;fanout.queue2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 绑定队列和交换机</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">bindingQueue2</span><span class="params">(Queue fanoutQueue2, FanoutExchange fanoutExchange)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(fanoutQueue2).to(fanoutExchange);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-4-2-消息发送"><a href="#3-4-2-消息发送" class="headerlink" title="3.4.2.消息发送"></a>3.4.2.消息发送</h3><p>在publisher服务的SpringAmqpTest类中添加测试方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFanoutExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 队列名称</span></span><br><span class="line">    String exchangeName = <span class="string">&quot;itcast.fanout&quot;</span>;</span><br><span class="line">    <span class="comment">// 消息</span></span><br><span class="line">    String message = <span class="string">&quot;hello, everyone!&quot;</span>;</span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;&quot;</span>, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-4-3-消息接收"><a href="#3-4-3-消息接收" class="headerlink" title="3.4.3.消息接收"></a>3.4.3.消息接收</h3><p>在consumer服务的SpringRabbitListener中添加两个方法，作为消费者：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;fanout.queue1&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenFanoutQueue1</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者1接收到Fanout消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;fanout.queue2&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenFanoutQueue2</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者2接收到Fanout消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-4-4-总结"><a href="#3-4-4-总结" class="headerlink" title="3.4.4.总结"></a>3.4.4.总结</h3><p>交换机的作用是什么？</p>
<ul>
<li>接收publisher发送的消息</li>
<li>将消息按照规则路由到与之绑定的队列</li>
<li>不能缓存消息，路由失败，消息丢失</li>
<li>FanoutExchange的会将消息路由到每个绑定的队列</li>
</ul>
<p>声明队列、交换机、绑定关系的Bean是什么？</p>
<ul>
<li>Queue</li>
<li>FanoutExchange</li>
<li>Binding</li>
</ul>
<h2 id="3-5-Direct"><a href="#3-5-Direct" class="headerlink" title="3.5.Direct"></a>3.5.Direct</h2><p>在Fanout模式中，一条消息，会被所有订阅的队列都消费。但是，在某些场景下，我们希望不同的消息被不同的队列消费。这时就要用到Direct类型的Exchange。</p>
<p><img src="/2022/07/26/RabbitMQ/image-20210717170041447.png" alt="image-20210717170041447"></p>
<p> 在Direct模型下：</p>
<ul>
<li>队列与交换机的绑定，不能是任意绑定了，而是要指定一个<code>RoutingKey</code>（路由key）</li>
<li>消息的发送方在 向 Exchange发送消息时，也必须指定消息的 <code>RoutingKey</code>。</li>
<li>Exchange不再把消息交给每一个绑定的队列，而是根据消息的<code>Routing Key</code>进行判断，只有队列的<code>Routingkey</code>与消息的 <code>Routing key</code>完全一致，才会接收到消息</li>
</ul>
<p><strong>案例需求如下</strong>：</p>
<ol>
<li><p>利用@RabbitListener声明Exchange、Queue、RoutingKey</p>
</li>
<li><p>在consumer服务中，编写两个消费者方法，分别监听direct.queue1和direct.queue2</p>
</li>
<li><p>在publisher中编写测试方法，向itcast. direct发送消息</p>
</li>
</ol>
<p><img src="/2022/07/26/RabbitMQ/image-20210717170223317.png" alt="image-20210717170223317"></p>
<h3 id="3-5-1-基于注解声明队列和交换机"><a href="#3-5-1-基于注解声明队列和交换机" class="headerlink" title="3.5.1.基于注解声明队列和交换机"></a>3.5.1.基于注解声明队列和交换机</h3><p>基于@Bean的方式声明队列和交换机比较麻烦，Spring还提供了基于注解方式来声明。</p>
<p>在consumer的SpringRabbitListener中添加两个消费者，同时基于注解来声明队列和交换机：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = &quot;direct.queue1&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = &quot;itcast.direct&quot;, type = ExchangeTypes.DIRECT),</span></span><br><span class="line"><span class="meta">    key = &#123;&quot;red&quot;, &quot;blue&quot;&#125;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenDirectQueue1</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者接收到direct.queue1的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = &quot;direct.queue2&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = &quot;itcast.direct&quot;, type = ExchangeTypes.DIRECT),</span></span><br><span class="line"><span class="meta">    key = &#123;&quot;red&quot;, &quot;yellow&quot;&#125;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenDirectQueue2</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者接收到direct.queue2的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-5-2-消息发送"><a href="#3-5-2-消息发送" class="headerlink" title="3.5.2.消息发送"></a>3.5.2.消息发送</h3><p>在publisher服务的SpringAmqpTest类中添加测试方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSendDirectExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 交换机名称</span></span><br><span class="line">    String exchangeName = <span class="string">&quot;itcast.direct&quot;</span>;</span><br><span class="line">    <span class="comment">// 消息</span></span><br><span class="line">    String message = <span class="string">&quot;红色警报！日本乱排核废水，导致海洋生物变异，惊现哥斯拉！&quot;</span>;</span><br><span class="line">    <span class="comment">// 发送消息</span></span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;red&quot;</span>, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-5-3-总结"><a href="#3-5-3-总结" class="headerlink" title="3.5.3.总结"></a>3.5.3.总结</h3><p>描述下Direct交换机与Fanout交换机的差异？</p>
<ul>
<li>Fanout交换机将消息路由给每一个与之绑定的队列</li>
<li>Direct交换机根据RoutingKey判断路由给哪个队列</li>
<li>如果多个队列具有相同的RoutingKey，则与Fanout功能类似</li>
</ul>
<p>基于@RabbitListener注解声明队列和交换机有哪些常见注解？</p>
<ul>
<li>@Queue</li>
<li>@Exchange</li>
</ul>
<h2 id="3-6-Topic"><a href="#3-6-Topic" class="headerlink" title="3.6.Topic"></a>3.6.Topic</h2><h3 id="3-6-1-说明"><a href="#3-6-1-说明" class="headerlink" title="3.6.1.说明"></a>3.6.1.说明</h3><p><code>Topic</code>类型的<code>Exchange</code>与<code>Direct</code>相比，都是可以根据<code>RoutingKey</code>把消息路由到不同的队列。只不过<code>Topic</code>类型<code>Exchange</code>可以让队列在绑定<code>Routing key</code> 的时候使用通配符！</p>
<p><code>Routingkey</code> 一般都是有一个或多个单词组成，多个单词之间以”.”分割，例如： <code>item.insert</code></p>
<p> 通配符规则：</p>
<p><code>#</code>：匹配一个或多个词</p>
<p><code>*</code>：匹配不多不少恰好1个词</p>
<p>举例：</p>
<p><code>item.#</code>：能够匹配<code>item.spu.insert</code> 或者 <code>item.spu</code></p>
<p><code>item.*</code>：只能匹配<code>item.spu</code></p>
<p>​     </p>
<p>图示：</p>
<p> <img src="/2022/07/26/RabbitMQ/image-20210717170705380.png" alt="image-20210717170705380"></p>
<p>解释：</p>
<ul>
<li>Queue1：绑定的是<code>china.#</code> ，因此凡是以 <code>china.</code>开头的<code>routing key</code> 都会被匹配到。包括china.news和china.weather</li>
<li>Queue2：绑定的是<code>#.news</code> ，因此凡是以 <code>.news</code>结尾的 <code>routing key</code> 都会被匹配。包括china.news和japan.news</li>
</ul>
<p>案例需求：</p>
<p>实现思路如下：</p>
<ol>
<li><p>并利用@RabbitListener声明Exchange、Queue、RoutingKey</p>
</li>
<li><p>在consumer服务中，编写两个消费者方法，分别监听topic.queue1和topic.queue2</p>
</li>
<li><p>在publisher中编写测试方法，向itcast. topic发送消息</p>
</li>
</ol>
<p><img src="/2022/07/26/RabbitMQ/image-20210717170829229.png" alt="image-20210717170829229"></p>
<h3 id="3-6-2-消息发送"><a href="#3-6-2-消息发送" class="headerlink" title="3.6.2.消息发送"></a>3.6.2.消息发送</h3><p>在publisher服务的SpringAmqpTest类中添加测试方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * topicExchange</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSendTopicExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 交换机名称</span></span><br><span class="line">    String exchangeName = <span class="string">&quot;itcast.topic&quot;</span>;</span><br><span class="line">    <span class="comment">// 消息</span></span><br><span class="line">    String message = <span class="string">&quot;喜报！孙悟空大战哥斯拉，胜!&quot;</span>;</span><br><span class="line">    <span class="comment">// 发送消息</span></span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;china.news&quot;</span>, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-6-3-消息接收"><a href="#3-6-3-消息接收" class="headerlink" title="3.6.3.消息接收"></a>3.6.3.消息接收</h3><p>在consumer服务的SpringRabbitListener中添加方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = &quot;topic.queue1&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = &quot;itcast.topic&quot;, type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">    key = &quot;china.#&quot;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenTopicQueue1</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者接收到topic.queue1的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = &quot;topic.queue2&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = &quot;itcast.topic&quot;, type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">    key = &quot;#.news&quot;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenTopicQueue2</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者接收到topic.queue2的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-6-4-总结"><a href="#3-6-4-总结" class="headerlink" title="3.6.4.总结"></a>3.6.4.总结</h3><p>描述下Direct交换机与Topic交换机的差异？</p>
<ul>
<li>Topic交换机接收的消息RoutingKey必须是多个单词，以 <code>**.**</code> 分割</li>
<li>Topic交换机与队列绑定时的bindingKey可以指定通配符</li>
<li><code>#</code>：代表0个或多个词</li>
<li><code>*</code>：代表1个词</li>
</ul>
<h2 id="3-7-消息转换器"><a href="#3-7-消息转换器" class="headerlink" title="3.7.消息转换器"></a>3.7.消息转换器</h2><p>之前说过，Spring会把你发送的消息序列化为字节发送给MQ，接收消息的时候，还会把字节反序列化为Java对象。</p>
<p><img src="/2022/07/26/RabbitMQ/image-20200525170410401.png" alt="image-20200525170410401"></p>
<p>只不过，默认情况下Spring采用的序列化方式是JDK序列化。众所周知，JDK序列化存在下列问题：</p>
<ul>
<li>数据体积过大</li>
<li>有安全漏洞</li>
<li>可读性差</li>
</ul>
<p>我们来测试一下。</p>
<h3 id="3-7-1-测试默认转换器"><a href="#3-7-1-测试默认转换器" class="headerlink" title="3.7.1.测试默认转换器"></a>3.7.1.测试默认转换器</h3><p>我们修改消息发送的代码，发送一个Map对象：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSendMap</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="comment">// 准备消息</span></span><br><span class="line">    Map&lt;String,Object&gt; msg = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    msg.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Jack&quot;</span>);</span><br><span class="line">    msg.put(<span class="string">&quot;age&quot;</span>, <span class="number">21</span>);</span><br><span class="line">    <span class="comment">// 发送消息</span></span><br><span class="line">    rabbitTemplate.convertAndSend(<span class="string">&quot;simple.queue&quot;</span>,<span class="string">&quot;&quot;</span>, msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>停止consumer服务</p>
<p>发送消息后查看控制台：</p>
<p><img src="/2022/07/26/RabbitMQ/image-20210422232835363.png" alt="image-20210422232835363"></p>
<h3 id="3-7-2-配置JSON转换器"><a href="#3-7-2-配置JSON转换器" class="headerlink" title="3.7.2.配置JSON转换器"></a>3.7.2.配置JSON转换器</h3><p>显然，JDK序列化方式并不合适。我们希望消息体的体积更小、可读性更高，因此可以使用JSON方式来做序列化和反序列化。</p>
<p>在publisher和consumer两个服务中都引入依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>配置消息转换器。</p>
<p>在启动类中添加一个Bean即可：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> MessageConverter <span class="title">jsonMessageConverter</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Jackson2JsonMessageConverter();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>SpringCloud</category>
      </categories>
      <tags>
        <tag>SpringCloud</tag>
      </tags>
  </entry>
</search>
